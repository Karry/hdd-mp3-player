MPASM 03.90 Released                               HLAVNI.ASM   1-27-2006  14:36:03         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;   HLAVNI SOUBOR 
                      00002 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00003 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00004 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00005 ;  displej k MP3 PREPRCAVACi
                      00006 ; ================
                      00007 ; 
                      00008 ; prosinec 2005 Boga
                      00009 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00010 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00011 
                      00012 
                      00013 ;**********************************************************
                      00014 ;   VERZE 0.0000000
                      00015 ;**********************************************************
                      00016         LIST            p=PIC16f877,C=132,n=60
2007   3F3A           00017         __CONFIG        _WDT_OFF & _HS_OSC & _PWRTE_OFF & _BODEN_OFF & _LVP_OFF 
                      00018                         ; LVP_OFF = RB3 jako digitalni I/O
                      00019         errorlevel -302         ; vypnuti Message [302]: Register in operand not in bank 0.
                      00020                                                 ; ! zjednoduseni vypisu, ale riziko prehlednuti chyby
                      00021 ;**********************************************************
                      00022         include "P16F877A.inc"  ; definice blbosti kolem procesoru
                      00001         LIST
                      00002 ; P16F877A.INC  Standard Header File, Version 1.00    Microchip Technology, Inc.
                      00398         LIST
                      00023         include "displej.inc"   ; definice promennych, konstant a portu
  00000020            00001 TMP0    equ 0X020
  00000021            00002 TMP1    equ 0X021
  00000023            00003 TMP2    equ 0X023
  00000024            00004 TMP3    equ 0X024
  00000025            00005 TMP4    equ 0X025
  00000026            00006 TMP5    equ 0X026
                      00007 ;XXXXXXXXXXXXXXXX;DEFINICE BITÙ K DISPLEJI
                      00008 #DEFINE LCD_RS          PORTB,2
                      00009 #DEFINE LCD_RW          PORTB,1
                      00010 #DEFINE LCD_ENABLE      PORTB,0
                      00011 #DEFINE LCD_PODSVICENI          PORTC,5
                      00012 
                      00013 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00014 ; registry pro potreby preruseni + prace s prikazy (jsou totiz dostupne odkudkoliv)
  00000070            00015 TEMP_WORKING    equ 0x070
  00000071            00016 TEMP_STATUS             equ 0x071
  00000072            00017 TEMP_FSR                equ 0x072
  00000074            00018 PRIJATE_DATO    equ 0x074               ; pomocna promenna v preruseni
  00000076            00019 TEMP_PCLATH             equ 0x076
                      00020 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00021 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00022 ; MAKRA
                      00023 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00024 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00025 BANK_0  macro                                   ; prepnuti do banky 0 v pameti dat
                      00026                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
                      00027                 bcf     STATUS,RP0    
                      00028                 endm
MPASM 03.90 Released                               HLAVNI.ASM   1-27-2006  14:36:03         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00029 BANK_1  macro                                   ; prepnuti do banky 1 v pameti dat
                      00030                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
                      00031                 bsf     STATUS,RP0    
                      00032                 endm
                      00033 BANK_2  macro                                   ; prepnuti do banky 2 v pameti dat
                      00034                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
                      00035                 bcf     STATUS,RP0    
                      00036                 endm
                      00037 BANK_3  macro                                   ; prepnuti do banky 3 v pameti dat
                      00038                 bsf     STATUS,RP1              ; BANK3  RP1:RP0 = 11
                      00039                 bsf     STATUS,RP0    
                      00040                 endm
                      00041 ; INDF_BANK_x slouzi k prepinani bank pro neprime adresovani pomoci INDF a FSR
                      00042 INDF_BANK_0     macro               
                      00043                         bcf STATUS,IRP    
                      00044                         endm
                      00045 INDF_BANK_1     macro               
                      00046                         bcf STATUS,IRP    
                      00047                         endm
                      00048 INDF_BANK_2     macro             
                      00049                         bsf STATUS,IRP    
                      00050                         endm
                      00051 INDF_BANK_3     macro             
                      00052                         bsf STATUS,IRP    
                      00053                         endm
                      00054 ;**********************************************************
                      00055 PROG_PAGE_0     macro             
                      00056                         bcf PCLATH,3
                      00057                         bcf PCLATH,4
                      00058                         endm
                      00059 PROG_PAGE_1     macro             
                      00060                         bsf PCLATH,3
                      00061                         bcf PCLATH,4
                      00062                         endm
                      00063 PROG_PAGE_2     macro             
                      00064                         bcf PCLATH,3
                      00065                         bsf PCLATH,4
                      00066                         endm
                      00067 PROG_PAGE_3     macro             
                      00068                         bsf PCLATH,3
                      00069                         bsf PCLATH,4
                      00070                         endm
                      00071 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00024 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00025 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00026 ; PROGRAM
                      00027 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00028 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00029 ;**********************************************************
0010                  00030  org 0x0010
                      00031         include "lcd.asm"       ; podprogramy pro praci s LCD
                      00001 ;*******************************************************************************************************
                            *************
                      00002 ; RUTINY PRO PRACI S LCD
MPASM 03.90 Released                               HLAVNI.ASM   1-27-2006  14:36:03         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00003 ;*******************************************************************************************************
                            *************
0010                  00004 INIT_LCD
0010   2197           00005         call ZPOZ_20MS                  ; nez se ustali napeti
0011   2025           00006         call INIT8B
0012   2197           00007         call ZPOZ_20MS
0013   2025           00008         call INIT8B
0014   2197           00009         call ZPOZ_20MS
0015   2025           00010         call INIT8B
0016   2197           00011         call ZPOZ_20MS
0017   2025           00012         call INIT8B
0018   2197           00013         call ZPOZ_20MS
0019   2025           00014         call INIT8B
                      00015 
001A   2036           00016         call CZ_INI
                      00017 
001B   3006           00018         movlw b'00000110' 
001C   2083           00019         call ZAPISI
001D   3001           00020         movlw b'00000001' 
001E   2083           00021         call ZAPISI
001F   2181           00022         CALL ZPOZ_2MS
0020   0008           00023         return
                      00024 ;*******************************************************************************************************
                            *************
0021                  00025 SMAZ_LCD
0021   3001           00026         movlw b'00000001' 
0022   2083           00027         call ZAPISI
0023   2181           00028         CALL ZPOZ_2MS
0024   0008           00029         return
                      00030 ;*******************************************************************************************************
                            *************
0025                  00031 INIT8B: 
0025   3038           00032         movlw   b'00111000'     ; 8 - bit
0026   2083           00033         call    ZAPISI
0027   300F           00034         movlw   b'00001111'     ; LCD on, kurzor on,no blik 
0028   2083           00035         call    ZAPISI
0029   0008           00036         return
                      00037 ;*******************************************************************************************************
                            *************
002A                  00038 LCD_1RADEK
002A   3080           00039         movlw h'80'             ; adresa 00h - 0
002B   2083           00040         call ZAPISI
002C   0008           00041         return
                      00042 ;*******************************************************************************************************
                            *************
002D                  00043 LCD_2RADEK
002D   30AA           00044         movlw h'AA'             ; adresa 2Ah - 42
002E   2083           00045         call ZAPISI
002F   0008           00046         return
                      00047 ;**********************************************************
0030                  00048 LCD_3RADEK
0030   3090           00049         movlw h'90'             ; adresa 10h - 16
0031   2083           00050         call ZAPISI
0032   0008           00051         return
MPASM 03.90 Released                               HLAVNI.ASM   1-27-2006  14:36:03         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00052 ;**********************************************************
0033                  00053 LCD_4RADEK
0033   30D0           00054         movlw h'd0'             ; adresa 50h - 80
0034   2083           00055         call ZAPISI
0035   0008           00056         return
                      00057 ;**********************************************************
0036                  00058 CZ_INI  
0036   01A4           00059         clrf    TMP3            ; cislo bytu, ktery jsme naplnily do uzivatelske pameti LCD
0037   3040           00060         movlw   0x40            ; prvni adresa znaku v LCD displeji
0038   2083           00061         call    ZAPISI
0039                  00062 CZ_INI_2        
0039   0824           00063         movf    TMP3,W
003A   2042           00064         call    TAB_CZ
003B   20A0           00065         call    ZAPISD
003C   0AA4           00066         incf    TMP3,F
003D   3040           00067         movlw   0x40            ; až ADRESA dosáhne 40h tak je konec
003E   0224           00068         subwf   TMP3,W
003F   1D03           00069         btfss   STATUS,Z
0040   2839           00070         goto    CZ_INI_2
                      00071 
0041   0008           00072         return
                      00073 ;**********************************************************
0042                  00074 TAB_CZ  
0042   0782           00075         addwf   PCL,F           ; definování ceských znaku pro LCD
                      00076 
                      00077         ; znak0 = 40h   á
0043   3402           00078         retlw   0x02    ; '      X '
0044   3404           00079         retlw   0x04    ; '     X  '
0045   341E           00080         retlw   0x1E    ; '   XXXX '
0046   3401           00081         retlw   0x01    ; '       X'
0047   340F           00082         retlw   0x0F    ; '    XXXX'
0048   3411           00083         retlw   0x11    ; '   X   X'
0049   340F           00084         retlw   0x0F    ; '    XXXX'
004A   3400           00085         retlw   0x00    ; '        '
                      00086         
                      00087         ; znak1 = 48h   í
004B   3402           00088         retlw   0x02    ; '      X '
004C   3404           00089         retlw   0x04    ; '     X  '
004D   340C           00090         retlw   0x0C    ; '    XX  '
004E   3404           00091         retlw   0x04    ; '     X  '
004F   3404           00092         retlw   0x04    ; '     X  '
0050   3404           00093         retlw   0x04    ; '     X  '
0051   340E           00094         retlw   0x0E    ; '    XXX '
0052   3400           00095         retlw   0x00    ; '        '
                      00096 
                      00097         ; znak2 = 50h   e s hackem
0053   340A           00098         retlw   0x0A    ; '    X X '
0054   3404           00099         retlw   0x04    ; '     X  '
0055   340E           00100         retlw   0x0E    ; '    XXX '
0056   3411           00101         retlw   0x11    ; '   X   X'
0057   341F           00102         retlw   0x1F    ; '   XXXXX'
0058   3410           00103         retlw   0x10    ; '   X    '
0059   340E           00104         retlw   0x0E    ; '    XXX '
005A   3400           00105         retlw   0x00    ; '        '
MPASM 03.90 Released                               HLAVNI.ASM   1-27-2006  14:36:03         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00106 
                      00107         ; znak3 = 58h   š
005B   340A           00108         retlw   0x0A    ; '    X X '
005C   3404           00109         retlw   0x04    ; '     X  '
005D   340E           00110         retlw   0x0E    ; '    XXX '
005E   3410           00111         retlw   0x10    ; '   X    '
005F   340E           00112         retlw   0x0E    ; '    XXX '
0060   3401           00113         retlw   0x01    ; '       X'
0061   341E           00114         retlw   0x1E    ; '   XXXX '
0062   3400           00115         retlw   0x00    ; '        '
                      00116 
                      00117         ; znak4 = 60h   c s hackem
0063   340A           00118         retlw   0x0A    ; '    X X '
0064   3404           00119         retlw   0x04    ; '     X  '
0065   340E           00120         retlw   0x0E    ; '    XXX '
0066   3410           00121         retlw   0x10    ; '   X    '
0067   3410           00122         retlw   0x10    ; '   X    '
0068   3411           00123         retlw   0x11    ; '   X   X'
0069   340E           00124         retlw   0x0E    ; '    XXX '
006A   3400           00125         retlw   0x00    ; '        '
                      00126 
                      00127         ; znak5 = 68h   r s hackem
006B   340A           00128         retlw   0x0A    ; '    X X '
006C   3404           00129         retlw   0x04    ; '     X  '
006D   3416           00130         retlw   0x16    ; '   X XX '
006E   3419           00131         retlw   0x19    ; '   XX  X'
006F   3410           00132         retlw   0x10    ; '   X    '
0070   3410           00133         retlw   0x10    ; '   X    '
0071   3410           00134         retlw   0x10    ; '   X    '
0072   3400           00135         retlw   0x00    ; '        '
                      00136 
                      00137         ; znak6 = 70h   z s hackem
0073   340A           00138         retlw   0x0A    ; '    X X '
0074   3404           00139         retlw   0x04    ; '     X  '
0075   341F           00140         retlw   0x1F    ; '   XXXXX'
0076   3402           00141         retlw   0x02    ; '      X '
0077   3404           00142         retlw   0x04    ; '     X  '
0078   3408           00143         retlw   0x08    ; '    X   '
0079   341F           00144         retlw   0x1F    ; '   XXXXX'
007A   3400           00145         retlw   0x00    ; '        '
                      00146 
                      00147         ; znak7 = 78h   ý
007B   3402           00148         retlw   0x02    ; '      X '
007C   3404           00149         retlw   0x04    ; '     X  '
007D   3411           00150         retlw   0x11    ; '   X   X'
007E   3411           00151         retlw   0x11    ; '   X   X'
007F   340F           00152         retlw   0x0F    ; '    XXXX'
0080   3401           00153         retlw   0x01    ; '       X'
0081   340E           00154         retlw   0x0E    ; '    XXX '
0082   3400           00155         retlw   0x00    ; '        '
                      00156 ;************************************************
0083                  00157 ZAPISI  
                      00158         ; krystal 20MHz => instrukce = 200ns
0083   1106           00159         BCF LCD_RS                      ; RS na  RB2 je 0 - instrukce
MPASM 03.90 Released                               HLAVNI.ASM   1-27-2006  14:36:03         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0084   1086           00160         BCF LCD_RW                      ; R/W na RB1 je 0 - zapis
0085   0000           00161         nop                                     ; Tas min 140ns
0086   0088           00162         MOVWF   PORTD
0087   0000           00163         nop
0088   0000           00164         nop
0089   0000           00165         nop
008A   0000           00166         nop
008B   0000           00167         nop
008C   0000           00168         nop
008D   0000           00169         nop
008E   0000           00170         nop
008F   0000           00171         nop
0090   0000           00172         nop
0091   1406           00173         BSF LCD_ENABLE
0092   0000           00174         NOP
0093   0000           00175         NOP
0094   0000           00176         nop
0095   0000           00177         nop
0096   0000           00178         NOP                                     ; ENABLE slespon 450ns v log1
0097   1006           00179         bcf LCD_ENABLE
0098   0000           00180         NOP
0099   0000           00181         NOP
009A   0000           00182         nop
009B   0000           00183         nop
009C   0000           00184         NOP
009D   1406           00185         bsf LCD_ENABLE
                      00186 
009E   21A9           00187         CALL ZPOZ_50US      ; zpozdeni 50 uS na vykonani instrukce
009F   0008           00188         RETURN
                      00189 ;**********************************************************
00A0                  00190 ZAPISD  
                      00191         ; krystal 20MHz => instrukce = 200ns
00A0   1506           00192         BSF LCD_RS                      ; RS na  RB2 je 1 - DATA
00A1   1086           00193         BCF LCD_RW                      ; R/W na RB1 je 0 - zapis
00A2   0000           00194         nop                                     ; Tas min 140ns
00A3   0088           00195         MOVWF   PORTD
00A4   0000           00196         nop
00A5   0000           00197         nop
00A6   0000           00198         nop
00A7   0000           00199         nop
00A8   0000           00200         nop
00A9   0000           00201         nop
00AA   0000           00202         nop
00AB   0000           00203         nop
00AC   0000           00204         nop
00AD   0000           00205         nop
00AE   1406           00206         BSF LCD_ENABLE
00AF   0000           00207         NOP
00B0   0000           00208         NOP
00B1   0000           00209         nop
00B2   0000           00210         nop
00B3   0000           00211         NOP                                     ; ENABLE slespon 450ns v log1
00B4   1006           00212         bcf LCD_ENABLE
00B5   0000           00213         NOP
MPASM 03.90 Released                               HLAVNI.ASM   1-27-2006  14:36:03         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00B6   0000           00214         NOP
00B7   0000           00215         nop
00B8   0000           00216         nop
00B9   0000           00217         NOP
                      00218         ;bsf LCD_ENABLE
                      00219 
00BA   21A9           00220         CALL ZPOZ_50US      ; zpozdeni 50 uS na zapis data
00BB   0008           00221         RETURN
                      00222 ;**********************************************************
                      00032         include "displej.asm"   ; podprogramy na ovladani mp3 decoderu
                      00001 ; ceske znaky na LCD: áíešcrzý
00BC                  00002 START
00BC   214F           00003         CALL INIT_CONFIG        ; nakonfiguruje preruseni, WDT, USART, pull ups...
00BD   2140           00004         call INIT_PORT
00BE   2010           00005         call INIT_LCD
                      00006 
00BF   3031           00007         MOVLW '1'
00C0   20A0           00008         CALL ZAPISD
00C1   302E           00009         MOVLW '.'
00C2   20A0           00010         CALL ZAPISD
00C3   3020           00011         MOVLW ' '
00C4   20A0           00012         CALL ZAPISD
00C5   3005           00013         MOVLW .5
00C6   20A0           00014         CALL ZAPISD
00C7   3000           00015         MOVLW .0
00C8   20A0           00016         CALL ZAPISD
00C9   3064           00017         MOVLW 'd'
00CA   20A0           00018         CALL ZAPISD
00CB   3065           00019         MOVLW 'e'
00CC   20A0           00020         CALL ZAPISD
00CD   306B           00021         MOVLW 'k'
00CE   20A0           00022         CALL ZAPISD
                      00023 
00CF   202D           00024         call LCD_2RADEK
00D0   3032           00025         MOVLW '2'
00D1   20A0           00026         CALL ZAPISD
00D2   302E           00027         MOVLW '.'
00D3   20A0           00028         CALL ZAPISD
00D4   3020           00029         MOVLW ' '
00D5   20A0           00030         CALL ZAPISD
00D6   3005           00031         MOVLW .5
00D7   20A0           00032         CALL ZAPISD
00D8   3000           00033         MOVLW .0
00D9   20A0           00034         CALL ZAPISD
00DA   3064           00035         MOVLW 'd'
00DB   20A0           00036         CALL ZAPISD
00DC   3065           00037         MOVLW 'e'
00DD   20A0           00038         CALL ZAPISD
00DE   306B           00039         MOVLW 'k'
00DF   20A0           00040         CALL ZAPISD
                      00041 
00E0   2030           00042         call LCD_3RADEK
00E1   3033           00043         MOVLW '3'
00E2   20A0           00044         CALL ZAPISD
MPASM 03.90 Released                               HLAVNI.ASM   1-27-2006  14:36:03         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00E3   302E           00045         MOVLW '.'
00E4   20A0           00046         CALL ZAPISD
00E5   3020           00047         MOVLW ' '
00E6   20A0           00048         CALL ZAPISD
00E7   3005           00049         MOVLW .5
00E8   20A0           00050         CALL ZAPISD
00E9   3000           00051         MOVLW .0
00EA   20A0           00052         CALL ZAPISD
00EB   3064           00053         MOVLW 'd'
00EC   20A0           00054         CALL ZAPISD
00ED   3065           00055         MOVLW 'e'
00EE   20A0           00056         CALL ZAPISD
00EF   306B           00057         MOVLW 'k'
00F0   20A0           00058         CALL ZAPISD
                      00059 
00F1   2033           00060         call LCD_4RADEK
00F2   3034           00061         MOVLW '4'
00F3   20A0           00062         CALL ZAPISD
00F4   302E           00063         MOVLW '.'
00F5   20A0           00064         CALL ZAPISD
00F6   3020           00065         MOVLW ' '
00F7   20A0           00066         CALL ZAPISD
00F8   3005           00067         MOVLW .5
00F9   20A0           00068         CALL ZAPISD
00FA   3000           00069         MOVLW .0
00FB   20A0           00070         CALL ZAPISD
00FC   3064           00071         MOVLW 'd'
00FD   20A0           00072         CALL ZAPISD
00FE   3065           00073         MOVLW 'e'
00FF   20A0           00074         CALL ZAPISD
0100   306B           00075         MOVLW 'k'
0101   20A0           00076         CALL ZAPISD
                      00077 
0102   2174           00078         call ZPOZ_1S
0103   2174           00079         call ZPOZ_1S
0104   2174           00080         call ZPOZ_1S
0105   2174           00081         call ZPOZ_1S
0106   2174           00082         call ZPOZ_1S
                      00083         
0107   2021           00084         call SMAZ_LCD
0108   202A           00085         call LCD_1RADEK
                      00086         ; ted zobrazim na LCD ceske znaky....
                      00087 ; ceske znaky na LCD: áíešcrzý
0109   3004           00088         movlw   .4
010A   20A0           00089         call    ZAPISD
010B   3065           00090         movlw   'e'
010C   20A0           00091         call    ZAPISD
010D   3073           00092         movlw   's'
010E   20A0           00093         call    ZAPISD
010F   306B           00094         movlw   'k'
0110   20A0           00095         call    ZAPISD
0111   3002           00096         movlw   .2
0112   20A0           00097         call    ZAPISD
0113   3020           00098         movlw   ' '
MPASM 03.90 Released                               HLAVNI.ASM   1-27-2006  14:36:03         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0114   20A0           00099         call    ZAPISD
0115   307A           00100         movlw   'z'
0116   20A0           00101         call    ZAPISD
0117   306E           00102         movlw   'n'
0118   20A0           00103         call    ZAPISD
0119   3061           00104         movlw   'a'
011A   20A0           00105         call    ZAPISD
011B   306B           00106         movlw   'k'
011C   20A0           00107         call    ZAPISD
011D   3079           00108         movlw   'y'
011E   20A0           00109         call    ZAPISD
011F   303A           00110         movlw   ':'
0120   20A0           00111         call    ZAPISD
                      00112 
0121   202D           00113         call LCD_2RADEK
0122   3000           00114         movlw   00h
0123   20A0           00115         call    ZAPISD
0124   3001           00116         movlw   01h
0125   20A0           00117         call    ZAPISD
0126   3002           00118         movlw   02h
0127   20A0           00119         call    ZAPISD
0128   3003           00120         movlw   03h
0129   20A0           00121         call    ZAPISD
012A   3004           00122         movlw   04h
012B   20A0           00123         call    ZAPISD
012C   3005           00124         movlw   05h
012D   20A0           00125         call    ZAPISD
012E   3006           00126         movlw   06h
012F   20A0           00127         call    ZAPISD
0130   3007           00128         movlw   07h
0131   20A0           00129         call    ZAPISD
                      00130 
0132   2174           00131         call ZPOZ_1S
0133   2174           00132         call ZPOZ_1S
0134   2174           00133         call ZPOZ_1S
0135   2174           00134         call ZPOZ_1S
0136   2174           00135         call ZPOZ_1S
                      00136         
0137   2021           00137         call SMAZ_LCD
0138   202A           00138         call LCD_1RADEK
0139   01A6           00139         clrf TMP5
013A   1687           00140         bsf LCD_PODSVICENI
013B                  00141 SMYCKA
013B   0826           00142         movfw TMP5
013C   20A0           00143         call ZAPISD
013D   218A           00144         call ZPOZ_300MS
013E   0AA6           00145         incf TMP5,f     
013F   293B           00146         GOTO SMYCKA
                      00147 ;*******************************************************************************************************
                            *************
                      00148 ; CEKACI SMYCKY
                      00149 ;       call ZPOZ_1S
                      00150 ;       call ZPOZ_300MS
                      00151 ;       call ZPOZ_100US
MPASM 03.90 Released                               HLAVNI.ASM   1-27-2006  14:36:03         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00152 ;       call ZPOZ_10US
                      00153 ;*******************************************************************************************************
                            *************
0140                  00154 INIT_PORT
                      00155         BANK_1
0140   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0141   1683               M                 bsf     STATUS,RP0    
0142   30FF           00156         MOVLW 0xff
0143   0085           00157         MOVWF TRISA
0144   30F8           00158         MOVLW B'11111000'
0145   0086           00159     MOVWF TRISB
0146   30DF           00160         MOVLW B'11011111'
0147   0087           00161         MOVWF TRISC
0148   3000           00162         MOVLW B'00000000'
0149   0088           00163         MOVWF TRISD
014A   3003           00164         MOVLW 0x03
014B   0089           00165         MOVWF TRISE
                      00166         BANK_0
014C   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
014D   1283               M                 bcf     STATUS,RP0    
014E   0008           00167         RETURN
                      00168 ;**********************************************************
014F                  00169 INIT_CONFIG     ; nakonfiguruje preruseni, WDT, USART, pull ups....
                      00170         BANK_1
014F   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0150   1683               M                 bsf     STATUS,RP0    
0151   30C7           00171         MOVLW b'11000111'       ; ...pull up a podobny koniny
                      00172                 ; PORTB Pull-up Enable bit              1 = pull up enabled
                      00173                 ; Interrupt Edge Select bit             1 = interrupt on rising edge of RB0/INT pin
                      00174                 ; TMR0 Clock Source Select bit  0 = Internal instruction cycle clock (CLKO)
                      00175                 ; TMR0 Source Edge Select bit   0 = Increment on low-to-high transition on RA4/T0CKI pin
                      00176                 ; Prescaler Assignment bit              0 = Prescaler is assigned to the Timer0 module
                      00177                 ; PS2:PS0: Prescaler Rate Select bits   111 = TMR0 Rate 1 : 256; WDT Rate 1 : 128
0152   0081           00178         MOVWF OPTION_REG
                      00179         
0153   3020           00180         MOVLW b'00100000'       ; povolime preruseni od USARTu (kdyz neco dostanem)
0154   3000           00181         MOVLW b'00000000'       ; povolime preruseni od USARTu (kdyz neco dostanem)
0155   008C           00182         MOVWF PIE1      
0156   3000           00183         MOVLW b'00000000'       ; ostatni vnejsi preruseni vymaskujeme
0157   008D           00184         MOVWF PIE2                      
                      00185 
0158   30C0           00186         MOVLW b'11000000'       ; povolime preruseni na vnejsi zarizeni (USART)                         
0159   008B           00187         MOVWF INTCON
                      00188 
015A   3026           00189         MOVLW b'00100110'       ;konfigurace USARTu (asynchronni, 8bit, bez parity, rychle - (BRGH = 1))
015B   0098           00190         MOVWF TXSTA
                      00191         BANK_0
015C   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
015D   1283               M                 bcf     STATUS,RP0    
015E   3090           00192         MOVLW b'10010000'       ;zapnu USART
015F   0098           00193         MOVWF RCSTA
                      00194         BANK_1
0160   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0161   1683               M                 bsf     STATUS,RP0    
MPASM 03.90 Released                               HLAVNI.ASM   1-27-2006  14:36:03         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0162   3081           00195         MOVLW .129              ; Fosc = 20 MHz, BRGH=1 => rychlost = 9615 bps
                      00196         ;MOVLW .103                     ; Fosc = 16 MHz, BRGH=1 => rychlost = 9615 bps
0163   0099           00197         MOVWF SPBRG     
                      00198 
0164   3007           00199         MOVLW b'00000111'
0165   009F           00200         MOVWF ADCON1            ; vsechny vstupy (RA,RE) jako digitalni
                      00201         BANK_0  
0166   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0167   1283               M                 bcf     STATUS,RP0    
0168   019F           00202         CLRF ADCON0                     ; pro jistotu (vypneme A/D prevodniky)
                      00203 
0169   0008           00204         RETURN
                      00205 ;**********************************************************
                      00206 ;**********************************************************
016A                  00207 INTERRUPT                                       ; sem se skace po zavolani preruseni (uz jsou vyreseny u
                            lohy dulezitych registru)
016A   1E8C           00208         btfss PIR1,RCIF                 ; Meli bychom mit povoleno sice jen jedno preruseni (od USARTU),
                             jeden ale nikdy nevi, proto ten test
016B   296C           00209         goto END_OF_INTERRUPT   ; Pokud nejde o preruseni od USARTU, tak koncime...
016C                  00210 END_OF_INTERRUPT                        ; sem skocime kdyz mame vsechny veci kolem preruseni vyrizeny
016C   0876           00211         movfw TEMP_PCLATH
016D   008A           00212         MOVWF PCLATH
016E   0872           00213         movfw TEMP_FSR
016F   0084           00214         MOVWF FSR
0170   0871           00215         movfw TEMP_STATUS
0171   0083           00216         MOVWF STATUS
0172   0870           00217         movfw TEMP_WORKING
0173   0009           00218         retfie
                      00219 ;**********************************************************
0174                  00220 ZPOZ_1S ;Delay 4999999 cycles
0174   301A           00221         MOVLW 0x1A  ;26 DEC
0175   00A3           00222         MOVWF TMP2
0176   305E           00223         MOVLW 0x5E  ;94 DEC
0177   00A1           00224         MOVWF TMP1
0178   306E           00225         MOVLW 0x6E  ;110 DEC
0179   00A0           00226         MOVWF TMP0
017A   0BA0           00227         DECFSZ TMP0,F
017B   297A           00228         GOTO $-1
017C   0BA1           00229         DECFSZ TMP1,F
017D   297A           00230         GOTO $-3
017E   0BA3           00231         DECFSZ TMP2,F
017F   297A           00232         GOTO $-5
0180   0008           00233                 RETURN
                      00234 ;**********************************************************
0181                  00235 ZPOZ_2MS
                      00236 ;Variables: TMP1, TMP0
                      00237 ;Delay 10001 cycles
0181   3010           00238         MOVLW 0x10  ;16 DEC
0182   00A1           00239         MOVWF TMP1
0183   30CF           00240         MOVLW 0x0CF  ;207 DEC
0184   00A0           00241         MOVWF TMP0
0185   0BA0           00242         DECFSZ TMP0,F
0186   2985           00243         GOTO $-1
0187   0BA1           00244         DECFSZ TMP1,F
MPASM 03.90 Released                               HLAVNI.ASM   1-27-2006  14:36:03         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0188   2983           00245         GOTO $-5
                      00246 ;End of Delay
0189   0008           00247                 RETURN
                      00248 ;**********************************************************
018A                  00249 ZPOZ_300MS
                      00250 ;Variables: TMP2, TMP1, TMP0
                      00251 ;Delay 1 500 001 cycles
018A   3008           00252         MOVLW 0x08  ;8 DEC
018B   00A3           00253         MOVWF TMP2
018C   309D           00254         MOVLW 0x9D  ;157 DEC
018D   00A1           00255         MOVWF TMP1
018E   3006           00256         MOVLW 0x06  ;6 DEC
018F   00A0           00257         MOVWF TMP0
0190   0BA0           00258         DECFSZ TMP0,F
0191   2990           00259         GOTO $-1
0192   0BA1           00260         DECFSZ TMP1,F
0193   2990           00261         GOTO $-3
0194   0BA3           00262         DECFSZ TMP2,F
0195   2990           00263         GOTO $-5
                      00264 ;End of Delay
0196   0008           00265                 RETURN
                      00266 ;**********************************************************
0197                  00267 ZPOZ_20MS
                      00268 ;Variables: TMP1, TMP0
                      00269 ;Delay 100001 cycles
0197   30A0           00270         MOVLW 0x0A0  ;160 DEC
0198   00A1           00271         MOVWF TMP1
0199   30CF           00272         MOVLW 0x0CF  ;207 DEC
019A   00A0           00273         MOVWF TMP0
019B   0BA0           00274         DECFSZ TMP0,F
019C   299B           00275         GOTO $-1
019D   0BA1           00276         DECFSZ TMP1,F
019E   2999           00277         GOTO $-5
                      00278 ;End of Delay
019F   0008           00279         return
                      00280 ;**********************************************************
01A0                  00281 ZPOZ_100US ;Delay 500 cycles
01A0   3001           00282         MOVLW 0x01  ;1 DEC
01A1   00A1           00283         MOVWF TMP1
01A2   30A5           00284         MOVLW 0x0A5  ;165 DEC
01A3   00A0           00285         MOVWF TMP0
01A4   0BA0           00286         DECFSZ TMP0,F
01A5   29A4           00287         GOTO $-1
01A6   0BA1           00288         DECFSZ TMP1,F
01A7   29A4           00289         GOTO $-3
01A8   0008           00290                 RETURN
                      00291 ;**********************************************************
01A9                  00292 ZPOZ_50US
                      00293 ;Variable: TMP0
                      00294 ;Delay 250 cycles
01A9   3053           00295         MOVLW 0x53  ;83 DEC
01AA   00A0           00296         MOVWF TMP0
01AB   0BA0           00297         DECFSZ TMP0,F
01AC   29AB           00298         GOTO $-1
MPASM 03.90 Released                               HLAVNI.ASM   1-27-2006  14:36:03         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00299 ;End of Delay
01AD   0008           00300                 RETURN
                      00301 ;**********************************************************
                      00033 ;**********************************************************
0000                  00034  org 0x0000
0000   28BC           00035         goto START
0004                  00036  org 0x0004
0004   00F0           00037         movwf TEMP_WORKING
0005   0803           00038         movfw STATUS
0006   00F1           00039         movwf TEMP_STATUS
0007   0804           00040         movfw FSR
0008   00F2           00041         movwf TEMP_FSR
0009   080A           00042         movfw PCLATH
000A   00F6           00043         movwf TEMP_PCLATH
000B   018A           00044         clrf PCLATH
                      00045         BANK_0
000C   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
000D   1283               M                 bcf     STATUS,RP0    
                      00046         INDF_BANK_0
000E   1383               M                         bcf STATUS,IRP    
000F   296A           00047         goto INTERRUPT
                      00048 ;**********************************************************
                      00049         END
MPASM 03.90 Released                               HLAVNI.ASM   1-27-2006  14:36:03         PAGE 14


SYMBOL TABLE
  LABEL                             VALUE 

ACKDT                             00000005
ACKEN                             00000004
ACKSTAT                           00000006
ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000006
ADCS1                             00000007
ADDEN                             00000003
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
BANK_0                            
BANK_1                            
BANK_2                            
BANK_3                            
BCLIE                             00000003
BCLIF                             00000003
BF                                00000000
BRGH                              00000002
C                                 00000000
C1INV                             00000004
C1OUT                             00000006
C2INV                             00000005
C2OUT                             00000007
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCP2CON                           0000001D
CCP2IE                            00000000
CCP2IF                            00000000
CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCP2X                             00000005
CCP2Y                             00000004
CCPR1H                            00000016
CCPR1L                            00000015
CCPR2H                            0000001C
CCPR2L                            0000001B
CHS0                              00000003
CHS1                              00000004
CHS2                              00000005
CIS                               00000003
CKE                               00000006
MPASM 03.90 Released                               HLAVNI.ASM   1-27-2006  14:36:03         PAGE 15


SYMBOL TABLE
  LABEL                             VALUE 

CKP                               00000004
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON                             0000009C
CMIE                              00000006
CMIF                              00000006
CREN                              00000004
CSRC                              00000007
CVR0                              00000000
CVR1                              00000001
CVR2                              00000002
CVR3                              00000003
CVRCON                            0000009D
CVREN                             00000007
CVROE                             00000006
CVRR                              00000005
CZ_INI                            00000036
CZ_INI_2                          00000039
D                                 00000005
DATA_ADDRESS                      00000005
DC                                00000001
D_A                               00000005
EEADR                             0000010D
EEADRH                            0000010F
EECON1                            0000018C
EECON2                            0000018D
EEDATA                            0000010C
EEDATH                            0000010E
EEIE                              00000004
EEIF                              00000004
EEPGD                             00000007
END_OF_INTERRUPT                  0000016C
F                                 00000001
FERR                              00000002
FSR                               00000004
GCEN                              00000007
GIE                               00000007
GO                                00000002
GO_DONE                           00000002
I2C_DATA                          00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
IBF                               00000007
IBOV                              00000005
INDF                              00000000
INDF_BANK_0                       
INDF_BANK_1                       
INDF_BANK_2                       
INDF_BANK_3                       
INIT8B                            00000025
INIT_CONFIG                       0000014F
INIT_LCD                          00000010
MPASM 03.90 Released                               HLAVNI.ASM   1-27-2006  14:36:03         PAGE 16


SYMBOL TABLE
  LABEL                             VALUE 

INIT_PORT                         00000140
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTERRUPT                         0000016A
INTF                              00000001
IRP                               00000007
LCD_1RADEK                        0000002A
LCD_2RADEK                        0000002D
LCD_3RADEK                        00000030
LCD_4RADEK                        00000033
LCD_ENABLE                        PORTB,0
LCD_PODSVICENI                    PORTC,5
LCD_RS                            PORTB,2
LCD_RW                            PORTB,1
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BO                            00000000
NOT_BOR                           00000000
NOT_DONE                          00000002
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RC8                           00000006
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_TX8                           00000006
NOT_W                             00000002
NOT_WRITE                         00000002
OBF                               00000006
OERR                              00000001
OPTION_REG                        00000081
P                                 00000004
PCFG0                             00000000
PCFG1                             00000001
PCFG2                             00000002
PCFG3                             00000003
PCL                               00000002
PCLATH                            0000000A
PCON                              0000008E
PEIE                              00000006
PEN                               00000002
PIE1                              0000008C
PIE2                              0000008D
PIR1                              0000000C
PIR2                              0000000D
PORTA                             00000005
PORTB                             00000006
PORTC                             00000007
PORTD                             00000008
PORTE                             00000009
PR2                               00000092
PRIJATE_DATO                      00000074
PROG_PAGE_0                       
MPASM 03.90 Released                               HLAVNI.ASM   1-27-2006  14:36:03         PAGE 17


SYMBOL TABLE
  LABEL                             VALUE 

PROG_PAGE_1                       
PROG_PAGE_2                       
PROG_PAGE_3                       
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PSPIE                             00000007
PSPIF                             00000007
PSPMODE                           00000004
R                                 00000002
RBIE                              00000003
RBIF                              00000000
RC8_9                             00000006
RC9                               00000006
RCD8                              00000000
RCEN                              00000003
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
READ_WRITE                        00000002
RP0                               00000005
RP1                               00000006
RSEN                              00000001
RX9                               00000006
RX9D                              00000000
R_W                               00000002
S                                 00000003
SEN                               00000000
SMAZ_LCD                          00000021
SMP                               00000007
SMYCKA                            0000013B
SPBRG                             00000099
SPEN                              00000007
SREN                              00000005
SSPADD                            00000093
SSPBUF                            00000013
SSPCON                            00000014
SSPCON2                           00000091
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPOV                             00000006
SSPSTAT                           00000094
START                             000000BC
STATUS                            00000003
SYNC                              00000004
T0CS                              00000005
MPASM 03.90 Released                               HLAVNI.ASM   1-27-2006  14:36:03         PAGE 18


SYMBOL TABLE
  LABEL                             VALUE 

T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1INSYNC                          00000002
T1OSCEN                           00000003
T1SYNC                            00000002
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TAB_CZ                            00000042
TEMP_FSR                          00000072
TEMP_PCLATH                       00000076
TEMP_STATUS                       00000071
TEMP_WORKING                      00000070
TMP0                              00000020
TMP1                              00000021
TMP2                              00000023
TMP3                              00000024
TMP4                              00000025
TMP5                              00000026
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000085
TRISB                             00000086
TRISC                             00000087
TRISD                             00000088
TRISE                             00000089
TRISE0                            00000000
TRISE1                            00000001
TRISE2                            00000002
TRMT                              00000001
TX8_9                             00000006
TX9                               00000006
TX9D                              00000000
TXD8                              00000000
TXEN                              00000005
MPASM 03.90 Released                               HLAVNI.ASM   1-27-2006  14:36:03         PAGE 19


SYMBOL TABLE
  LABEL                             VALUE 

TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
UA                                00000001
W                                 00000000
WCOL                              00000007
WR                                00000001
WREN                              00000002
WRERR                             00000003
Z                                 00000002
ZAPISD                            000000A0
ZAPISI                            00000083
ZPOZ_100US                        000001A0
ZPOZ_1S                           00000174
ZPOZ_20MS                         00000197
ZPOZ_2MS                          00000181
ZPOZ_300MS                        0000018A
ZPOZ_50US                         000001A9
_BODEN_OFF                        00003FBF
_BODEN_ON                         00003FFF
_CPD_OFF                          00003FFF
_CPD_ON                           00003EFF
_CP_ALL                           00001FFF
_CP_OFF                           00003FFF
_DEBUG_OFF                        00003FFF
_DEBUG_ON                         000037FF
_HS_OSC                           00003FFE
_LP_OSC                           00003FFC
_LVP_OFF                          00003F7F
_LVP_ON                           00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC                           00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_WRT_1FOURTH                      00003BFF
_WRT_256                          00003DFF
_WRT_HALF                         000039FF
_WRT_OFF                          00003FFF
_XT_OSC                           00003FFD
__16F877A                         00000001
MPASM 03.90 Released                               HLAVNI.ASM   1-27-2006  14:36:03         PAGE 20


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)


0000 : X---XXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0180 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXX-- ----------------
2000 : -------X-------- ---------------- ---------------- ----------------

All other memory blocks unused.

Program Memory Words Used:   427
Program Memory Words Free:  7765


Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     0 reported,    11 suppressed

