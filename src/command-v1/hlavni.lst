MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;   HLAVNI SOUBOR 
                      00002 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00003 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00004 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00005 ;  displej k MP3 PREPRCAVACi
                      00006 ; ================
                      00007 ; 
                      00008 ; prosinec 2005 - brezen 2006 Boga
                      00009 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00010 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00011 
                      00012 
                      00013 ;**********************************************************
                      00014 ;   VERZE 0.2
                      00015 ;**********************************************************
                      00016         LIST            p=PIC16f877,C=132,n=60
2007   3F3A           00017         __CONFIG        _WDT_OFF & _HS_OSC & _PWRTE_OFF & _BODEN_OFF & _LVP_OFF 
                      00018                         ; LVP_OFF = RB3 jako digitalni I/O
                      00019         errorlevel -302 ; vypnuti Message [302]: Register in operand not in bank 0.
                      00020                                                 ; ! zjednoduseni vypisu, ale riziko prehlednuti chyby
                      00021 ;**********************************************************
                      00022         include "eeprom.inc"    ; definice blbosti kolem procesoru
                      00001         ; znak0 = 40h   á
                      00002         ; znak1 = 48h   í
                      00003         ; znak2 = 50h   e s hackem
                      00004         ; znak3 = 58h   š
                      00005         ; znak4 = 60h   c s hackem
                      00006         ; znak5 = 68h   r s hackem
                      00007         ; znak6 = 70h   z s hackem
                      00008         ; znak7 = 78h   ý
                      00009 
                      00010 ; prevodni tabulka pro vypisovani na LCD
                      00011 ; snaky s diakritikou se prevadeji na nediakriticke 
                      00012 ; (krome 8 uzivatelsky definovanych v LCD)
                      00013 ; .0    -> h'FF'        / konec retezce
                      00014 ; .193  -> h'00'        / velke A s carkou
                      00015 ; .225  -> h'00'        / male a s carkou
                      00016 
2100                  00017         org     0x2100          ; tabulka v pameti EEPROM (256 bytu)
2100   00FF 0001 0002 00018         de      0xFF, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07
       0003 0004 0005 
       0006 0007 
2108   0008 0009 000A 00019         de      0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F
       000B 000C 000D 
       000E 000F 
2110   0010 0011 0012 00020         de      0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17
       0013 0014 0015 
       0016 0017 
2118   0018 0019 001A 00021         de      0x18, 0x19, 0x1A, 0x1B, 0x1C, 0x1D, 0x1E, 0x1F
       001B 001C 001D 
       001E 001F 
2120   0020 0021 0022 00022         de      0x20, 0x21, 0x22, 0x23, 0x24, 0x25, 0x26, 0x27
       0023 0024 0025 
       0026 0027 
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

2128   0028 0029 002A 00023         de      0x28, 0x29, 0x2A, 0x2B, 0x2C, 0x2D, 0x2E, 0x2F
       002B 002C 002D 
       002E 002F 
2130   0030 0031 0032 00024         de      0x30, 0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37
       0033 0034 0035 
       0036 0037 
2138   0038 0039 003A 00025         de      0x38, 0x39, 0x3A, 0x3B, 0x3C, 0x3D, 0x3E, 0x3F
       003B 003C 003D 
       003E 003F 
                      00026 
2140   0040 0041 0042 00027         de      0x40, 0x41, 0x42, 0x43, 0x44, 0x45, 0x46, 0x47
       0043 0044 0045 
       0046 0047 
2148   0048 0049 004A 00028         de      0x48, 0x49, 0x4A, 0x4B, 0x4C, 0x4D, 0x4E, 0x4F
       004B 004C 004D 
       004E 004F 
2150   0050 0051 0052 00029         de      0x50, 0x51, 0x52, 0x53, 0x54, 0x55, 0x56, 0x57
       0053 0054 0055 
       0056 0057 
2158   0058 0059 005A 00030         de      0x58, 0x59, 0x5A, 0x5B, 0x5C, 0x5D, 0x5E, 0x5F
       005B 005C 005D 
       005E 005F 
2160   0060 0061 0062 00031         de      0x60, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 0x67
       0063 0064 0065 
       0066 0067 
2168   0068 0069 006A 00032         de      0x68, 0x69, 0x6A, 0x6B, 0x6C, 0x6D, 0x6E, 0x6F
       006B 006C 006D 
       006E 006F 
2170   0070 0071 0072 00033         de      0x70, 0x71, 0x72, 0x73, 0x74, 0x75, 0x76, 0x77
       0073 0074 0075 
       0076 0077 
2178   0078 0079 007A 00034         de      0x78, 0x79, 0x7A, 0x7B, 0x7C, 0x7D, 0x7E, 0x7F
       007B 007C 007D 
       007E 007F 
                      00035 
2180   0080 0081 0082 00036         de      0x80, 0x81, 0x82, 0x83, 0x84, 0x85, 0x86, 0x87
       0083 0084 0085 
       0086 0087 
2188   0088 0089 0003 00037         de      0x88, 0x89, 0x03, 0x8B, 0x8C, 0x8D, 0x06, 0x8F
       008B 008C 008D 
       0006 008F 
2190   0090 0091 0092 00038         de      0x90, 0x91, 0x92, 0x93, 0x94, 0x95, 0x96, 0x97
       0093 0094 0095 
       0096 0097 
2198   0098 0099 0003 00039         de      0x98, 0x99, 0x03, 0x9B, 0x9C, 0x9D, 0x06, 0x9F
       009B 009C 009D 
       0006 009F 
21A0   00A0 00A1 00A2 00040         de      0xA0, 0xA1, 0xA2, 0xA3, 0xA4, 0xA5, 0xA6, 0xA7
       00A3 00A4 00A5 
       00A6 00A7 
21A8   00A8 00A9 00AA 00041         de      0xA8, 0xA9, 0xAA, 0xAB, 0xAC, 0xAD, 0xAE, 0xAF
       00AB 00AC 00AD 
       00AE 00AF 
21B0   00B0 00B1 00B2 00042         de      0xB0, 0xB1, 0xB2, 0xB3, 0xB4, 0xB5, 0xB6, 0xB7
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

       00B3 00B4 00B5 
       00B6 00B7 
21B8   00B8 00B9 00BA 00043         de      0xB8, 0xB9, 0xBA, 0xBB, 0xBC, 0xBD, 0xBE, 0xBF
       00BB 00BC 00BD 
       00BE 00BF 
                      00044 
21C0   00C0 0000 00C2 00045         de      0xC0, 0x00, 0xC2, 0xC3, 0xC4, 0xC5, 0xC6, 0xC7
       00C3 00C4 00C5 
       00C6 00C7 
21C8   0004 0045 00CA 00046         de      0x04, 'E' , 0xCA, 0xCB, 0x02, 0x01, 0xCE, 'D' 
       00CB 0002 0001 
       00CE 0044 
21D0   00D0 00D1 004E 00047         de      0xD0, 0xD1, 'N' , 'O' , 0xD4, 0xD5, 0xD6, 0xD7
       004F 00D4 00D5 
       00D6 00D7 
21D8   0005 0055 0055 00048         de      0x05, 'U' , 'U' , 0xDB, 0xDC, 0x07, 0xDE, 0xDF
       00DB 00DC 0007 
       00DE 00DF 
21E0   00E0 0000 00E2 00049         de      0xE0, 0x00, 0xE2, 0xE3, 0xE4, 0xE5, 0xE6, 0xE7
       00E3 00E4 00E5 
       00E6 00E7 
21E8   0004 0065 00EA 00050         de      0x04, 'e' , 0xEA, 0xEB, 0x02, 0x01, 0xEE, 'd' 
       00EB 0002 0001 
       00EE 0064 
21F0   00F0 00F1 006E 00051         de      0xF0, 0xF1, 'n' , 'o' , 0xF4, 0xF5, 0xF6, 0xF7
       006F 00F4 00F5 
       00F6 00F7 
21F8   0005 0075 0075 00052         de      0x05, 'u' , 'u' , 0xFB, 0xFC, 0x07, 0xFE, 0xFF
       00FB 00FC 0007 
       00FE 00FF 
                      00023         include "P16F877A.inc"  ; definice blbosti kolem procesoru
                      00001         LIST
                      00002 ; P16F877A.INC  Standard Header File, Version 1.00    Microchip Technology, Inc.
                      00398         LIST
                      00024         include "displej.inc"   ; definice promennych, konstant a portu
                      00001 ; roznmisteni pameti:
                      00002 ;       0. banka -> funkcni promenne
                      00003 ;       1. banka -> nic
                      00004 ;       2. banka -> buffer2 (na dlouha jmena souboru pri prehravani)
                      00005 ;       3. banka -> buffer1 (na dlouha jmena adresaru pri prehravani,
                      00006 ;                                               jmena oddilu a jine veci...)
                      00007 ;XXXXXXXXXXXXXXXX DEFINICE VLASTNICH PROMENNYCH
                      00008 ; pomocne promenne (pro casove smycky a jine kokotiny...)
  00000020            00009 TMP0                    equ 0X020
  00000021            00010 TMP1                    equ 0X021
  00000023            00011 TMP2                    equ 0X023
  00000024            00012 TMP3                    equ 0X024
  00000025            00013 TMP4                    equ 0X025
  00000026            00014 TMP5                    equ 0X026
                      00015 ; stavove promenne (zda se neco prehrava, zda je nactena FATka a podobne...)
  00000027            00016 AKTUAL_HLAS             equ 0x027       ; aktualni hlasitost prehravace (255 je maximalni hlasitost)
  00000028            00017 STAV                    equ 0x028       ; stav prehravace
                      00018                 ; 7. bit = 1 => je nactena FATka
                      00019                 ; 6. bit = 1 => doslo k preruseni od TMR1 (kazdych 5ms) tento bit pouzivat pouze v TEST_
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            TLAC
                      00020                 ; 5:4   => nastaveni podsviceni
                      00021                 ;       00      - podsviceni vypnuto
                      00022                 ;       01      - podsviceni zapnuto porad
                      00023                 ;       11      - podsviceni blika 50Hz
                      00024                 ; 3. bit = 1 => pri zmene hlasitosti se vypise hlasitost na LCD (v menu je tedy dobre te
                            nto bit vynulovat)
                      00025                 ; 2. bit = 1 => je zobrazen odehrany cas mp3 (kvuli tomu, aby mohl cas pri pauze blikat)
  00000029            00026 PREH_STAV0              equ 0x029       ; stav prehravani (vis. dokumentace komunikace)
  0000002A            00027 PREH_STAV1              equ 0x02A
                      00028 
  0000002B            00029 PREH_ADR_CL1    equ 0X02B
  0000002C            00030 PREH_ADR_CL2    equ 0X02C
  0000002D            00031 PREH_ADR_CL3    equ 0X02D
  0000002E            00032 PREH_ADR_CL4    equ 0X02E
  0000002F            00033 PREH_SOUB_1             equ 0X02F
  00000030            00034 PREH_SOUB_2             equ 0X030       ; adresa souboru, ktery prave hraje
                      00035 
  00000031            00036 CASOVAC                 equ 0X031       ; tento registr se kazdych 5ms dekrementuje 
                      00037                                                         ; (kdyz dosahne hodnoty 0, derkementovani presta
                            ne)
                      00038 
  00000032            00039 VTERINY1                equ 0X032
  00000033            00040 VTERINY2                equ 0X033
  00000034            00041 MINUTY1                 equ 0X034
  00000035            00042 MINUTY2                 equ 0X035       ; odehrany cas mp3
                      00043 
  00000036            00044 COUNTER                 equ 0X036
  00000037            00045 PRETECENI               equ 0X037
  00000038            00046 VYSLEDEK1               equ 0X038
  00000039            00047 VYSLEDEK2               equ 0X039
  00000040            00048 POMOCNA1                equ 0X040
  00000041            00049 POMOCNA2                equ 0X041       ; REGISTRY PRO ARITMETICKE OPERACE
                      00050 
  00000042            00051 ZAC_ZOB_SOUB    equ 0x042
  00000043            00052 ZAC_ZOB_ADR             equ 0x043       ; od kolikateho znaku se zobrazuji rolovane nazvy
                      00053 
  00000044            00054 TLACITKA                equ 0x044       
                      00055                 ; aby drzeni tlacitka nebylo brano jako nekolik stisku je stav tlacitek 
                      00056                 ; testovan pomoci tohoto registru. O nastaveni jeho bitu se stara podprogram TEST_TLAC. 
                      00057                 ; (ktery take resi tlac. hlasitosti) Obsluha tlacitek je pak provadena podle situace.
                      00058                 ; bity museji byt mazany po obslouzeni
                      00059                 ; 7. bit - play
                      00060                 ; 6. bit - stop
                      00061                 ; 5. bit - previjeni dopredu
                      00062                 ; 4. bit - previjeni dozadu
                      00063                 ; 3. bit - [nepouzit]
                      00064                 ; 2. bit - menu
                      00065                 ; 1. bit - menu up
                      00066                 ; 0. bit - menu down
  00000045            00067 TLACITKA_PRED   equ 0x045       ; stav tlacitek pri predchozim testovanim. 
                      00068                                                         ; pokud nekter bit vynulujeme, muze byt podrzeni
                             tlacitka brano 
                      00069                                                         ; jako nekolik stisku
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00070 
                      00071 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00072 ; registry pro potreby preruseni
  00000070            00073 TEMP_WORKING    equ 0x070
  00000071            00074 TEMP_STATUS             equ 0x071
  00000072            00075 TEMP_FSR                equ 0x072
  00000073            00076 TEMP_PCLATH             equ 0x073
                      00077 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00078 ;DEFINICE BITÙ K DISPLEJI A TLACITEK
                      00079 #DEFINE LCD_RS                  PORTB,2
                      00080 #DEFINE LCD_RW                  PORTB,1
                      00081 #DEFINE LCD_ENABLE              PORTB,0
                      00082 #DEFINE LCD_PODSVICENI  PORTC,5
                      00083 #DEFINE TL_PODSVICENI   PORTC,4
                      00084 #DEFINE TL_PLAY                 PORTA,1
                      00085 #DEFINE TL_STOP                 PORTA,2
                      00086 #DEFINE TL_DOPREDU              PORTA,3
                      00087 #DEFINE TL_DOZADU               PORTA,0
                      00088 #DEFINE TL_VOLUME_UP    PORTA,4
                      00089 #DEFINE TL_VOLUME_DOWN  PORTA,5
                      00090 #DEFINE TL_MENU                 PORTE,1
                      00091 #DEFINE TL_MENU_UP              PORTE,0
                      00092 #DEFINE TL_MENU_DOWN    PORTE,2
                      00093 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00094 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00095 ; MAKRA
                      00096 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00097 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00098 BANK_0  macro                                   ; prepnuti do banky 0 v pameti dat
                      00099                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
                      00100                 bcf     STATUS,RP0    
                      00101                 endm
                      00102 BANK_1  macro                                   ; prepnuti do banky 1 v pameti dat
                      00103                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
                      00104                 bsf     STATUS,RP0    
                      00105                 endm
                      00106 BANK_2  macro                                   ; prepnuti do banky 2 v pameti dat
                      00107                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
                      00108                 bcf     STATUS,RP0    
                      00109                 endm
                      00110 BANK_3  macro                                   ; prepnuti do banky 3 v pameti dat
                      00111                 bsf     STATUS,RP1              ; BANK3  RP1:RP0 = 11
                      00112                 bsf     STATUS,RP0    
                      00113                 endm
                      00114 ; INDF_BANK_x slouzi k prepinani bank pro neprime adresovani pomoci INDF a FSR
                      00115 INDF_BANK_0     macro               
                      00116                         bcf STATUS,IRP    
                      00117                         endm
                      00118 INDF_BANK_1     macro               
                      00119                         bcf STATUS,IRP    
                      00120                         endm
                      00121 INDF_BANK_2     macro             
                      00122                         bsf STATUS,IRP    
                      00123                         endm
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00124 INDF_BANK_3     macro             
                      00125                         bsf STATUS,IRP    
                      00126                         endm
                      00127 ;**********************************************************
                      00128 PROG_PAGE_0     macro             
                      00129                         bcf PCLATH,3
                      00130                         bcf PCLATH,4
                      00131                         endm
                      00132 PROG_PAGE_1     macro             
                      00133                         bsf PCLATH,3
                      00134                         bcf PCLATH,4
                      00135                         endm
                      00136 PROG_PAGE_2     macro             
                      00137                         bcf PCLATH,3
                      00138                         bsf PCLATH,4
                      00139                         endm
                      00140 PROG_PAGE_3     macro             
                      00141                         bsf PCLATH,3
                      00142                         bsf PCLATH,4
                      00143                         endm
                      00144 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00025 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00026 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00027 ; PROGRAM
                      00028 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00029 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00030 ;**********************************************************
0010                  00031  org 0x0010
                      00032         include "lcd.asm"               ; podprogramy pro praci s LCD
                      00001 ;*******************************************************************************************************
                            *************
                      00002 ; RUTINY PRO PRACI S LCD
                      00003 ;*******************************************************************************************************
                            *************
0010                  00004 INIT_LCD
0010   21A9           00005         call ZPOZ_20MS
0011   2025           00006         call INIT8B
0012   21A9           00007         call ZPOZ_20MS
0013   2025           00008         call INIT8B
0014   21A9           00009         call ZPOZ_20MS
0015   2025           00010         call INIT8B
0016   21A9           00011         call ZPOZ_20MS
0017   2025           00012         call INIT8B
0018   21A9           00013         call ZPOZ_20MS
0019   2025           00014         call INIT8B
                      00015 
001A   203E           00016         call CZ_INI
                      00017 
001B   3006           00018         movlw b'00000110' 
001C   208B           00019         call ZAPISI
001D   3001           00020         movlw b'00000001' 
001E   208B           00021         call ZAPISI
001F   2193           00022         CALL ZPOZ_2MS
0020   0008           00023         return
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00024 ;*******************************************************************************************************
                            *************
0021                  00025 SMAZ_LCD
0021   3001           00026         movlw b'00000001' 
0022   208B           00027         call ZAPISI
0023   2193           00028         CALL ZPOZ_2MS
0024   0008           00029         return
                      00030 ;*******************************************************************************************************
                            *************
0025                  00031 INIT8B: 
0025   3038           00032         movlw   b'00111000'     ; 8 - bit
0026   208B           00033         call    ZAPISI
0027   300F           00034         movlw   b'00001111'     ; LCD on, kurzor on, blik 
0028   300C           00035         movlw   b'00001100'     ; LCD on, kurzor off,no blik 
0029   208B           00036         call    ZAPISI
002A   0008           00037         return
                      00038 ;*******************************************************************************************************
                            *************
002B                  00039 LCD_SMAZ_RADEK
002B   3014           00040         movlw .20
002C   00A1           00041         movwf TMP1
002D   3020           00042         movlw ' '
002E   20A8           00043         call ZAPISD
002F   0BA1           00044         decfsz TMP1,f
0030   282D           00045         goto $-3        
0031   0008           00046         return
                      00047 ;*******************************************************************************************************
                            *************
0032                  00048 LCD_1RADEK
0032   3080           00049         movlw h'80'             ; adresa 00h - 0
0033   208B           00050         call ZAPISI
0034   0008           00051         return
                      00052 ;*******************************************************************************************************
                            *************
0035                  00053 LCD_2RADEK
0035   30AA           00054         movlw h'AA'             ; adresa 2Ah - 42
0036   208B           00055         call ZAPISI
0037   0008           00056         return
                      00057 ;**********************************************************
0038                  00058 LCD_3RADEK
0038   3094           00059         movlw h'94'             ; adresa 10h - 16
0039   208B           00060         call ZAPISI
003A   0008           00061         return
                      00062 ;**********************************************************
003B                  00063 LCD_4RADEK
003B   30D4           00064         movlw h'd4'             ; adresa 50h - 80
003C   208B           00065         call ZAPISI
003D   0008           00066         return
                      00067 ;**********************************************************
003E                  00068 CZ_INI  
003E   01A4           00069         clrf    TMP3            ; cislo bytu, ktery jsme naplnily do uzivatelske pameti LCD
003F   3040           00070         movlw   0x40            ; prvni adresa znaku v LCD displeji
0040   208B           00071         call    ZAPISI
0041                  00072 CZ_INI_2        
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0041   0824           00073         movf    TMP3,W
0042   204A           00074         call    TAB_CZ
0043   20A8           00075         call    ZAPISD
0044   0AA4           00076         incf    TMP3,F
0045   3040           00077         movlw   0x40            ; až ADRESA dosáhne 40h tak je konec
0046   0224           00078         subwf   TMP3,W
0047   1D03           00079         btfss   STATUS,Z
0048   2841           00080         goto    CZ_INI_2
                      00081 
0049   0008           00082         return
                      00083 ;**********************************************************
004A                  00084 TAB_CZ  
004A   0782           00085         addwf   PCL,F           ; definování ceských znaku pro LCD
                      00086 
                      00087         ; znak0 = 40h   á
004B   3402           00088         retlw   0x02    ; '      X '
004C   3404           00089         retlw   0x04    ; '     X  '
004D   341E           00090         retlw   0x1E    ; '   XXXX '
004E   3401           00091         retlw   0x01    ; '       X'
004F   340F           00092         retlw   0x0F    ; '    XXXX'
0050   3411           00093         retlw   0x11    ; '   X   X'
0051   340F           00094         retlw   0x0F    ; '    XXXX'
0052   3400           00095         retlw   0x00    ; '        '
                      00096         
                      00097         ; znak1 = 48h   í
0053   3402           00098         retlw   0x02    ; '      X '
0054   3404           00099         retlw   0x04    ; '     X  '
0055   340C           00100         retlw   0x0C    ; '    XX  '
0056   3404           00101         retlw   0x04    ; '     X  '
0057   3404           00102         retlw   0x04    ; '     X  '
0058   3404           00103         retlw   0x04    ; '     X  '
0059   340E           00104         retlw   0x0E    ; '    XXX '
005A   3400           00105         retlw   0x00    ; '        '
                      00106 
                      00107         ; znak2 = 50h   e s hackem
005B   340A           00108         retlw   0x0A    ; '    X X '
005C   3404           00109         retlw   0x04    ; '     X  '
005D   340E           00110         retlw   0x0E    ; '    XXX '
005E   3411           00111         retlw   0x11    ; '   X   X'
005F   341F           00112         retlw   0x1F    ; '   XXXXX'
0060   3410           00113         retlw   0x10    ; '   X    '
0061   340E           00114         retlw   0x0E    ; '    XXX '
0062   3400           00115         retlw   0x00    ; '        '
                      00116 
                      00117         ; znak3 = 58h   š
0063   340A           00118         retlw   0x0A    ; '    X X '
0064   3404           00119         retlw   0x04    ; '     X  '
0065   340E           00120         retlw   0x0E    ; '    XXX '
0066   3410           00121         retlw   0x10    ; '   X    '
0067   340E           00122         retlw   0x0E    ; '    XXX '
0068   3401           00123         retlw   0x01    ; '       X'
0069   341E           00124         retlw   0x1E    ; '   XXXX '
006A   3400           00125         retlw   0x00    ; '        '
                      00126 
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00127         ; znak4 = 60h   c s hackem
006B   340A           00128         retlw   0x0A    ; '    X X '
006C   3404           00129         retlw   0x04    ; '     X  '
006D   340E           00130         retlw   0x0E    ; '    XXX '
006E   3410           00131         retlw   0x10    ; '   X    '
006F   3410           00132         retlw   0x10    ; '   X    '
0070   3411           00133         retlw   0x11    ; '   X   X'
0071   340E           00134         retlw   0x0E    ; '    XXX '
0072   3400           00135         retlw   0x00    ; '        '
                      00136 
                      00137         ; znak5 = 68h   r s hackem
0073   340A           00138         retlw   0x0A    ; '    X X '
0074   3404           00139         retlw   0x04    ; '     X  '
0075   3416           00140         retlw   0x16    ; '   X XX '
0076   3419           00141         retlw   0x19    ; '   XX  X'
0077   3410           00142         retlw   0x10    ; '   X    '
0078   3410           00143         retlw   0x10    ; '   X    '
0079   3410           00144         retlw   0x10    ; '   X    '
007A   3400           00145         retlw   0x00    ; '        '
                      00146 
                      00147         ; znak6 = 70h   z s hackem
007B   340A           00148         retlw   0x0A    ; '    X X '
007C   3404           00149         retlw   0x04    ; '     X  '
007D   341F           00150         retlw   0x1F    ; '   XXXXX'
007E   3402           00151         retlw   0x02    ; '      X '
007F   3404           00152         retlw   0x04    ; '     X  '
0080   3408           00153         retlw   0x08    ; '    X   '
0081   341F           00154         retlw   0x1F    ; '   XXXXX'
0082   3400           00155         retlw   0x00    ; '        '
                      00156 
                      00157         ; znak7 = 78h   ý
0083   3402           00158         retlw   0x02    ; '      X '
0084   3404           00159         retlw   0x04    ; '     X  '
0085   3411           00160         retlw   0x11    ; '   X   X'
0086   3411           00161         retlw   0x11    ; '   X   X'
0087   340F           00162         retlw   0x0F    ; '    XXXX'
0088   3401           00163         retlw   0x01    ; '       X'
0089   340E           00164         retlw   0x0E    ; '    XXX '
008A   3400           00165         retlw   0x00    ; '        '
                      00166 ;************************************************
008B                  00167 ZAPISI  
                      00168         ; krystal 20MHz => instrukce = 200ns
008B   1106           00169         BCF LCD_RS                      ; RS na  RB2 je 0 - instrukce
008C   1086           00170         BCF LCD_RW                      ; R/W na RB1 je 0 - zapis
008D   0000           00171         nop                                     ; Tas min 140ns
008E   0088           00172         MOVWF   PORTD
008F   0000           00173         nop
0090   0000           00174         nop
0091   0000           00175         nop
0092   0000           00176         nop
0093   0000           00177         nop
0094   0000           00178         nop
0095   0000           00179         nop
0096   0000           00180         nop
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0097   0000           00181         nop
0098   0000           00182         nop
0099   1406           00183         BSF LCD_ENABLE
009A   0000           00184         NOP
009B   0000           00185         NOP
009C   0000           00186         nop
009D   0000           00187         nop
009E   0000           00188         NOP                                     ; ENABLE slespon 450ns v log1
009F   1006           00189         bcf LCD_ENABLE
00A0   0000           00190         NOP
00A1   0000           00191         NOP
00A2   0000           00192         nop
00A3   0000           00193         nop
00A4   0000           00194         NOP
00A5   1406           00195         bsf LCD_ENABLE
                      00196 
00A6   21BB           00197         CALL ZPOZ_50US      ; zpozdeni 50 uS na vykonani instrukce
00A7   0008           00198         RETURN
                      00199 ;**********************************************************
00A8                  00200 ZAPISD  
                      00201         ; krystal 20MHz => instrukce = 200ns
00A8   1506           00202         BSF LCD_RS                      ; RS na  RB2 je 1 - DATA
00A9   1086           00203         BCF LCD_RW                      ; R/W na RB1 je 0 - zapis
00AA   0000           00204         nop                                     ; Tas min 140ns
00AB   0088           00205         MOVWF   PORTD
00AC   0000           00206         nop
00AD   0000           00207         nop
00AE   0000           00208         nop
00AF   0000           00209         nop
00B0   0000           00210         nop
00B1   0000           00211         nop
00B2   0000           00212         nop
00B3   0000           00213         nop
00B4   0000           00214         nop
00B5   0000           00215         nop
00B6   1406           00216         BSF LCD_ENABLE
00B7   0000           00217         NOP
00B8   0000           00218         NOP
00B9   0000           00219         nop
00BA   0000           00220         nop
00BB   0000           00221         NOP                                     ; ENABLE slespon 450ns v log1
00BC   1006           00222         bcf LCD_ENABLE
00BD   0000           00223         NOP
00BE   0000           00224         NOP
00BF   0000           00225         nop
00C0   0000           00226         nop
00C1   0000           00227         NOP
                      00228         ;bsf LCD_ENABLE
                      00229 
00C2   21BB           00230         CALL ZPOZ_50US      ; zpozdeni 50 uS na zapis data
00C3   0008           00231         RETURN
                      00232 ;**********************************************************
                      00033         include "displej.asm"   ; hlavni programova smycka
                      00001         ; znak0 = 40h   á
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00002         ; znak1 = 48h   í
                      00003         ; znak2 = 50h   e s hackem
                      00004         ; znak3 = 58h   š
                      00005         ; znak4 = 60h   c s hackem
                      00006         ; znak5 = 68h   r s hackem
                      00007         ; znak6 = 70h   z s hackem
                      00008         ; znak7 = 78h   ý
00C4                  00009 START
00C4   2110           00010         CALL INIT_CONFIG        ; nakonfiguruje preruseni, USART, pull ups...
00C5   2101           00011         call INIT_PORT          ; konfigurace vstupu a vystupu (trisy)
00C6   2010           00012         call INIT_LCD           ; init LCD displeje (vcetne definovani 8 ceskych znaku)
                      00013 
00C7   2216           00014         call HLASKA_PREPRCAVAC
00C8   2240           00015         call HLASKA_AUTORI
00C9   2186           00016         call ZPOZ_1S
00CA   2186           00017         call ZPOZ_1S
00CB   2021           00018         call SMAZ_LCD
00CC   2216           00019         call HLASKA_PREPRCAVAC
00CD   2264           00020         call HLASKA_DISK
00CE   2312           00021         call JMENODISKU
00CF   2186           00022         call ZPOZ_1S
                      00023 
00D0   21D0           00024         call NACTIODDILY
00D1   2021           00025         call SMAZ_LCD
00D2   0825           00026         movfw TMP4
00D3   3C01           00027         sublw .1
00D4   1903           00028         btfsc STATUS,Z
00D5   28D8           00029         goto $+3
00D6   2576           00030         call VYBER_ODDILU
00D7   28DB           00031         goto $+4
00D8   21F0           00032         CALL NASTAVODDIL                        ; pokud je na disku pouze jeden oddil, nastavime ten prv
                            ni
00D9   1FA8           00033         BTFSS STAV,7
00DA   22F4           00034         CALL HLASKA_CHYBAODDILU
                      00035 
00DB   2562           00036         call ZAKLADNI_NASTAVENI  
00DC   2D77           00037         goto PRUZKUMNIK
                      00038 
00DD   0000           00039         nop
00DE   28DD           00040         goto $-1
                      00041 ;;;;;;;;;;;;;;;;;;;;;;;;;
00DF   3080           00042         movlw h'80'             ; prikaz pro prime hrani mp3
00E0   21C0           00043         CALL WR_USART
00E1   3002           00044         movlw h'02'
00E2   21C0           00045     CALL WR_USART
00E3   3000           00046         movlw h'00'
00E4   21C0           00047         CALL WR_USART
00E5   3000           00048         movlw h'00'
00E6   21C0           00049     CALL WR_USART
00E7   3000           00050         movlw h'00'
00E8   21C0           00051     CALL WR_USART
00E9   3048           00052         movlw h'48'
00EA   21C0           00053     CALL WR_USART
00EB   3000           00054         movlw h'00'
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00EC   21C0           00055     CALL WR_USART
00ED   21C8           00056         CALL RD_USART
                      00057 
                      00058         ; nastaveni jmena zakladniho adresare
                      00059         INDF_BANK_3
00EE   1783               M                         bsf STATUS,IRP    
00EF   3091           00060         movlw 0x91
00F0   0084           00061         movwf FSR
00F1   3052           00062         movlw 'R'
00F2   0080           00063         movwf INDF
00F3   0A84           00064         incf FSR,f
                      00065 
00F4   304F           00066         movlw 'O'
00F5   0080           00067         movwf INDF
00F6   0A84           00068         incf FSR,f
                      00069 
00F7   304F           00070         movlw 'O'
00F8   0080           00071         movwf INDF
00F9   0A84           00072         incf FSR,f
                      00073 
00FA   3054           00074         movlw 'T'
00FB   0080           00075         movwf INDF
00FC   0A84           00076         incf FSR,f
                      00077 
00FD   30FF           00078         movlw h'FF'
00FE   0080           00079         movwf INDF
                      00080 ;;;;;;;;;;;;;;;;;;;;;;;;;
                      00081 
00FF   2562           00082         call ZAKLADNI_NASTAVENI  
0100   2B44           00083     goto PREHRAVANI
                      00084 ;*******************************************************************************************************
                            *************
                      00085 ; CEKACI SMYCKY
                      00086 ;       call ZPOZ_1S
                      00087 ;       call ZPOZ_300MS
                      00088 ;       call ZPOZ_100US
                      00089 ;       call ZPOZ_10US
                      00090 ;*******************************************************************************************************
                            *************
0101                  00091 INIT_PORT
                      00092         BANK_1
0101   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0102   1683               M                 bsf     STATUS,RP0    
0103   30FF           00093         MOVLW 0xff
0104   0085           00094         MOVWF TRISA
0105   30F8           00095         MOVLW B'11111000'
0106   0086           00096     MOVWF TRISB
0107   30DF           00097         MOVLW B'11011111'
0108   0087           00098         MOVWF TRISC
0109   3000           00099         MOVLW B'00000000'
010A   0088           00100         MOVWF TRISD
010B   3003           00101         MOVLW 0x03
010C   0089           00102         MOVWF TRISE
                      00103         BANK_0
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

010D   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
010E   1283               M                 bcf     STATUS,RP0    
010F   0008           00104         RETURN
                      00105 ;**********************************************************
0110                  00106 INIT_CONFIG     ; nakonfiguruje preruseni, WDT, USART, pull ups....
0110   3009           00107         MOVLW b'00001001'       ; Configure for external clock,
0111   0090           00108         MOVWF T1CON                     ; Asynchronous operation, external oscillator
                      00109 
0112   30FF           00110         movlw h'FF'
0113   008F           00111         movwf TMR1H
0114   018E           00112         clrf TMR1L
                      00113 
                      00114         BANK_1
0115   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0116   1683               M                 bsf     STATUS,RP0    
0117   140C           00115         BSF PIE1, TMR1IE        ; Enable Timer1 interrupt
0118   178B           00116         BSF INTCON,GIE
0119   170B           00117         BSF INTCON,PEIE
                      00118         BANK_0
011A   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
011B   1283               M                 bcf     STATUS,RP0    
                      00119 
                      00120 
                      00121         BANK_1
011C   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
011D   1683               M                 bsf     STATUS,RP0    
011E   30C7           00122         MOVLW b'11000111'       ; ...pull up a podobny koniny
                      00123                 ; PORTB Pull-up Enable bit              1 = pull up enabled
                      00124                 ; Interrupt Edge Select bit             1 = interrupt on rising edge of RB0/INT pin
                      00125                 ; TMR0 Clock Source Select bit  0 = Internal instruction cycle clock (CLKO)
                      00126                 ; TMR0 Source Edge Select bit   0 = Increment on low-to-high transition on RA4/T0CKI pin
                      00127                 ; Prescaler Assignment bit              0 = Prescaler is assigned to the Timer0 module
                      00128                 ; PS2:PS0: Prescaler Rate Select bits   111 = TMR0 Rate 1 : 256; WDT Rate 1 : 128
011F   0081           00129         MOVWF OPTION_REG
                      00130         
                      00131 ;       MOVLW b'00100000'       ; povolime preruseni od USARTu (kdyz neco dostanem)
                      00132 ;       MOVLW b'00000000'       ; povolime preruseni od USARTu (kdyz neco dostanem)
                      00133 ;       MOVWF PIE1      
                      00134 ;       MOVLW b'00000000'       ; ostatni vnejsi preruseni vymaskujeme
                      00135 ;       MOVWF PIE2                      
                      00136 
                      00137 ;       MOVLW b'11000000'       ; povolime preruseni na vnejsi zarizeni (USART)                         
                      00138 ;       MOVWF INTCON
                      00139 
0120   3026           00140         MOVLW b'00100110'       ;konfigurace USARTu (asynchronni, 8bit, bez parity, rychle - (BRGH = 1))
0121   0098           00141         MOVWF TXSTA
                      00142         BANK_0
0122   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0123   1283               M                 bcf     STATUS,RP0    
0124   3090           00143         MOVLW b'10010000'       ;zapnu USART
0125   0098           00144         MOVWF RCSTA
                      00145         BANK_1
0126   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0127   1683               M                 bsf     STATUS,RP0    
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0128   3081           00146         MOVLW .129              ; Fosc = 20 MHz, BRGH=1 => rychlost = 9615 bps
                      00147         ;MOVLW .103                     ; Fosc = 16 MHz, BRGH=1 => rychlost = 9615 bps
0129   0099           00148         MOVWF SPBRG     
                      00149 
012A   3007           00150         MOVLW b'00000111'
012B   009F           00151         MOVWF ADCON1            ; vsechny vstupy (RA,RE) jako digitalni
                      00152         BANK_0  
012C   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
012D   1283               M                 bcf     STATUS,RP0    
012E   019F           00153         CLRF ADCON0                     ; pro jistotu (vypneme A/D prevodniky)
                      00154 
012F   30BE           00155         movlw h'BE'
0130   00A7           00156         movwf AKTUAL_HLAS
0131   1628           00157         bsf STAV,4
0132   12A8           00158         bcf STAV,5                      ; zapneme podsviceni
0133   0008           00159         RETURN
                      00160 ;**********************************************************
                      00161 ;**********************************************************
0134                  00162 INTERRUPT                                       ; sem se skace po zavolani preruseni (uz jsou vyreseny u
                            lohy dulezitych registru)
                      00163 ;       movlw 0xC1
                      00164 ;       movwf TMR1L
                      00165 ;       MOVLW 0x3C
                      00166 ;       MOVWF TMR1H             ; 10ms
0134   3069           00167         movlw 0x69
0135   008E           00168         movwf TMR1L
0136   309E           00169         MOVLW 0x9e
0137   008F           00170         MOVWF TMR1H             ; 5ms
0138   100C           00171         BCF PIR1, TMR1IF        ; Clear interrupt flag  
                      00172         ; timto zapisem dosahnu preruseni presne kazdych 5ms (pri Fosc = 20MHz)
                      00173 
0139   0831           00174         movfw CASOVAC
013A   39FF           00175         andlw h'FF'
013B   1D03           00176         btfss STATUS,Z
013C   03B1           00177         decf CASOVAC,f
                      00178 
013D   1728           00179         bsf STAV,6
                      00180 
                      00181 
                      00182 ;----------------------------------------------------------
                      00183 ; testy tlacitek
013E   1C85           00184         btfss TL_PLAY
013F   2943           00185         goto $+4
0140   1BC5           00186         btfsc TLACITKA_PRED,7
0141   2943           00187         goto $+2
0142   17C4           00188         bsf TLACITKA,7
                      00189 
0143   1D05           00190         btfss TL_STOP
0144   2948           00191         goto $+4
0145   1B45           00192         btfsc TLACITKA_PRED,6
0146   2948           00193         goto $+2
0147   1744           00194         bsf TLACITKA,6
                      00195 
0148   1D85           00196         btfss TL_DOPREDU
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0149   294D           00197         goto $+4
014A   1AC5           00198         btfsc TLACITKA_PRED,5
014B   294D           00199         goto $+2
014C   16C4           00200         bsf TLACITKA,5
                      00201 
014D   1C05           00202         btfss TL_DOZADU
014E   2952           00203         goto $+4
014F   1A45           00204         btfsc TLACITKA_PRED,4
0150   2952           00205         goto $+2
0151   1644           00206         bsf TLACITKA,4
                      00207 
0152   1C89           00208         btfss TL_MENU
0153   2957           00209         goto $+4
0154   1945           00210         btfsc TLACITKA_PRED,2
0155   2957           00211         goto $+2
0156   1544           00212         bsf TLACITKA,2
                      00213 
0157   1C09           00214         btfss TL_MENU_UP
0158   295C           00215         goto $+4
0159   18C5           00216         btfsc TLACITKA_PRED,1
015A   295C           00217         goto $+2
015B   14C4           00218         bsf TLACITKA,1
                      00219 
015C   1D09           00220         btfss TL_MENU_DOWN
015D   2961           00221         goto $+4
015E   1845           00222         btfsc TLACITKA_PRED,0
015F   2961           00223         goto $+2
0160   1444           00224         bsf TLACITKA,0
                      00225 
0161   01C5           00226         clrf TLACITKA_PRED
0162   1885           00227         btfsc TL_PLAY
0163   17C5           00228         bsf TLACITKA_PRED,7
0164   1905           00229         btfsc TL_STOP
0165   1745           00230         bsf TLACITKA_PRED,6
0166   1985           00231         btfsc TL_DOPREDU
0167   16C5           00232         bsf TLACITKA_PRED,5
0168   1805           00233         btfsc TL_DOZADU
0169   1645           00234         bsf TLACITKA_PRED,4
016A   1889           00235         btfsc TL_MENU
016B   1545           00236         bsf TLACITKA_PRED,2
016C   1809           00237         btfsc TL_MENU_UP
016D   14C5           00238         bsf TLACITKA_PRED,1
016E   1909           00239         btfsc TL_MENU_DOWN
016F   1445           00240         bsf TLACITKA_PRED,0
                      00241 ;----------------------------------------------------------
                      00242 
0170   1E28           00243         btfss STAV,4
0171   2976           00244         goto INTERRUPT_PODSV_OFF
0172                  00245 INTERRUPT_PODSV_ON
0172   1AA8           00246         btfsc STAV,5
0173   2978           00247         goto INTERRUPT_PODSV_BLIK
0174   1687           00248         bsf LCD_PODSVICENI
0175   297E           00249         goto END_OF_INTERRUPT
0176                  00250 INTERRUPT_PODSV_OFF
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0176   1287           00251         bcf LCD_PODSVICENI
0177   297E           00252         goto END_OF_INTERRUPT
0178                  00253 INTERRUPT_PODSV_BLIK
0178   1E87           00254         btfss LCD_PODSVICENI
0179   297C           00255         goto $+3
017A   1287           00256         bcf LCD_PODSVICENI
017B   297D           00257         goto $+2
017C   1687           00258         bsf LCD_PODSVICENI      
                      00259         
017D   297E           00260         goto END_OF_INTERRUPT   ; koncime...
017E                  00261 END_OF_INTERRUPT                        ; sem skocime kdyz mame vsechny veci kolem preruseni vyrizeny
017E   0873           00262         movfw TEMP_PCLATH
017F   008A           00263         MOVWF PCLATH
0180   0872           00264         movfw TEMP_FSR
0181   0084           00265         MOVWF FSR
0182   0871           00266         movfw TEMP_STATUS
0183   0083           00267         MOVWF STATUS
0184   0870           00268         movfw TEMP_WORKING
0185   0009           00269         retfie
                      00270 ;**********************************************************
0186                  00271 ZPOZ_1S ;Delay 4999999 cycles
0186   301A           00272         MOVLW 0x1A  ;26 DEC
0187   00A3           00273         MOVWF TMP2
0188   305E           00274         MOVLW 0x5E  ;94 DEC
0189   00A1           00275         MOVWF TMP1
018A   306E           00276         MOVLW 0x6E  ;110 DEC
018B   00A0           00277         MOVWF TMP0
018C   0BA0           00278         DECFSZ TMP0,F
018D   298C           00279         GOTO $-1
018E   0BA1           00280         DECFSZ TMP1,F
018F   298C           00281         GOTO $-3
0190   0BA3           00282         DECFSZ TMP2,F
0191   298C           00283         GOTO $-5
0192   0008           00284                 RETURN
                      00285 ;**********************************************************
0193                  00286 ZPOZ_2MS
                      00287 ;Variables: TMP1, TMP0
                      00288 ;Delay 10001 cycles
0193   3010           00289         MOVLW 0x10  ;16 DEC
0194   00A1           00290         MOVWF TMP1
0195   30CF           00291         MOVLW 0x0CF  ;207 DEC
0196   00A0           00292         MOVWF TMP0
0197   0BA0           00293         DECFSZ TMP0,F
0198   2997           00294         GOTO $-1
0199   0BA1           00295         DECFSZ TMP1,F
019A   2995           00296         GOTO $-5
                      00297 ;End of Delay
019B   0008           00298                 RETURN
                      00299 ;**********************************************************
019C                  00300 ZPOZ_300MS
                      00301 ;Variables: TMP2, TMP1, TMP0
                      00302 ;Delay 1 500 001 cycles
019C   3008           00303         MOVLW 0x08  ;8 DEC
019D   00A3           00304         MOVWF TMP2
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

019E   309D           00305         MOVLW 0x9D  ;157 DEC
019F   00A1           00306         MOVWF TMP1
01A0   3006           00307         MOVLW 0x06  ;6 DEC
01A1   00A0           00308         MOVWF TMP0
01A2   0BA0           00309         DECFSZ TMP0,F
01A3   29A2           00310         GOTO $-1
01A4   0BA1           00311         DECFSZ TMP1,F
01A5   29A2           00312         GOTO $-3
01A6   0BA3           00313         DECFSZ TMP2,F
01A7   29A2           00314         GOTO $-5
                      00315 ;End of Delay
01A8   0008           00316                 RETURN
                      00317 ;**********************************************************
01A9                  00318 ZPOZ_20MS
                      00319 ;Variables: TMP1, TMP0
                      00320 ;Delay 100001 cycles
01A9   30A0           00321         MOVLW 0x0A0  ;160 DEC
01AA   00A1           00322         MOVWF TMP1
01AB   30CF           00323         MOVLW 0x0CF  ;207 DEC
01AC   00A0           00324         MOVWF TMP0
01AD   0BA0           00325         DECFSZ TMP0,F
01AE   29AD           00326         GOTO $-1
01AF   0BA1           00327         DECFSZ TMP1,F
01B0   29AB           00328         GOTO $-5
                      00329 ;End of Delay
01B1   0008           00330         return
                      00331 ;**********************************************************
01B2                  00332 ZPOZ_100US ;Delay 500 cycles
01B2   3001           00333         MOVLW 0x01  ;1 DEC
01B3   00A1           00334         MOVWF TMP1
01B4   30A5           00335         MOVLW 0x0A5  ;165 DEC
01B5   00A0           00336         MOVWF TMP0
01B6   0BA0           00337         DECFSZ TMP0,F
01B7   29B6           00338         GOTO $-1
01B8   0BA1           00339         DECFSZ TMP1,F
01B9   29B6           00340         GOTO $-3
01BA   0008           00341                 RETURN
                      00342 ;**********************************************************
01BB                  00343 ZPOZ_50US
                      00344 ;Variable: TMP0
                      00345 ;Delay 250 cycles
01BB   3053           00346         MOVLW 0x53  ;83 DEC
01BC   00A0           00347         MOVWF TMP0
01BD   0BA0           00348         DECFSZ TMP0,F
01BE   29BD           00349         GOTO $-1
                      00350 ;End of Delay
01BF   0008           00351                 RETURN
                      00352 ;**********************************************************
01C0                  00353 WR_USART                        ; odesle slovo ve workingu po USARTu
                      00354         BANK_1  
01C0   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
01C1   1683               M                 bsf     STATUS,RP0    
01C2   1C98           00355         btfss TXSTA,1 
01C3   29C0           00356         goto WR_USART   ; cekame do chvile nez bude pripraven transmit buffer 
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00357         BANK_0  
01C4   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
01C5   1283               M                 bcf     STATUS,RP0    
01C6   0099           00358         movwf TXREG
01C7   0008           00359         return
                      00360 ;**********************************************************
01C8                  00361 RD_USART                                ; pocka nez prijde dato po usartu a pote ho umisti do Workingu
01C8   1E8C           00362         btfss PIR1,RCIF
01C9   29C8           00363         goto RD_USART           ; Pokud nejde o preruseni od USARTU, tak koncime...
01CA   081A           00364         movfw RCREG                     ; !!! vynulovat pøíznak !!!     
01CB   0008           00365         return  
                      00366 ;**********************************************************¨
01CC                  00367 USART_PRESKOC                   ; precte tolik bytu z usartu, jaka je hodnota v TMP1
01CC   21C8           00368         CALL RD_USART
01CD   0BA1           00369     decfsz TMP1,f
01CE   29CC           00370     GOTO $-2
01CF   0008           00371         return  
                      00372 ;**********************************************************¨
01D0                  00373 NACTIODDILY
01D0   13A8           00374         bcf STAV,7
01D1   01A4           00375         clrf TMP3                       ; kolikaty oddil ted prozkoumavame
01D2   01A5           00376         clrf TMP4                       ; kolik oddilu obsahuje disk
                      00377         INDF_BANK_3
01D3   1783               M                         bsf STATUS,IRP    
01D4   3090           00378         movlw 0x90
01D5   0084           00379         movwf FSR
                      00380 
01D6                  00381 NACTIODDILY_JEDENODDIL
01D6   3002           00382         movlw h'02'                     ; prikaz vrat oddil s FAT32
01D7   21C0           00383         call WR_USART
01D8   0824           00384         movfw TMP3
01D9   21C0           00385         call WR_USART
01DA   21C8           00386         call RD_USART
01DB   0080           00387         movwf INDF
01DC   1C00           00388         btfss INDF,0
01DD   29E7           00389         goto NACTIODDILY_NEPLATNY
                      00390         ; prohlizeny zaznam obsahuje oddil s FATkou     
                      00391 
01DE   300F           00392         movlw .15
01DF   00A3           00393         movwf TMP2
01E0   0A84           00394         incf FSR,f
01E1   21C8           00395         call RD_USART
01E2   0080           00396         movwf INDF
01E3   0BA3           00397         decfsz TMP2,f
01E4   29E0           00398         goto $-4
                      00399         
01E5   0AA5           00400         incf TMP4,f
01E6   29EA           00401         goto NACTIODDILY_DALSI
01E7                  00402 NACTIODDILY_NEPLATNY
                      00403         ; prohlizeny zaznam NEobsahuje oddil s FATkou   
01E7   300F           00404         movlw .15
01E8   00A1           00405         movwf TMP1
01E9   21CC           00406         call USART_PRESKOC
01EA                  00407 NACTIODDILY_DALSI
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01EA   0AA4           00408         incf TMP3,f
01EB   0824           00409         movfw TMP3
01EC   3C04           00410         sublw .4
01ED   1D03           00411         btfss STATUS,Z
01EE   29D6           00412         goto NACTIODDILY_JEDENODDIL
01EF   0008           00413         return
                      00414 ;**********************************************************¨
01F0                  00415 NASTAVODDIL
                      00416         ;ODDIL 1
01F0   3003           00417         movlw .3
01F1   21C0           00418         CALL WR_USART
                      00419         INDF_BANK_3
01F2   1783               M                         bsf STATUS,IRP    
01F3   3091           00420         movlw h'91'
01F4   0084           00421         movwf FSR
01F5   0800           00422         movfw INDF
01F6   21C0           00423         CALL WR_USART
01F7   3092           00424         movlw h'92'
01F8   0084           00425         movwf FSR
01F9   0800           00426         movfw INDF
01FA   21C0           00427         CALL WR_USART
01FB   3093           00428         movlw h'93'
01FC   0084           00429         movwf FSR
01FD   0800           00430         movfw INDF
01FE   21C0           00431         CALL WR_USART
01FF   3094           00432         movlw h'94'
0200   0084           00433         movwf FSR
0201   0800           00434         movfw INDF
0202   21C0           00435         CALL WR_USART
                      00436 
0203   21C8           00437         CALL RD_USART
0204   00A6           00438         movwf TMP5
0205   13A8           00439         BcF     STAV,7
0206   1A26           00440         BTFSC TMP5,4
0207   17A8           00441         BSF     STAV,7
0208   0008           00442         RETURN
                      00443 ;**********************************************************¨
0209                  00444 PREVED_ZNAK
                      00445 ; prevede znaky pred vypsanim na LCD (snaky s diakritikou a pod.)
                      00446 ; prevodni tabulka je pro jednoduchost umistena v EEPROMe
                      00447 
                      00448         BANK_2
0209   1703               M                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
020A   1283               M                 bcf     STATUS,RP0    
020B   008D           00449         MOVWF EEADR             ; Address to read
                      00450         BANK_3
020C   1703               M                 bsf     STATUS,RP1              ; BANK3  RP1:RP0 = 11
020D   1683               M                 bsf     STATUS,RP0    
020E   138C           00451         BCF EECON1,EEPGD        ; Point to Data memory
020F   140C           00452         BSF EECON1,RD           ; EE Read
                      00453         BANK_2
0210   1703               M                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
0211   1283               M                 bcf     STATUS,RP0    
0212   080C           00454         MOVFW EEDATA            ; W = EEDATA
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00455         BANK_0
0213   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0214   1283               M                 bcf     STATUS,RP0    
                      00456 
0215   0008           00457         return
                      00458 ;**********************************************************¨
                      00034         include "menu.asm"              ; soubor s definici hlasek na LCD
                      00001 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00002 ; menu a hlaseni prehravace
                      00003 
0216                  00004 HLASKA_PREPRCAVAC
0216   2032           00005     call LCD_1RADEK
0217   303C           00006         MOVLW '<'
0218   20A8           00007         CALL ZAPISD
0219   303C           00008         MOVLW '<'
021A   20A8           00009         CALL ZAPISD
021B   303C           00010     MOVLW '<'
021C   20A8           00011         CALL ZAPISD
021D   304D           00012         MOVLW 'M'
021E   20A8           00013         CALL ZAPISD
021F   3050           00014         MOVLW 'P'
0220   20A8           00015         CALL ZAPISD
0221   3033           00016         MOVLW '3'
0222   20A8           00017         CALL ZAPISD
0223   3020           00018         MOVLW ' '
0224   20A8           00019     CALL ZAPISD
0225   3070           00020         MOVLW 'p'
0226   20A8           00021         CALL ZAPISD
0227   3005           00022         MOVLW h'05'                     ; znak5 = 68h   r s hackem
0228   20A8           00023         CALL ZAPISD
0229   3065           00024         MOVLW 'e'
022A   20A8           00025         CALL ZAPISD
022B   3070           00026         MOVLW 'p'
022C   20A8           00027         CALL ZAPISD
022D   3072           00028         MOVLW 'r'
022E   20A8           00029         CALL ZAPISD
022F   3063           00030         MOVLW 'c'
0230   20A8           00031         CALL ZAPISD
0231   3000           00032         MOVLW h'00'                     ; znak0 = 40h   á
0232   20A8           00033         CALL ZAPISD
0233   3076           00034         MOVLW 'v'
0234   20A8           00035         CALL ZAPISD
0235   3061           00036         MOVLW 'a'
0236   20A8           00037         CALL ZAPISD
0237   3004           00038         MOVLW h'04'             ; znak4 = 60h   c s hackem
0238   20A8           00039         CALL ZAPISD
0239   303E           00040         MOVLW '>'
023A   20A8           00041         CALL ZAPISD
023B   303E           00042         MOVLW '>'
023C   20A8           00043         CALL ZAPISD
023D   303E           00044     MOVLW '>'
023E   20A8           00045         CALL ZAPISD
023F   0008           00046         RETURN
                      00047 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 21


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0240                  00048 HLASKA_AUTORI
0240   2038           00049         call LCD_3RADEK
0241   3020           00050         MOVLW ' '
0242   20A8           00051         CALL ZAPISD
0243   3020           00052         MOVLW ' '
0244   20A8           00053         CALL ZAPISD
0245   3020           00054         MOVLW ' '
0246   20A8           00055         CALL ZAPISD
0247   304B           00056         MOVLW 'K'
0248   20A8           00057         CALL ZAPISD
0249   3061           00058         MOVLW 'a'
024A   20A8           00059         CALL ZAPISD
024B   3072           00060         MOVLW 'r'
024C   20A8           00061         CALL ZAPISD
024D   3072           00062         MOVLW 'r'
024E   20A8           00063         CALL ZAPISD
024F   3079           00064         MOVLW 'y'
0250   20A8           00065         CALL ZAPISD
0251   3020           00066         MOVLW ' '
0252   20A8           00067         CALL ZAPISD
0253   3020           00068         MOVLW ' '
0254   20A8           00069         CALL ZAPISD
0255   3026           00070         MOVLW '&'
0256   20A8           00071         CALL ZAPISD
0257   3020           00072         MOVLW ' '
0258   20A8           00073         CALL ZAPISD
0259   3020           00074         MOVLW ' '
025A   20A8           00075         CALL ZAPISD
025B   3042           00076         MOVLW 'B'
025C   20A8           00077         CALL ZAPISD
025D   306F           00078         MOVLW 'o'
025E   20A8           00079         CALL ZAPISD
025F   3067           00080         MOVLW 'g'
0260   20A8           00081         CALL ZAPISD
0261   3061           00082         MOVLW 'a'
0262   20A8           00083         CALL ZAPISD
0263   0008           00084         RETURN
                      00085 
                      00086 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
0264                  00087 HLASKA_DISK
0264   2035           00088         call LCD_2RADEK
0265   3004           00089         MOVLW h'04'             ; c
0266   20A8           00090         CALL ZAPISD
0267   3065           00091         MOVLW 'e'
0268   20A8           00092         CALL ZAPISD
0269   306B           00093     MOVLW 'k'
026A   20A8           00094         CALL ZAPISD
026B   3000           00095         MOVLW h'00'             ; a
026C   20A8           00096         CALL ZAPISD
026D   306D           00097         MOVLW 'm'
026E   20A8           00098         CALL ZAPISD
026F   3020           00099         MOVLW ' '
0270   20A8           00100         CALL ZAPISD
0271   306E           00101         MOVLW 'n'
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 22


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0272   20A8           00102     CALL ZAPISD
0273   3061           00103         MOVLW 'a'
0274   20A8           00104         CALL ZAPISD
0275   3020           00105         MOVLW ' '
0276   20A8           00106         CALL ZAPISD
0277   3064           00107         MOVLW 'd'
0278   20A8           00108         CALL ZAPISD
0279   3069           00109         MOVLW 'i'
027A   20A8           00110         CALL ZAPISD
027B   3073           00111         MOVLW 's'
027C   20A8           00112         CALL ZAPISD
027D   306B           00113         MOVLW 'k'
027E   20A8           00114         CALL ZAPISD
027F   302E           00115         MOVLW '.'
0280   20A8           00116         CALL ZAPISD
0281   219C           00117     call ZPOZ_300MS
0282   302E           00118         MOVLW '.'
0283   20A8           00119         CALL ZAPISD
0284   219C           00120     call ZPOZ_300MS
0285   302E           00121         MOVLW '.'
0286   20A8           00122         CALL ZAPISD
0287   219C           00123     call ZPOZ_300MS
0288   0008           00124         RETURN
                      00125 
                      00126 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
0289                  00127 HLASKA_DISKOK
0289   2038           00128         call LCD_3RADEK
028A   3044           00129         MOVLW 'D'
028B   20A8           00130         CALL ZAPISD
028C   3049           00131         MOVLW 'I'
028D   20A8           00132         CALL ZAPISD
028E   3053           00133         MOVLW 'S'
028F   20A8           00134         CALL ZAPISD
0290   304B           00135         MOVLW 'K'
0291   20A8           00136         CALL ZAPISD
0292   3020           00137         MOVLW ' '
0293   20A8           00138         CALL ZAPISD
0294   304F           00139         MOVLW 'O'
0295   20A8           00140         CALL ZAPISD
0296   304B           00141         MOVLW 'K'
0297   20A8           00142         CALL ZAPISD
0298   0008           00143     RETURN
                      00144 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
0299                  00145 HLASKA_NEPODPOROVANY_HDD
0299   2038           00146         call LCD_3RADEK
029A   304E           00147         MOVLW 'N'
029B   20A8           00148         CALL ZAPISD
029C   3045           00149         MOVLW 'E'
029D   20A8           00150         CALL ZAPISD
029E   3050           00151         MOVLW 'P'
029F   20A8           00152         CALL ZAPISD
02A0   3044           00153         MOVLW 'D'
02A1   20A8           00154         CALL ZAPISD
02A2   3050           00155         MOVLW 'P'
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 23


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02A3   20A8           00156         CALL ZAPISD
02A4   304F           00157         MOVLW 'O'
02A5   20A8           00158         CALL ZAPISD
02A6   3052           00159         MOVLW 'R'
02A7   20A8           00160         CALL ZAPISD
02A8   304F           00161         MOVLW 'O'
02A9   20A8           00162         CALL ZAPISD
02AA   3056           00163         MOVLW 'V'
02AB   20A8           00164         CALL ZAPISD
02AC   3041           00165         MOVLW 'A'
02AD   20A8           00166         CALL ZAPISD
02AE   304E           00167         MOVLW 'N'
02AF   20A8           00168         CALL ZAPISD
02B0   3059           00169         MOVLW 'Y'
02B1   20A8           00170         CALL ZAPISD
02B2   3020           00171         MOVLW ' '
02B3   20A8           00172         CALL ZAPISD
02B4   3044           00173         MOVLW 'D'
02B5   20A8           00174         CALL ZAPISD
02B6   3049           00175         MOVLW 'I'
02B7   20A8           00176         CALL ZAPISD
02B8   3053           00177         MOVLW 'S'
02B9   20A8           00178         CALL ZAPISD
02BA   304B           00179         MOVLW 'K'
02BB   20A8           00180         CALL ZAPISD
02BC   0008           00181     RETURN              
                      00182 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
02BD                  00183 HLASKA_VICODDILU        
02BD   2032           00184         call LCD_1RADEK
02BE   3064           00185         MOVLW 'd'
02BF   20A8           00186         CALL ZAPISD
02C0   3069           00187         MOVLW 'i'
02C1   20A8           00188         CALL ZAPISD
02C2   3073           00189         MOVLW 's'
02C3   20A8           00190         CALL ZAPISD
02C4   306B           00191         MOVLW 'k'
02C5   20A8           00192         CALL ZAPISD
02C6   3020           00193         MOVLW ' '
02C7   20A8           00194         CALL ZAPISD
02C8   306F           00195         MOVLW 'o'
02C9   20A8           00196         CALL ZAPISD
02CA   3062           00197         MOVLW 'b'
02CB   20A8           00198         CALL ZAPISD
02CC   3073           00199         MOVLW 's'
02CD   20A8           00200         CALL ZAPISD
02CE   3061           00201         MOVLW 'a'
02CF   20A8           00202         CALL ZAPISD
02D0   3068           00203         MOVLW 'h'
02D1   20A8           00204         CALL ZAPISD
02D2   3075           00205         MOVLW 'u'
02D3   20A8           00206         CALL ZAPISD
02D4   306A           00207         MOVLW 'j'
02D5   20A8           00208         CALL ZAPISD
02D6   3065           00209         MOVLW 'e'
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 24


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02D7   20A8           00210         CALL ZAPISD
02D8   2035           00211         call LCD_2RADEK
                      00212 
02D9   3076           00213         MOVLW 'v'
02DA   20A8           00214         CALL ZAPISD
02DB   3001           00215         MOVLW h'01'             ; i
02DC   20A8           00216         CALL ZAPISD
02DD   3063           00217         MOVLW 'c'
02DE   20A8           00218         CALL ZAPISD
02DF   3065           00219         MOVLW 'e'
02E0   20A8           00220         CALL ZAPISD
02E1   3020           00221         MOVLW ' '
02E2   20A8           00222         CALL ZAPISD
02E3   306F           00223         MOVLW 'o'
02E4   20A8           00224         CALL ZAPISD
02E5   3064           00225         MOVLW 'd'
02E6   20A8           00226         CALL ZAPISD
02E7   3064           00227         MOVLW 'd'
02E8   20A8           00228         CALL ZAPISD
02E9   3001           00229         MOVLW h'01'             ; i
02EA   20A8           00230         CALL ZAPISD
02EB   306C           00231         MOVLW 'l'
02EC   20A8           00232         CALL ZAPISD
02ED   3075           00233         MOVLW 'u'
02EE   20A8           00234         CALL ZAPISD
02EF   3021           00235         MOVLW '!'
02F0   20A8           00236         CALL ZAPISD
02F1   0000           00237         nop
02F2   2AF1           00238         goto $-1
02F3   0008           00239     RETURN      
                      00240 
                      00241 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00242 
02F4                  00243 HLASKA_CHYBAODDILU
02F4   2038           00244     call LCD_3RADEK
02F5   3043           00245         MOVLW 'C'
02F6   20A8           00246         CALL ZAPISD
02F7   3048           00247         MOVLW 'H'
02F8   20A8           00248         CALL ZAPISD
02F9   3059           00249         MOVLW 'Y'
02FA   20A8           00250         CALL ZAPISD
02FB   3042           00251         MOVLW 'B'
02FC   20A8           00252         CALL ZAPISD
02FD   3041           00253         MOVLW 'A'
02FE   20A8           00254         CALL ZAPISD
02FF   3020           00255         MOVLW ' '
0300   20A8           00256         CALL ZAPISD
0301   304F           00257         MOVLW 'O'
0302   20A8           00258         CALL ZAPISD
0303   3044           00259         MOVLW 'D'
0304   20A8           00260         CALL ZAPISD
0305   3044           00261         MOVLW 'D'
0306   20A8           00262         CALL ZAPISD
0307   3049           00263         MOVLW 'I'
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 25


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0308   20A8           00264         CALL ZAPISD
0309   304C           00265         MOVLW 'L'
030A   20A8           00266         CALL ZAPISD
030B   3055           00267         MOVLW 'U'
030C   20A8           00268         CALL ZAPISD
030D   3020           00269         MOVLW ' '
030E   20A8           00270         CALL ZAPISD
030F   0000           00271         NOP
0310   2B0F           00272         GOTO $-1
0311   0008           00273         return   
                      00274 
                      00275 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
0312                  00276 JMENODISKU
0312   3001           00277         movlw .1
0313   21C0           00278         CALL WR_USART
0314   21C8           00279         CALL RD_USART
0315   00A3           00280         movwf TMP2
0316   1BA3           00281         BTFSC TMP2,7
0317   2289           00282         CALL HLASKA_DISKOK
0318   1FA3           00283         BTFSS TMP2,7
0319   2299           00284         CALL HLASKA_NEPODPOROVANY_HDD
                      00285 
031A   203B           00286         call LCD_4RADEK
031B   3014           00287         movlw .20             ;prijem jmena disku
031C   00A1           00288         movwf TMP1
031D   21C8           00289         CALL RD_USART
031E   20A8           00290         CALL ZAPISD
031F   0BA1           00291     decfsz TMP1,f
0320   2B1D           00292     GOTO $-3
                      00293     
0321   3014           00294         movlw .20   
0322   00A1           00295         movwf TMP1
0323   21CC           00296         call USART_PRESKOC       
                      00297 
0324   1BA3           00298         BTFSC TMP2,7
0325   0008           00299         RETURN
0326   0000           00300         NOP
0327   2B26           00301         GOTO $-1    
                      00302 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
0328                  00303 MENU
0328   2021           00304         call SMAZ_LCD
0329   2032           00305         call LCD_1RADEK
                      00306 
032A   20A8           00307         call ZAPISD
032B   304E           00308         movlw 'N'
032C   20A8           00309         call ZAPISD
032D   3045           00310         movlw 'E'
032E   20A8           00311         call ZAPISD
032F   304E           00312         movlw 'N'
0330   20A8           00313         call ZAPISD
0331   3049           00314         movlw 'I'
0332   20A8           00315         call ZAPISD
0333   3020           00316         movlw ' '
0334   20A8           00317         call ZAPISD
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 26


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0335   3048           00318         movlw 'H'
0336   20A8           00319         call ZAPISD
0337   304F           00320         movlw 'O'
0338   20A8           00321         call ZAPISD
0339   3054           00322         movlw 'T'
033A   20A8           00323         call ZAPISD
033B   304F           00324         movlw 'O'
033C   20A8           00325         call ZAPISD
033D   3056           00326         movlw 'V'
033E   20A8           00327         call ZAPISD
033F   304F           00328         movlw 'O'
0340   20A8           00329         call ZAPISD
                      00330         
0341   2186           00331         call ZPOZ_1S
0342   2186           00332         call ZPOZ_1S
0343   2B44           00333         goto PREHRAVANI
                      00035         include "prehravani.asm"; programova smycka pro prehravani
                      00001 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00002 ; smycka prehravani (zobrazuje nazev souboru a slozky, odehrany cas a dalsi blbosti...)
                      00003 
0344                  00004 PREHRAVANI
0344   3081           00005         movlw h'81'    ;vraci stav prehravani
0345   21C0           00006         CALL WR_USART
0346   21C8           00007     CALL RD_USART
0347   00A9           00008         MOVWF PREH_STAV0
0348   21C8           00009         CALL RD_USART
0349   00AA           00010         MOVWF PREH_STAV1
034A   21C8           00011         CALL RD_USART
034B   21C8           00012         CALL RD_USART
034C   1429           00013         bsf PREH_STAV0,0
034D   102A           00014         bcf PREH_STAV1,0
                      00015         ;bcf PREH_STAV1,4
034E   255A           00016         call NASTAV_STAV
                      00017 
034F   3083           00018         movlw h'83'             ; vraci informace o prehravanem souboru
0350   21C0           00019         CALL WR_USART
0351   3006           00020         MOVLW .6
0352   00A1           00021         MOVWF TMP1
0353   21CC           00022         CALL USART_PRESKOC
0354   21C8           00023     CALL RD_USART
0355   00AB           00024         MOVWF PREH_ADR_CL1      ; cl1,cl2,cl3,cl4....4bitove cislo,ktere urcuje 1. cluster adresare
0356   21C8           00025         CALL RD_USART
0357   00AC           00026     MOVWF PREH_ADR_CL2
0358   21C8           00027         CALL RD_USART
0359   00AD           00028     MOVWF PREH_ADR_CL3
035A   21C8           00029         CALL RD_USART
035B   00AE           00030         MOVWF PREH_ADR_CL4
035C   21C8           00031         CALL RD_USART
035D   00AF           00032         MOVWF PREH_SOUB_1   ; PREH_SOUB_1,PREH_SOUB_2.....cislo zaznamu obsahujici prehravany soubor
035E   21C8           00033         CALL RD_USART
035F   00B0           00034         MOVWF PREH_SOUB_2
                      00035         
                      00036         
0360   300A           00037         MOVLW h'0A'             ; zjisteni dlouheho nazvu souboru....
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 27


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0361   21C0           00038     CALL WR_USART
0362   082B           00039         MOVFW PREH_ADR_CL1
0363   21C0           00040         CALL WR_USART
0364   082C           00041         MOVFW PREH_ADR_CL2
0365   21C0           00042         CALL WR_USART
0366   082D           00043         MOVFW PREH_ADR_CL3
0367   21C0           00044         CALL WR_USART
0368   082E           00045         MOVFW PREH_ADR_CL4
0369   21C0           00046         CALL WR_USART
036A   082F           00047         MOVFW PREH_SOUB_1
036B   21C0           00048         CALL WR_USART
036C   0830           00049         MOVFW PREH_SOUB_2
036D   21C0           00050         CALL WR_USART
                      00051 
                      00052         INDF_BANK_2
036E   1783               M                         bsf STATUS,IRP    
036F   3010           00053         MOVLW h'10'
0370   0084           00054         MOVWF FSR
0371   3042           00055         MOVLW .66
0372   00A1           00056         MOVWF TMP1
                      00057 
0373   21C8           00058         CALL RD_USART
0374   2209           00059         call PREVED_ZNAK
0375   0080           00060         MOVWF INDF
0376   0A84           00061         INCF FSR,F
0377   0BA1           00062         DECFSZ TMP1,F
0378   2B73           00063         GOTO $-5
                      00064 
0379   3010           00065         movlw h'10'
037A   0084           00066         movwf FSR
037B   0800           00067         movfw INDF
037C   3C01           00068         sublw .1
037D   1D03           00069         btfss STATUS,Z
037E   2B84           00070         goto PREHRAVANI_NENIDLOUHYNAZEV         ; pokud stavovy byte na prikaz 0Ah neni 01h nebyl precte
                            n dlouhy nazev
037F   0A84           00071         incf FSR,f
0380   0800           00072         movfw INDF
0381   3CFF           00073         sublw h'FF'                                                     ; kdyz prvni znak nazvu je 0 (po
                             prevodu FFh) neni take dlouhy nazev
0382   1D03           00074         btfss STATUS,Z
0383   2BA8           00075         goto PREHRAVANI_JELOUHYNAZEV
0384                  00076 PREHRAVANI_NENIDLOUHYNAZEV                              ; budeme si muset vystacit s kratkym nazvem
0384   3005           00077         movlw h'05'
0385   21C0           00078         call WR_USART
0386   082B           00079         MOVFW PREH_ADR_CL1
0387   21C0           00080         CALL WR_USART
0388   082C           00081         MOVFW PREH_ADR_CL2
0389   21C0           00082         CALL WR_USART
038A   082D           00083         MOVFW PREH_ADR_CL3
038B   21C0           00084         CALL WR_USART
038C   082E           00085         MOVFW PREH_ADR_CL4
038D   21C0           00086         CALL WR_USART
038E   082F           00087         MOVFW PREH_SOUB_1
038F   21C0           00088         CALL WR_USART
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 28


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0390   0830           00089         MOVFW PREH_SOUB_2
0391   21C0           00090         CALL WR_USART
                      00091 
0392   3010           00092         MOVLW h'10'
0393   0084           00093         MOVWF FSR
0394   3009           00094         MOVLW .9
0395   00A1           00095         MOVWF TMP1
                      00096 
0396   21C8           00097         CALL RD_USART
                      00098         ;call PREVED_ZNAK
0397   0080           00099         MOVWF INDF
0398   0A84           00100         INCF FSR,F
0399   0BA1           00101         DECFSZ TMP1,F
039A   2B96           00102         GOTO $-4
                      00103         
039B   302E           00104         movlw '.'
039C   0080           00105         MOVWF INDF
039D   0A84           00106         INCF FSR,F
039E   3003           00107         MOVLW .3
039F   00A1           00108         MOVWF TMP1
                      00109 
03A0   21C8           00110         CALL RD_USART
                      00111         ;call PREVED_ZNAK
03A1   0080           00112         MOVWF INDF
03A2   0A84           00113         INCF FSR,F
03A3   0BA1           00114         DECFSZ TMP1,F
03A4   2BA0           00115         GOTO $-4
                      00116 
03A5   3004           00117         MOVLW .4
03A6   00A1           00118         MOVWF TMP1
03A7   21CC           00119         call USART_PRESKOC
03A8                  00120 PREHRAVANI_JELOUHYNAZEV
                      00121         
                      00122                 
03A8   3011           00123         movlw h'11'
03A9   00C2           00124         movwf ZAC_ZOB_SOUB
03AA   3091           00125         movlw h'91'
03AB   00C3           00126         movwf ZAC_ZOB_ADR
03AC   3064           00127         movlw .100
03AD   00B1           00128         movwf CASOVAC                   ; casovac je dekrementovan v preruseni kazdy 5ms, 
                      00129                                                         ; timto tedy dosahneme presne 500ms smycky
03AE   15A8           00130         bsf STAV,3
                      00131 
03AF   2021           00132         call SMAZ_LCD
                      00133 
03B0                  00134 PREHRAVANI_SMYCKA
03B0   2032           00135         call LCD_1RADEK
03B1   202B           00136         call LCD_SMAZ_RADEK
03B2   2032           00137         call LCD_1RADEK
03B3   3000           00138         movlw h'00'
03B4   00A5           00139         movwf TMP4
03B5   23D7           00140         call ROLUJ                              ; TMP4 = 0 -> rolujeme nazev adresare 
                      00141 
03B6   2035           00142         call LCD_2RADEK
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 29


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

03B7   202B           00143         call LCD_SMAZ_RADEK
03B8   2035           00144         call LCD_2RADEK
03B9   3001           00145         movlw h'01'
03BA   00A5           00146         movwf TMP4
03BB   23D7           00147         call ROLUJ                              ; TMP4 = 1 -> rolujeme nazev souboru
                      00148 
03BC   2447           00149         CALL CAS_MP3
03BD   240E           00150         call ZOBRAZ_HLASITOST
03BE   1929           00151         BTFSC PREH_STAV0,2
03BF   2B44           00152         GOTO  PREHRAVANI                ; pokud byla zmenena prehravana mp3 (automaticky), nactemem si j
                            eji jmeno
                      00153         
03C0                  00154 PREHRAVANI_SMYCKA_DELAY
03C0   24FC           00155         CALL TEST_TLAC
03C1   24B1           00156         CALL PREH_OBSLUHA_TLACITEK
03C2   0831           00157         movfw CASOVAC
03C3   39FF           00158         andlw h'FF'
03C4   1D03           00159         btfss STATUS,Z
03C5   2BC0           00160         goto PREHRAVANI_SMYCKA_DELAY
                      00161 
03C6   3064           00162         movlw .100
03C7   00B1           00163         movwf CASOVAC                   ; casovac je dekrementovan v preruseni kazdy 5ms, 
                      00164                                                         ; timto tedy dosahneme presne 500ms smycky
                      00165  
03C8   1929           00166         BTFSC PREH_STAV0,2
03C9   2B44           00167         GOTO  PREHRAVANI                ; pokud byla zmenena prehravana mp3 (tlacitkem), nactemem si jej
                            i jmeno
                      00168 
03CA   1D44           00169         btfss TLACITKA,2
03CB   2BCE           00170         goto $+3
03CC   1144           00171         bcf TLACITKA,2
03CD   2B28           00172         goto MENU
                      00173 
03CE   1844           00174         btfsc TLACITKA,0
03CF   2BD3           00175         goto $+4
03D0   18C4           00176         btfsc TLACITKA,1
03D1   2BD3           00177         goto $+2
03D2   2BD6           00178         goto $+4
03D3   1044           00179         bcf TLACITKA,0
03D4   10C4           00180         bcf TLACITKA,1
03D5   2D77           00181         goto PRUZKUMNIK
                      00182 
03D6   2BB0           00183         GOTO PREHRAVANI_SMYCKA          
                      00184 
                      00185 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
03D7                  00186 ROLUJ
03D7   01A6           00187         clrf TMP5
                      00188 
03D8   3013           00189         movlw .19
03D9   00A1           00190         movwf TMP1
                      00191         INDF_BANK_2
03DA   1783               M                         bsf STATUS,IRP    
                      00192 
03DB   0842           00193         movfw ZAC_ZOB_SOUB
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 30


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

03DC   1C25           00194         btfss TMP4,0
03DD   0843           00195         movfw ZAC_ZOB_ADR
                      00196 
03DE   0084           00197         movwf FSR
                      00198 
03DF   0800           00199         movfw INDF
03E0   3CFF           00200         sublw h'FF'
03E1   1903           00201         btfsc STATUS,Z
03E2   1426           00202         bsf TMP5,0      
03E3   1903           00203         btfsc STATUS,Z
03E4   2BF3           00204         goto ROLUJ_KONVYP
03E5   0800           00205         movfw INDF
03E6   20A8           00206         CALL ZAPISD
03E7   0A84           00207         INCF FSR,F 
                      00208         
03E8                  00209 ROLUJ_ZACVYP
03E8   0800           00210         movfw INDF
03E9   3CFF           00211         sublw h'FF'
03EA   1903           00212         btfsc STATUS,Z
03EB   14A6           00213         bsf TMP5,1
03EC   1903           00214         btfsc STATUS,Z
03ED   2BF3           00215         goto ROLUJ_KONVYP
                      00216                 
03EE   0800           00217         movfw INDF
03EF   20A8           00218         CALL ZAPISD
03F0   0A84           00219         INCF FSR,F 
03F1   0BA1           00220         DECFSZ TMP1,F
03F2   2BE8           00221         GOTO ROLUJ_ZACVYP
03F3                  00222 ROLUJ_KONVYP
                      00223         ; pokud byl na prvni zobrazovane pozici znak h'FF' (konec retezce), 
                      00224         ; je nastaven bit 0 TMP5, pokud byl jinde, je nastaven bit 1 TMP5
                      00225 
03F3   0826           00226         movfw TMP5
03F4   39FF           00227         andlw h'FF'
03F5   1903           00228         btfsc STATUS,Z
03F6   2C08           00229         goto ROLUJ_INCREMENTUJ
                      00230 
03F7   1C26           00231         btfss TMP5,0
03F8   2C01           00232         goto ROLUJ_KRATKE               ; konec retezce byl vypsan ale ne na prvni pozici...
                      00233 
03F9   1C25           00234         btfss TMP4,0
03FA   2BFE           00235         goto $+4        
03FB   3011           00236         movlw h'11'
03FC   00C2           00237         movwf ZAC_ZOB_SOUB
03FD   0008           00238         return
03FE   3091           00239         movlw h'91'
03FF   00C3           00240         movwf ZAC_ZOB_ADR
0400   0008           00241         return
0401                  00242 ROLUJ_KRATKE                            ; ...proto se podivame zda neni retezec dost kratky (takovy nero
                            luje)
0401   0842           00243         movfw ZAC_ZOB_SOUB
0402   1C25           00244         btfss TMP4,0
0403   0843           00245         movfw ZAC_ZOB_ADR
0404   397F           00246         andlw b'01111111'
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 31


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0405   3C11           00247         sublw b'00010001'
0406   1903           00248         btfsc STATUS,Z
0407   0008           00249         return
0408                  00250 ROLUJ_INCREMENTUJ
0408   1C25           00251         btfss TMP4,0
0409   2C0C           00252         goto $+3
040A   0AC2           00253         incf ZAC_ZOB_SOUB,f
040B   0008           00254         return
                      00255 
040C   0AC3           00256         incf ZAC_ZOB_ADR,f
040D   0008           00257         return
                      00258 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00259 ; zobrazi aktualni hlasitost na LCD
040E                  00260 ZOBRAZ_HLASITOST
040E   30A1           00261         movlw h'A1'
040F   208B           00262         call ZAPISI
                      00263         ; kurzor vlevo na 3. radek
0410   1A2A           00264         btfsc PREH_STAV1,4      ; je-li tento bit 1 => MUTE
0411   2C38           00265         goto ZOBRAZ_HLASITOST_MUTE      
                      00266 
0412   3056           00267         movlw 'V'
0413   20A8           00268         call ZAPISD
0414   304F           00269         movlw 'O'
0415   20A8           00270         call ZAPISD
0416   304C           00271         movlw 'L'
0417   20A8           00272         call ZAPISD
0418   3020           00273         movlw ' '
0419   20A8           00274         call ZAPISD
                      00275 
041A   0827           00276         movfw AKTUAL_HLAS       
041B   00A6           00277         movwf TMP5
041C   1003           00278         bcf STATUS,C
041D   0CA6           00279         rrf TMP5,f                      ; hlasitost menime po 2, proto ji upravime do rozsahu 0-128
041E   01A3           00280         clrf TMP2
041F   3064           00281         movlw .100
                      00282 
0420   0AA3           00283         incf TMP2,f     
0421   02A6           00284         subwf TMP5,f            ; TMP5 := TMP5 - 100
0422   1803           00285         btfsc STATUS,C
0423   2C20           00286         goto $-3
                      00287 
0424   07A6           00288         addwf TMP5,f
0425   03A3           00289         decf TMP2,f
0426   3030           00290         movlw .48
0427   0723           00291         addwf TMP2,w
0428   20A8           00292         call ZAPISD                     ; stovky
0429   01A3           00293         clrf TMP2
042A   300A           00294         movlw .10
                      00295 
042B   0AA3           00296         incf TMP2,f     
042C   02A6           00297         subwf TMP5,f            ; TMP5 := TMP5 - 10
042D   1803           00298         btfsc STATUS,C
042E   2C2B           00299         goto $-3
                      00300 
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 32


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

042F   07A6           00301         addwf TMP5,f
0430   03A3           00302         decf TMP2,f
0431   3030           00303         movlw .48
0432   0723           00304         addwf TMP2,w
0433   20A8           00305         call ZAPISD                     ; desitky
                      00306 
0434   3030           00307         movlw .48
0435   0726           00308         addwf TMP5,w
0436   20A8           00309         call ZAPISD                     ; jednotky
                      00310 
0437   0008           00311         return
0438                  00312 ZOBRAZ_HLASITOST_MUTE
0438   304D           00313         movlw 'M'
0439   20A8           00314         call ZAPISD
043A   3055           00315         movlw 'U'
043B   20A8           00316         call ZAPISD
043C   3054           00317         movlw 'T'
043D   20A8           00318         call ZAPISD
043E   3045           00319         movlw 'E'
043F   20A8           00320         call ZAPISD
0440   3020           00321         movlw ' '
0441   20A8           00322         call ZAPISD
0442   3020           00323         movlw ' '
0443   20A8           00324         call ZAPISD
0444   3020           00325         movlw ' '
0445   20A8           00326         call ZAPISD
                      00327 
0446   0008           00328         return
                      00329 
                      00330 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00331 ; zobrazi cas prehravani MP3 na LCD (cas od casu dochazi chybam v dekodovani
                      00332 ; a tim i k udavanemu casu, proto je potreba brat tento udaj pouze informacne)
0447                  00333 CAS_MP3
0447   3081           00334         movlw h'81'    ;vraci stav prehravani
0448   21C0           00335         CALL WR_USART
0449   21C8           00336     CALL RD_USART
044A   00A9           00337         MOVWF PREH_STAV0
044B   21C8           00338         CALL RD_USART
044C   00AA           00339         MOVWF PREH_STAV1
044D   21C8           00340         CALL RD_USART
044E   00B2           00341         MOVWF VTERINY1
044F   21C8           00342         CALL RD_USART
0450   00B3           00343         MOVWF VTERINY2
                      00344 
0451   2038           00345         call LCD_3RADEK
0452   1CA9           00346         btfss PREH_STAV0,1              ; je-li pripraven soubor...
0453   2C58           00347         goto CAS_MP3_ZOBRAZ_CAS
0454   1829           00348         btfsc PREH_STAV0,0              ; ...a presto se nic neprehrava
0455   2C58           00349         goto CAS_MP3_ZOBRAZ_CAS
0456   1928           00350         btfsc STAV,2
0457   2C7E           00351         goto CAS_MP3_SHOVEJ_CAS
0458                  00352 CAS_MP3_ZOBRAZ_CAS
0458   1528           00353         bsf STAV,2
                      00354 
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 33


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0459   249F           00355         CALL PREVOD                     ;vypocet  minut a sekund
                      00356         ; MINUTY := VTERINY div 60
                      00357         ; VTERINY := VTERINY mod 60
045A   0834           00358         movfw MINUTY1
045B   00C0           00359         movwf POMOCNA1
045C   0835           00360         movfw MINUTY2
045D   00C1           00361         movwf POMOCNA2
045E   248C           00362         call DELENO10
                      00363         ; preteceni := pomocna mod 10
                      00364         ; pomocna := pomocna div 10
045F   0837           00365         movfw PRETECENI
0460   00A1           00366         movwf TMP1                      ; zaloha jednotek minut
0461   248C           00367         call DELENO10
0462   0840           00368         movfw POMOCNA1  
0463   39FF           00369         andlw h'FF'
                      00370 
0464   1903           00371         btfsc STATUS,Z
0465   2C68           00372         goto $+3
0466   3E30           00373         addlw .48
0467   2C69           00374         goto $+2
0468   3020           00375         movlw ' '
0469   20A8           00376         call ZAPISD                     ; stovky minut
                      00377 
046A   0837           00378         movfw PRETECENI
046B   3E30           00379         addlw .48
046C   20A8           00380         call ZAPISD                     ; desitky minut
                      00381 
046D   0821           00382         movfw TMP1
046E   3E30           00383         addlw .48
046F   20A8           00384         call ZAPISD                     ; jednotky minut
                      00385         
                      00386 
0470   303A           00387         movlw ':'
0471   20A8           00388         call ZAPISD
                      00389 
0472   0832           00390         movfw VTERINY1
0473   00C0           00391         movwf POMOCNA1
0474   0833           00392         movfw VTERINY2
0475   00C1           00393         movwf POMOCNA2
0476   248C           00394         call DELENO10
                      00395         ; preteceni := pomocna mod 10
                      00396         ; pomocna := pomocna div 10
0477   0840           00397         movfw POMOCNA1
0478   3E30           00398         addlw .48
0479   20A8           00399         call ZAPISD
047A   0837           00400         movfw PRETECENI
047B   3E30           00401         addlw .48
047C   20A8           00402         call ZAPISD      
                      00403 
047D   0008           00404         RETURN
047E                  00405 CAS_MP3_SHOVEJ_CAS
047E   1128           00406         bcf STAV,2
                      00407 
047F   3020           00408         movlw ' '
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 34


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0480   20A8           00409         call ZAPISD
0481   3020           00410         movlw ' '
0482   20A8           00411         call ZAPISD
0483   3020           00412         movlw ' '
0484   20A8           00413         call ZAPISD
0485   303A           00414         movlw ':'
0486   20A8           00415         call ZAPISD
0487   3020           00416         movlw ' '
0488   20A8           00417         call ZAPISD
0489   3020           00418         movlw ' '
048A   20A8           00419         call ZAPISD
048B   0008           00420         return
                      00421 
                      00422 ;**********************************************************
                      00423 ;----------------------------------------------------------------------------
048C                  00424 DELENO10
                      00425         ; preteceni := pomocna mod 10
                      00426         ; pomocna := pomocna div 10
                      00427         ; zpusob deleni je podobny jako u PREVOD
048C   01B7           00428         CLRF  PRETECENI                 ; PRETECENI := 0
048D   3010           00429         MOVLW .16                               ; // pomocna ma 16bitu
048E   00B6           00430         MOVWF COUNTER
048F                  00431 DELENO10_LOOP
048F   0DC0           00432         RLF POMOCNA1,f
0490   0DC1           00433         RLF POMOCNA2,f
0491   0DB7           00434         RLF PRETECENI,f
0492   300A           00435         MOVLW .10
0493   0237           00436         SUBWF PRETECENI,W
0494   1803           00437         BTFSc STATUS,C
0495   00B7           00438         MOVWF PRETECENI
                      00439 
0496   0DB8           00440         RLF   VYSLEDEK1,f
0497   0DB9           00441         RLF   VYSLEDEK2,f
                      00442 
0498   0BB6           00443         DECFSZ COUNTER,f
0499   2C8F           00444         GOTO  DELENO10_LOOP
                      00445 
049A   0838           00446         movfw VYSLEDEK1
049B   00C0           00447         movwf POMOCNA1
049C   0839           00448         movfw VYSLEDEK2
049D   00C1           00449         movwf POMOCNA2
049E   0008           00450         RETURN
                      00451 
                      00452 ;**************************************************************************
049F                  00453 PREVOD  ; z poctu odehranych vterin vypocita pocet odehranych minut a vterin
                      00454         ; MINUTY := VTERINY div 60      // div je celociselne deleni se zbytkem
                      00455         ; VTERINY := VTERINY mod 60     // mod je zbytek po deleni
049F   01B7           00456         CLRF  PRETECENI                 ; PRETECENI := 0
04A0   3010           00457         MOVLW .16
04A1   00B6           00458         MOVWF COUNTER                           
04A2                  00459 PREVOD_LOOP                                     ; for (COUNTER:=0 ; COUNTER<16 ; COUNTER++):
04A2   0DB2           00460         RLF   VTERINY1,1
04A3   0DB3           00461         RLF   VTERINY2,1                ;       PRETECENI := (PRETECENI * 2) + (VTERINY mod 2)
04A4   0DB7           00462         RLF   PRETECENI,1               ;       VTERINY := VTERINY div 2
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 35


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

04A5   303C           00463         MOVLW .60
04A6   0237           00464         SUBWF PRETECENI,W
04A7   1803           00465         BTFSc STATUS,C                  ;       if (PRETECENI - 60 > 0):
04A8   00B7           00466         MOVWF PRETECENI                 ;               PRETECENI := PRETECENI - 60
                      00467                                                         ;               MINUTY := (MINUTY * 2) + 1
04A9   0DB4           00468         RLF   MINUTY1,1                 ;       else:
04AA   0DB5           00469         RLF   MINUTY2,1                 ;               MINUTY := (MINUTY * 2)
                      00470                                                         ;       endif;
04AB   0BB6           00471         DECFSZ COUNTER,1                ; endfor;
04AC   2CA2           00472         GOTO  PREVOD_LOOP
                      00473 
04AD   0837           00474         movfw PRETECENI
04AE   00B2           00475         movwf VTERINY1
04AF   01B3           00476         clrf VTERINY2
04B0   0008           00477         RETURN
                      00478 ;*********************************************************************
                      00479 
                      00480 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00481 ;OVLADANI
                      00482 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
04B1                  00483 PREH_OBSLUHA_TLACITEK
                      00484 ; obsluhuje udalosti jednotlivych tlacitek pri prehravani
04B1   1BC4           00485         btfsc TLACITKA,7
04B2   250E           00486         CALL PLAY
04B3   13C4           00487         bcf TLACITKA,7
                      00488 
04B4   1EC4           00489         btfss TLACITKA,5                                ; pokud bylo stisknuto tlacitko previjeni...
04B5   2CC3           00490         goto PREH_OBSLUHA_NOREWIND
04B6   219C           00491         call ZPOZ_300MS
04B7   12C4           00492         bcf TLACITKA,5
04B8   1D85           00493         btfss TL_DOPREDU                                ; ...koukneme se zda je stale drzeno...
04B9   2CCA           00494         goto PREH_OBSLUHA_DALSI_MP3
                      00495 
04BA   142A           00496         bsf PREH_STAV1,0                                ; ..a pokud ano, dame mp3 previjet...
04BB   1429           00497         bsf PREH_STAV0,0
04BC   255A           00498         call NASTAV_STAV
                      00499 
04BD   2447           00500         call CAS_MP3
04BE   219C           00501         call ZPOZ_300MS                                 ; /nebudeme to s tim vypisovanim casu prehanet/
04BF   1985           00502         btfsc TL_DOPREDU
04C0   2CBD           00503         goto $-3
                      00504 
04C1   102A           00505         bcf PREH_STAV1,0                                ; ..do okamziku, nez tlacitko pusti
04C2   255A           00506         call NASTAV_STAV        
04C3                  00507 PREH_OBSLUHA_NOREWIND
04C3   1A44           00508         btfsc TLACITKA,4
04C4   2CC6           00509         goto PREH_OBSLUHA_PREDCHOZI_MP3
                      00510 ;       CALL STOP
                      00511 ;       CALL PAUSE
04C5   0008           00512         return
                      00513 ;---------------------------
04C6                  00514 PREH_OBSLUHA_PREDCHOZI_MP3
04C6   1244           00515         bcf TLACITKA,4
04C7   3016           00516         movlw b'00010110'
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 36


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

04C8   00A6           00517         movwf TMP5                                      ; do TMP5 dame parametry hledani
04C9   2CCC           00518         goto $+3
04CA                  00519 PREH_OBSLUHA_DALSI_MP3
04CA   3006           00520         movlw b'00000110'
04CB   00A6           00521         movwf TMP5                                      ; do TMP5 dame parametry hledani
                      00522 
04CC   3009           00523         movlw h'09'
04CD   21C0           00524         call WR_USART
04CE   082B           00525         movfw PREH_ADR_CL1
04CF   21C0           00526         call WR_USART
04D0   082C           00527         movfw PREH_ADR_CL2
04D1   21C0           00528         call WR_USART
04D2   082D           00529         movfw PREH_ADR_CL3
04D3   21C0           00530         call WR_USART
04D4   082E           00531         movfw PREH_ADR_CL4
04D5   21C0           00532         call WR_USART
04D6   082F           00533         movfw PREH_SOUB_1
04D7   21C0           00534         call WR_USART
04D8   0830           00535         movfw PREH_SOUB_2
04D9   21C0           00536         call WR_USART
04DA   0826           00537         movfw TMP5                                      ; parametry hledani
04DB   21C0           00538         call WR_USART
                      00539 
                      00540 
04DC   21C8           00541         call RD_USART
04DD   3C06           00542         sublw h'06'
04DE   1D03           00543         btfss STATUS,Z
04DF   2CF8           00544         goto PREH_OBSLUHA_NENALEZENO
                      00545         ; nasli jsme mp3
04E0   300F           00546         movlw .15
04E1   00A1           00547         movwf TMP1
04E2   21CC           00548         call USART_PRESKOC
04E3   21C8           00549         call RD_USART
04E4   00AF           00550         movwf PREH_SOUB_1
04E5   21C8           00551         call RD_USART
04E6   00B0           00552         movwf PREH_SOUB_2
                      00553 
04E7   3080           00554         movlw h'80'             ; prikaz pro prime hrani mp3
04E8   21C0           00555         CALL WR_USART
04E9   082B           00556         movfw PREH_ADR_CL1
04EA   21C0           00557     CALL WR_USART
04EB   082C           00558         movfw PREH_ADR_CL2
04EC   21C0           00559         CALL WR_USART
04ED   082D           00560         movfw PREH_ADR_CL3
04EE   21C0           00561     CALL WR_USART
04EF   082E           00562         movfw PREH_ADR_CL4
04F0   21C0           00563     CALL WR_USART
04F1   082F           00564         movfw PREH_SOUB_1
04F2   21C0           00565     CALL WR_USART
04F3   0830           00566         movfw PREH_SOUB_2
04F4   21C0           00567     CALL WR_USART
04F5   21C8           00568         CALL RD_USART
                      00569 
04F6   1529           00570         bsf PREH_STAV0,2                        ; nastavime tento bit, protoze se zmenila prehravana mp3
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 37


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                                    
04F7   0008           00571         return
04F8                  00572 PREH_OBSLUHA_NENALEZENO
04F8   3011           00573         movlw .17
04F9   00A1           00574         movwf TMP1
04FA   21CC           00575         call USART_PRESKOC
04FB   0008           00576         return
                      00577 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00578 ; 7. bit - play
                      00579 ; 6. bit - stop
                      00580 ; 5. bit - previjeni dopredu
                      00581 ; 4. bit - previjeni dozadu
                      00582 ; 3. bit - [nepouzit]
                      00583 ; 2. bit - menu
                      00584 ; 1. bit - menu up
                      00585 ; 0. bit - menu down
                      00586 
04FC                  00587 TEST_TLAC
                      00588 
04FC   1E05           00589         btfss TL_VOLUME_UP              
04FD   2D09           00590         goto TEST_TLAC_NO_MUTE  
04FE   1E85           00591         btfss TL_VOLUME_DOWN
04FF   2D09           00592         goto TEST_TLAC_NO_MUTE          ; jeslize jsou stisknuta obe tlatitka hlasitosti, dame MUTE
0500                  00593 TEST_TLAC_MUTE
0500   162A           00594         bsf PREH_STAV1,4
0501   255A           00595         call NASTAV_STAV
0502   19A8           00596         btfsc STAV,3
0503   240E           00597         call ZOBRAZ_HLASITOST
0504   21A9           00598         call ZPOZ_20MS
0505   21A9           00599         call ZPOZ_20MS
0506   21A9           00600         call ZPOZ_20MS
0507   21A9           00601         call ZPOZ_20MS                          ; protoze se nikdy nepovede pustit tlacitka soucasne, pr
                            oto tato prodleva
0508   2D0D           00602         goto TEST_TLAC_KONHLAS
                      00603 
0509                  00604 TEST_TLAC_NO_MUTE
0509   1A05           00605         BTFSC TL_VOLUME_UP              
050A   2528           00606         CALL VOLUME_UP
                      00607 
050B   1A85           00608         BTFSC TL_VOLUME_DOWN            
050C   2541           00609         CALL VOLUME_DOWN
050D                  00610 TEST_TLAC_KONHLAS
                      00611 
050D   0008           00612         RETURN
                      00613 
                      00614 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
050E                  00615 PLAY
050E   1C29           00616         btfss PREH_STAV0,0
050F   2D12           00617         goto $+3
0510   1029           00618         bcf PREH_STAV0,0
0511   2D13           00619         goto $+2
0512   1429           00620         bsf PREH_STAV0,0
                      00621 
0513   102A           00622         bcf PREH_STAV1,0
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 38


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0514   255A           00623         CALL NASTAV_STAV
0515   0008           00624         return
                      00625 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00626 ;PAUSE
                      00627 ;       btfss PREH_STAV0,0
                      00628 ;       goto  $+5
                      00629 ;       bcf       PREH_STAV0,0
                      00630 ;       MOVFW PREH_STAV0
                      00631 ;       CALL WR_USART
                      00632 ;       return
                      00633 ;       bsf       PREH_STAV0,0
                      00634 ;       MOVFW PREH_STAV0
                      00635 ;       CALL WR_USART
                      00636 ;       CALL RD_USART
                      00637 ;       RETURN
                      00638 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00639 
0516                  00640 STOP
0516   3084           00641         MOVLW h'84'
0517   21C0           00642         CALL WR_USART
0518   1429           00643         BSF PREH_STAV0,0
0519   0829           00644         MOVFW PREH_STAV0
051A   21C0           00645         CALL WR_USART
051B   082A           00646         MOVFW PREH_STAV1
051C   21C0           00647         CALL WR_USART   
051D   21C8           00648         CALL RD_USART
051E   0008           00649         RETURN
                      00650 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00651 
051F                  00652 DOPREDU
051F   3084           00653     MOVLW h'84'
0520   21C0           00654         CALL WR_USART
0521   0829           00655         MOVFW PREH_STAV0
0522   21C0           00656         CALL WR_USART
0523   142A           00657     BSF PREH_STAV1,0
0524   082A           00658         MOVFW PREH_STAV1
0525   21C0           00659         CALL WR_USART   
0526   21C8           00660         CALL RD_USART
0527   0008           00661         RETURN
                      00662 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00663 
0528                  00664 VOLUME_UP
0528   1E2A           00665         btfss PREH_STAV1,4
0529   2D2C           00666         goto $+3
052A   122A           00667         bcf PREH_STAV1,4
052B   255A           00668         call NASTAV_STAV                        ; jestli predtim bylo mute, vypneme
                      00669 
052C   3002           00670         movlw .2
052D   0727           00671         addwf AKTUAL_HLAS,w
052E   1C03           00672         btfss STATUS,C
052F   2D31           00673         goto VOLUME_UP_OK
0530   0008           00674         return                                          ; pokud je jiz hlasitost maximalni, nemuzeme ji 
                            zvetsovat
                      00675 
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 39


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0531                  00676 VOLUME_UP_OK
0531   3082           00677         MOVLW h'82'
0532   21C0           00678         CALL WR_USART
0533   0AA7           00679         incf AKTUAL_HLAS,f
0534   0AA7           00680         incf AKTUAL_HLAS,f                      ; protoze hlasitost ma pomeren dost kroku, pricitame po 
                            2
0535   0827           00681         MOVFW AKTUAL_HLAS
0536   3CFF           00682         sublw h'FF'
0537   21C0           00683         CALL WR_USART
0538   0827           00684         MOVFW AKTUAL_HLAS
0539   3CFF           00685         sublw h'FF'
053A   21C0           00686         CALL WR_USART
053B   21A9           00687         call ZPOZ_20MS                          ; kdyz se neprehrava mp3 je odezva obsluzneho procesoru 
                            temer okamzita
053C   21A9           00688         call ZPOZ_20MS                          ; proto tady cekame, aby zmena hlasitosti nebyla moc ryc
                            hla (kdyz se neprehrava)
053D   21C8           00689         CALL RD_USART
053E   19A8           00690         btfsc STAV,3
053F   240E           00691         call ZOBRAZ_HLASITOST
0540   0008           00692         RETURN
                      00693 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
0541                  00694 VOLUME_DOWN
0541   1E2A           00695         btfss PREH_STAV1,4
0542   2D45           00696         goto $+3
0543   122A           00697         bcf PREH_STAV1,4
0544   255A           00698         call NASTAV_STAV                        ; jestli predtim bylo mute, vypneme
                      00699 
0545   3002           00700         movlw .2
0546   0227           00701         subwf AKTUAL_HLAS,w
0547   1803           00702         btfsc STATUS,C
0548   2D4A           00703         goto VOLUME_DOWN_OK
0549   0008           00704         return                                          ; pokud je jiz hlasitost minimalni, nemuzeme ji 
                            zmensovat
                      00705 
054A                  00706 VOLUME_DOWN_OK
054A   3082           00707     MOVLW h'82'
054B   21C0           00708         CALL WR_USART
054C   03A7           00709         decf AKTUAL_HLAS,f
054D   03A7           00710         decf AKTUAL_HLAS,f                      ; protoze hlasitost ma pomeren dost kroku, odecitame po 
                            2
054E   0827           00711     MOVFW AKTUAL_HLAS
054F   3CFF           00712         sublw h'FF'
0550   21C0           00713     CALL WR_USART
0551   0827           00714     MOVFW AKTUAL_HLAS
0552   3CFF           00715         sublw h'FF'
0553   21C0           00716     CALL WR_USART
0554   21A9           00717         call ZPOZ_20MS                          ; kdyz se neprehrava mp3 je odezva obsluzneho procesoru 
                            temer okamzita
0555   21A9           00718         call ZPOZ_20MS                          ; proto tady cekame, aby zmena hlasitosti nebyla moc ryc
                            hla (kdyz se neprehrava)
0556   21C8           00719     CALL RD_USART
0557   19A8           00720         btfsc STAV,3
0558   240E           00721         call ZOBRAZ_HLASITOST
0559   0008           00722         RETURN
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 40


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00723 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
055A                  00724 NASTAV_STAV
055A   3084           00725         movlw h'84'
055B   21C0           00726         call WR_USART
055C   0829           00727         movfw PREH_STAV0
055D   21C0           00728         call WR_USART
055E   082A           00729         movfw PREH_STAV1
055F   21C0           00730         call WR_USART
0560   21C8           00731         call RD_USART
0561   0008           00732         return
                      00733 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
0562                  00734 ZAKLADNI_NASTAVENI       
                      00735 ; nastavy vychozi hodnoty po zapnuti
0562   3081           00736         movlw h'81'             ; vraci stav prehravani
0563   21C0           00737         CALL WR_USART
0564   21C8           00738     CALL RD_USART
0565   00A9           00739         MOVWF PREH_STAV0
0566   21C8           00740         CALL RD_USART
0567   00AA           00741         MOVWF PREH_STAV1
0568   21C8           00742         CALL RD_USART
0569   21C8           00743         CALL RD_USART
056A   122A           00744         bcf PREH_STAV1,4        ; vypneme mute
056B   255A           00745         call NASTAV_STAV
                      00746 
056C   3082           00747     MOVLW h'82'
056D   21C0           00748         CALL WR_USART
056E   0827           00749     MOVFW AKTUAL_HLAS
056F   3CFF           00750         sublw h'FF'
0570   21C0           00751     CALL WR_USART
0571   0827           00752     MOVFW AKTUAL_HLAS
0572   3CFF           00753         sublw h'FF'
0573   21C0           00754     CALL WR_USART
0574   21C8           00755     CALL RD_USART               ; nastavime hlasitost
0575   0008           00756         return
                      00757 
                      00758 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00036         include "pruzkumnik.asm"; programova smycka pro vyber souboru a oddilu
0576                  00001 VYBER_ODDILU
                      00002 
0576   0008           00003         return
                      00004 ;*******************************************************************************************************
                            *************
0577                  00005 PRUZKUMNIK
0577   2021           00006         call SMAZ_LCD
0578   2032           00007         call LCD_1RADEK
                      00008 
0579   20A8           00009         call ZAPISD
057A   304E           00010         movlw 'N'
057B   20A8           00011         call ZAPISD
057C   3045           00012         movlw 'E'
057D   20A8           00013         call ZAPISD
057E   304E           00014         movlw 'N'
057F   20A8           00015         call ZAPISD
0580   3049           00016         movlw 'I'
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 41


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0581   20A8           00017         call ZAPISD
0582   3020           00018         movlw ' '
0583   20A8           00019         call ZAPISD
0584   3048           00020         movlw 'H'
0585   20A8           00021         call ZAPISD
0586   304F           00022         movlw 'O'
0587   20A8           00023         call ZAPISD
0588   3054           00024         movlw 'T'
0589   20A8           00025         call ZAPISD
058A   304F           00026         movlw 'O'
058B   20A8           00027         call ZAPISD
058C   3056           00028         movlw 'V'
058D   20A8           00029         call ZAPISD
058E   304F           00030         movlw 'O'
058F   20A8           00031         call ZAPISD
                      00032         
0590   2186           00033         call ZPOZ_1S
0591   2186           00034         call ZPOZ_1S
0592   2D91           00035         goto $-1
                      00036 ;*******************************************************************************************************
                            *************
                      00037 
                      00037 ;**********************************************************
0000                  00038  org 0x0000
0000   28C4           00039         goto START
0004                  00040  org 0x0004
0004   00F0           00041         movwf TEMP_WORKING
0005   0803           00042         movfw STATUS
0006   00F1           00043         movwf TEMP_STATUS
0007   0804           00044         movfw FSR
0008   00F2           00045         movwf TEMP_FSR
0009   080A           00046         movfw PCLATH
000A   00F3           00047         movwf TEMP_PCLATH
000B   018A           00048         clrf PCLATH
                      00049         BANK_0
000C   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
000D   1283               M                 bcf     STATUS,RP0    
                      00050         INDF_BANK_0
000E   1383               M                         bcf STATUS,IRP    
000F   2934           00051         goto INTERRUPT
                      00052 ;**********************************************************
                      00053         END
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 42


SYMBOL TABLE
  LABEL                             VALUE 

ACKDT                             00000005
ACKEN                             00000004
ACKSTAT                           00000006
ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000006
ADCS1                             00000007
ADDEN                             00000003
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
AKTUAL_HLAS                       00000027
BANK_0                            
BANK_1                            
BANK_2                            
BANK_3                            
BCLIE                             00000003
BCLIF                             00000003
BF                                00000000
BRGH                              00000002
C                                 00000000
C1INV                             00000004
C1OUT                             00000006
C2INV                             00000005
C2OUT                             00000007
CASOVAC                           00000031
CAS_MP3                           00000447
CAS_MP3_SHOVEJ_CAS                0000047E
CAS_MP3_ZOBRAZ_CAS                00000458
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCP2CON                           0000001D
CCP2IE                            00000000
CCP2IF                            00000000
CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCP2X                             00000005
CCP2Y                             00000004
CCPR1H                            00000016
CCPR1L                            00000015
CCPR2H                            0000001C
CCPR2L                            0000001B
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 43


SYMBOL TABLE
  LABEL                             VALUE 

CHS0                              00000003
CHS1                              00000004
CHS2                              00000005
CIS                               00000003
CKE                               00000006
CKP                               00000004
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON                             0000009C
CMIE                              00000006
CMIF                              00000006
COUNTER                           00000036
CREN                              00000004
CSRC                              00000007
CVR0                              00000000
CVR1                              00000001
CVR2                              00000002
CVR3                              00000003
CVRCON                            0000009D
CVREN                             00000007
CVROE                             00000006
CVRR                              00000005
CZ_INI                            0000003E
CZ_INI_2                          00000041
D                                 00000005
DATA_ADDRESS                      00000005
DC                                00000001
DELENO10                          0000048C
DELENO10_LOOP                     0000048F
DOPREDU                           0000051F
D_A                               00000005
EEADR                             0000010D
EEADRH                            0000010F
EECON1                            0000018C
EECON2                            0000018D
EEDATA                            0000010C
EEDATH                            0000010E
EEIE                              00000004
EEIF                              00000004
EEPGD                             00000007
END_OF_INTERRUPT                  0000017E
F                                 00000001
FERR                              00000002
FSR                               00000004
GCEN                              00000007
GIE                               00000007
GO                                00000002
GO_DONE                           00000002
HLASKA_AUTORI                     00000240
HLASKA_CHYBAODDILU                000002F4
HLASKA_DISK                       00000264
HLASKA_DISKOK                     00000289
HLASKA_NEPODPOROVANY_HDD          00000299
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 44


SYMBOL TABLE
  LABEL                             VALUE 

HLASKA_PREPRCAVAC                 00000216
HLASKA_VICODDILU                  000002BD
I2C_DATA                          00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
IBF                               00000007
IBOV                              00000005
INDF                              00000000
INDF_BANK_0                       
INDF_BANK_1                       
INDF_BANK_2                       
INDF_BANK_3                       
INIT8B                            00000025
INIT_CONFIG                       00000110
INIT_LCD                          00000010
INIT_PORT                         00000101
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTERRUPT                         00000134
INTERRUPT_PODSV_BLIK              00000178
INTERRUPT_PODSV_OFF               00000176
INTERRUPT_PODSV_ON                00000172
INTF                              00000001
IRP                               00000007
JMENODISKU                        00000312
LCD_1RADEK                        00000032
LCD_2RADEK                        00000035
LCD_3RADEK                        00000038
LCD_4RADEK                        0000003B
LCD_ENABLE                        PORTB,0
LCD_PODSVICENI                    PORTC,5
LCD_RS                            PORTB,2
LCD_RW                            PORTB,1
LCD_SMAZ_RADEK                    0000002B
MENU                              00000328
MINUTY1                           00000034
MINUTY2                           00000035
NACTIODDILY                       000001D0
NACTIODDILY_DALSI                 000001EA
NACTIODDILY_JEDENODDIL            000001D6
NACTIODDILY_NEPLATNY              000001E7
NASTAVODDIL                       000001F0
NASTAV_STAV                       0000055A
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BO                            00000000
NOT_BOR                           00000000
NOT_DONE                          00000002
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RC8                           00000006
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 45


SYMBOL TABLE
  LABEL                             VALUE 

NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_TX8                           00000006
NOT_W                             00000002
NOT_WRITE                         00000002
OBF                               00000006
OERR                              00000001
OPTION_REG                        00000081
P                                 00000004
PCFG0                             00000000
PCFG1                             00000001
PCFG2                             00000002
PCFG3                             00000003
PCL                               00000002
PCLATH                            0000000A
PCON                              0000008E
PEIE                              00000006
PEN                               00000002
PIE1                              0000008C
PIE2                              0000008D
PIR1                              0000000C
PIR2                              0000000D
PLAY                              0000050E
POMOCNA1                          00000040
POMOCNA2                          00000041
PORTA                             00000005
PORTB                             00000006
PORTC                             00000007
PORTD                             00000008
PORTE                             00000009
PR2                               00000092
PREHRAVANI                        00000344
PREHRAVANI_JELOUHYNAZEV           000003A8
PREHRAVANI_NENIDLOUHYNAZEV        00000384
PREHRAVANI_SMYCKA                 000003B0
PREHRAVANI_SMYCKA_DELAY           000003C0
PREH_ADR_CL1                      0000002B
PREH_ADR_CL2                      0000002C
PREH_ADR_CL3                      0000002D
PREH_ADR_CL4                      0000002E
PREH_OBSLUHA_DALSI_MP3            000004CA
PREH_OBSLUHA_NENALEZENO           000004F8
PREH_OBSLUHA_NOREWIND             000004C3
PREH_OBSLUHA_PREDCHOZI_MP3        000004C6
PREH_OBSLUHA_TLACITEK             000004B1
PREH_SOUB_1                       0000002F
PREH_SOUB_2                       00000030
PREH_STAV0                        00000029
PREH_STAV1                        0000002A
PRETECENI                         00000037
PREVED_ZNAK                       00000209
PREVOD                            0000049F
PREVOD_LOOP                       000004A2
PROG_PAGE_0                       
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 46


SYMBOL TABLE
  LABEL                             VALUE 

PROG_PAGE_1                       
PROG_PAGE_2                       
PROG_PAGE_3                       
PRUZKUMNIK                        00000577
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PSPIE                             00000007
PSPIF                             00000007
PSPMODE                           00000004
R                                 00000002
RBIE                              00000003
RBIF                              00000000
RC8_9                             00000006
RC9                               00000006
RCD8                              00000000
RCEN                              00000003
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
RD_USART                          000001C8
READ_WRITE                        00000002
ROLUJ                             000003D7
ROLUJ_INCREMENTUJ                 00000408
ROLUJ_KONVYP                      000003F3
ROLUJ_KRATKE                      00000401
ROLUJ_ZACVYP                      000003E8
RP0                               00000005
RP1                               00000006
RSEN                              00000001
RX9                               00000006
RX9D                              00000000
R_W                               00000002
S                                 00000003
SEN                               00000000
SMAZ_LCD                          00000021
SMP                               00000007
SPBRG                             00000099
SPEN                              00000007
SREN                              00000005
SSPADD                            00000093
SSPBUF                            00000013
SSPCON                            00000014
SSPCON2                           00000091
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 47


SYMBOL TABLE
  LABEL                             VALUE 

SSPOV                             00000006
SSPSTAT                           00000094
START                             000000C4
STATUS                            00000003
STAV                              00000028
STOP                              00000516
SYNC                              00000004
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1INSYNC                          00000002
T1OSCEN                           00000003
T1SYNC                            00000002
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TAB_CZ                            0000004A
TEMP_FSR                          00000072
TEMP_PCLATH                       00000073
TEMP_STATUS                       00000071
TEMP_WORKING                      00000070
TEST_TLAC                         000004FC
TEST_TLAC_KONHLAS                 0000050D
TEST_TLAC_MUTE                    00000500
TEST_TLAC_NO_MUTE                 00000509
TLACITKA                          00000044
TLACITKA_PRED                     00000045
TL_DOPREDU                        PORTA,3
TL_DOZADU                         PORTA,0
TL_MENU                           PORTE,1
TL_MENU_DOWN                      PORTE,2
TL_MENU_UP                        PORTE,0
TL_PLAY                           PORTA,1
TL_PODSVICENI                     PORTC,4
TL_STOP                           PORTA,2
TL_VOLUME_DOWN                    PORTA,5
TL_VOLUME_UP                      PORTA,4
TMP0                              00000020
TMP1                              00000021
TMP2                              00000023
TMP3                              00000024
TMP4                              00000025
TMP5                              00000026
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 48


SYMBOL TABLE
  LABEL                             VALUE 

TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000085
TRISB                             00000086
TRISC                             00000087
TRISD                             00000088
TRISE                             00000089
TRISE0                            00000000
TRISE1                            00000001
TRISE2                            00000002
TRMT                              00000001
TX8_9                             00000006
TX9                               00000006
TX9D                              00000000
TXD8                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
UA                                00000001
USART_PRESKOC                     000001CC
VOLUME_DOWN                       00000541
VOLUME_DOWN_OK                    0000054A
VOLUME_UP                         00000528
VOLUME_UP_OK                      00000531
VTERINY1                          00000032
VTERINY2                          00000033
VYBER_ODDILU                      00000576
VYSLEDEK1                         00000038
VYSLEDEK2                         00000039
W                                 00000000
WCOL                              00000007
WR                                00000001
WREN                              00000002
WRERR                             00000003
WR_USART                          000001C0
Z                                 00000002
ZAC_ZOB_ADR                       00000043
ZAC_ZOB_SOUB                      00000042
ZAKLADNI_NASTAVENI                00000562
ZAPISD                            000000A8
ZAPISI                            0000008B
ZOBRAZ_HLASITOST                  0000040E
ZOBRAZ_HLASITOST_MUTE             00000438
ZPOZ_100US                        000001B2
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 49


SYMBOL TABLE
  LABEL                             VALUE 

ZPOZ_1S                           00000186
ZPOZ_20MS                         000001A9
ZPOZ_2MS                          00000193
ZPOZ_300MS                        0000019C
ZPOZ_50US                         000001BB
_BODEN_OFF                        00003FBF
_BODEN_ON                         00003FFF
_CPD_OFF                          00003FFF
_CPD_ON                           00003EFF
_CP_ALL                           00001FFF
_CP_OFF                           00003FFF
_DEBUG_OFF                        00003FFF
_DEBUG_ON                         000037FF
_HS_OSC                           00003FFE
_LP_OSC                           00003FFC
_LVP_OFF                          00003F7F
_LVP_ON                           00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC                           00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_WRT_1FOURTH                      00003BFF
_WRT_256                          00003DFF
_WRT_HALF                         000039FF
_WRT_OFF                          00003FFF
_XT_OSC                           00003FFD
__16F877A                         00000001


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)

0000 : X---XXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0180 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
01C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0200 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0240 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0280 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
02C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0300 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0340 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0380 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
MPASM 03.90 Released                               HLAVNI.ASM   3-5-2006  14:19:29         PAGE 50


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)


03C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0400 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0440 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0480 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
04C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0500 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0540 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0580 : XXXXXXXXXXXXXXXX XXX------------- ---------------- ----------------
2000 : -------X-------- ---------------- ---------------- ----------------
2100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
2140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
2180 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
21C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX

All other memory blocks unused.

Program Memory Words Used:  1424
Program Memory Words Free:  6768


Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     0 reported,    15 suppressed

