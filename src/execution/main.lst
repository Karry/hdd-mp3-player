MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;   HLAVNI SOUBOR 
                      00002 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00003 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00004 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00005 ;  MP3 PREPRCAVAC
                      00006 ; ================
                      00007 ; 
                      00008 ; Program mp3 prehravace pouzivajici jako zdroj dat ATA disk.
                      00009 ; 
                      00010 ; Umi identifikovat disk, precist libovolny sektor, v MBR  najit oddily se systemem souboru FAT32, 
                      00011 ; nacist spousteci zaznam FAT32, praci s FAT32, komunikaci s vs1001 a prehravani mp3 pres vs1001.
                      00012 ;
                      00013 ;
                      00014 ; dodelat:
                      00015 ;       - podporu ID3v1
                      00016 ;       - pak uz jen vychytavky...      (napr. do vs1001 naprogramovat ekvalizer a nejak ho ovladat...)
                      00017 ;       - najit a zabit chyby
                      00018 ;
                      00019 ; chyby o kterych vim:
                      00020 ;
                      00021 ; vyreseen chyby:
                      00022 ;       - Pri cteni SCI (registru VS1001k) dochazi k praskani na vystupu a obcas k resetovani dekoderu
                      00023 ;               ...vyreseno postavenim konecne faze hardwaru
                      00024 ;       - pri cteni nekterych clusteru jsou precteny clustery jine
                      00025 ;               ...tato chyba byla zpusobena chybnym scitanim (MPLAB SIM se chova jinak nez PIC - decf u
                             picu nemeni priznak Carry!!!)
                      00026 ;       - Obcas se nechce vs1001k resetovat. Snad tomu pomuze mala hardwarova uprava.
                      00027 ;               ...opravdu tomu znacne pomohlo pridani kondiku a odporu na reset jako u PICu (v datashee
                            tu je tato uprava zminovana jen u vs1002.(?))
                      00028 ;
                      00029 ; srpen 2005 - duben 2006 Karry - lukas.karas@centrum.cz
                      00030 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00031 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00032 
                      00033 
                      00034 ;**********************************************************
                      00035 ;   VERZE 1.2
                      00036 ;**********************************************************
                      00037 ; !!!!!!!! VSECHNY CASOVE SMYCKY JSOU POCITANY NA Fosc=20MHz !!!!!
                      00038 ; !!!!!!!! NASTAVENI USARTu TAKY !!!!!!!
                      00039         LIST            p=PIC16F877A,C=132,n=60
2007   3F3A           00040         __CONFIG        _WDT_OFF & _HS_OSC & _PWRTE_OFF & _BODEN_OFF & _LVP_OFF 
                      00041                         ; LVP_OFF = RB3 jako digitalni I/O
                      00042         errorlevel -302         ; vypnuti Message [302]: Register in operand not in bank 0.
                      00043         errorlevel -306         ; vypnuti Message[306] : Crossing page boundary -- ensure page bits are 
                            set.
                      00044                                                 ; ! zjednoduseni vypisu, ale riziko prehlednuti chyby
                      00045 ;**********************************************************
                      00046 
                      00047         include "P16F877A.inc"  ; definice blbosti kolem procesoru
                      00001         LIST
                      00002 ; P16F877A.INC  Standard Header File, Version 1.00    Microchip Technology, Inc.
                      00398         LIST
                      00048         include "mp3.inc"               ; definice promennych, konstant a portu
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00002 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00003 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00004 ; DEFINICE PORTU
                      00005 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00006 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00007 ;**********************************************************
                      00008 ; ZAPOJENI PORTU:
                      00009 ;       portA - adresove signaly ATA
                      00010 ;                               5     4     3      2    1    0
                      00011 ;                               CS1-  -     CS0-   DA2  DA1  DA0  
                      00012 ;                               (signaly se znaminkem minus jsou aktivni v logicke 0 !!!)
                      00013 ;               portB - ATA datova sbernice (dolnich 8 bitu)
                      00014 ;               7   .. 0
                      00015 ;               DD7 .. DD0
                      00016 ;               portD - ATA datova sbernice (hornich 8 bitu)
                      00017 ;               15   .. 8
                      00018 ;               DD15 .. DD8 
                      00019 ;               portC - MP3 dekoder vs1001k a USART
                      00020 ;                               7          6        5  4  3    2     1  0
                      00021 ;                               USART out  USART in SI SO SCLK BSYNC CS DREQ
                      00022 ;               portE - ridici signaly ATA
                      00023 ;                               2       1      0
                      00024 ;                               DIOR-   DIOW-  RESET-
                      00025 ;                               (signaly se znaminkem minus jsou aktivni v logicke 0 !!!)
                      00026 ;**********************************************************
  00000007            00027 MP3_PORT                equ PORTC
  00000087            00028 MP3_PORT_TRIS   equ TRISC
                      00029 ; BITY MP3_PORT
                      00030 #define MP3_SO          MP3_PORT,4      ; serial output - tady dostavame z dekoderu data
                      00031 #define MP3_SI          MP3_PORT,5      ; serial input  - pokud MP3_CS=1, tak posilame mp3 data, pokud =
                            0, tak posilame prikaz
                      00032 #define MP3_SCLK        MP3_PORT,3      ; clock - nabezna hrana urcuje platnost dat pri seriovem prenosu
                      00033 #define MP3_CS          MP3_PORT,1      ; cable select  - pokud MP3_CS=1, tak po SI posilame mp3 data, p
                            okud =0, tak posilame prikaz
                      00034 #define MP3_DREQ        MP3_PORT,0      ; data request  - pokud =1, tak dekoder pozaduje dalsi mp3 data
                      00035 #define MP3_BSYNC       MP3_PORT,2      ; pro synchronizaci - ma byt nastaven pri prvnim prenasenem bitu
                             kazdeho bytu
                      00036 ;**********************************************************
                      00037 ; pokud jsem dobre pochopil dataSheat dekoderu vs1001, tak staci do nej jen cpat data, a kdyz skonci mp3
                            , tak odeslat 1024 nulovych bytu,
                      00038 ; softwarove resetovat a posilat dalsi mp3...
                      00039 ;
                      00040 ; popis registru obvodu vs1001 najdete na strane 22 dataSheatu 
                      00041 ; v jeho registrech jsou k dispozici data z hlavicky mp3, zdali mp3 ma spravny format, 
                      00042 ; ovladani hlasitosti a dalsi spousty uzitecnych informaci
                      00043 ;**********************************************************
                      00044 ; PORTY DISKU
  00000005            00045 ATA_ADDRESS             equ PORTA
  00000009            00046 ATA_CONTROL             equ PORTE
  00000006            00047 DATA_PORT_LOW           equ PORTB
  00000008            00048 DATA_PORT_HIGH          equ PORTD
                      00049 
  00000085            00050 ATA_ADDRESS_TRIS        equ TRISA
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000089            00051 ATA_CONTROL_TRIS        equ TRISE
  00000086            00052 DATA_PORT_LOW_TRIS      equ TRISB
  00000088            00053 DATA_PORT_HIGH_TRIS     equ TRISD
                      00054 
                      00055 ; bity ATA_ADDRESS portu
                      00056 #define ERROR_LED       ATA_ADDRESS,3
                      00057 ; bity ATA_CONTROL portu
                      00058 #define ATA_RESET_N     ATA_CONTROL,0
                      00059 #define ATA_DIOW_N      ATA_CONTROL,1
                      00060 #define ATA_DIOR_N      ATA_CONTROL,2
                      00061 
                      00062 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00063 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00064 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00065 ; DEFINICE KONSTANT
                      00066 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00067 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00068 ; ADRESY ATA REGISTRU:
                      00069 ;                                                                       / CHS adressing
                      00070 ;   +-----------+--------------+-------------------+-----------------+
                      00071 ;   | CS0- CS1- |  DA2 DA1 DA0 | READ              | WRITE           |   
                      00072 ;   +-----------+--------------+-------------------+-----------------+
                      00073 ;   | 1    1    |  x   x   x   | data bush h.imped (validace prikazu)|
                      00074 ;   +-----------+--------------+-------------------+-----------------+
                      00075 ;   | 1    0    |  1   1   0   | alternate status  | device control  |
                      00076 ;   +-----------+--------------+-------------------+-----------------+
                      00077 ;   | 0    1    |  0   0   0   | data              | data            |
                      00078 ;   | 0    1    |  0   0   1   | error             | features        |
                      00079 ;   | 0    1    |  0   1   0   |             sector count            |
                      00080 ;   | 0    1    |  0   1   1   |             LBA bits 0-7            |  sector number
                      00081 ;   | 0    1    |  1   0   0   |             LBA bits 8-15           |  cilinder LOW 
                      00082 ;   | 0    1    |  1   0   1   |             LBA bits 16-23          |  cilinder HIGH
                      00083 ;   | 0    1    |  1   1   0   |         device / LBA bits 24-27*    |  device, head
                      00084 ;   | 0    1    |  1   1   1   | status            | command         |
                      00085 ;   +-----------+--------------+-------------------+-----------------+
                      00086 ;   | 0    0    |  0   0   0   | invalid addres    | invalid addres  |
                      00087 ;   +-----------+--------------+-------------------+-----------------+
                      00088 ;
                      00089 ;   * 7 6 5 4   3     2     1     0 
                      00090 ;     1 L 1 DEV LBA27 LBA26 LBA25 LBA24
                      00091 ;  L=1 -> aresa je LBA , L=0 -> adresa je CHS
                      00092 ;  DEV=0 -> master , DEV=1 -> SLAVE
                      00093 ;
                      00094 ;  pokud disk podporuje LBA 48, tak je zadavani adresy trochu odlisne od LBA27
                      00095 ;**********************************************************
                      00096 ; toto jsou definice adres ATA registru. Staci udat jejich adresu na ATA_ADDRESS port a dat prikaz ke ct
                            eni ci zapisu (DIOR- / DIOW-)
                      00097 
                      00098 ;       portA - adresove signaly ATA
                      00099 ;                               5     4     3       2    1    0
                      00100 ;                               CS1-  -     CS0-    DA2  DA1  DA0  
                      00101 ;                               (signaly se znaminkem minus jsou aktivni v logicke 0 !!!)
  0000001E            00102 D_STATUS_A    equ b'00011110'
  0000001E            00103 D_DEVICE_C    equ D_STATUS_A
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000020            00104 D_DATA_R      equ b'00100000'
  00000021            00105 D_FEATURES    equ b'00100001'
  00000021            00106 D_ERROR       equ D_FEATURES
  00000022            00107 D_SECTOR_C    equ b'00100010'
  00000023            00108 D_LBA1        equ b'00100011'   ; LBA low
  00000024            00109 D_LBA2        equ b'00100100'   ; LBA middle
  00000025            00110 D_LBA3        equ b'00100101'   ; LBA high
  00000026            00111 D_DEVICE      equ b'00100110'
  00000027            00112 D_STATUS      equ b'00100111'
  00000027            00113 D_COMMAND     equ D_STATUS
                      00114 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00115 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00116 ; ROZLOZENI PAMETI PROGRAMU
                      00117 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00118 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00119 ;       page 0  0x0000 - 0x07FF
                      00120 ;                               - mp3.asm (hlavni smycka)
                      00121 ;                               - ata.asm
                      00122 ;                               - fat32.asm
                      00123 ;                               - aritmetic.asm
                      00124 ;       page 1  0x0800 - 0x0FFF
                      00125 ;                               - vs1001.asm
                      00126 ;                               - commands.asm
                      00127 ;       page 2  0x1000 - 0x17FF
                      00128 ;       page 3  0x1800 - 0x1FFF
                      00129 ;
                      00130 ; Vsechny podprogramy by mely nechat nastaven PCLATH na hodnotu jak se do nich vstoupilo...
                      00131 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00132 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00133 ; DEFINICE PROMENNYCH
                      00134 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00135 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00136 ; MAPA PAMETI: (368 bytu)
                      00137 ;       BANK 0:         0x000 - 0x01F = specialni registry,
                      00138 ;                               0x020 - 0x07F = misto (96bytu) pro nase registry:
                      00139 ;                                       0x020 - 0x034 -> 21bytu pro registry a parametry HDD
                      00140 ;                                       0x035 - 0x03a -> 6bytu pro parametry podprogramu (musime zajisti
                            t, abychom nepouzivali registry, ktere pouzivaji i podprogramy!!!)
                      00141 ;                                       0x03B - 0x04C -> parametry FATky
                      00142 ;                                       0x04D - 0x050 -> registry pro praci s VS1001
                      00143 ;                                       0x051 - 0xXXX -> ---------------------------
                      00144 ;                                       0x05F - 0x06F -> informace potrebne pro prehravani
                      00145 ;                               0x070 - 0x07F -> registry pro potreby preruseni (dostupne z kterekoliv b
                            anky)
                      00146 ;                                       0x070 - 0x072 -> 3 registry slouzici k zalohovani W, STATUS, FSR
                      00147 ;                                       0x073 - 0x076 -> registry pro prikazy a preruseni + zaloha pro P
                            CLATH
                      00148 ;                                       0x077         -> ---------------------------
                      00149 ;                                       0x078 - 0x07F -> 8 bytu zasobniku prikazu (obsahujici data prika
                            zu prisla po USARTU)
                      00150 ;
                      00151 ;       BANK 1:         0x080 - 0x09F = specialni registry,
                      00152 ;                               0x0A0 - 0x0EF = volne misto (80bytu)
                      00153 ;                                       0x0A0 - 0x0AC -> parametry a navratove hodnoty z aritmeto/logick
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            ych podprogramu
                      00154 ;                                       0x0AD - 0x0EF -> --------------------------- (67bytu)
                      00155 ;
                      00156 ;       BANK 2:         0x100 - 0x10F = specialni registry,
                      00157 ;                               0x110 - 0x16F = misto (96bytu) pro nase registry:
                      00158 ;                                       0x110 - 0x14F -> 64bytu BUFFER_2 (pro dlouhe nazvy souboru, tabu
                            lku oddilu, a treba pro cast fatky)
                      00159 ;                                       0x150         -> pri cteni dlouheho jmena potrebuju v bufferu2 6
                            5 bytu... (ten 65 je tady)
                      00160 ;                                       0x151 - 0x16F -> --------------------------- (31bytu)
                      00161 ;
                      00162 ;       BANK 3:         0x180 - 0x18F = specialni registry,
                      00163 ;                               0x190 - 0x1EF = misto (96bytu) pro nase registry:
                      00164 ;                                       0x190 - 0x1CF -> 64bytu BUFFER_1 (pro ruzna data pri cteni...)
                      00165 ;                                       0x1D0 - 0x1EF -> --------------------------- (32 bytu)
                      00166 
                      00167 ; prectena ci zapisovana data
  00000020            00168 DATA_L                  equ 0x020 ; res 1
  00000021            00169 DATA_H                  equ 0x021
                      00170 ; HODNOTY ATA REGISTRU 
  00000022            00171 ATA_STATUS_A    equ 0x022
  00000023            00172 DEVICE_C                equ 0x023
  00000024            00173 FEATURES                equ 0x024
  00000025            00174 ATA_ERROR               equ 0x025
  00000026            00175 SECTOR_C                equ 0x026
  00000027            00176 LBA1                    equ 0x027       ; alias  SECTOR_N
  00000028            00177 LBA2                    equ 0x028       ; alias  CILINDER_L
  00000029            00178 LBA3                    equ 0x029       ; alias  CILINDER_H
  0000002A            00179 LBA4                    equ 0x02a       ; toto neni registr ATA, ale pouze posledni cast aktualni adresy
  0000002B            00180 DEVICE                  equ 0x02b       ; alias  DEVICE_H
  0000002C            00181 ATA_STATUS              equ 0x02c
  0000002D            00182 COMMAND                 equ 0x02d
                      00183 ;**********************************************************
                      00184 ; BITY ATA REGISTRU
                      00185          ; ATA_STATUS register
  00000007            00186 BSY                             equ 7   ; = 1 -> disk je zaneprazdneny, ostatni registry nemusi obsahova
                            t pravdivou informaci
  00000006            00187 DRDY                    equ 6   ; = 1 -> disk ready (pripraven k praci)
  00000003            00188 DRQ                             equ 3   ; = 1 -> signalizuje, ze jsou pripravena data ke cteni 
  00000000            00189 ERR                             equ 0   ; = 1 -> pri provadeni posledniho prikazu doslo k chybe
                      00190          ; ATA_ERROR register
  00000002            00191 ABRT                    equ 2   ; = 1 -> prikaz aborted (spatny optkode prikazu)
                      00192          ; DEVICE_C (control) register
  00000002            00193 SRST                    equ 2   ; nastavime-li, provedeme soft. reset disku
  00000001            00194 nEIN                    equ 1   ; zakazuje preruseni disku (signal INTRQ)
  00000007            00195 HOB                             equ 7   ; tento bit DEVICE CONTROL se nastavuje pouze pokud disk podporu
                            je LBA 48 a cteme horni cast adresy LBA...
                      00196 ;**********************************************************
  0000002E            00197 ATA_ATTRIBUTES  equ 0x02e       ; Parametry hardisku. 
                      00198 ;Bity maji nasledujici vyznam:
  00000000            00199 ATA_OK                  equ 0   ; 0. bit = 1 -> disk je pritomen, zapnuty a funkcni :-)
  00000001            00200 LBA_SUPPORT             equ 1   ; 1. bit = 1 -> podpora LBA (pokud neni nastaven bit2, tak pouze LBA28 -
                            > disk do 120GB)
  00000002            00201 LBA48_SUPPORT   equ 2   ; 2. bit = 1 -> podpora LBA 48 (disk je zrejme vetsi jak 120GB)
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000003            00202 BIG_SECTOR              equ 3   ; 3. bit = 1 -> velikost sektoru je vetsi nez 256 !!! (s takovym diskem 
                            zatim tento program neumi)
  00000004            00203 FAT32_LOAD              equ 4   ; 4. bit = 1 -> FATka byla uspesne analyzovana a udaje o ni jsou pravdiv
                            e
  00000005            00204 STANDBY                 equ 5   ; 5. bit = 1 -> disk ve standby rezimu
                      00205                                                 ; 6. bit  -> nepouzit
  00000007            00206 APPLICABLE              equ 7   ; 7. bit = 1 -> disk je pro nas pouzitelny (LBA, sektor o 512B)
                      00207 
                      00208 ;PARAM_MAX_LBA1 equ 0x02F               ; [4B] maximalni hodnota LBA (velikost disku)   
                      00209 ;PARAM_MAX_LBA2 equ 0x030               ; tady pozor, disky mohou byt adresovany az LBA 48, MBR je ale o
                            mezen na LBA 32 (2TB)
                      00210 ;PARAM_MAX_LBA3 equ 0x031               ; tak by nemelo smysl vsech 48b kdyz by se nevyuzily. (Navic jse
                            m disk vetsi nez 2TB nevidel :)
                      00211 ;PARAM_MAX_LBA4 equ 0x032               ; (registr s indexem 1 ma nejnizsi vahu)
                      00212 ; Tyto registry nepotrebuju
                      00213 ;**********************************************************
  0000002F            00214 VS_LOUDNESS             equ 0x02F               ; registr obsahujici hodnotu s nastavenym ekvalizerem
                      00215 ;                               equ 0x030
                      00216 ;                               equ 0x031
                      00217 ;                               equ 0x032
                      00218 
                      00219 ;**********************************************************
                      00220 
  00000033            00221 PARAM_SLOV_V_SEKTORU1   equ 0x33 ; [2B] disky mohou mit velikost sektoru vetsi nez 512 (256sl) 
  00000034            00222 PARAM_SLOV_V_SEKTORU2   equ 0x34 
                      00223 ; pokud je to zapsano takto, nejvyznamejsi bity jsou niz v paneti (PARAM_MAX_LBA + X)
                      00224 ; pokud je zapsano jako skupina LBA1, LBA2, LBA3, LBA4, tak nejvyznamejsi bity jsou v LBA4
                      00225 ;**********************************************************
                      00226 ; pomocne registry pouzivane v podprogramech 
                      00227 ; !!! MUSIME ZAJISTIT ABY NEBYLY POUZIVANY VE VNORENYCH PODPROGRAMECH !!!
  00000035            00228 TEMPW                   equ 0x035
  00000036            00229 TEMP1                   equ 0x036
  00000037            00230 TEMP2                   equ 0x037
  00000038            00231 TEMP3                   equ 0x038
  00000039            00232 TEMP4                   equ 0x039
  0000003A            00233 TEMP5                   equ 0x03A
                      00234 
                      00235 ; !!! pomocne promenne pro spozdovaci smycky jsou na stejnych mistech
                      00236 ; pouzito pro synchronizaci s prog. picdelay
  00000036            00237 TMP1                    equ 0x036
  00000037            00238 TMP2                    equ 0x037
  00000038            00239 TMP0                    equ 0x038
                      00240 ;**********************************************************
                      00241 ; registry pro praci s FATkou
  0000003B            00242 POZICE                  equ 0x03B               ; na ukladani aktualni pozice v slusteru, pripadne jine 
                            kokotiny
  0000003C            00243 CLUSTER1                equ 0x03C
  0000003D            00244 CLUSTER2                equ 0x03D
  0000003E            00245 CLUSTER3                equ 0x03E
  0000003F            00246 CLUSTER4                equ 0x03F
                      00247 
  00000040            00248 POCATEK_DAT1    equ 0x040
  00000041            00249 POCATEK_DAT2    equ 0x041
  00000042            00250 POCATEK_DAT3    equ 0x042
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000043            00251 POCATEK_DAT4    equ 0x043
                      00252 
  00000044            00253 POCATEK_FAT1    equ 0x044
  00000045            00254 POCATEK_FAT2    equ 0x045
  00000046            00255 POCATEK_FAT3    equ 0x046
  00000047            00256 POCATEK_FAT4    equ 0x047
                      00257 
  00000048            00258 ROOT_DIR_CL1    equ 0x048
  00000049            00259 ROOT_DIR_CL2    equ 0x049
  0000004A            00260 ROOT_DIR_CL3    equ 0x04A
  0000004B            00261 ROOT_DIR_CL4    equ 0x04B
                      00262 
  0000004C            00263 CLUSTER_SIZE    equ 0x04C               ; velikost clusteru (pocet sektoru na cluster)
                      00264 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00265 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00266 ; DEFINICE PROMENNYCH a KONSTANT PRO PRACI S VS1001
                      00267 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00268 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00269 ; adresy registru VS1001
  00000000            00270 VSADDR_MODE                     equ .0          ; nastaveni VS1001
  00000001            00271 VSADDR_STATUS           equ .1          ; slouzi pouze pro zapnuti / vypnuti analogove casti (MUTE)
  00000003            00272 VSADDR_CLOCKF           equ .3          ; informuje dekoder o jeho krystalu. !! je nutne pro spravne dek
                            odovani !!
  00000004            00273 VSADDR_DECODE_TIME      equ .4          ; obsahuje cas dekodovani aktualni MP3 !! neaktualizuje se pri s
                            kocich (previjeni)
  00000005            00274 VSADDR_AUDATA           equ .5          ; obsahuje informace o datovem toku a vzorkovaci frekvenci MP3
                      00275         ; bit 15 = 1 => STEREO; = 0 => MONO
                      00276         ; bity 12-9 obsahuji vzorkovaci frekvenci v Hz
                      00277         ;       0000 -> neznama vzorkovaci frekvence
                      00278         ;       0001 -> 44 100
                      00279         ;       0010 -> 48 000
                      00280         ;       0011 -> 32 000
                      00281         ;       0100 -> 22 050
                      00282         ;       0101 -> 24 000 
                      00283         ;       0110 -> 16 000
                      00284         ;       0111 -> 11 025
                      00285         ;       1000 -> 12 000
                      00286         ;       1001 ->  8 000
                      00287         ; bity 8-0 obsahuji bitrate v kbps 
                      00288 
  00000006            00289 VSADDR_WRAM             equ .6                  ; Slouzi k zapisovani uzivatelskeho programu, dato se za
                            pise na adresu v WRAMADDR
  00000007            00290 VSADDR_WRAMADDR equ .7                  ; Adresuje uzivatelskou pamet dekoderu
  00000008            00291 VSADDR_HDAT0    equ .8                  ; Obsahuje informace ziskane z hlavicky MP3
  00000009            00292 VSADDR_HDAT1    equ .9                  ; Obsahuje informace ziskane z hlavicky MP3
  0000000A            00293 VSADDR_AIADDR   equ .10                 ; Start uzivatelskeho programu (vis. datasheet)
  0000000B            00294 VSADDR_VOL              equ .11                 ; ovladani hlasitosti (pro oba kanaly) Horni byte je lev
                            y kanal, dolni byte je pravy kanal
                      00295                                                                 ; (hodnota 0000h znamena hlasitost na ma
                            x., FF00h hraje pouze pravy kanal, FFFFh je ticho)
  0000000D            00296 VSADDR_AICTRL0  equ .13                 ; Registr pro ovladani uzivatelskeho programu
  0000000E            00297 VSADDR_AICTRL1  equ .14                 ; Registr pro ovladani uzivatelskeho programu
                      00298 ;**********************************************************
                      00299 ; registry pro praci s VS1001   
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00300 ; dekoder VS1001 ma vsechny registry 16bitove, proto za jmeno pisu _L /_H (u nekterych registru potrebuj
                            i pouze jednu cast)
  0000004D            00301 VSREG_MODE_L    equ 0x04D
  0000004E            00302 VSREG_STATUS_L  equ 0x04E
  0000004F            00303 VSREG_VOL_L             equ 0x04F               ; pravy kanal
  00000050            00304 VSREG_VOL_H             equ 0x050               ; levy kanal
                      00305 ;**********************************************************
  00000051            00306 FRAGMENT1               equ 0x051
  00000052            00307 FRAGMENT2               equ 0x052
                      00308 ;**********************************************************
  00000053            00309 PREH_D_FRAGMENT1        equ 0x053
  00000054            00310 PREH_D_FRAGMENT2        equ 0x054       ; 16bit cislo, ktere udava kolik clusteru mp3 dat po sobe je na 
                            disku nefragmentovano
                      00311                 ; pokazde kdyz prehrajeme cluster, tak toto cislo dekrementujeme. Kdyz dosahneme 0, tak 
                            zjistime dalsi 
                      00312                 ; cluster a pocet nefragmentovanych clusteru. (jak dlouha je rada po sobe jdoucich clust
                            eru)
  00000055            00313 CITAC_NECINNOSTI1       equ 0x055       ; v preruseni se pokazdych 100ms dekrementuje, dokud neni 0. v h
                            lavni programove smycce 
  00000056            00314 CITAC_NECINNOSTI2       equ 0x056       ; se testuje, a kdyz se rovna 0, posle disku prikaz SLEEP. v pri
                            kazu ke cteni z disku se do nej umisti konstanta.
                      00315                                                                 ; to cele zbusobi to, ze po nekolika min
                            utach necinnosti se disk prepne do sleep
  00000057            00316 KONST_NECINNOSTI1       equ 0x057
  00000058            00317 KONST_NECINNOSTI2       equ 0x058
                      00318 ;**********************************************************
                      00319 ; registry pro ukladani nastaveni hledani
  00000059            00320 HL_PARAMETRY            equ 0x059
                      00321 ;               0. bit = 0 > pokud hledáme soubory, tak pouze MP3
                      00322 ;                                1 > pokud hledáme soubory, vrací všechny soubory
                      00323 ;               1. bit = 0 > hledáme klasicky (nejdríve adresáre, poté soubory
                      00324 ;                                1 > hledáme pouze adresáre, nebo soubory
                      00325 ;               2. bit = 0 > je-li nastaven 1. bit, hledáme pouze adresáøe
                      00326 ;                                1 > je-li nastaven 1. bit, hledáme pouze soubory
                      00327 ;               3. bit = 0 > hledáme podle cisla zaznamu bud následující ci predchozi zaznam
                      00328 ;                                1 > hledáme první záznam v adresáøi
                      00329 ;               4. bit = 0 > hledáme NÁSLEDUJÍCÍ záznam
                      00330 ;                                1 > hledáme PØEDCHOZÍ záznam
                      00331 ;               7. bit - tento bit nelze nastavit uzivatelem
                      00332 ;                               = 0 > adresar je ROOT
                      00333 ;                               = 1 > adresar neni ROOT
                      00334 
  0000005A            00335 HL_ADR_CL1                      equ 0x05A
  0000005B            00336 HL_ADR_CL2                      equ 0x05B
  0000005C            00337 HL_ADR_CL3                      equ 0x05C
  0000005D            00338 HL_ADR_CL4                      equ 0x05D       ; v jakem adresari momentalne vyhledavame
                      00339 
  0000005E            00340 ZAZNAMU_vBUFFERU_DISKU  equ 0x05E       ; sem nam procedura SKOC_NA_ZAZNAM vraci kolik po sobe
                      00341                         ; jdoucich zaznamu nam nechala pripravenych v bufferu na disku
                      00342                         ; (znacne totiz zrychluje praci, protoze pokud chceme cist nasledujici zaznam a 
                            mame ho jiz 
                      00343                         ; v bufferu, memusime znova volat SKOC_NA_ZAZNAM ale rovnou FILE_INFO)
                      00344 ;XXXXXXXXX              equ 0x05F
                      00345 ;**********************************************************
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00346 ; registry pro praci procedur v filesystem (dalsi registry pozivane proceduramy v filesystem jsou CLUSTE
                            R a POZICE)
  00000060            00347 ZAZNAM1                         equ 0x060
  00000061            00348 ZAZNAM2                         equ 0x061       ; poradi zaznamu v adresari
                      00349 ;**********************************************************
                      00350 ; informace potrebne pro prehravani
  00000062            00351 PREH_ADR_CL1            equ 0x062
  00000063            00352 PREH_ADR_CL2            equ 0x063
  00000064            00353 PREH_ADR_CL3            equ 0x064
  00000065            00354 PREH_ADR_CL4            equ 0x065       ; prni cluster adresare, ktery se prave prehrava...
                      00355 
  00000066            00356 PREH_ZAZNAM1            equ 0x066
  00000067            00357 PREH_ZAZNAM2            equ 0x067       ; poradi zaznamu v adresari ktery se zrovna prehrava (soubor mp3
                            )
                      00358 
  00000068            00359 PREH_CITAC_PREV         equ 0x068       ; pokud je mp3 previjena pomalu, sem se zapisuje kolik sektoru s
                            e jiz previnulo. 
                      00360                                                                 ; (Pøi pomalém pøevíjení je pomìr pøehra
                            ných sektorù ku pøeskoèeným 5:20.)
                      00361 
  00000069            00362 PREH_DATA_CL1           equ 0x069
  0000006A            00363 PREH_DATA_CL2           equ 0x06A
  0000006B            00364 PREH_DATA_CL3           equ 0x06B
  0000006C            00365 PREH_DATA_CL4           equ 0x06C       ; aktualni cluster, ktery se prehrava
  0000006D            00366 PREH_DATA_POZICE        equ 0x06D       ; sektor v clusteru, ktery se prehrava
                      00367 
  0000006E            00368 PREH_STAV0                      equ 0x06E       ; registr obsahuje informace o stavu aktualniho prehrava
                            ni
                      00369                                 ; 0. bit =      0 => stop nebo pausa (nic nehraje)
                      00370                                 ;                       1 => play            (nejaky soubor je prehravan
                            )
                      00371                                 ; 1. bit =      0 => neni zadny soubor k prehravani (nastaveni bitu play
                             nema zadny ucinek)
                      00372                                 ;                       1 => je soubor pripraven k prehravani (muze byt 
                            ale pauza - nic nehraje)
                      00373                                 ; 2. bit =      1 => je nastaven, kdyz se zmeni prehravany soubor (bez v
                            olani prikazu) do doby, nez prijde prikaz na dotaz STAVU... (81h)
                      00374                                 ; 3. bit =      0 => po skonceni souboru se pokracuje v prehravani (zavi
                            si na nastaveni repeatu)
                      00375                                 ;                       1 => po skonceni prehravani souboru se nic nepre
                            hrava (ceka se na prijeti prikazu k prehravani)
                      00376                                 ; 4. bit =      0 => repeat off
                      00377                                 ;                       1 => repeat on
                      00378                                 ; 5. bit =      0 => repeat adresare (prvni cluster adresare musi byt na
                            staven v PREH_ADDR_ZACATEK_CL[1-4] )
                      00379                                 ;                       1 => repeat souboru (po skonceni prehravani soub
                            oru se ten samy soubor zacne prehravat znova)
                      00380                                 ; 6. bit =      0 => 
                      00381                                 ;                       1 => rezervovano (pro nahodny vyber, nebo jiny r
                            ezim prehravani...)
                      00382                                 ; 7. bit =  0 => 
                      00383                                 ;                       1 => rezervovano
  0000006F            00384 PREH_STAV1                      equ 0x06F
                      00385                                 ; 0. bit =  0 => normalni prehravani
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00386                                 ;                       1 => previjeni mp3 dopredu
                      00387                                 ; 1. bit =  0 => 
                      00388                                 ;                       1 => rezervovano (pro previjeni dozadu)
                      00389                                 ; 2. bit =      zpusob previjeni,       0 => previji se rychle, potichu
                      00390                                 ;                                                               1 => pre
                            viji se pomalu, vzdy se po nejake dobe kratky usek souboru prehraje
                      00391                                 ; 3. bit =      0 => normalni nastaveni zvuku
                      00392                                 ;                       1 => zvyrazneni basu a vysek (moznost dekoderu v
                            s1001 "bass/treble enhancer")
                      00393                                 ; 4. bit =      0 => NO MUTE
                      00394                                 ;                       1 => MUTE
                      00395                                 ; 5., 6., 7. bit 
                      00396                                 ;                       => rezervovano
                      00397 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00398 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00399 ; registry pro potreby preruseni + prace s prikazy (jsou totiz dostupne odkudkoliv)
  00000070            00400 TEMP_WORKING    equ 0x070
  00000071            00401 TEMP_STATUS             equ 0x071
  00000072            00402 TEMP_FSR                equ 0x072
  00000073            00403 PRIJATYCH_DAT   equ 0x073               ; ukazuje kolik je platnych dat v zasobniku prikazu (0 -> zasobn
                            ik je prazdny)
  00000074            00404 PRIJATE_DATO    equ 0x074               ; pomocna promenna v preruseni
  00000075            00405 STAV_PRIKAZU    equ 0x075               ; pomocny registr signalizujici stav prikazu umisteneho v zasobn
                            iku prikazu
                      00406                                                                 ; pokud zadna procedura nenastavi do 1, 
                            je prikaz v tuto chvili neplatny
                      00407                                                                 ; pokud prikaz je pro proceduru ale nama
                             zatim dost parametru, muji tento byt nastavit take do 1
  00000076            00408 TEMP_PCLATH             equ 0x076
                      00409 ; 0x078 - 0x07F         -> zasobnik prikazu (data prisla po USARTU)
                      00410 ;**********************************************************
                      00411 ; BANK_1        s touto bankou pracuji procedury provadejici 32 bitove 
                      00412 ;                       aritmeto/logicke operace
  000000A0            00413 OPERAND_X1              equ 0x0A0
  000000A1            00414 OPERAND_X2              equ 0x0A1
  000000A2            00415 OPERAND_X3              equ 0x0A2
  000000A3            00416 OPERAND_X4              equ 0x0A3
                      00417 
  000000A4            00418 OPERAND_Y1              equ 0x0A4
  000000A5            00419 OPERAND_Y2              equ 0x0A5
  000000A6            00420 OPERAND_Y3              equ 0x0A6
  000000A7            00421 OPERAND_Y4              equ 0x0A7
                      00422 
  000000A8            00423 VYSLEDEK1               equ 0x0A8
  000000A9            00424 VYSLEDEK2               equ 0x0A9
  000000AA            00425 VYSLEDEK3               equ 0x0AA
  000000AB            00426 VYSLEDEK4               equ 0x0AB
                      00427 
  000000AC            00428 PRETECENI               equ 0x0AC
                      00429 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00430 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00431 ; MAKRA
                      00432 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00433 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00434 BANK_0  macro                                   ; prepnuti do banky 0 v pameti dat
                      00435                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
                      00436                 bcf     STATUS,RP0    
                      00437                 endm
                      00438 BANK_1  macro                                   ; prepnuti do banky 1 v pameti dat
                      00439                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
                      00440                 bsf     STATUS,RP0    
                      00441                 endm
                      00442 BANK_2  macro                                   ; prepnuti do banky 2 v pameti dat
                      00443                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
                      00444                 bcf     STATUS,RP0    
                      00445                 endm
                      00446 BANK_3  macro                                   ; prepnuti do banky 3 v pameti dat
                      00447                 bsf     STATUS,RP1              ; BANK3  RP1:RP0 = 11
                      00448                 bsf     STATUS,RP0    
                      00449                 endm
                      00450 ; INDF_BANK_x slouzi k prepinani bank pro neprime adresovani pomoci INDF a FSR
                      00451 INDF_BANK_0     macro               
                      00452                         bcf STATUS,IRP    
                      00453                         endm
                      00454 INDF_BANK_1     macro               
                      00455                         bcf STATUS,IRP    
                      00456                         endm
                      00457 INDF_BANK_2     macro             
                      00458                         bsf STATUS,IRP    
                      00459                         endm
                      00460 INDF_BANK_3     macro             
                      00461                         bsf STATUS,IRP    
                      00462                         endm
                      00463 ;**********************************************************
                      00464 PROG_PAGE_0     macro             
                      00465                         bcf PCLATH,3
                      00466                         bcf PCLATH,4
                      00467                         endm
                      00468 PROG_PAGE_1     macro             
                      00469                         bsf PCLATH,3
                      00470                         bcf PCLATH,4
                      00471                         endm
                      00472 PROG_PAGE_2     macro             
                      00473                         bcf PCLATH,3
                      00474                         bsf PCLATH,4
                      00475                         endm
                      00476 PROG_PAGE_3     macro             
                      00477                         bsf PCLATH,3
                      00478                         bsf PCLATH,4
                      00479                         endm
                      00480 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00049 
                      00050 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00051 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00052 ; PROGRAM
                      00053 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00054 ;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                      00055 ;**********************************************************
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0000                  00056  org 0x0000                                     ; PAGE 0
0000   2810           00057         goto START
0004                  00058  org 0x0004                                     ; PAGE 0
0004   00F0           00059         movwf TEMP_WORKING
0005   0803           00060         movfw STATUS
0006   00F1           00061         movwf TEMP_STATUS
0007   0804           00062         movfw FSR
0008   00F2           00063         movwf TEMP_FSR
0009   080A           00064         movfw PCLATH
000A   00F6           00065         movwf TEMP_PCLATH
000B   018A           00066         clrf PCLATH
                      00067         BANK_0
000C   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
000D   1283               M                 bcf     STATUS,RP0    
                      00068         INDF_BANK_0
000E   1383               M                         bcf STATUS,IRP    
000F   2A05           00069         goto INTERRUPT
                      00070 ;**********************************************************
0010                  00071  org 0x0010                                     ; PAGE 0
                      00072         include "mp3.asm"               ; hlavni programova smycka
0010                  00001 START
0010   21AA           00002         call INIT_CONFIG        ; nakonfiguruje preruseni, WDT, USART, pull ups...
0011   2197           00003         call INIT_PORT          ; nastavy trisy, a porty do vychozi polohy
                      00004 
0012   23B1           00005         call DELAY_25us         ; chvili pockame, protoze napjeti zdroje co mam doma (stary PC-AT zdroj)
0013   23B1           00006         call DELAY_25us         ; zezacatku dost kolisa...
0014   23B1           00007         call DELAY_25us
                      00008 
                      00009         PROG_PAGE_1
0015   158A               M                         bsf PCLATH,3
0016   120A               M                         bcf PCLATH,4
0017   2105           00010         call VS_INIT
                      00011         PROG_PAGE_3
0018   158A               M                         bsf PCLATH,3
0019   160A               M                         bsf PCLATH,4
001A   25F0           00012         call VS_LOAD_PLUGIN
                      00013         PROG_PAGE_0
001B   118A               M                         bcf PCLATH,3
001C   120A               M                         bcf PCLATH,4
                      00014 
001D   22FA           00015         call ATA_RESET                          ; resetujeme disk, koukneme zda tu nejakej mame
001E   1C2E           00016         btfss ATA_ATTRIBUTES,ATA_OK
001F   281D           00017         goto $-2                                        ; pokud neni pripojen disk, tak se jej pokousime
                             neustale najit...
0020   0000           00018         nop                                                     ; ...pokud tam zadny disk neni, tak bych
                            om se stejne ani sem nemeli dostat, protoze budem porad cekat na WAIT_FOR_READY
                      00019 
0021   2366           00020         call IDENTIFY_DEVICE            ; koukneme co disk umi
                      00021 
0022                  00022 CEK_PRIKAZ_01h
                      00023         PROG_PAGE_1
0022   158A               M                         bsf PCLATH,3
0023   120A               M                         bcf PCLATH,4
0024   2119           00024         call CEKEJ_PRIKAZ
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00025         PROG_PAGE_0
0025   118A               M                         bcf PCLATH,3
0026   120A               M                         bcf PCLATH,4
                      00026 
                      00027 
0027   0878           00028         movfw 0x078                                     ; prvni byte prikazoveho zasobniku
0028   01F3           00029         clrf PRIJATYCH_DAT                      ; prikaz byl vybran -> prazdny zasobnik
0029   3C01           00030         sublw h'01'                                     ; ...pokud to byl prikaz 01h...
002A   1D03           00031         btfss STATUS,Z
002B   2822           00032         goto CEK_PRIKAZ_01h
                      00033 
002C   082E           00034         movfw ATA_ATTRIBUTES            ; ...vodesleme zpet vlastnosti disku a jeho jmenovku (vis. popis
                             protokolu)
002D   21D0           00035         call WR_USART
002E   21E0           00036         call ODESLI_MODEL_NUMBER        ; odesleme jmeno disku 
                      00037 
                      00038 
                      00039         PROG_PAGE_2
002F   118A               M                         bcf PCLATH,3
0030   160A               M                         bsf PCLATH,4
0031   2000           00040         call SCAN_MBR                           ; najdeme oddily s FAT32 a jejich seznam dame do bufferu
                             2
                      00041         PROG_PAGE_0
0032   118A               M                         bcf PCLATH,3
0033   120A               M                         bcf PCLATH,4
0034                  00042 CEK_PRIKAZ_02h_03h
                      00043         PROG_PAGE_1
0034   158A               M                         bsf PCLATH,3
0035   120A               M                         bcf PCLATH,4
0036   2119           00044         call CEKEJ_PRIKAZ                       ; pockame si na prikaz
0037   01F5           00045         clrf STAV_PRIKAZU                       ; smazeme registr signalizujici platnost prikazu
0038   211E           00046         call PRIKAZ_02h                         ; testujeme zda prisel prikaz 02h, pokud ano tak jej pro
                            vedeme a nastavime platnost prikazu
0039   213F           00047         call PRIKAZ_03h                         ; ---//---
                      00048         PROG_PAGE_0
003A   118A               M                         bcf PCLATH,3
003B   120A               M                         bcf PCLATH,4
003C   1C75           00049         btfss STAV_PRIKAZU,0            ; Pokud si zadna z procedur prikaz neprevzala, ...
003D   01F3           00050         clrf PRIJATYCH_DAT                      ; ...vymazeme zasobnik prikazu. (prikaz neni pro tuto ch
                            vili platny)
003E   1E2E           00051         btfss ATA_ATTRIBUTES,FAT32_LOAD ; cekame dokud nedojde k nasteni nejakeho oddilu
003F   2834           00052         goto CEK_PRIKAZ_02h_03h         ; pokud byl oddil vporadku nacten, pokracujeme...
                      00053 
0040   01EE           00054         clrf PREH_STAV0
                      00055 ;*******************************************************************************************************
                            *************
                      00056 ;*******************************************************************************************************
                            *************
                      00057 ;*******************************************************************************************************
                            *************
                      00058 ;*******************************************************************************************************
                            *************
0041                  00059 BIG_LOOP
                      00060         ; Tady ta smycka beha po nacteni disku a nejake FATky porad dokola.
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00061         ; Pri kazdem prubehu smyckou vyresime prikazy, ktere prisly, a pokud prehravame 
                      00062         ; nejakou mp3 tak dekoder nakrmime jednim sektorem...
                      00063         ; Mimo to je v teto smycce osefovano, ze kdyz skonci mp3, nacteme dalsi... (v zavislosti na nast
                            aveni repeatu)
0041   0873           00064         movfw PRIJATYCH_DAT
0042   39FF           00065         andlw h'FF'
0043   1903           00066         btfsc STATUS,Z
0044   2862           00067         goto BIG_LOOP__NENI_PRIKAZ
                      00068         
0045   01F5           00069         clrf STAV_PRIKAZU                       ; smazeme registr signalizujici platnost prikazu
                      00070         ; Pokud jsme tady, tak prisel nejaky prikaz, jdem predat prikaz jednotlivym proceduram
                      00071         PROG_PAGE_1
0046   158A               M                         bsf PCLATH,3
0047   120A               M                         bcf PCLATH,4
0048   215D           00072         call PRIKAZ_04h                         ; testujeme zda prisel prikaz 04h, pokud ano tak jej pro
                            vedeme a nastavime platnost prikazu
0049   216A           00073         call PRIKAZ_05h                         ; --- // ---
004A   219B           00074         call PRIKAZ_06h                         ; --- // ---
004B   21BD           00075         call PRIKAZ_07h                         ; --- // ---
004C   21E4           00076         call PRIKAZ_08h                         ; --- // ---
004D   2212           00077         call PRIKAZ_09h                         ; --- // ---
004E   2245           00078         call PRIKAZ_0Ah                         ; --- // ---
                      00079         PROG_PAGE_2
004F   118A               M                         bcf PCLATH,3
0050   160A               M                         bsf PCLATH,4
0051   21D3           00080         call PRIKAZ_0Bh                         ; --- // ---
0052   21F5           00081         call PRIKAZ_0Ch                         ; --- // ---
0053   2239           00082         call PRIKAZ_0Dh                         ; --- // ---
                      00083         PROG_PAGE_1
0054   158A               M                         bsf PCLATH,3
0055   120A               M                         bcf PCLATH,4
                      00084 
0056   2273           00085         call PRIKAZ_80h                         ; --- // ---
0057   22DF           00086         call PRIKAZ_81h                         ; --- // ---
0058   22FE           00087         call PRIKAZ_82h                         ; --- // ---
0059   2314           00088         call PRIKAZ_83h                         ; --- // ---
005A   2348           00089         call PRIKAZ_84h                         ; --- // ---
                      00090         PROG_PAGE_2
005B   118A               M                         bcf PCLATH,3
005C   160A               M                         bsf PCLATH,4
005D   2257           00091         call PRIKAZ_85h                         ; --- // ---
                      00092         PROG_PAGE_0
005E   118A               M                         bcf PCLATH,3
005F   120A               M                         bcf PCLATH,4
                      00093         
0060   1C75           00094         btfss STAV_PRIKAZU,0            ; Pokud si zadna z procedur prikaz neprevzala, ...
0061   01F3           00095         clrf PRIJATYCH_DAT                      ; ...vymazeme zasobnik prikazu. (prikaz neni pro tuto ch
                            vili platny)
                      00096 
0062                  00097 BIG_LOOP__NENI_PRIKAZ
0062   0857           00098         movfw KONST_NECINNOSTI1
0063   0558           00099         andwf KONST_NECINNOSTI2,w
0064   3CFF           00100         sublw h'FF'
0065   1903           00101         btfsc STATUS,Z
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0066   286B           00102         goto BIG_LOOP__NO_STANDBY       ; pokud je KONST_NECINNOSTI = h'FFFF', tak disk nechame porad za
                            pnuty
                      00103         
0067   0855           00104         movfw CITAC_NECINNOSTI1
0068   0456           00105         iorwf CITAC_NECINNOSTI2,w
0069   1903           00106         btfsc STATUS,Z
006A   234D           00107         call ATA_STANDBY                        ; pokud z disku jsme jiz dlouho nic necetli, tak jej dam
                            e do STANDBY
                      00108                                                                 ; potrebna doba je v KONST_NECINNOSTI
                      00109 
006B                  00110 BIG_LOOP__NO_STANDBY
                      00111 
006B   1C6E           00112         btfss PREH_STAV0,0                      ; Pokud je zvoleno play,...
006C   28FE           00113         goto MP3_NOT_PLAY
                      00114 
006D   1CEE           00115         btfss PREH_STAV0,1                      ; ...a je co prehravat...
006E   28FE           00116         goto MP3_NOT_PLAY
                      00117         
006F   086D           00118         movfw PREH_DATA_POZICE
0070   024C           00119         subwf CLUSTER_SIZE,W
0071   1D03           00120         btfss STATUS,Z                          ; ...podivame se zda jiz nejsme na konci clusteru...
0072   28C1           00121         goto SEND_MP3_DATA
                      00122 
0073   0853           00123         movfw PREH_D_FRAGMENT1          ; ...pokud ano, podivame se zda nejsme na posledni casti fragmen
                            tu...
0074   0454           00124         iorwf PREH_D_FRAGMENT2,w
0075   1D03           00125         btfss STATUS,Z
0076   2897           00126         goto BIG_LOOP_DEC_FRAGMENT      ; ...pokud ne, tak PREH_D_FRAGMENT1-- ; PREH_DATA_CL++
                      00127 
0077   0869           00128         movfw PREH_DATA_CL1                     ; ...pokud jo, tak si najdeme dalsi cluster v retezci.
0078   00BC           00129         movwf CLUSTER1
0079   086A           00130         movfw PREH_DATA_CL2
007A   00BD           00131         movwf CLUSTER2
007B   086B           00132         movfw PREH_DATA_CL3
007C   00BE           00133         movwf CLUSTER3
007D   086C           00134         movfw PREH_DATA_CL4
007E   00BF           00135         movwf CLUSTER4
                      00136 
007F   01ED           00137         clrf PREH_DATA_POZICE
0080   241F           00138         call NEXT_CLUSTER
0081   083C           00139         movfw CLUSTER1
0082   00E9           00140         movwf PREH_DATA_CL1
0083   083D           00141         movfw CLUSTER2
0084   00EA           00142         movwf PREH_DATA_CL2
0085   083E           00143         movfw CLUSTER3
0086   00EB           00144         movwf PREH_DATA_CL3
0087   083F           00145         movfw CLUSTER4
0088   00EC           00146         movwf PREH_DATA_CL4
                      00147         
0089   1C3B           00148         btfss POZICE,0                          ; Pokud byl cluster posledni v retezci...
008A   2891           00149         goto BIG_LOOP_DALSI_FRAGMENT
                      00150 
008B   20FF           00151         call DALSI_SKLADBA                      ; ...tak najdeme dalsi soubor co se ma prehrat (pokud je
                             nastaven repeat a dalsi kraviny)
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00152         ; otestujeme zda se ma nejaka dalsi mp3 prehravat
008C   1C6E           00153         btfss PREH_STAV0,0                      ; Je zvoleno play?
008D   28FE           00154         goto MP3_NOT_PLAY
008E   1CEE           00155         btfss PREH_STAV0,1                      ; Je co prehravat?
008F   28FE           00156         goto MP3_NOT_PLAY
0090   28C1           00157         goto SEND_MP3_DATA
                      00158 
0091                  00159 BIG_LOOP_DALSI_FRAGMENT
0091   24A7           00160         call ZJISTI_FRAGMENT
                      00161 
0092   0851           00162         movfw FRAGMENT1
0093   00D3           00163         movwf PREH_D_FRAGMENT1
0094   0852           00164         movfw FRAGMENT2
0095   00D4           00165         movwf PREH_D_FRAGMENT2
                      00166 
                      00167         ;movlw 'F'
                      00168         ;call WR_USART
                      00169 
0096   28C1           00170         goto SEND_MP3_DATA
0097                  00171 BIG_LOOP_DEC_FRAGMENT
                      00172         ;----------------------------
0097   082F           00173         movfw VS_LOUDNESS
0098   39FF           00174         andlw h'FF'
0099   1903           00175         btfsc STATUS,Z                          ; pokud je nastaven nejaky filter, tak jej reaktivujeme.
                            ..
009A   28B1           00176         goto BIG_LOOP_DEC_FRAGMENT_NO_PLUG
                      00177 
009B   300A           00178         movlw VSADDR_AIADDR
009C   00B6           00179         movwf TEMP1
009D   3000           00180         movlw 0x00
009E   00B7           00181         movwf TEMP2     
009F   3042           00182         movlw 0x42
00A0   00B8           00183         movwf TEMP3
                      00184         PROG_PAGE_1
00A1   158A               M                         bsf PCLATH,3
00A2   120A               M                         bcf PCLATH,4
00A3   2063           00185         call VS_WR_REG                          ; nastavime zacatek uzivatelskeho programu (0x4200)
                      00186         PROG_PAGE_0
00A4   118A               M                         bcf PCLATH,3
00A5   120A               M                         bcf PCLATH,4
                      00187 
00A6   300D           00188         movlw VSADDR_AICTRL0
00A7   00B6           00189         movwf TEMP1
00A8   082F           00190         movfw VS_LOUDNESS
00A9   00B7           00191         movwf TEMP2     
00AA   3000           00192         movlw 0x00
00AB   00B8           00193         movwf TEMP3
                      00194         PROG_PAGE_1     
00AC   158A               M                         bsf PCLATH,3
00AD   120A               M                         bcf PCLATH,4
00AE   2063           00195         call VS_WR_REG                          ; nastavime pozadovany filter
                      00196         PROG_PAGE_0
00AF   118A               M                         bcf PCLATH,3
00B0   120A               M                         bcf PCLATH,4
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00197 
00B1                  00198 BIG_LOOP_DEC_FRAGMENT_NO_PLUG
                      00199         ;----------------------------
                      00200 
                      00201         ; PREH_D_FRAGMENT1 --
00B1   3001           00202         movlw .1
00B2   02D3           00203         subwf PREH_D_FRAGMENT1,f
00B3   1803           00204         btfsc STATUS,C
00B4   28B6           00205         goto $+2
00B5   02D4           00206         subwf PREH_D_FRAGMENT2,f
                      00207 
                      00208         ; PREH_DATA_CL ++
00B6   0AE9           00209         incf PREH_DATA_CL1,f
00B7   1D03           00210         btfss STATUS,Z
00B8   28C0           00211         goto $+8
00B9   0AEA           00212         incf PREH_DATA_CL2,f
00BA   1D03           00213         btfss STATUS,Z
00BB   28C0           00214         goto $+5
00BC   0AEB           00215         incf PREH_DATA_CL3,f
00BD   1D03           00216         btfss STATUS,Z
00BE   28C0           00217         goto $+2
00BF   0AEC           00218         incf PREH_DATA_CL4,f
                      00219 
00C0   01ED           00220         clrf PREH_DATA_POZICE
                      00221 
00C1                  00222 SEND_MP3_DATA
00C1   1C6F           00223         btfss PREH_STAV1,0                      ; 0. bit = 1 => previjeni mp3 dopredu
00C2   28DC           00224         goto NOT_MP3_REWIND_FORWARD
00C3   14CD           00225         bsf VSREG_MODE_L,1                      ; fast forward on
                      00226 
00C4   1D6F           00227         btfss PREH_STAV1,2                      ; 2. bit = 1 => previji se pomalu, vzdy se po nejake dob
                            e kratky usek souboru prehraje  
00C5   28D0           00228         goto MP3_REWIND_FORWARD
                      00229 
00C6   0868           00230         movfw PREH_CITAC_PREV           ; MP3 previjime pomalu...
00C7   3C14           00231         sublw .20                                       ; ...podivame se kolik sektoru jsme previnuly...
00C8   1803           00232         btfsc STATUS,C                          ; ...pokud jich je vic jak 20...
00C9   28D0           00233         goto MP3_REWIND_FORWARD         ; 
                      00234         
00CA   10CD           00235         bcf VSREG_MODE_L,1                      ; ...tak dalsi pustime normalne. (fast forward off)
                      00236 
00CB   0868           00237         movfw PREH_CITAC_PREV
00CC   3C19           00238         sublw .25
00CD   1D03           00239         btfss STATUS,Z                          ; pokud jsme jich uz normalne pustily 5, ... (25-20)
00CE   28D0           00240         goto MP3_REWIND_FORWARD
                      00241 
00CF   01E8           00242         clrf PREH_CITAC_PREV            ; ...vymazeme citac previjeni (zas nejaky sektory pustime rychle
                            )
00D0                  00243 MP3_REWIND_FORWARD
00D0   3000           00244         movlw VSADDR_MODE
00D1   00B6           00245         movwf TEMP1
00D2   084D           00246         movfw VSREG_MODE_L
00D3   00B7           00247         movwf TEMP2
00D4   01B8           00248         clrf TEMP3
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00249         PROG_PAGE_1     
00D5   158A               M                         bsf PCLATH,3
00D6   120A               M                         bcf PCLATH,4
00D7   2063           00250         call VS_WR_REG
                      00251         PROG_PAGE_0
00D8   118A               M                         bcf PCLATH,3
00D9   120A               M                         bcf PCLATH,4
                      00252         
00DA   196F           00253         btfsc PREH_STAV1,2                      ; 2. bit = 1 => previji se pomalu, vzdy se po nejake dob
                            e kratky usek souboru prehraje  
00DB   0AE8           00254         incf PREH_CITAC_PREV,f
00DC                  00255 NOT_MP3_REWIND_FORWARD
                      00256 
00DC   0869           00257         movfw PREH_DATA_CL1                     ; Mame zjisteny cluster a jeho cast, kterou mame prehrav
                            at...
00DD   00BC           00258         movwf CLUSTER1
00DE   086A           00259         movfw PREH_DATA_CL2
00DF   00BD           00260         movwf CLUSTER2
00E0   086B           00261         movfw PREH_DATA_CL3
00E1   00BE           00262         movwf CLUSTER3
00E2   086C           00263         movfw PREH_DATA_CL4
00E3   00BF           00264         movwf CLUSTER4
00E4   086D           00265         movfw PREH_DATA_POZICE
00E5   00BB           00266         movwf POZICE
                      00267 
00E6   23BC           00268         call CLUSTER_TO_LBA                     ; zjistime si skutecnou polohu dat na disku...
00E7   3001           00269         movlw .1
00E8   00A6           00270         movwf SECTOR_C
00E9   2315           00271         call READ_SECTOR                        ; dame prikaz precist data...
                      00272 
00EA   1487           00273         bsf MP3_CS                                      ; po SI posilam data
00EB   3000           00274         movlw .0                                        ; posilame celkem 256 slov
00EC   00B6           00275         movwf TEMP1             
00ED                  00276 SEND_MP3_WORD
                      00277         PROG_PAGE_1
00ED   158A               M                         bsf PCLATH,3
00EE   120A               M                         bcf PCLATH,4
00EF   20DE           00278         call WAIT_FOR_VSDREQ
                      00279         PROG_PAGE_0
00F0   118A               M                         bcf PCLATH,3
00F1   120A               M                         bcf PCLATH,4
00F2   22B8           00280         call READ_DATA
00F3   0820           00281         movfw DATA_L
                      00282         PROG_PAGE_1
00F4   158A               M                         bsf PCLATH,3
00F5   120A               M                         bcf PCLATH,4
00F6   2000           00283         call VS_WR_BYTE
00F7   0821           00284         movfw DATA_H
00F8   2000           00285         call VS_WR_BYTE
                      00286         PROG_PAGE_0
00F9   118A               M                         bcf PCLATH,3
00FA   120A               M                         bcf PCLATH,4
00FB   0BB6           00287         decfsz TEMP1,f  
00FC   28ED           00288         goto SEND_MP3_WORD
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00289 
00FD   0AED           00290         incf PREH_DATA_POZICE,f
00FE                  00291 MP3_NOT_PLAY
                      00292 
00FE   2841           00293         goto BIG_LOOP
                      00294 ;*******************************************************************************************************
                            *************
                      00295 ;*******************************************************************************************************
                            *************
                      00296 ;*******************************************************************************************************
                            *************
                      00297 ;*******************************************************************************************************
                            *************
00FF                  00298 DALSI_SKLADBA
                      00299         ; tato procedura je volana, kdyz skonci mp3, aby nasla v adresari dalsi mp3 ktera se ma prehrava
                            t...
00FF   106E           00300         bcf PREH_STAV0,0                ; 0. bit =      0 => stop nebo pausa (nic nehraje)
0100   10EE           00301         bcf PREH_STAV0,1                ; 1. bit =      0 => neni zadny soubor k prehravani (nastaveni b
                            itu play nema zadny ucinek)
0101   116E           00302         bcf PREH_STAV0,2                ; 2. bit =      1 => je nastaven, kdyz se zmeni prehravany soubo
                            r (bez volani prikazu) do doby, nez prijde prikaz na dotaz STAVU... (81h)
0102   106F           00303         bcf PREH_STAV1,0                ; 0. bit =  0 => normalni prehravani (mp3 se nepreviji)
0103   19EE           00304         btfsc PREH_STAV0,3              ; 3. bit =      0 => po skonceni souboru se pokracuje v prehrava
                            ni (zavisi na nastaveni repeatu)
0104   0008           00305         return
                      00306 
                      00307 ; PREH_STAV0
                      00308 ;       4. bit =        0 => repeat off
                      00309 ;                               1 => repeat on
                      00310 ;       5. bit =        0 => repeat adresare (prvni cluster adresare musi byt nastaven v PREH_ADDR_ZACAT
                            EK_CL[1-4] )
                      00311 ;                               1 => repeat souboru (po skonceni prehravani souboru se ten samy soubor z
                            acne prehravat znova)
0105   1E6E           00312         btfss PREH_STAV0,4
0106   2939           00313         goto DALSI_SKLADBA_NO_R_S
0107   1EEE           00314         btfss PREH_STAV0,5
0108   2939           00315         goto DALSI_SKLADBA_NO_R_S       
0109                  00316 DALSI_SKLADBA_REPAT_SOUBORU
0109   0862           00317         movfw PREH_ADR_CL1
010A   00BC           00318         movwf CLUSTER1
010B   0863           00319         movfw PREH_ADR_CL2
010C   00BD           00320         movwf CLUSTER2
010D   0864           00321         movfw PREH_ADR_CL3
010E   00BE           00322         movwf CLUSTER3
010F   0865           00323         movfw PREH_ADR_CL4
0110   00BF           00324         movwf CLUSTER4
0111   0866           00325         movfw PREH_ZAZNAM1
0112   00E0           00326         movwf ZAZNAM1
0113   0867           00327         movfw PREH_ZAZNAM2
0114   00E1           00328         movwf ZAZNAM2
                      00329 
                      00330         PROG_PAGE_1
0115   158A               M                         bsf PCLATH,3
0116   120A               M                         bcf PCLATH,4
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0117   23B6           00331         call SKOC_NA_ZAZNAM
                      00332         PROG_PAGE_0
0118   118A               M                         bcf PCLATH,3
0119   120A               M                         bcf PCLATH,4
011A   183B           00333         btfsc POZICE,0                          ; tento test by tu byt nemusel, protoze jsme jiz tento s
                            oubor hrali, jeden ale nikdy nevi...
011B   0008           00334         return
                      00335         PROG_PAGE_1
011C   158A               M                         bsf PCLATH,3
011D   120A               M                         bcf PCLATH,4
011E   2436           00336         call FILE_INFO
                      00337         PROG_PAGE_0
011F   118A               M                         bcf PCLATH,3
0120   120A               M                         bcf PCLATH,4
                      00338 
                      00339         INDF_BANK_2
0121   1783               M                         bsf STATUS,IRP    
                      00340         ; ...nastavime jej jako prehravany soubor.
0122   301C           00341         movlw 0x1C                                      ; 13. byte bufferu 2
0123   0084           00342         movwf FSR
0124   0800           00343         movfw INDF
0125   00E9           00344         movwf PREH_DATA_CL1
0126   00BC           00345         movwf CLUSTER1
0127   0A84           00346         incf FSR,f
0128   0800           00347         movfw INDF
0129   00EA           00348         movwf PREH_DATA_CL2
012A   00BD           00349         movwf CLUSTER2
012B   0A84           00350         incf FSR,f
012C   0800           00351         movfw INDF
012D   00EB           00352         movwf PREH_DATA_CL3
012E   00BE           00353         movwf CLUSTER3
012F   0A84           00354         incf FSR,f
0130   0800           00355         movfw INDF
0131   00EC           00356         movwf PREH_DATA_CL4
0132   00BF           00357         movwf CLUSTER4
                      00358 
0133   24A7           00359         call ZJISTI_FRAGMENT
                      00360 
0134   0851           00361         movfw FRAGMENT1
0135   00D3           00362         movwf PREH_D_FRAGMENT1
0136   0852           00363         movfw FRAGMENT2
0137   00D4           00364         movwf PREH_D_FRAGMENT2
                      00365 
0138   2985           00366         goto DALSI_SKLADBA_PLAY         ; nic jineho nemusime nastavovat, protoze hrajeme ten samy soubo
                            r co predtim
0139                  00367 DALSI_SKLADBA_NO_R_S
                      00368 ; PREH_STAV0
                      00369 ;       4. bit =        0 => repeat off
                      00370 ;                               1 => repeat on
                      00371 ;       5. bit =        0 => repeat adresare (prvni cluster adresare musi byt nastaven v PREH_ADDR_ZACAT
                            EK_CL[1-4] )
                      00372 ;                               1 => repeat souboru (po skonceni prehravani souboru se ten samy soubor z
                            acne prehravat znova)
                      00373         ; tak ted jdem hledat dalsi soubor v adresari...
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 21


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00374         
                      00375 ;       HL_PARAMETRY    -- parametry hledani
                      00376 ;       HL_ADR_CL[1-4]  -- prnvi cluster prohledavaneho adresare
                      00377 ;       ZAZNAM[1-2]             -- zaznam od ktereho hledame
0139   3006           00378         movlw b'00000110'
013A   00D9           00379         movwf HL_PARAMETRY
013B   0862           00380         movfw PREH_ADR_CL1
013C   00DA           00381         movwf HL_ADR_CL1
013D   0863           00382         movfw PREH_ADR_CL2
013E   00DB           00383         movwf HL_ADR_CL2
013F   0864           00384         movfw PREH_ADR_CL3
0140   00DC           00385         movwf HL_ADR_CL3
0141   0865           00386         movfw PREH_ADR_CL4
0142   00DD           00387         movwf HL_ADR_CL4
0143   0866           00388         movfw PREH_ZAZNAM1
0144   00E0           00389         movwf ZAZNAM1
0145   0867           00390         movfw PREH_ZAZNAM2
0146   00E1           00391         movwf ZAZNAM2
                      00392         
                      00393         PROG_PAGE_1
0147   158A               M                         bsf PCLATH,3
0148   120A               M                         bcf PCLATH,4
0149   24CE           00394         call HLEDEJ
                      00395         PROG_PAGE_0     
014A   118A               M                         bcf PCLATH,3
014B   120A               M                         bcf PCLATH,4
                      00396 
                      00397         INDF_BANK_2
014C   1783               M                         bsf STATUS,IRP    
014D   3030           00398         movlw 0x30
014E   0084           00399         movwf FSR
014F   0800           00400         movfw INDF
0150   3C06           00401         sublw h'06'
0151   1903           00402         btfsc STATUS,Z
0152   2968           00403         goto DALSI_SKLADBA_MAME_SOUBOR
                      00404 
                      00405         ; zadny dalsi mp3 soubor v adresari neni...
0153   1E6E           00406         btfss PREH_STAV0,4                              ; ..podivame se, zda neni nastaven repeat slozky
0154   0008           00407         return
                      00408 
                      00409         ; je nastaven repeat slozky a uz neni co prehravat. Jdem hledat prvni mp3 ve slozce...
                      00410 
                      00411         ; HL_PARAMETRY
                      00412         ;               7. bit - tento bit nelze nastavit uzivatelem
                      00413         ;                               = 0 > adresar je ROOT
                      00414         ;                               = 1 > adresar neni ROOT 
0155   3006           00415         movlw b'00000110'                               ; parametry hledani, pokud hledame prvni mp3 adr
                            esari ktery neni ROOT 
                      00416                                                                         ; (prvni zaznam je ukazatel na p
                            redchozi adresar)
0156   1FD9           00417         btfss HL_PARAMETRY,7
0157   300E           00418         movlw b'00001110'                               ; parametry hledani, pokud hledame prvni mp3 v R
                            OOT adresari (prvni zaznam)
0158   00D9           00419         movwf HL_PARAMETRY
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 22


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00420 
0159   3001           00421         movlw h'01'                                             ; prvni cluster prohledavaneho adresare 
                            mame jiz nastaven,
015A   00E0           00422         movwf ZAZNAM1                                   ; parametry taky, ted jen zaznam od klereho hled
                            ame... 
015B   01E1           00423         clrf ZAZNAM2                                    ; (pokud hledame v ROOTu, hledame prvni zaznam)
                      00424 
                      00425         PROG_PAGE_1
015C   158A               M                         bsf PCLATH,3
015D   120A               M                         bcf PCLATH,4
015E   24CE           00426         call HLEDEJ
                      00427         PROG_PAGE_0     
015F   118A               M                         bcf PCLATH,3
0160   120A               M                         bcf PCLATH,4
                      00428 
                      00429         INDF_BANK_2
0161   1783               M                         bsf STATUS,IRP    
0162   3030           00430         movlw 0x30
0163   0084           00431         movwf FSR
0164   0800           00432         movfw INDF
0165   3C06           00433         sublw h'06'
0166   1D03           00434         btfss STATUS,Z
0167   0008           00435         return                                                  ; sem bychom se nemeli dostat, protoze k
                            dyz uz neco hralo, tak tu nejaky soubor musi byt?!
                      00436         ;goto DALSI_SKLADBA_MAME_SOUBOR
0168                  00437 DALSI_SKLADBA_MAME_SOUBOR
                      00438         INDF_BANK_2
0168   1783               M                         bsf STATUS,IRP    
0169   303C           00439         movlw 0x3C
016A   0084           00440         movwf FSR
016B   0800           00441         movfw INDF
016C   00E9           00442         movwf PREH_DATA_CL1
016D   00BC           00443         movwf CLUSTER1
016E   0A84           00444         incf FSR,f
016F   0800           00445         movfw INDF
0170   00EA           00446         movwf PREH_DATA_CL2
0171   00BD           00447         movwf CLUSTER2
0172   0A84           00448         incf FSR,f
0173   0800           00449         movfw INDF
0174   00EB           00450         movwf PREH_DATA_CL3
0175   00BE           00451         movwf CLUSTER3
0176   0A84           00452         incf FSR,f
0177   0800           00453         movfw INDF
0178   00EC           00454         movwf PREH_DATA_CL4
0179   00BF           00455         movwf CLUSTER4
017A   0A84           00456         incf FSR,f
017B   0800           00457         movfw INDF
017C   00E6           00458         movwf PREH_ZAZNAM1
017D   0A84           00459         incf FSR,f
017E   0800           00460         movfw INDF
017F   00E7           00461         movwf PREH_ZAZNAM2
                      00462 
0180   24A7           00463         call ZJISTI_FRAGMENT
                      00464 
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 23


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0181   0851           00465         movfw FRAGMENT1
0182   00D3           00466         movwf PREH_D_FRAGMENT1
0183   0852           00467         movfw FRAGMENT2
0184   00D4           00468         movwf PREH_D_FRAGMENT2
                      00469 
                      00470 
0185                  00471 DALSI_SKLADBA_PLAY
0185   01ED           00472         clrf PREH_DATA_POZICE
0186   146E           00473         bsf PREH_STAV0,0
0187   14EE           00474         bsf PREH_STAV0,1                        ; nastavime si vlastosti prehravani: (PREH_STAV[0-1])
0188   156E           00475         bsf PREH_STAV0,2
                      00476 
                      00477         PROG_PAGE_1
0189   158A               M                         bsf PCLATH,3
018A   120A               M                         bcf PCLATH,4
018B   2094           00478         call VS_SOFT_RESET
                      00479 
018C   10CD           00480         bcf VSREG_MODE_L,1                      ; prehravame normalni rychlosti 
018D   106F           00481         bcf PREH_STAV1,0                        ; prehravame normalni rychlosti 
                      00482         
018E   3000           00483         movlw VSADDR_MODE
018F   00B6           00484         movwf TEMP1
0190   084D           00485         movfw VSREG_MODE_L
0191   00B7           00486         movwf TEMP2
0192   01B8           00487         clrf TEMP3
0193   2063           00488         call VS_WR_REG
                      00489         PROG_PAGE_0
0194   118A               M                         bcf PCLATH,3
0195   120A               M                         bcf PCLATH,4
                      00490         
0196   0008           00491         return
                      00492 ;*******************************************************************************************************
                            *************
0197                  00493 INIT_PORT
                      00494         BANK_1
0197   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0198   1683               M                 bsf     STATUS,RP0    
                      00495 
0199   3091           00496         movlw b'10010001'                       ; bity SO a DREQ jako vstupy (signaly z dekoderu)
019A   0087           00497         movwf MP3_PORT_TRIS
019B   3000           00498         movlw b'00000000'                       ; adresovani disku jako vystupy
019C   0085           00499         movwf ATA_ADDRESS_TRIS          
019D   3000           00500         movlw .0
019E   0089           00501         movwf ATA_CONTROL_TRIS          ; ovladani disku jako vystupy
019F   30FF           00502         movlw 0xff
01A0   0086           00503         movwf DATA_PORT_LOW_TRIS        ; datovou sbernici jako vstupy
01A1   0088           00504         movwf DATA_PORT_HIGH_TRIS       
                      00505         BANK_0
01A2   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
01A3   1283               M                 bcf     STATUS,RP0    
                      00506         
01A4   3007           00507         movlw b'00000111'       ; signal reset-, diow- a dior- jsou aktivni v log. 0 !!!
01A5   0089           00508         movwf ATA_CONTROL
01A6   3037           00509         movlw b'00110111'       ; CS1-, CS0- = 1 => datova sbernice disku je odpojena
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 24


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01A7   0085           00510         movwf ATA_ADDRESS
01A8   0187           00511         clrf MP3_PORT   
01A9   0008           00512         return
                      00513 ;**********************************************************
01AA                  00514 INIT_CONFIG     ; nakonfiguruje preruseni, WDT, USART, pull ups....
                      00515         BANK_0
01AA   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
01AB   1283               M                 bcf     STATUS,RP0    
01AC   3031           00516         MOVLW b'00110001'       ; preddelicka 1:8, timer1 on, interni osc
01AD   0090           00517         MOVWF T1CON                     ; 
01AE   018F           00518         clrf TMR1H
01AF   018E           00519         clrf TMR1L
                      00520 
                      00521         BANK_1
01B0   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
01B1   1683               M                 bsf     STATUS,RP0    
01B2   30C7           00522         movlw b'11000111'       ; ...pull up a podobny koniny
                      00523                 ; PORTB Pull-up Enable bit              1 = pull up enabled
                      00524                 ; Interrupt Edge Select bit             1 = interrupt on rising edge of RB0/INT pin
                      00525                 ; TMR0 Clock Source Select bit  0 = Internal instruction cycle clock (CLKO)
                      00526                 ; TMR0 Source Edge Select bit   0 = Increment on low-to-high transition on RA4/T0CKI pin
                      00527                 ; Prescaler Assignment bit              0 = Prescaler is assigned to the Timer0 module
                      00528                 ; PS2:PS0: Prescaler Rate Select bits   111 = TMR0 Rate 1 : 256; WDT Rate 1 : 128
01B3   0081           00529         movwf OPTION_REG
                      00530         
01B4   3020           00531         movlw b'00100000'       ; povolime preruseni od USARTu (kdyz neco dostanem)
01B5   008C           00532         movwf PIE1      
01B6   3000           00533         movlw b'00000000'       ; ostatni vnejsi preruseni vymaskujeme
01B7   008D           00534         movwf PIE2                      
01B8   140C           00535         bsf PIE1, TMR1IE        ; Enable Timer1 interrupt
                      00536 
01B9   30C0           00537         movlw b'11000000'       ; povolime preruseni na vnejsi zarizeni (USART)                         
01BA   008B           00538         movwf INTCON
                      00539 
01BB   3026           00540         movlw b'00100110'       ;konfigurace USARTu (asynchronni, 8bit, bez parity, rychle - (BRGH = 1))
01BC   0098           00541         movwf TXSTA
                      00542         BANK_0
01BD   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
01BE   1283               M                 bcf     STATUS,RP0    
01BF   3090           00543         movlw b'10010000'       ;zapnu USART
01C0   0098           00544         movwf RCSTA
                      00545         BANK_1
01C1   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
01C2   1683               M                 bsf     STATUS,RP0    
01C3   3081           00546         movlw .129              ; Fosc = 20 MHz, BRGH=1 => rychlost = 9615 bps
                      00547         ;movlw .103     ; Fosc = 16 MHz, BRGH=1 => rychlost = 9615 bps
01C4   0099           00548         movwf SPBRG     
                      00549 
01C5   3007           00550         movlw b'00000111'
01C6   009F           00551         movwf ADCON1            ; vsechny vstupy (RA,RE) jako digitalni
                      00552         BANK_0  
01C7   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
01C8   1283               M                 bcf     STATUS,RP0    
01C9   019F           00553         clrf ADCON0                     ; pro jistotu (vypneme A/D prevodniky)
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 25


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00554 
01CA   01F3           00555         clrf PRIJATYCH_DAT      ; zasobnik prikazu prazdny...
01CB   3070           00556         movlw h'70'     
01CC   00D7           00557         movwf KONST_NECINNOSTI1
01CD   3017           00558         movlw h'17'                     ; 1770h = 6000d => pri 0.1s preruseni 10 minut
01CE   00D8           00559         movwf KONST_NECINNOSTI2
  00000058            00560 KONST_NECINNOSTI2       equ 0x058
                      00561 
01CF   0008           00562         return
                      00563 ;**********************************************************
01D0                  00564 WR_USART        ; odesle slovo ve workingu po USARTu
                      00565                         ; prijimani dat je reseno prez preruseni...
                      00566         BANK_1  
01D0   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
01D1   1683               M                 bsf     STATUS,RP0    
01D2   1C98           00567         btfss TXSTA,1 
01D3   29D0           00568         goto WR_USART   ; cekame do chvile nez bude pripraven transmit buffer 
                      00569 
                      00570         BANK_0  
01D4   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
01D5   1283               M                 bcf     STATUS,RP0    
01D6   0099           00571         movwf TXREG
01D7   0008           00572         return
                      00573 ;**********************************************************
                      00574 ; tento podprogram bude pro budouci praci zbytecny, je zde jen proto, abych na PC videl ze program byl s
                            pusten...
                      00575 ;POZDRAV  ; odesle po seriove lince pozdrav
                      00576 ;       movlw 'A'       
                      00577 ;       call WR_USART
                      00578 ;       movlw 'h'
                      00579 ;       call WR_USART
                      00580 ;       movlw 'o'
                      00581 ;       call WR_USART
                      00582 ;       movlw 'j'
                      00583 ;       call WR_USART
                      00584 ;       movlw '!'
                      00585 ;       call WR_USART
                      00586 ;       return
                      00587 ;**********************************************************
                      00588 ; odesle data, ktera jdou z disku USARTEM. Pocet dat je v reg. TEMP1
01D8                  00589 ODESLI_DATA
01D8   22B8           00590         call READ_DATA  
01D9   0820           00591         movfw DATA_L
01DA   21D0           00592         call WR_USART
01DB   0821           00593         movfw DATA_H
01DC   21D0           00594         call WR_USART   
01DD   0BB6           00595         decfsz TEMP1,F
01DE   29D8           00596         goto ODESLI_DATA
01DF   0008           00597         return
                      00598 ;**********************************************************
01E0                  00599 ODESLI_MODEL_NUMBER     ; Podprogram IDENTIFY_DEVICE nam do bufferu 1 hodil jmeno disku
                      00600                         ; mi jej ted odesleme USARTem, aby mohl byt zobrazen na displeji
                      00601         INDF_BANK_3     ; BUFFER_1 je v bance 3
01E0   1783               M                         bsf STATUS,IRP    
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 26


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01E1   3090           00602         movlw 0x90      ; na adrese 90
01E2   0084           00603         movwf FSR
01E3   3014           00604         movlw .20       ; budeme odesilat 20 slov (40 znaku)
01E4   00B6           00605         movwf TEMP1
01E5                  00606 ODESLI_MODEL_NUMBER_ODESILANI
01E5   0800           00607         movfw INDF
01E6   00B7           00608         movwf TEMP2     ; data do bufferu byla vkladana stylem DATA_L, DATA_H, DATA_L, DATA_H...
01E7   0A84           00609         incf FSR,F      ; ASCII hodnoty jsou ale razeny stylem DATA_H, DATA_L, DATA_H, DATA_L...
01E8   0800           00610         movfw INDF      ; proto to pisu tak slozite...
01E9   0A84           00611         incf FSR,F
                      00612         
01EA   21D0           00613         call WR_USART
01EB   0837           00614         movfw TEMP2
01EC   21D0           00615         call WR_USART   
                      00616 
01ED   0BB6           00617         decfsz TEMP1,F
01EE   29E5           00618         goto ODESLI_MODEL_NUMBER_ODESILANI
                      00619 
                      00620         INDF_BANK_0     
01EF   1383               M                         bcf STATUS,IRP    
01F0   0008           00621         return
                      00622 ;**********************************************************
01F1                  00623 ODESLI_BUFF2_HIGH
                      00624         ; odesle z horni poloviny bufferu2 tolik bytu, kolik je v TEMP1
                      00625         INDF_BANK_2     ; BUFFER_2 je v bance 2
01F1   1783               M                         bsf STATUS,IRP    
01F2   3030           00626         movlw 0x30      ; horni pulka od adresy 30h
01F3   0084           00627         movwf FSR
01F4                  00628 ODESLI_BUFF2_HIGH_ODESILANI
01F4   0800           00629         movfw INDF
01F5   21D0           00630         call WR_USART
01F6   0A84           00631         incf FSR,F      
01F7   0BB6           00632         decfsz TEMP1,F
01F8   29F4           00633         goto ODESLI_BUFF2_HIGH_ODESILANI
                      00634 
                      00635         INDF_BANK_0             
01F9   1383               M                         bcf STATUS,IRP    
01FA   0008           00636         return
                      00637 ;**************************************************************************
01FB                  00638 ODESLI_BUFFER2
                      00639         ; v TEMP1 ocakava hodnotu kolik bytu ma odeslat
                      00640         INDF_BANK_2     ; BUFFER_2 je v bance 2
01FB   1783               M                         bsf STATUS,IRP    
01FC   3010           00641         movlw 0x10      ; na adrese 10
01FD   0084           00642         movwf FSR
01FE                  00643 ODESLI_BUFFER2_ODESILANI
01FE   0800           00644         movfw INDF
01FF   21D0           00645         call WR_USART
0200   0A84           00646         incf FSR,F      
0201   0BB6           00647         decfsz TEMP1,F
0202   29FE           00648         goto ODESLI_BUFFER2_ODESILANI
                      00649 
                      00650         INDF_BANK_0             
0203   1383               M                         bcf STATUS,IRP    
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 27


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0204   0008           00651         return
                      00652 ;**********************************************************
0205                  00653 INTERRUPT                                       ; sem se skace po zavolani preruseni (uz jsou vyreseny u
                            lohy dulezitych registru)
0205   1A8C           00654         btfsc PIR1,RCIF                 ; testujeme o jake preruseni jde
0206   2A18           00655         goto INTERRUPT_USART    ; Pokud jde o preruseni od USARTU, skocime...
0207   180C           00656         btfsc PIR1,TMR1IF               ; testujeme o jake preruseni jde
0208   2A0A           00657         goto INTERRUPT_TIMER1   ; Pokud jde o preruseni od TIMER1, skocime...
0209   2A24           00658         goto END_OF_INTERRUPT   ; Pokud jde o jine preruseni, koncime
                      00659 
020A                  00660 INTERRUPT_TIMER1
020A   100C           00661         bcf PIR1,TMR1IF
020B   30DF           00662         movlw h'df'
020C   008E           00663         movwf TMR1L
020D   300B           00664         movlw h'0b'
020E   008F           00665         movwf TMR1H
                      00666 
                      00667 ;       movfw CITAC_NECINNOSTI1
                      00668 ;       iorwf CITAC_NECINNOSTI2,w
                      00669 ;       btfsc STATUS,Z
                      00670 ;       call WR_USART
                      00671 
020F   0855           00672         movfw CITAC_NECINNOSTI1
0210   0456           00673         iorwf CITAC_NECINNOSTI2,w
0211   1903           00674         btfsc STATUS,Z
0212   2A24           00675         goto END_OF_INTERRUPT   ; pokud je CITAC_NECINNOSTI = 0, nic se nedekrementuje
                      00676         
0213   3001           00677         movlw .1
0214   02D5           00678         subwf CITAC_NECINNOSTI1,f
0215   1C03           00679         btfss STATUS,C
0216   02D6           00680         subwf CITAC_NECINNOSTI2,f
                      00681 
0217   2A24           00682         goto END_OF_INTERRUPT
                      00683 
0218                  00684 INTERRUPT_USART
0218   081A           00685         movfw RCREG                             ; !!! vynulovat pøíznak !!!     
0219   00F4           00686         movwf PRIJATE_DATO
                      00687 
021A   0873           00688         movfw PRIJATYCH_DAT
021B   3C07           00689         sublw .7                                ; pokud je v zasobniku uz plno (PRIJATYCH_DAT=8), tak ko
                            ncime
021C   1C03           00690         btfss STATUS,C
021D   2A24           00691         goto END_OF_INTERRUPT   ; Zasobnik je plny, nic prijimat nebudeme
                      00692 
021E   0873           00693         movfw PRIJATYCH_DAT
021F   3E78           00694         addlw 0x78                              ; zacatek zasobniku prikazu
0220   0084           00695         movwf FSR
0221   0874           00696         movfw PRIJATE_DATO              ; prijmuta data -> do W
0222   0080           00697         movwf INDF                              ; prijate dato na prvni volne misto v zasobniku
                      00698         
0223   0AF3           00699         incf  PRIJATYCH_DAT,F   ; pricteme k indikaci zasobniku
                      00700 ;       movlw '['
                      00701 ;       call WR_USART
                      00702 ;       movfw PRIJATYCH_DAT
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 28


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00703 ;       addlw .48
                      00704 ;       call WR_USART
                      00705 ;       movlw ']'
                      00706 ;       call WR_USART   
0224                  00707 END_OF_INTERRUPT                        ; sem skocime kdyz mame vsechny veci kolem preruseni vyrizeny
0224   0876           00708         movfw TEMP_PCLATH
0225   008A           00709         movwf PCLATH
0226   0872           00710         movfw TEMP_FSR
0227   0084           00711         movwf FSR
0228   0871           00712         movfw TEMP_STATUS
0229   0083           00713         movwf STATUS
022A   0870           00714         movfw TEMP_WORKING
022B   0009           00715         retfie
                      00716 ;**********************************************************
022C                  00717 DELAY_2ms
                      00718 ; (Fosc = 20 MHz , instr. cyklus= 200 ns) 2 000us / 0.2  us = 10 000 instrukcnich cyklu
                      00719 ;Variables: TMP1, TMP0
                      00720 ;Delay 10001 cycles
022C   3010           00721         MOVLW 0x10  ;16 DEC
022D   00B6           00722         MOVWF TMP1
022E   30CF           00723         MOVLW 0x0CF  ;207 DEC
022F   00B8           00724         MOVWF TMP0
0230   0BB8           00725         DECFSZ TMP0,F
0231   2A30           00726         GOTO $-1
0232   0BB6           00727         DECFSZ TMP1,F
0233   2A2E           00728         GOTO $-5
                      00729 ;End of Delay
0234   0008           00730         return
                      00731 ;**********************************************************
0235                  00732 DELAY_200ms
                      00733 ; (Fosc = 20 MHz , instr. cyklus= 200 ns) 200 000us / 0.2  us = 1 000 000 instrukcnich cyklu
                      00734 ;Variables: TMP2, TMP1, TMP0
                      00735 ;Delay 1000000 cycles
0235   3015           00736         MOVLW 0x15  ;21 DEC
0236   00B7           00737         MOVWF TMP2
0237   3059           00738         MOVLW 0x59  ;89 DEC
0238   00B6           00739         MOVWF TMP1
0239   30B1           00740         MOVLW 0x0B1  ;177 DEC
023A   00B8           00741         MOVWF TMP0
023B   0BB8           00742         DECFSZ TMP0,F
023C   2A3B           00743         GOTO $-1
023D   0BB6           00744         DECFSZ TMP1,F
023E   2A39           00745         GOTO $-5
023F   0BB7           00746         DECFSZ TMP2,F
0240   2A37           00747         GOTO $-9
                      00748 ;End of Delay
0241   0008           00749         return
                      00750 ;**********************************************************
                      00073         include "ata.asm"               ; podprogramy na ovladani ATA disku
                      00001 ;**********************************************************
                      00002 ;**********************************************************
                      00003 ;**********************************************************
                      00004 ; OBSLUZNE PODPROGRAMY PRO ATA
                      00005 ;**********************************************************
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 29


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00006 ;**********************************************************
                      00007 ;**********************************************************
                      00008 
                      00009 ;**********************************************************
                      00010 ; cteni a zapis ATA registru 
                      00011 ;**********************************************************
0242                  00012 RD_STATUS         
0242   3027           00013         movlw D_STATUS      ; Status 
0243   2295           00014         call RUTR 
0244   00AC           00015         movwf ATA_STATUS
0245   0008           00016         return
                      00017 ;*****************************************
0246                  00018 RD_ERROR
0246   3021           00019         movlw D_ERROR      ; Error
0247   2295           00020         call RUTR
0248   00A5           00021         movwf ATA_ERROR
0249   0008           00022         return
                      00023 ;*****************************************
                      00024 ;RD_STATUS_A     
                      00025 ;       movlw D_STATUS_A    ; Alternate Status 
                      00026 ;       call RUTR 
                      00027 ;       movwf ATA_STATUS_A
                      00028 ;       return
                      00029 ;*****************************************
024A                  00030 RD_SC
024A   3022           00031         movlw D_SECTOR_C    ; Sector Count
024B   2295           00032         call RUTR
024C   00A6           00033         movwf SECTOR_C
024D   0008           00034         return
                      00035 ;*****************************************
024E                  00036 RD_LBA1
024E   3023           00037         movlw D_LBA1    ; Sector Number 
024F   2295           00038         call RUTR                
0250   00A7           00039         movwf LBA1 
0251   0008           00040         return
                      00041 ;*****************************************
0252                  00042 RD_LBA2
0252   3024           00043         movlw D_LBA2  ; Cylinder Low
0253   2295           00044         call RUTR
0254   00A8           00045         movwf LBA2
0255   0008           00046         return
                      00047 ;*****************************************
0256                  00048 RD_LBA3
0256   3025           00049         movlw D_LBA3  ; Cylinder High   
0257   2295           00050         call RUTR
0258   00A9           00051         movwf LBA3
0259   0008           00052         return
                      00053 ;*****************************************
025A                  00054 RD_DEVICE
025A   3026           00055         movlw D_DEVICE  ; Device Head
025B   2295           00056         call RUTR
025C   00AB           00057         movwf DEVICE
025D   0008           00058         return
                      00059 ;*****************************************
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 30


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00060 ;*****************************************
025E                  00061 WR_DC
025E   0823           00062         movf DEVICE_C,w     ; Device Control
025F   00B5           00063         movwf TEMPW
0260   301E           00064         movlw D_DEVICE_C
0261   22A2           00065         call RUTW
0262   0008           00066         return
                      00067 ;*****************************************
0263                  00068 WR_COMMAND          
0263   082D           00069         movf COMMAND,w      ; Command       
0264   00B5           00070         movwf TEMPW
0265   3027           00071         movlw D_COMMAND
0266   22A2           00072         call RUTW
0267   0008           00073         return
                      00074 ;*****************************************
0268                  00075 WR_SC                    
0268   0826           00076     movf SECTOR_C,w     ; Sector Count
0269   00B5           00077         movwf TEMPW
026A   3022           00078         movlw D_SECTOR_C     
026B   22A2           00079         call RUTW
026C   0008           00080         return
                      00081 ;*****************************************
026D                  00082 WR_LBA1
026D   0827           00083         movf LBA1,w     
026E   00B5           00084         movwf TEMPW
026F   3023           00085         movlw D_LBA1    
0270   22A2           00086         call RUTW
0271   0008           00087         return
                      00088 ;*****************************************
0272                  00089 WR_LBA2
0272   0828           00090         movf LBA2,w   ; Cylinder Low
0273   00B5           00091         movwf TEMPW
0274   3024           00092         movlw D_LBA2
0275   22A2           00093         call RUTW
0276   0008           00094         return
                      00095 ;*****************************************
0277                  00096 WR_LBA3
0277   0829           00097         movf LBA3,w   ; Cylinder High
0278   00B5           00098         movwf TEMPW
0279   3025           00099         movlw D_LBA3
027A   22A2           00100         call RUTW
027B   0008           00101         return
                      00102 ;*****************************************
027C                  00103 WR_DEVICE
027C   082B           00104         movf DEVICE,w     ; Device Head 
027D   00B5           00105         movwf TEMPW
027E   3026           00106         movlw D_DEVICE
027F   22A2           00107         call RUTW
0280   0008           00108         return
                      00109 ;*****************************************
0281                  00110 WR_FEATURES
0281   0824           00111         movf FEATURES,w     ; Features
0282   00B5           00112         movwf TEMPW
0283   3021           00113         movlw D_FEATURES
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 31


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0284   22A2           00114         call RUTW
0285   0008           00115         return
                      00116 ;*****************************************
                      00117 ; zapise vsechny registry potrebne k vykonani prikazu (adresove registry a prikaz)
0286                  00118 WR_BLOCK
                      00119 ;       call WAIT_FOR_READY_FOR_COMMAND
0286   2242           00120         call RD_STATUS
0287   182C           00121         btfsc ATA_STATUS,ERR
0288   2A8D           00122         goto $+5                                        ; Nastal error disku. Co budeme delat? S*r*m* na
                             to a jdeme dal
0289   1BAC           00123         btfsc ATA_STATUS,BSY
028A   2A86           00124         goto $-4                                        ; Bsy <> 0, cekame dal 
028B   1F2C           00125         btfss ATA_STATUS,DRDY
028C   2A86           00126         goto $-6
                      00127 
028D   2281           00128         call WR_FEATURES
028E   2268           00129         call WR_SC
028F   226D           00130         call WR_LBA1
0290   2272           00131         call WR_LBA2
0291   2277           00132         call WR_LBA3
0292   227C           00133         call WR_DEVICE
0293   2263           00134         call WR_COMMAND
0294   0008           00135         return
                      00136 ;*****************************************
                      00137 ; ve workingu mame adresu registru ktery mame precist, 
                      00138 ; pak v nem vracime jeho hodnotu...
0295                  00139 RUTR          
0295   0085           00140         movwf ATA_ADDRESS                  ; adresa pozadovaneho registru
                      00141 
                      00142         BANK_1
0296   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0297   1683               M                 bsf     STATUS,RP0    
0298   30FF           00143     movlw 0xFF
0299   0086           00144     movwf DATA_PORT_LOW_TRIS   ; z datove zbernice cteme
029A   0088           00145     movwf DATA_PORT_HIGH_TRIS
                      00146         BANK_0
029B   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
029C   1283               M                 bcf     STATUS,RP0    
                      00147 
029D   1109           00148         bcf ATA_DIOR_N
029E   0000           00149     nop                                                 ; PIO delay min. 120ns (PIO 4)  
029F   0806           00150     movfw DATA_PORT_LOW                 ; Read DD0..D7 IDE
02A0   1509           00151         bsf ATA_DIOR_N
                      00152 
02A1   0008           00153     return
                      00154 ;**********************************************************
                      00155 ; ve workingu mame adresu registru ktery mame zapsat,
                      00156 ; a v reg. TEMPW hodnotu kterou mame do tohoto registru zapsat
02A2                  00157 RUTW
02A2   0085           00158         movwf ATA_ADDRESS
                      00159 
                      00160         BANK_1
02A3   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
02A4   1683               M                 bsf     STATUS,RP0    
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 32


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02A5   3000           00161     movlw 0x0
02A6   0086           00162     movwf DATA_PORT_LOW_TRIS   ; do datove sbernice zapisujeme
02A7   0088           00163     movwf DATA_PORT_HIGH_TRIS
                      00164         BANK_0
02A8   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
02A9   1283               M                 bcf     STATUS,RP0    
                      00165 
02AA   0835           00166     movf TEMPW,w        
02AB   0086           00167     movwf DATA_PORT_LOW                 ; Write DD0..DD7 IDE 
02AC   0188           00168         clrf DATA_PORT_HIGH
                      00169 
02AD   1089           00170         bcf ATA_DIOW_N
02AE   0000           00171         nop
02AF   1489           00172         bsf ATA_DIOW_N
                      00173           
                      00174         BANK_1
02B0   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
02B1   1683               M                 bsf     STATUS,RP0    
02B2   30FF           00175     movlw 0xff
02B3   0086           00176     movwf DATA_PORT_LOW_TRIS   ; datova sbernice na cteni
02B4   0088           00177     movwf DATA_PORT_HIGH_TRIS
                      00178         BANK_0
02B5   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
02B6   1283               M                 bcf     STATUS,RP0    
                      00179 
02B7   0008           00180         return
                      00181 ;**********************************************************
02B8                  00182 READ_DATA
                      00183 ;       call WAIT_FOR_DATA      ; tento odskok do dalsich podprogramu si nemohu, dovolit, protoze mam je
                            n 8bit STACK
                      00184         ; Wait: ( Bsy=0 AND Drq=1 ) OR err=1
                      00185         ; 7   6    5  4   3   2    1   0
                      00186         ; BSY DRDY DF DSC DRQ CORR IDX ERR
                      00187         ; (cekame az disk bude mit pro nas prichystana data)
02B8   3027           00188         movlw D_STATUS      ; Status 
02B9   2295           00189         call RUTR 
02BA   00AC           00190         movwf ATA_STATUS
02BB   182C           00191         btfsc ATA_STATUS,ERR
02BC   2AC1           00192         goto READ_DATA_CTEME            ; Nastal error disku. Co budeme delat? S*r*m* na to a data prect
                            eme...
                      00193 
02BD   1BAC           00194         btfsc ATA_STATUS,BSY
02BE   2AB8           00195         goto READ_DATA                          ; Bsy <> 0, cekame dal 
                      00196         
02BF   1DAC           00197         btfss ATA_STATUS,DRQ
02C0   2AB8           00198         goto READ_DATA                          ; Drq <> 1, cekame dal 
                      00199         
02C1                  00200 READ_DATA_CTEME
02C1   0857           00201         movfw KONST_NECINNOSTI1
02C2   00D5           00202         movwf CITAC_NECINNOSTI1
02C3   0858           00203         movfw KONST_NECINNOSTI2
02C4   00D6           00204         movwf CITAC_NECINNOSTI2         ; disk je vypinan po urcite dobe necinosti
02C5   12AE           00205         bcf ATA_ATTRIBUTES,STANDBY
                      00206 
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 33


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02C6   3020           00207     movlw D_DATA_R
02C7   0085           00208         movwf ATA_ADDRESS
                      00209 
                      00210         BANK_1
02C8   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
02C9   1683               M                 bsf     STATUS,RP0    
02CA   30FF           00211     movlw 0xFF
02CB   0086           00212     movwf DATA_PORT_LOW_TRIS   ; z datove zbernice cteme
02CC   0088           00213     movwf DATA_PORT_HIGH_TRIS
                      00214         BANK_0
02CD   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
02CE   1283               M                 bcf     STATUS,RP0    
                      00215 
02CF   1109           00216         bcf ATA_DIOR_N
02D0   0000           00217     nop                                                 ; PIO delay min. 120ns (PIO 4)  
02D1   0000           00218         nop
02D2   0806           00219     movfw DATA_PORT_LOW                 ; Read DD0..D7 IDE
02D3   00A0           00220         movwf DATA_L
02D4   0808           00221     movfw DATA_PORT_HIGH                ; Read DD8..D15 IDE
02D5   00A1           00222         movwf DATA_H
02D6   1509           00223         bsf ATA_DIOR_N
                      00224 
02D7   0008           00225     return
                      00226 ;**********************************************************
                      00227 ; stava se, ze obcas nas zajima jen cast vracenych dat, tak ty ktere nas nezajimaji, preskocime
                      00228 ; ocakava parametr v registru TEMP1 (kolik slov ma preskocit)
                      00229 ; pokud TEMP1 = 0 tak preskoci 256 slov
02D8                  00230 PRESKOC
02D8   22B8           00231         call READ_DATA
02D9   0BB6           00232         decfsz TEMP1,F
02DA   2AD8           00233         goto PRESKOC
02DB   0008           00234         return
                      00235 ;**********************************************************
                      00236 ; rekne disku na ze pristi instrukce, registry, data.... budou pro mastera
02DC                  00237 SELECT_DEVICE
02DC   30E0           00238         movlw b'11100000'       ; adresy budou v LBA, budeme pracovat s masterem
02DD   00AB           00239         movwf DEVICE
02DE   227C           00240         call WR_DEVICE
02DF   0008           00241         return
                      00242 ;**********************************************************
02E0                  00243 ZAPIS_DO_BUFFERU_1      ; buffer1 ma 64B a je v bance 3 na adrese 0x190 - 0x1CF
                      00244                                         ; jako parametr dostanem TEMP1, kde je pocet bytu k zapisu
                      00245                                         ; maximalni hodnota v TEMP1 muze byt 32 (1 slovo = 2 byty)
                      00246         INDF_BANK_3             ; neprime adresovani na banku 3
02E0   1783               M                         bsf STATUS,IRP    
02E1   3090           00247         movlw 0x90              ; adresa ja 190, devaty byt urcuje banku (0,1 / 2,3) fsr je tedy 90
02E2   0084           00248         movwf FSR               
02E3                  00249 ZAPIS_DO_BUFFERU_1__ZAPIS
02E3   22B8           00250         call READ_DATA
                      00251         
02E4   0820           00252         movfw DATA_L
02E5   0080           00253         movwf INDF
02E6   0A84           00254         incf FSR,F
02E7   0821           00255         movfw DATA_H
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 34


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02E8   0080           00256         movwf INDF
02E9   0A84           00257         incf FSR,F
                      00258 
02EA   0BB6           00259         decfsz TEMP1,F
02EB   2AE3           00260         goto ZAPIS_DO_BUFFERU_1__ZAPIS
                      00261 
                      00262         INDF_BANK_0     
02EC   1383               M                         bcf STATUS,IRP    
02ED   0008           00263         return
                      00264 ;**********************************************************
02EE                  00265 CLEAR_BUFFER2           ; BUFFER2 je 64bytu dat v bance 2 na adrese 0x110 - 0x14F
                      00266                                         ; pouziva TEMP1
02EE   3040           00267         movlw .64
02EF   00B6           00268         movwf TEMP1
                      00269         INDF_BANK_2             ; neprime adresovani na banku 2
02F0   1783               M                         bsf STATUS,IRP    
02F1   3010           00270         movlw 0x10
02F2   0084           00271         movwf FSR
02F3   3000           00272         movlw .0
                      00273 
02F4                  00274 CLEAR_BEFFER2__CLEAR
02F4   0080           00275         movwf INDF
02F5   0A84           00276         incf FSR,F
02F6   0BB6           00277         decfsz TEMP1,F
02F7   2AF4           00278         goto CLEAR_BEFFER2__CLEAR
                      00279 
                      00280         INDF_BANK_0             ; neprime adresovani na banku 0
02F8   1383               M                         bcf STATUS,IRP    
02F9   0008           00281         return
                      00282 ;**********************************************************
02FA                  00283 ATA_RESET
                      00284         ; Resetuje disk zjisti, zda vubec nejaky disk je pripojen
02FA   01AE           00285         clrf ATA_ATTRIBUTES     ; registr obsahujici bity rikajici co disk umi
                      00286 
02FB   1009           00287         bcf ATA_RESET_N         ; resetujeme disk
02FC   23B1           00288         call DELAY_25us         ; signal reset musi byt min. 25us
02FD   1409           00289         bsf ATA_RESET_N         ; koncime s resetem disku
                      00290 
02FE   23B6           00291         call WAIT_FOR_READY     ; vynulujeme device bit v DEVICE registru (disk musi byt master!), ...
02FF   22DC           00292         call SELECT_DEVICE      ; ...nastavime bit L - LBA addressing
                      00293 
0300   23B6           00294         call WAIT_FOR_READY
0301   3002           00295         movlw b'00000010'       ; zakazeme preruseni (ted mam na mysli signal INTRQ z disku)
0302   00A3           00296         movwf DEVICE_C          ; bit nIEN = 1 -> zakazeme preruseni disku (stejne nemame signal INTRQ p
                            ripojen)
0303   225E           00297         call WR_DC                      ; zapiseme hodnotu do registru DEVICE CONTROL
                      00298 
0304   30E0           00299         movlw b'11100000'       ; adresy budou v LBA, budeme pracovat s masterem
0305   00AB           00300         movwf DEVICE
0306   01A6           00301         clrf SECTOR_C
0307   01A7           00302         clrf LBA1       
0308   01A8           00303         clrf LBA2
0309   01A9           00304         clrf LBA3
030A   01A4           00305         clrf FEATURES
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 35


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

030B   3000           00306         movlw h'00'                     ; code prikazu nop
030C   00AD           00307         movwf COMMAND
030D   2286           00308         call WR_BLOCK           ; ted provedeme prvni prikaz (nop) a podivame se co nam disk vrati
                      00309 
030E   23B6           00310         call WAIT_FOR_READY
030F   225A           00311         call RD_DEVICE          ; Precteme reg. device. Pokud je disk OK, tak by nam mel vratit to, co j
                            sme do nej predtim zapsaly
0310   082B           00312         movfw DEVICE
0311   3CE0           00313         sublw b'11100000'
0312   1903           00314         btfsc STATUS,Z          ; pokud DEVICE <> b'11100000', tak tu bud disk nemame, nebo je nejakej r
                            ozsypanej, nebo je spatne svicivanej (treba SLAVE)
0313   142E           00315         bsf ATA_ATTRIBUTES,ATA_OK       ; 0. bit = 1 -> disk je pritomen, zapnuty a funkcni...
                      00316 
0314   0008           00317         return          
                      00318 ;**********************************************************
0315                  00319 READ_SECTOR
                      00320         ; Tento podprogram prevezme parametry SECTOR_C (kolik sec. mame precist)
                      00321         ; a LBA1 - LBA4, kde je ulozena LBA adresa sectoru od ktereho mame cist
                      00322         ; Postara se o spravne zadani adresy do disku (LBA28 / LBA48) a zavolani prikazu ke cteni...
                      00323         ; Samotne cteni se musi obslouzit v jine casti programu (podle toho co cteme...)
                      00324 
                      00325 ;       call WAIT_FOR_READY
                      00326         ; Cekame az Bsy bit = 0 
0315   2242           00327         call RD_STATUS
0316   182C           00328         btfsc ATA_STATUS,ERR
0317   2B1A           00329         goto $+3                                        ; Nastal error disku. Co budeme delat? S*r*m* na
                             to a jdeme dal
0318   1BAC           00330         btfsc ATA_STATUS,BSY
0319   2B15           00331         goto $-4                                        ; Bsy <> 0, cekame dal 
                      00332 
                      00333 
                      00334 ;       call SELECT_DEVICE
031A   30E0           00335         movlw b'11100000'       ; adresy budou v LBA, budeme pracovat s masterem
031B   00AB           00336         movwf DEVICE
031C   227C           00337         call WR_DEVICE
                      00338 
                      00339 ;       call WAIT_FOR_READY_FOR_COMMAND
031D   2242           00340         call RD_STATUS
031E   182C           00341         btfsc ATA_STATUS,ERR
031F   2B24           00342         goto $+5                                        ; Nastal error disku. Co budeme delat? S*r*m* na
                             to a jdeme dal
0320   1BAC           00343         btfsc ATA_STATUS,BSY
0321   2B1D           00344         goto $-4                                        ; Bsy <> 0, cekame dal 
0322   1F2C           00345         btfss ATA_STATUS,DRDY
0323   2B1D           00346         goto $-6
                      00347 
0324   192E           00348         btfsc ATA_ATTRIBUTES,LBA48_SUPPORT
0325   2B35           00349         goto READ_SECTOR_LBA48
                      00350 
0326                  00351 READ_SECTOR_LBA27               ; zadavani adresy v LBA28 je celkem jednoduche, LBA bity 24-27 jsou obsa
                            zene v dolnich 4 bitech DEVICE reg.
0326   01A4           00352         clrf FEATURES
0327   2281           00353         call WR_FEATURES
0328   2268           00354         call WR_SC
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 36


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0329   226D           00355         call WR_LBA1
032A   2272           00356         call WR_LBA2
032B   2277           00357         call WR_LBA3
032C   082A           00358         movfw LBA4                      ; Z nejvyssi casti adresy...
032D   390F           00359         andlw b'00001111'       ; ...pouzijeme pouze dolni 4bity...
032E   38E0           00360         iorlw b'11100000'       ; ...horni 3bity nastavime (LBA adresovani, master)...
032F   00AB           00361         movwf DEVICE            ; ...a zapiseme do DEVICE.
0330   227C           00362         call WR_DEVICE
0331   3020           00363         movlw 0x20                      ; Read sector. OPCODE - 20h (with retries) or 21h (without retri
                            es)
0332   00AD           00364         movwf COMMAND           ; ...podle me to znamena ze prikaz 20h se bude pri neuspechu pokouset zn
                            ova o cteni....
0333   2263           00365         call WR_COMMAND         ; ...protoze se v novejsich spicifacich jiz prikaz 21h nevyskytuje, pouz
                            ivam ke cteni 20h.
0334   0008           00366         return
                      00367 
0335                  00368 READ_SECTOR_LBA48
                      00369         ; !!! Pripominam ze to co zde pisu (o LBA48) vim ze specifikace ATA8, v praxi jsem LBA48 na zadn
                            em disku jeste nezkousel !!!
                      00370         ; Zadavani adresy pri LBA48 se o neco lisi nez LBA28. Do registru LBA 1,2,3 se data zadavaji 2x.
                             
                      00371         ; Prvi zadavani znamena horni cast adresy, druhe zadavani dolni cast adresy.
                      00372         ; Znova sem pisu ze v tomto programu vyuzijeme jen LBA o 32bitech (2TB) a ne celych LBA48
0335   3000           00373         movlw .0
0336   00B5           00374         movwf TEMPW
0337   3022           00375         movlw D_SECTOR_C    ; vyssi cast parametru SECTOR_C = 0
0338   22A2           00376         call RUTW       
0339   2268           00377         call WR_SC                      ; nizci cast parametru SECTOR_C
                      00378 
033A   3000           00379         movlw .0
033B   00B5           00380         movwf TEMPW
033C   3025           00381         movlw D_LBA3            ; LBA bity 47:40
033D   22A2           00382         call RUTW
033E   3000           00383         movlw .0
033F   00B5           00384         movwf TEMPW
0340   3024           00385         movlw D_LBA2            ; LBA bity 39:32
0341   22A2           00386         call RUTW
0342   082A           00387         movfw LBA4
0343   00B5           00388         movwf TEMPW
0344   3023           00389         movlw D_LBA1            ; LBA bity 31:24
0345   22A2           00390         call RUTW
                      00391 
0346   2277           00392         call WR_LBA3            ; LBA bity 23:16
0347   2272           00393         call WR_LBA2            ; LBA bity 15:8
0348   226D           00394         call WR_LBA1            ; LBA bity  7:0
0349   3024           00395         movlw h'24'                     ; pri LBA48 se musi pouzit tohoto prikazu ke cteni (READ SECTOR(
                            S) EXT - 24h, PIO data-in)
034A   00AD           00396         movwf COMMAND
034B   2263           00397         call WR_COMMAND
034C   0008           00398         return
                      00399 ;**********************************************************
034D                  00400 ATA_STANDBY
034D   1AAE           00401         btfsc ATA_ATTRIBUTES,STANDBY
034E   0008           00402         return                                          ; pokud disk jiz je ve standby, nebudeme posilat
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 37


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                             prikaz
                      00403                                                                 ; tento bit je nulovan pri cteni z disku
                      00404 
034F   01A4           00405         clrf FEATURES
0350   01A6           00406         clrf SECTOR_C
0351   01A7           00407         clrf LBA1
0352   01A8           00408         clrf LBA2
0353   01A9           00409         clrf LBA3
                      00410 
0354   3096           00411         movlw h'96'
0355   00AD           00412         movwf COMMAND
                      00413 
0356   2242           00414         call RD_STATUS
0357   182C           00415         btfsc ATA_STATUS,ERR
0358   2B5D           00416         goto $+5                                        ; Nastal error disku. Co budeme delat? S*r*m* na
                             to a jdeme dal
0359   1BAC           00417         btfsc ATA_STATUS,BSY
035A   2B56           00418         goto $-4                                        ; Bsy <> 0, cekame dal 
035B   1F2C           00419         btfss ATA_STATUS,DRDY
035C   2B56           00420         goto $-6
                      00421 
035D   2281           00422         call WR_FEATURES
035E   2268           00423         call WR_SC
035F   226D           00424         call WR_LBA1
0360   2272           00425         call WR_LBA2
0361   2277           00426         call WR_LBA3
0362   227C           00427         call WR_DEVICE
0363   2263           00428         call WR_COMMAND
0364   16AE           00429         bsf ATA_ATTRIBUTES,STANDBY
0365   0008           00430         return
                      00431 ;**********************************************************
0366                  00432 IDENTIFY_DEVICE
                      00433         ; ted uz vime, ze mame pripojen nejaky disk, tento podprogram provede prikaz 
                      00434         ; identify device a zjisti co je disk zac. Nektere dulezite informace ulozi 
                      00435         ; (nastavi byty v ATA_ATTRIBUTES) a jmenovku disku hodi do bufferu
                      00436 
                      00437         ; rekneme disku, ze s nim chcem pracovat (s masterem)
0366   23B6           00438         call WAIT_FOR_READY
0367   22DC           00439         call SELECT_DEVICE
                      00440         
                      00441         ; podivame se zda tu vubec disk je a co podporuje (LBA)
0368   23B6           00442         call WAIT_FOR_READY     ; celame nez bude disk opet ready pro dalsi prikazy
                      00443 
0369   30E0           00444         movlw b'11100000'       ; adresy budou v LBA, budeme pracovat s masterem
036A   00AB           00445         movwf DEVICE
036B   01A6           00446         clrf SECTOR_C
036C   01A7           00447         clrf LBA1       
036D   01A8           00448         clrf LBA2
036E   01A9           00449         clrf LBA3
036F   01A4           00450         clrf FEATURES
0370   30EC           00451         movlw 0xEC                      ; code prikazu IDENTIFY DEVICE
0371   00AD           00452         movwf COMMAND
0372   2286           00453         call WR_BLOCK
                      00454 
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 38


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00455         ; pokud se neco nepodelalo, dostanem 256 16ti bitovych slov kde je napsano co disk umi a co je t
                            o zac...
                      00456         ; slova cisluji od nuly, (tzn. ze slov je 0-255)
0373   301B           00457         movlw .27               ; prvnich 27 slov je pro nas nepotrebnych
0374   00B6           00458         movwf TEMP1
0375   22D8           00459         call PRESKOC
                      00460         
                      00461         ; [27-46] model mumber (ASCI retezec s nazvem disku)
                      00462         ; tady precteme 20 slov a rovnou je odesleme do pric
                      00463                 ; pokud nekde od disku dostavame ASCII retezec jsou data nasledujici: 
                      00464                 ; pr. disk nam posila string “Copyright”
                      00465                 ;               1. DATA_H = 'C' 
                      00466                 ;               1. DATA_l = 'o'
                      00467                 ;               2. DATA_H = 'P' 
                      00468                 ;               2. DATA_l = 'y'
0376   3014           00469         movlw .20               ; dalsich 20 slov obsahuje 40 s ASCII znaku s nazvem disku
0377   00B6           00470         movwf TEMP1
0378   22E0           00471         call ZAPIS_DO_BUFFERU_1
                      00472                 
                      00473         ; ted jsme uz precetli 47 slov z 256 :-)
0379   3002           00474         movlw .2                ; dalsi 2 slova jsou nam k nicemu
037A   00B6           00475         movwf TEMP1
037B   22D8           00476         call PRESKOC
                      00477                 
037C   22B8           00478         call READ_DATA  ; slovo 49 - capabilities (schopnosti)
                      00479                         ; 15:14 Reserved for the IDENTIFY PACKET DEVICE command.
                      00480                         ;    13 1 = Standby timer values as specified in this standard are supported
                      00481                         ;       0 = Standby timer values shall be managed by the device
                      00482                         ;    12 Reserved for the IDENTIFY PACKET DEVICE command.
                      00483                         ;    11 1 = IORDY supported
                      00484                         ;       0 = IORDY may be supported
                      00485                         ;    10 1 = IORDY may be disabled
                      00486                         ;     9 1 = LBA supported
                      00487                         ;     8 1 = DMA supported.
                      00488                         ;   7:0 Retired 
037D   18A1           00489         btfsc DATA_H,1  ;bit 9 = 1 -> LBA supported
037E   14AE           00490         bsf ATA_ATTRIBUTES,LBA_SUPPORT
                      00491 
                      00492         ;precetli jsme 50 slov
037F   300A           00493         movlw .10
0380   00B6           00494         movwf TEMP1
0381   22D8           00495         call PRESKOC
                      00496         
0382   22B8           00497         call READ_DATA  ; 60
0383   0820           00498         movfw DATA_L
                      00499 ;       movwf PARAM_MAX_LBA1            ; nejnizsi cast adresy
0384   0821           00500         movfw DATA_H
                      00501 ;       movwf PARAM_MAX_LBA2    
                      00502         
0385   22B8           00503         call READ_DATA  ; 61
0386   0820           00504         movfw DATA_L
                      00505 ;       movwf PARAM_MAX_LBA3
0387   0821           00506         movfw DATA_H
                      00507 ;       movwf PARAM_MAX_LBA4            ; nejvyssi cast adresy
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 39


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00508         
                      00509         ;precetli jsme 62 slov, zbyva 194
0388   3015           00510         movlw .21
0389   00B6           00511         movwf TEMP1
038A   22D8           00512         call PRESKOC
                      00513 
                      00514         ; 83 slov, na rade je slovo 83 (pripominam ze slova jsou cislovana od nuly)
038B   22B8           00515         call READ_DATA  ; 83 - command supported. Tady nas zajima bit 10 - 1 = 48-bit Address feature se
                            t supported
038C   1921           00516         btfsc DATA_H,2  ; pokud disk umi LBA 48 pripiseme tuto skutecnost do ATA_ATTRIBUTES
038D   152E           00517         bsf ATA_ATTRIBUTES,LBA48_SUPPORT
                      00518 
                      00519         ;precetli jsme 84 slov
038E   3010           00520         movlw .16
038F   00B6           00521         movwf TEMP1
0390   22D8           00522         call PRESKOC
                      00523                 
0391   1D2E           00524         btfss ATA_ATTRIBUTES,LBA48_SUPPORT
0392   2B9A           00525         goto INIT_ATA__NOT_SUPPORT_LBA48
                      00526                         ; pokud je podporovano LBA 48, nachazi se ve slovech [100-103] skutecny pocet se
                            ktoru 
                      00527                         ; do slov 60-61 by se sice vesel pocet sektoru u disku do 2TB, podle standardu s
                            e tam ale zapisuje pouze hodnota max pro LBA 28 (cca 120 GB)
                      00528                         ; mi precteme ale jen nejnizsi 2 slova, predpokladam totiz ze disk neni vetsi ja
                            k 2TB
0393   22B8           00529                         call READ_DATA  ; 100
0394   0820           00530                         movfw DATA_L
                      00531 ;                       movwf PARAM_MAX_LBA1            ; nejnizsi cast adresy
0395   0821           00532                         movfw DATA_H
                      00533 ;                       movwf PARAM_MAX_LBA2    
                      00534 
0396   22B8           00535                         call READ_DATA  ; 101
0397   0820           00536                         movfw DATA_L
                      00537 ;                       movwf PARAM_MAX_LBA3
0398   0821           00538                         movfw DATA_H
                      00539 ;                       movwf PARAM_MAX_LBA4            ; nejvyssi cast adresy                  
0399   2B9D           00540                 goto INIT_ATA__DALSI
039A                  00541 INIT_ATA__NOT_SUPPORT_LBA48
039A   3002           00542         movlw .2        ; 100, 101
039B   00B6           00543         movwf TEMP1
039C   22D8           00544         call PRESKOC    
039D                  00545 INIT_ATA__DALSI
                      00546         ; precetli jsme 102 slov
039D   3004           00547         movlw .4        ; 102, 103, 104, 105
039E   00B6           00548         movwf TEMP1
039F   22D8           00549         call PRESKOC
                      00550 
03A0   22B8           00551         call READ_DATA  ; slovo 106 - pokud bit 15=0 a bit 14=1, tak obsahuje pravdive informace
                      00552                                                 ; pro nas je podstatne, ze pokud je bit 12 = 1, tak sekt
                            or je vetsi nez 256 slov
                      00553                                                 ; pokud je sektor vetsi nez 256 slov, je jeho velikost v
                            e slovech [117-118]
03A1   1BA1           00554         btfsc DATA_H,7
03A2   2BA7           00555         goto INIT_ATA__DALSI2
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 40


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

03A3   1F21           00556         btfss DATA_H,6
03A4   2BA7           00557         goto INIT_ATA__DALSI2
03A5   1A21           00558         btfsc DATA_H,4
03A6   15AE           00559         bsf ATA_ATTRIBUTES,BIG_SECTOR
03A7                  00560 INIT_ATA__DALSI2
                      00561         ; precteno 107, zbyva 149
03A7   3095           00562         movlw .149      ; 107 - 256
03A8   00B6           00563         movwf TEMP1
03A9   22D8           00564         call PRESKOC
                      00565                 
                      00566         ; ted vime co mame za disk, tak se na to jdem podivat...
                      00567         ; pokud disk splnuje vsechny nase pozadavky, tak nastavime 7 bit v ATA_ATTRIBUTES
03AA   13AE           00568         bcf ATA_ATTRIBUTES,APPLICABLE   
03AB   1CAE           00569         btfss ATA_ATTRIBUTES,LBA_SUPPORT
03AC   0008           00570         return
                      00571         ; pokud jsme tady, disk podporuje LBA (dneska se jich uz moc nevidi, co by LBA neumeli)
03AD   19AE           00572         btfsc ATA_ATTRIBUTES,BIG_SECTOR
03AE   0008           00573         return
                      00574         ; mazec, disk ma velikost sektoru 256 slov, vetsi naroky na disk nemam :-)
03AF   17AE           00575         bsf ATA_ATTRIBUTES,APPLICABLE ; disk umi to co potrebujeme...   
                      00576 
03B0   0008           00577         return
                      00578 ;**************************************************************************
                      00579 ;**********************************************************
                      00580 ; CEKACI PROCEDURY
                      00581 ;**********************************************************
03B1                  00582 DELAY_25us
                      00583         ; pouziva TEMP1
                      00584         ; (Fosc = 20 MHz , instr. cyklus= 0.20 us) 25us / 0.20 us = 125 instrukcnich cyklu
                      00585         ; (Fosc = 16 MHz , instr. cyklus= 0.25 us) 25us / 0.25 us = 100 instrukcnich cyklu
                      00586         ; (Fosc = 04 MHz , instr. cyklus= 1.00 us) 25us / 1.00 us =  25 instrukcnich cyklu      
03B1   302A           00587         MOVLW 0x2A              ;42 DEC -> Delay 127 cycles
                      00588         ;MOVLW 0x21             ;33 DEC -> Delay 100 cycles
                      00589         ;MOVLW 0x08             ;25 DEC -> Delay  25 cycles
03B2   00B6           00590         MOVWF TEMP1
03B3   0BB6           00591         DECFSZ TEMP1,F
03B4   2BB3           00592         GOTO $-1
                      00593         ;End of Delay
03B5   0008           00594         return
                      00595 ;**************************************************************************
03B6                  00596 WAIT_FOR_READY
                      00597         ; Cekame az Bsy bit = 0 
                      00598         ; (cekame az disk nebude zaneprazdnen)
03B6   2242           00599         call RD_STATUS
03B7   082C           00600         movfw ATA_STATUS
03B8   3980           00601         andlw b'10000000'
03B9   1903           00602         btfsc STATUS,Z
03BA   0008           00603         return
03BB   2BB6           00604         goto WAIT_FOR_READY
                      00605 ;**************************************************************************
                      00606 ;WAIT_FOR_READY_FOR_COMMAND
                      00607 ;       call WAIT_FOR_READY
                      00608 ;       btfss ATA_STATUS,DRDY
                      00609 ;       goto WAIT_FOR_READY_FOR_COMMAND
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 41


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00610 ;       return
                      00611 ;**************************************************************************
                      00074         include "fat32.asm"     ; podprogramy na nacteni a praci s FAT32
                      00001 ;**********************************************************
                      00002 ;**********************************************************
                      00003 ;**********************************************************
                      00004 ; OBSLUZNE PODPROGRAMY PRO FAT32
                      00005 ;**********************************************************
                      00006 ;**********************************************************
                      00007 ;**********************************************************
                      00008 
                      00009 ;**************************************************************************
03BC                  00010 CLUSTER_TO_LBA
                      00011         ; vezme hodnoty v CLUSTER[1-4] a POZICE (sektor v clusteru) a do LBA 1-4 vypocita skutecnou pozi
                            ci na disku
                      00012         ; pro spravnou funkci musi byt POZICE < CLUSTER_SIZE (POZICE muze byt v rozsahu 0 .. CLUSTER_SIZ
                            E - 1)
                      00013         ; LBA := POCATEK_DAT + (CLUSTER * CLUSTER_SIZE) + POZICE
                      00014         INDF_BANK_1                             ; neprime adresovani do banku1
03BC   1383               M                         bcf STATUS,IRP    
03BD   30A0           00015         movlw 0xA0                                      ; OPERAND_X
03BE   0084           00016         movwf FSR
03BF   083C           00017         movfw CLUSTER1
03C0   0080           00018         movwf INDF
03C1   0A84           00019         incf FSR,F
03C2   083D           00020         movfw CLUSTER2
03C3   0080           00021         movwf INDF
03C4   0A84           00022         incf FSR,F
03C5   083E           00023         movfw CLUSTER3
03C6   0080           00024         movwf INDF
03C7   0A84           00025         incf FSR,F
03C8   083F           00026         movfw CLUSTER4
03C9   0080           00027         movwf INDF
03CA   0A84           00028         incf FSR,F
                      00029 
                      00030         ; Nejdriv se koukneme zda-li CLUSTER se nerovna 0, to bychom pak vratily 
                      00031         ; pozici na prvnim clusteru root adresare...
03CB   2672           00032         call NULA                                               ; if (X =  0) then PRETECENI := 0 else P
                            RETECENI := 1
                      00033         BANK_1
03CC   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
03CD   1683               M                 bsf     STATUS,RP0    
03CE   182C           00034         btfsc PRETECENI,0
03CF   2BE0           00035         goto CLUSTER_TO_LBA_NO_ROOT
                      00036         BANK_0
03D0   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
03D1   1283               M                 bcf     STATUS,RP0    
03D2   30A0           00037         movlw 0xA0                                      ; OPERAND_X
03D3   0084           00038         movwf FSR
03D4   0848           00039         movfw ROOT_DIR_CL1
03D5   0080           00040         movwf INDF
03D6   0A84           00041         incf FSR,F
03D7   0849           00042         movfw ROOT_DIR_CL2
03D8   0080           00043         movwf INDF
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 42


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

03D9   0A84           00044         incf FSR,F
03DA   084A           00045         movfw ROOT_DIR_CL3
03DB   0080           00046         movwf INDF
03DC   0A84           00047         incf FSR,F
03DD   084B           00048         movfw ROOT_DIR_CL4
03DE   0080           00049         movwf INDF
03DF   0A84           00050         incf FSR,F
                      00051                 
03E0                  00052 CLUSTER_TO_LBA_NO_ROOT
                      00053         BANK_0
03E0   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
03E1   1283               M                 bcf     STATUS,RP0    
                      00054         ; CLUSTER_SIZE je vzdy exponentem 2 (1,2,4,8,16,32,64,128), proto tento jednoduchy zapis
03E2   18CC           00055         btfsc CLUSTER_SIZE,1            ; 2
03E3   25CB           00056         call POSUNDOLEVA_1                      ; X := X * 2
03E4   194C           00057         btfsc CLUSTER_SIZE,2            ; 4
03E5   25D3           00058         call POSUNDOLEVA_2                      ; X := X * 4
03E6   19CC           00059         btfsc CLUSTER_SIZE,3            ; 8
03E7   25DC           00060         call POSUNDOLEVA_3                      ; X := X * 8
03E8   1A4C           00061         btfsc CLUSTER_SIZE,4            ; 16
03E9   25E6           00062         call POSUNDOLEVA_4                      ; X := X * 4
03EA   1ACC           00063         btfsc CLUSTER_SIZE,5            ; 32
03EB   25F1           00064         call POSUNDOLEVA_5                      ; X := X * 32
03EC   1B4C           00065         btfsc CLUSTER_SIZE,6            ; 64
03ED   25FD           00066         call POSUNDOLEVA_6                      ; X := X * 64
03EE   1BCC           00067         btfsc CLUSTER_SIZE,7            ; 128
03EF   260A           00068         call POSUNDOLEVA_7                      ; X := X * 128
                      00069         
03F0   0840           00070         movfw POCATEK_DAT1
03F1   0080           00071         movwf INDF                                      ; OPERAND_Y
03F2   0A84           00072         incf FSR,F
03F3   0841           00073         movfw POCATEK_DAT2
03F4   0080           00074         movwf INDF
03F5   0A84           00075         incf FSR,F
03F6   0842           00076         movfw POCATEK_DAT3
03F7   0080           00077         movwf INDF
03F8   0A84           00078         incf FSR,F
03F9   0843           00079         movfw POCATEK_DAT4
03FA   0080           00080         movwf INDF
03FB   0A84           00081         incf FSR,F
                      00082 
03FC   255D           00083         call SOUCET                                     ; VYSLEDEK := POCATEK_DAT + (CLUSTER * CLUSTER_S
                            IZE)
                      00084 
                      00085         ; zbyva tedy k vysledku pricist POZICE a dat nasledny vysledek do LBA    
03FD   083B           00086         movfw POZICE
                      00087         BANK_1
03FE   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
03FF   1683               M                 bsf     STATUS,RP0    
0400   00A4           00088         movwf OPERAND_Y1
0401   01A5           00089         clrf OPERAND_Y2
0402   01A6           00090         clrf OPERAND_Y3
0403   01A7           00091         clrf OPERAND_Y4
0404   0828           00092         movfw VYSLEDEK1
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 43


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0405   00A0           00093         movwf OPERAND_X1
0406   0829           00094         movfw VYSLEDEK2
0407   00A1           00095         movwf OPERAND_X2
0408   082A           00096         movfw VYSLEDEK3
0409   00A2           00097         movwf OPERAND_X3
040A   082B           00098         movfw VYSLEDEK4
040B   00A3           00099         movwf OPERAND_X4        
                      00100         BANK_0
040C   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
040D   1283               M                 bcf     STATUS,RP0    
040E   255D           00101         call SOUCET
                      00102 
                      00103         INDF_BANK_1                             ; neprime adresovani do banku1
040F   1383               M                         bcf STATUS,IRP    
0410   30A8           00104         movlw 0xA8                                      ; VYSLEDEK
0411   0084           00105         movwf FSR
0412   0800           00106         movfw INDF
0413   00A7           00107         movwf LBA1
0414   0A84           00108         incf FSR,F
0415   0800           00109         movfw INDF
0416   00A8           00110         movwf LBA2
0417   0A84           00111         incf FSR,F
0418   0800           00112         movfw INDF
0419   00A9           00113         movwf LBA3
041A   0A84           00114         incf FSR,F
041B   0800           00115         movfw INDF
041C   00AA           00116         movwf LBA4
041D   0A84           00117         incf FSR,F
                      00118         
041E   0008           00119         return
                      00120 ;**************************************************************************
041F                  00121 NEXT_CLUSTER
                      00122         ; V CLUSTER prijme cislo clusteru, podiva se do FATky na disku a v CLUSTER vrati 
                      00123         ; hodnotu clustru, ktery nasleduje v retezu clusteru.
                      00124         ; Pokud pozadovany cluster byl posledni v retezu vrati v reg. POZICE konstantu FFh
                      00125         ; Pokud soucasny cluster je prazdny (coz by se stat nemelo) vrati taky v POZICE FFh
                      00126         ; Jinak, pokud s vse povede, dame do POZICE 0
                      00127 
                      00128         ; ! PODPROGRAM NETESTUJE ZDA NEBYLO ZADANO VETSI CISLO NEZ JE POCET CLUSTERU !!!
                      00129         
041F   01BB           00130         clrf POZICE
                      00131         ; LBA := [(CLUSTER * 4) / 512 ] + POCATEK_FAT
                      00132         ; LBA := ( CLUSTER / 128 ) + POCATEK_FAT
                      00133         ; offset := CLUSTER mod 128 
                      00134         INDF_BANK_1                             ; neprime adresovani do banku1
0420   1383               M                         bcf STATUS,IRP    
0421   30A0           00135         movlw 0xA0                                      ; OPERAND_X
0422   0084           00136         movwf FSR
0423   083C           00137         movfw CLUSTER1
0424   0080           00138         movwf INDF
0425   0A84           00139         incf FSR,F
0426   083D           00140         movfw CLUSTER2
0427   0080           00141         movwf INDF
0428   0A84           00142         incf FSR,F
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 44


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0429   083E           00143         movfw CLUSTER3
042A   0080           00144         movwf INDF
042B   0A84           00145         incf FSR,F
042C   083F           00146         movfw CLUSTER4
042D   0080           00147         movwf INDF
                      00148 
                      00149         ; Nejdriv se koukneme zda-li CLUSTER se nerovna 0, to pak musime jako cluster brat prvni cluster
                             ROOT adr.
042E   2672           00150         call NULA                                               ; if (X =  0) then PRETECENI := 0 else P
                            RETECENI := 1
                      00151         BANK_1
042F   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0430   1683               M                 bsf     STATUS,RP0    
0431   182C           00152         btfsc PRETECENI,0
0432   2C43           00153         goto NEXT_CLUSTER_NO_ROOT
                      00154         BANK_0
0433   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0434   1283               M                 bcf     STATUS,RP0    
0435   30A0           00155         movlw 0xA0                                      ; OPERAND_X
0436   0084           00156         movwf FSR
0437   0848           00157         movfw ROOT_DIR_CL1
0438   0080           00158         movwf INDF
0439   0A84           00159         incf FSR,F
043A   0849           00160         movfw ROOT_DIR_CL2
043B   0080           00161         movwf INDF
043C   0A84           00162         incf FSR,F
043D   084A           00163         movfw ROOT_DIR_CL3
043E   0080           00164         movwf INDF
043F   0A84           00165         incf FSR,F
0440   084B           00166         movfw ROOT_DIR_CL4
0441   0080           00167         movwf INDF
0442   0A84           00168         incf FSR,F
                      00169                 
0443                  00170 NEXT_CLUSTER_NO_ROOT
                      00171         BANK_0
0443   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0444   1283               M                 bcf     STATUS,RP0    
                      00172         
0445   2663           00173         call POSUNDOPRAVA_7     ; X := X div 128  ; PRETECENI := X mod 128
0446   30AC           00174         movlw 0xAC                                      ; PRETECENI
0447   0084           00175         movwf FSR
0448   0800           00176         movfw INDF
0449   00B6           00177         movwf TEMP1
                      00178 
044A   30A4           00179         movlw 0xA4                                      ; OPERAND_Y
044B   0084           00180         movwf FSR
044C   0844           00181         movfw POCATEK_FAT1
044D   0080           00182         movwf INDF
044E   0A84           00183         incf FSR,F
044F   0845           00184         movfw POCATEK_FAT2
0450   0080           00185         movwf INDF
0451   0A84           00186         incf FSR,F
0452   0846           00187         movfw POCATEK_FAT3
0453   0080           00188         movwf INDF
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 45


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0454   0A84           00189         incf FSR,F
0455   0847           00190         movfw POCATEK_FAT4
0456   0080           00191         movwf INDF
0457   0A84           00192         incf FSR,F
                      00193 
0458   255D           00194         call SOUCET
                      00195         
0459   0800           00196         movfw INDF                                      ; FSR ukazuje na VYSLEDEK
045A   00A7           00197         movwf LBA1
045B   0A84           00198         incf FSR,F
045C   0800           00199         movfw INDF
045D   00A8           00200         movwf LBA2
045E   0A84           00201         incf FSR,F
045F   0800           00202         movfw INDF
0460   00A9           00203         movwf LBA3
0461   0A84           00204         incf FSR,F
0462   0800           00205         movfw INDF
0463   00AA           00206         movwf LBA4
0464   0A84           00207         incf FSR,F
                      00208         
0465   01A4           00209         clrf FEATURES
0466   3001           00210         movlw .1
0467   00A6           00211         movwf SECTOR_C
0468   2315           00212         call READ_SECTOR
                      00213 
0469   1003           00214         bcf STATUS,C                            ; TEMP1 := CLUSTER mod 128 (TEMP1 je v intervalu 0..127)
046A   0D36           00215         rlf TEMP1,W                                     ; W := TEMP1 * 2
046B   00B6           00216         movwf TEMP1
046C   39FF           00217         andlw h'FF'
046D   1D03           00218         btfss STATUS,Z
046E   22D8           00219         call PRESKOC                            ; pokud je zaznam o clusteru na nulte pozici v sektoru, 
                            nic preskakovat nebudem...
                      00220 
                      00221 
046F   30A0           00222         movlw 0xA0                                      ; OPERAND_X
0470   0084           00223         movwf FSR               
0471   22B8           00224         call READ_DATA  
0472   0820           00225         movfw DATA_L
0473   0080           00226         movwf INDF
0474   00BC           00227         movwf CLUSTER1
0475   0A84           00228         incf FSR,F
0476   0821           00229         movfw DATA_H
0477   0080           00230         movwf INDF
0478   00BD           00231         movwf CLUSTER2
0479   0A84           00232         incf FSR,F      
047A   22B8           00233         call READ_DATA  
047B   0820           00234         movfw DATA_L
047C   0080           00235         movwf INDF
047D   00BE           00236         movwf CLUSTER3
047E   0A84           00237         incf FSR,F
047F   0821           00238         movfw DATA_H
0480   0080           00239         movwf INDF
0481   00BF           00240         movwf CLUSTER4
0482   0A84           00241         incf FSR,F
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 46


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00242 
                      00243         ; ted mame hodnotu clusteru ktery nam byl na pocatku predan v reg. CLUSTER, podivame se zda neby
                            l nasledkem 
                      00244         ; nejake chyby prazdny, nebo zda neni posledni v alokacnim retezu
0483   2672           00245         call NULA                                               ; if (OPERAND_X =  0) then PRETECENI := 
                            0 else PRETECENI := 1
                      00246         BANK_1
0484   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0485   1683               M                 bsf     STATUS,RP0    
0486   182C           00247         btfsc PRETECENI,0
0487   2C8D           00248         goto NEXT_CLUSTER_NEPRAZDNY
                      00249         BANK_0
0488   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0489   1283               M                 bcf     STATUS,RP0    
048A   30FF           00250         movlw h'FF'
048B   00BB           00251         movwf POZICE
048C   2CA4           00252         goto NEXT_CLUSTER_KONEC                 ; Nevim sice jak by se toto mohlo stat, ale cluster byl 
                            prazdny, proto neni jiz co resit..
048D                  00253 NEXT_CLUSTER_NEPRAZDNY
                      00254         BANK_0
048D   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
048E   1283               M                 bcf     STATUS,RP0    
                      00255         ; Ted se podivame zda cluster nebyl posledni v alokacnim retezu -> cluster >= 0x0FFFFFF7
048F   30F7           00256         movlw 0xF7
0490   0080           00257         movwf INDF
0491   0A84           00258         incf FSR,F
0492   30FF           00259         movlw 0xFF
0493   0080           00260         movwf INDF
0494   0A84           00261         incf FSR,F
0495   30FF           00262         movlw 0xFF
0496   0080           00263         movwf INDF
0497   0A84           00264         incf FSR,F
0498   300F           00265         movlw 0x0F
0499   0080           00266         movwf INDF
049A   0A84           00267         incf FSR,F
                      00268         
049B   2589           00269         call ROZDIL                                             ; VYSLEDEK := X - Y 
                      00270                                                                         ; pri podteceni PRETECENI = 1 ( 
                            VYSLEDEK < 0 => PRETECENI = 1 )
                      00271         BANK_1
049C   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
049D   1683               M                 bsf     STATUS,RP0    
049E   182C           00272         btfsc PRETECENI,0
049F   2CA4           00273         goto NEXT_CLUSTER_KONEC
                      00274         BANK_0
04A0   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
04A1   1283               M                 bcf     STATUS,RP0    
04A2   30FF           00275         movlw h'FF'
04A3   00BB           00276         movwf POZICE
04A4                  00277 NEXT_CLUSTER_KONEC
                      00278         BANK_0
04A4   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
04A5   1283               M                 bcf     STATUS,RP0    
04A6   0008           00279         return
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 47


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00280 ;**************************************************************************
04A7                  00281 ZJISTI_FRAGMENT
                      00282 ; v CLUSTER[1-4] prijme cislo clusteru a do FRAGMENT[1-2] umisti kolik clusteru 
                      00283 ; po tomto clusteru nasledujich tvori jeden fragment
                      00284 ; (pokud je retezec tvoren pouze z tohoto clusteru, je vraceno cislo 0)
                      00285 
                      00286 ; Pokud soucasny cluster je prazdny (coz by se stat nemelo) vrati v POZICE FFh
                      00287 ; Jinak, pokud s vse povede, dame do POZICE 0
                      00288 
                      00289 ; ! PODPROGRAM NENI POUZITELNY PRO CLUSTER 0 (prvni cluster ROOT adresare)
                      00290 ; ! PODPROGRAM NETESTUJE ZDA NEBYLO ZADANO VETSI CISLO NEZ JE POCET CLUSTERU !!!
                      00291         
04A7   01BB           00292         clrf POZICE
04A8   01D2           00293         clrf FRAGMENT2
                      00294         ;movlw .1
                      00295         ;movwf FRAGMENT1
04A9   01D1           00296         clrf FRAGMENT1
                      00297         ; LBA := [(CLUSTER * 4) / 512 ] + POCATEK_FAT
                      00298         ; LBA := ( CLUSTER / 128 ) + POCATEK_FAT
                      00299         ; offset := CLUSTER mod 128 
                      00300         INDF_BANK_1                             ; neprime adresovani do banku1
04AA   1383               M                         bcf STATUS,IRP    
04AB   30A0           00301         movlw 0xA0                                      ; OPERAND_X
04AC   0084           00302         movwf FSR
04AD   083C           00303         movfw CLUSTER1
04AE   00DA           00304         movwf HL_ADR_CL1                        ; v HL_ADR_CL[1-4] mam hodnotu clusteru na predchozim za
                            znamu, proto si prvni cluster dame sem
04AF   0080           00305         movwf INDF
04B0   0A84           00306         incf FSR,F
04B1   083D           00307         movfw CLUSTER2
04B2   00DB           00308         movwf HL_ADR_CL2
04B3   0080           00309         movwf INDF
04B4   0A84           00310         incf FSR,F
04B5   083E           00311         movfw CLUSTER3
04B6   00DC           00312         movwf HL_ADR_CL3
04B7   0080           00313         movwf INDF
04B8   0A84           00314         incf FSR,F
04B9   083F           00315         movfw CLUSTER4
04BA   00DD           00316         movwf HL_ADR_CL4
04BB   0080           00317         movwf INDF
                      00318 
04BC   2663           00319         call POSUNDOPRAVA_7                     ; X := X div 128  ; PRETECENI := X mod 128
04BD   30AC           00320         movlw 0xAC                                      ; PRETECENI
04BE   0084           00321         movwf FSR
04BF   0800           00322         movfw INDF
04C0   00BA           00323         movwf TEMP5                                     ; TEMP5 := CLUSTER mod 128 (TEMP5 je v intervalu
                             0..127)
                      00324 ;       bcf STATUS,C                            
                      00325 ;       rlf TEMP2,W                                     ; W := TEMP1 * 2
                      00326 
04C1   30A4           00327         movlw 0xA4                                      ; OPERAND_Y
04C2   0084           00328         movwf FSR
04C3   0844           00329         movfw POCATEK_FAT1
04C4   0080           00330         movwf INDF
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 48


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

04C5   0A84           00331         incf FSR,F
04C6   0845           00332         movfw POCATEK_FAT2
04C7   0080           00333         movwf INDF
04C8   0A84           00334         incf FSR,F
04C9   0846           00335         movfw POCATEK_FAT3
04CA   0080           00336         movwf INDF
04CB   0A84           00337         incf FSR,F
04CC   0847           00338         movfw POCATEK_FAT4
04CD   0080           00339         movwf INDF
04CE   0A84           00340         incf FSR,F
                      00341 
04CF   255D           00342         call SOUCET
                      00343         
04D0   0800           00344         movfw INDF                                      ; FSR ukazuje na VYSLEDEK
04D1   00A7           00345         movwf LBA1
04D2   0A84           00346         incf FSR,F
04D3   0800           00347         movfw INDF
04D4   00A8           00348         movwf LBA2
04D5   0A84           00349         incf FSR,F
04D6   0800           00350         movfw INDF
04D7   00A9           00351         movwf LBA3
04D8   0A84           00352         incf FSR,F
04D9   0800           00353         movfw INDF
04DA   00AA           00354         movwf LBA4
04DB   0A84           00355         incf FSR,F
                      00356 
04DC   01A4           00357         clrf FEATURES
04DD   3001           00358         movlw .1
04DE   00A6           00359         movwf SECTOR_C
04DF   2315           00360         call READ_SECTOR
                      00361 
04E0   1003           00362         bcf STATUS,C
04E1   0D3A           00363         rlf TEMP5,w
04E2   00B6           00364         movwf TEMP1                                     ; TEMP1 := TEMP5 * 2
04E3   083A           00365         movfw TEMP5
04E4   39FF           00366         andlw h'FF'
04E5   1D03           00367         btfss STATUS,Z
04E6   22D8           00368         call PRESKOC                            ; pokud je zaznam o clusteru na nulte pozici v sektoru, 
                            nic preskakovat nebudem...
                      00369                                                                 ; preskakujeme pouze na zacatku, pak jdo
                            u hezky za sebou
04E7   2CEC           00370         goto ZJISTI_FRAGMENT_CLUSTER
04E8                  00371 ZJISTI_FRAGMENT_CTI_SECTOR
                      00372 
04E8   01A4           00373         clrf FEATURES
04E9   3001           00374         movlw .1
04EA   00A6           00375         movwf SECTOR_C
04EB   2315           00376         call READ_SECTOR
                      00377 
04EC                  00378 ZJISTI_FRAGMENT_CLUSTER
04EC   30A0           00379         movlw 0xA0                                      ; OPERAND_X
04ED   0084           00380         movwf FSR               
04EE   22B8           00381         call READ_DATA  
04EF   0820           00382         movfw DATA_L
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 49


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

04F0   0080           00383         movwf INDF
04F1   0A84           00384         incf FSR,F
04F2   0821           00385         movfw DATA_H
04F3   0080           00386         movwf INDF
04F4   0A84           00387         incf FSR,F      
04F5   22B8           00388         call READ_DATA  
04F6   0820           00389         movfw DATA_L
04F7   0080           00390         movwf INDF
04F8   0A84           00391         incf FSR,F
04F9   0821           00392         movfw DATA_H
04FA   0080           00393         movwf INDF
04FB   0A84           00394         incf FSR,F
                      00395 
                      00396 
                      00397         ; ted mame hodnotu clusteru v OPERAND_X. pokud je posledni v retezci, nebo je prazdny, tak konci
                            me
04FC   2672           00398         call NULA                                               ; if (OPERAND_X =  0) then PRETECENI := 
                            0 else PRETECENI := 1
                      00399         BANK_1
04FD   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
04FE   1683               M                 bsf     STATUS,RP0    
04FF   182C           00400         btfsc PRETECENI,0
0500   2D04           00401         goto ZJISTI_FRAGMENT_NEPRAZDNY
                      00402         BANK_0
0501   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0502   1283               M                 bcf     STATUS,RP0    
0503   2D5A           00403         goto ZJISTI_FRAGMENT_KONEC                      ; Nevim sice jak by se toto mohlo stat, ale clus
                            ter byl prazdny, proto neni jiz co resit..
0504                  00404 ZJISTI_FRAGMENT_NEPRAZDNY
                      00405         BANK_0
0504   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0505   1283               M                 bcf     STATUS,RP0    
                      00406 
                      00407         ; Ted se podivame zda cluster nebyl posledni v alokacnim retezu -> cluster >= 0x0FFFFFF7
0506   30F7           00408         movlw 0xF7
0507   0080           00409         movwf INDF
0508   0A84           00410         incf FSR,F
0509   30FF           00411         movlw 0xFF
050A   0080           00412         movwf INDF
050B   0A84           00413         incf FSR,F
050C   30FF           00414         movlw 0xFF
050D   0080           00415         movwf INDF
050E   0A84           00416         incf FSR,F
050F   300F           00417         movlw 0x0F
0510   0080           00418         movwf INDF
0511   0A84           00419         incf FSR,F
                      00420         
0512   2589           00421         call ROZDIL                                             ; VYSLEDEK := X - Y 
                      00422                                                                         ; pri podteceni PRETECENI = 1 ( 
                            VYSLEDEK < 0 => PRETECENI = 1 )
                      00423         BANK_1
0513   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0514   1683               M                 bsf     STATUS,RP0    
0515   1C2C           00424         btfss PRETECENI,0                               ; pokud je vysledek zaporny, je neni cluster pos
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 50


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            ledni a my pokracujeme...
0516   2D5A           00425         goto ZJISTI_FRAGMENT_KONEC
                      00426         BANK_0
0517   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0518   1283               M                 bcf     STATUS,RP0    
                      00427 
0519   30A4           00428         movlw 0xA4                                              ; OPERAND_Y
051A   0084           00429         movwf FSR               
051B   085A           00430         movfw HL_ADR_CL1                                ; v HL_ADR_CL[1-4] mam hodnotu clusteru na predc
                            hozim zaznamu
051C   0080           00431         movwf INDF
051D   0A84           00432         incf FSR,F
051E   085B           00433         movfw HL_ADR_CL2
051F   0080           00434         movwf INDF
0520   0A84           00435         incf FSR,F
0521   085C           00436         movfw HL_ADR_CL3
0522   0080           00437         movwf INDF
0523   0A84           00438         incf FSR,F
0524   085D           00439         movfw HL_ADR_CL4
0525   0080           00440         movwf INDF
                      00441 
                      00442 
0526   2589           00443         call ROZDIL                                             ; VYSLEDEK := SOUCASNY_CL - PREDCHOZI_CL
                      00444                                                                         ; vysledek se musi rovnat 1
                      00445         BANK_1
0527   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0528   1683               M                 bsf     STATUS,RP0    
0529   082B           00446         movfw VYSLEDEK4
052A   042A           00447         iorwf VYSLEDEK3,W
052B   0429           00448         iorwf VYSLEDEK2,W
052C   1D03           00449         btfss STATUS,Z
052D   2D5A           00450         goto ZJISTI_FRAGMENT_KONEC
052E   0828           00451         movfw VYSLEDEK1
052F   3C01           00452         sublw .1
0530   1D03           00453         btfss STATUS,Z
0531   2D5A           00454         goto ZJISTI_FRAGMENT_KONEC
                      00455         BANK_0
0532   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0533   1283               M                 bcf     STATUS,RP0    
                      00456 
                      00457         ; OK, ted vime, ze predchozi cluster byl o jednu mensi, nez soucasny...
                      00458         ; podivame se zda neni FRAGMENT moc velky...
0534   1BD2           00459         btfsc FRAGMENT2,7
0535   2D5A           00460         goto ZJISTI_FRAGMENT_KONEC
                      00461         
                      00462         ; FRAGMENT++
0536   0AD1           00463         incf FRAGMENT1,f
0537   1903           00464         btfsc STATUS,Z
0538   0AD2           00465         incf FRAGMENT2,f
                      00466 
0539   30A0           00467         movlw 0xA0                                              ; OPERAND_X
053A   0084           00468         movwf FSR               
053B   0800           00469         movfw INDF
053C   00DA           00470         movwf HL_ADR_CL1                                ; v HL_ADR_CL[1-4] mam hodnotu clusteru na predc
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 51


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            hozim zaznamu
053D   0A84           00471         incf FSR,F
053E   0800           00472         movfw INDF
053F   00DB           00473         movwf HL_ADR_CL2
0540   0A84           00474         incf FSR,F
0541   0800           00475         movfw INDF
0542   00DC           00476         movwf HL_ADR_CL3
0543   0A84           00477         incf FSR,F
0544   0800           00478         movfw INDF
0545   00DD           00479         movwf HL_ADR_CL4
                      00480 
                      00481 
0546   0ABA           00482         incf TEMP5,f
0547   083A           00483         movfw TEMP5
0548   3C80           00484         sublw .128
0549   1D03           00485         btfss STATUS,Z
054A   2CEC           00486         goto ZJISTI_FRAGMENT_CLUSTER
                      00487 
054B   01BA           00488         clrf TEMP5
                      00489 
                      00490         ; LBA++
054C   3001           00491         movlw .1
054D   07A7           00492         addwf LBA1,f
054E   1C03           00493         btfss STATUS,C
054F   2D57           00494         goto ZJISTI_FRAGMENT_INC_KONEC
0550   07A8           00495         addwf LBA2,f
0551   1C03           00496         btfss STATUS,C
0552   2D57           00497         goto ZJISTI_FRAGMENT_INC_KONEC
0553   07A9           00498         addwf LBA3,f
0554   1C03           00499         btfss STATUS,C
0555   2D57           00500         goto ZJISTI_FRAGMENT_INC_KONEC
0556   07AA           00501         addwf LBA4,f
0557                  00502 ZJISTI_FRAGMENT_INC_KONEC
                      00503 
                      00504         BANK_0
0557   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0558   1283               M                 bcf     STATUS,RP0    
0559   2CE8           00505         goto ZJISTI_FRAGMENT_CTI_SECTOR
                      00506 
055A                  00507 ZJISTI_FRAGMENT_KONEC
                      00508         BANK_0
055A   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
055B   1283               M                 bcf     STATUS,RP0    
055C   0008           00509         return
                      00510 ;**************************************************************************
                      00075         include "aritmetic.asm" ; podprogramy vykonavajici zakladni aritmetologicke operace
                      00001 ;**********************************************************
                      00002 ;**********************************************************
                      00003 ;**********************************************************
                      00004 ; Obsahuje podrogramy realizujici zakladni aritmeticke operace
                      00005 ; pouzivane v mp3 preprcavaci. Vsechny operace se provadi 
                      00006 ; s 32bitovymi cisly.
                      00007 ; 
                      00008 ; Pro praci aritmetickych procedur je rezervovana BANKA 1 !!!!!
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 52


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00009 ;**********************************************************
                      00010 ;**********************************************************
                      00011 ;**********************************************************
055D                  00012 SOUCET
                      00013 ; provede soucet hodnoty v registrech OPERAND_X[1..4] 
                      00014 ; s hodnotou v OPERAND_Y[1..4] a umisti do VYSLEDEK[1..4] 
                      00015 ; pokud dojde k preteceni, nastavi se PRETECENI do 1
                      00016 ; (byty s indexem 1 maji nejnizsi vahu)
                      00017         BANK_1
055D   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
055E   1683               M                 bsf     STATUS,RP0    
055F   01AC           00018         clrf PRETECENI
                      00019 
0560   0820           00020         movfw OPERAND_X1
0561   0724           00021         addwf OPERAND_Y1,W
0562   00A8           00022         movwf VYSLEDEK1
0563   1803           00023         btfsc STATUS,C
0564   14AC           00024                 bsf PRETECENI,1
                      00025 
0565   0821           00026         movfw OPERAND_X2
0566   0725           00027         addwf OPERAND_Y2,W
0567   00A9           00028         movwf VYSLEDEK2
0568   3001           00029         movlw .1
0569   1803           00030         btfsc STATUS,C
056A   142C           00031                 bsf PRETECENI,0
056B   18AC           00032         btfsc PRETECENI,1
056C   07A9           00033                 addwf VYSLEDEK2,F
056D   1803           00034         btfsc STATUS,C
056E   142C           00035                 bsf PRETECENI,0
056F   10AC           00036         bcf PRETECENI,1
                      00037 
0570   0822           00038         movfw OPERAND_X3
0571   0726           00039         addwf OPERAND_Y3,W
0572   00AA           00040         movwf VYSLEDEK3
0573   3001           00041         movlw .1
0574   1803           00042         btfsc STATUS,C
0575   14AC           00043                 bsf PRETECENI,1
0576   182C           00044         btfsc PRETECENI,0
0577   07AA           00045                 addwf VYSLEDEK3,F
0578   1803           00046         btfsc STATUS,C
0579   14AC           00047                 bsf PRETECENI,1
057A   102C           00048         bcf PRETECENI,0
                      00049 
057B   0823           00050         movfw OPERAND_X4
057C   0727           00051         addwf OPERAND_Y4,W
057D   00AB           00052         movwf VYSLEDEK4
057E   3001           00053         movlw .1
057F   1803           00054         btfsc STATUS,C
0580   142C           00055                 bsf PRETECENI,0
0581   18AC           00056         btfsc PRETECENI,1
0582   07AB           00057                 addwf VYSLEDEK4,F
0583   1803           00058         btfsc STATUS,C
0584   142C           00059                 bsf PRETECENI,0
0585   10AC           00060         bcf PRETECENI,1 
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 53


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00061 
                      00062         BANK_0
0586   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0587   1283               M                 bcf     STATUS,RP0    
0588   0008           00063         return
                      00064 ;**********************************************************
                      00065 ;**********************************************************
0589                  00066 ROZDIL  ; VYSLEDEK := X - Y
                      00067                 ; pri podteceni PRETECENI = 1 ( VYSLEDEK < 0 => PRETECENI = 1 )
                      00068         BANK_1
0589   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
058A   1683               M                 bsf     STATUS,RP0    
058B   01AC           00069         clrf PRETECENI
                      00070 
058C   0824           00071         movfw OPERAND_Y1
058D   0220           00072         subwf OPERAND_X1,W      ; W = X - Y     
058E   00A8           00073         movwf VYSLEDEK1
058F   1C03           00074         btfss STATUS,C
0590   14AC           00075                 bsf PRETECENI,1
                      00076         
0591   0825           00077         movfw OPERAND_Y2
0592   0221           00078         subwf OPERAND_X2,W      ; W = X - Y     
0593   00A9           00079         movwf VYSLEDEK2
0594   3001           00080         movlw .1
0595   1C03           00081         btfss STATUS,C
0596   142C           00082                 bsf PRETECENI,0
0597   18AC           00083         btfsc PRETECENI,1
0598   02A9           00084                 subwf VYSLEDEK2,F
0599   1C03           00085         btfss STATUS,C
059A   142C           00086                 bsf PRETECENI,0
059B   10AC           00087         bcf PRETECENI,1 
                      00088         
059C   0826           00089         movfw OPERAND_Y3
059D   0222           00090         subwf OPERAND_X3,W      ; W = X - Y     
059E   00AA           00091         movwf VYSLEDEK3
059F   3001           00092         movlw .1
05A0   1C03           00093         btfss STATUS,C
05A1   14AC           00094                 bsf PRETECENI,1
05A2   182C           00095         btfsc PRETECENI,0
05A3   02AA           00096                 subwf VYSLEDEK3,F
05A4   1C03           00097         btfss STATUS,C
05A5   14AC           00098                 bsf PRETECENI,1
05A6   102C           00099         bcf PRETECENI,0
                      00100         
05A7   0827           00101         movfw OPERAND_Y4
05A8   0223           00102         subwf OPERAND_X4,W      ; W = X - Y     
05A9   00AB           00103         movwf VYSLEDEK4
05AA   3001           00104         movlw .1
05AB   1C03           00105         btfss STATUS,C
05AC   142C           00106                 bsf PRETECENI,0
05AD   18AC           00107         btfsc PRETECENI,1
05AE   02AB           00108                 subwf VYSLEDEK4,F
05AF   1C03           00109         btfss STATUS,C
05B0   142C           00110                 bsf PRETECENI,0
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 54


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

05B1   10AC           00111         bcf PRETECENI,1 
                      00112         
                      00113         BANK_0
05B2   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
05B3   1283               M                 bcf     STATUS,RP0    
05B4   0008           00114         return
                      00115 ;**********************************************************
05B5                  00116 DEKREMENTUJ     ; X := X - 1
                      00117         BANK_1
05B5   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
05B6   1683               M                 bsf     STATUS,RP0    
05B7   3001           00118         movlw .1
                      00119 
05B8   02A0           00120         subwf OPERAND_X1,f
05B9   1803           00121         btfsc STATUS,C
05BA   2DC2           00122         goto DEKREMENTUJ_KONEC
                      00123         
05BB   02A1           00124         subwf OPERAND_X2,f
05BC   1803           00125         btfsc STATUS,C
05BD   2DC2           00126         goto DEKREMENTUJ_KONEC
                      00127 
05BE   02A2           00128         subwf OPERAND_X3,f
05BF   1803           00129         btfsc STATUS,C
05C0   2DC2           00130         goto DEKREMENTUJ_KONEC
                      00131 
05C1   02A3           00132         subwf OPERAND_X4,f
05C2                  00133 DEKREMENTUJ_KONEC
                      00134         BANK_0
05C2   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
05C3   1283               M                 bcf     STATUS,RP0    
05C4   0008           00135         return
                      00136 ;**********************************************************
05C5                  00137 POSUNDOLEVA     ; X := (X * 2) mod 0xFFFFFFFF , PRETECENI := (X * 2) div 0xFFFFFFFF
                      00138                         ; tento podprogram nepouzivat, primo v hlavnim programu
                      00139                         ; musi se nastavit BANK_1 a vymazat PRETECENI!!!
                      00140                         ; (je pouze pro pouziti v nasobicich podprogramech)
                      00141                         ; pouzivat jen POSUNDOLEVA_1, 2, 3, 4 
05C5   0DA0           00142         rlf OPERAND_X1,F
05C6   0DA1           00143         rlf OPERAND_X2,F
05C7   0DA2           00144         rlf OPERAND_X3,F
05C8   0DA3           00145         rlf OPERAND_X4,F
05C9   0DAC           00146         rlf PRETECENI,F 
05CA   0008           00147         return
                      00148 ;**********************************************************
05CB                  00149 POSUNDOLEVA_1   ; X := X * 2
                      00150                                 ; X > 0xFFFF FFFF => PRETECENI obsahuje bity navic
                      00151         BANK_1
05CB   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
05CC   1683               M                 bsf     STATUS,RP0    
05CD   01AC           00152         clrf PRETECENI
05CE   1003           00153         bcf STATUS,C
                      00154         
05CF   25C5           00155         call POSUNDOLEVA
                      00156 
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 55


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00157         BANK_0
05D0   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
05D1   1283               M                 bcf     STATUS,RP0    
05D2   0008           00158         return
                      00159 ;**********************************************************
05D3                  00160 POSUNDOLEVA_2   ; X := X * 4
                      00161                                 ; X > 0xFFFF FFFF => PRETECENI obsahuje bity navic
                      00162         BANK_1
05D3   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
05D4   1683               M                 bsf     STATUS,RP0    
05D5   01AC           00163         clrf PRETECENI
05D6   1003           00164         bcf STATUS,C
                      00165         
05D7   25C5           00166         call POSUNDOLEVA
05D8   25C5           00167         call POSUNDOLEVA
                      00168 
                      00169         BANK_0
05D9   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
05DA   1283               M                 bcf     STATUS,RP0    
05DB   0008           00170         return
                      00171 ;**********************************************************
05DC                  00172 POSUNDOLEVA_3   ; X := X * 8
                      00173                                 ; X > 0xFFFF FFFF => PRETECENI obsahuje bity navic
                      00174         BANK_1
05DC   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
05DD   1683               M                 bsf     STATUS,RP0    
05DE   01AC           00175         clrf PRETECENI
05DF   1003           00176         bcf STATUS,C
                      00177         
05E0   25C5           00178         call POSUNDOLEVA
05E1   25C5           00179         call POSUNDOLEVA
05E2   25C5           00180         call POSUNDOLEVA
                      00181 
                      00182         BANK_0
05E3   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
05E4   1283               M                 bcf     STATUS,RP0    
05E5   0008           00183         return
                      00184 ;**********************************************************
05E6                  00185 POSUNDOLEVA_4   ; X := X * 16
                      00186                                 ; X > 0xFFFF FFFF => PRETECENI obsahuje bity navic
                      00187         BANK_1
05E6   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
05E7   1683               M                 bsf     STATUS,RP0    
05E8   01AC           00188         clrf PRETECENI
05E9   1003           00189         bcf STATUS,C
                      00190         
05EA   25C5           00191         call POSUNDOLEVA
05EB   25C5           00192         call POSUNDOLEVA
05EC   25C5           00193         call POSUNDOLEVA
05ED   25C5           00194         call POSUNDOLEVA
                      00195 
                      00196         BANK_0
05EE   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
05EF   1283               M                 bcf     STATUS,RP0    
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 56


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

05F0   0008           00197         return
                      00198 ;**********************************************************
05F1                  00199 POSUNDOLEVA_5   ; X := X * 32
                      00200                                 ; X > 0xFFFF FFFF => PRETECENI obsahuje bity navic
                      00201         BANK_1
05F1   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
05F2   1683               M                 bsf     STATUS,RP0    
05F3   01AC           00202         clrf PRETECENI
05F4   1003           00203         bcf STATUS,C
                      00204         
05F5   25C5           00205         call POSUNDOLEVA
05F6   25C5           00206         call POSUNDOLEVA
05F7   25C5           00207         call POSUNDOLEVA
05F8   25C5           00208         call POSUNDOLEVA
05F9   25C5           00209         call POSUNDOLEVA
                      00210 
                      00211         BANK_0
05FA   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
05FB   1283               M                 bcf     STATUS,RP0    
05FC   0008           00212         return
                      00213 ;**********************************************************
05FD                  00214 POSUNDOLEVA_6   ; X := X * 64
                      00215                                 ; X > 0xFFFF FFFF => PRETECENI obsahuje bity navic
                      00216         BANK_1
05FD   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
05FE   1683               M                 bsf     STATUS,RP0    
05FF   01AC           00217         clrf PRETECENI
0600   1003           00218         bcf STATUS,C
                      00219         
0601   25C5           00220         call POSUNDOLEVA
0602   25C5           00221         call POSUNDOLEVA
0603   25C5           00222         call POSUNDOLEVA
0604   25C5           00223         call POSUNDOLEVA
0605   25C5           00224         call POSUNDOLEVA
0606   25C5           00225         call POSUNDOLEVA
                      00226 
                      00227         BANK_0
0607   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0608   1283               M                 bcf     STATUS,RP0    
0609   0008           00228         return
                      00229 ;**********************************************************
060A                  00230 POSUNDOLEVA_7   ; X := X * 128
                      00231                                 ; X > 0xFFFF FFFF => PRETECENI obsahuje bity navic
                      00232         BANK_1
060A   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
060B   1683               M                 bsf     STATUS,RP0    
060C   01AC           00233         clrf PRETECENI
060D   1003           00234         bcf STATUS,C
                      00235         
060E   25C5           00236         call POSUNDOLEVA
060F   25C5           00237         call POSUNDOLEVA
0610   25C5           00238         call POSUNDOLEVA
0611   25C5           00239         call POSUNDOLEVA
0612   25C5           00240         call POSUNDOLEVA
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 57


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0613   25C5           00241         call POSUNDOLEVA
0614   25C5           00242         call POSUNDOLEVA
                      00243 
                      00244         BANK_0
0615   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0616   1283               M                 bcf     STATUS,RP0    
0617   0008           00245         return
                      00246 ;**********************************************************
0618                  00247 POSUNDOPRAVA    ; X := X div 2 , PRETECENI := X mod 2
                      00248                         ; tento podprogram nepouzivat, primo v hlavnim programu
                      00249                         ; musi se nastavit BANK_1 a vymazat PRETECENI!!!
                      00250                         ; (je pouze pro pouziti v nasobicich podprogramech)
                      00251                         ; pouzivat jen POSUNDOPRAVA_1, 2, 3, 4 
0618   1003           00252         bcf STATUS,C
0619   0CA3           00253         rrf OPERAND_X4,F
061A   0CA2           00254         rrf OPERAND_X3,F
061B   0CA1           00255         rrf OPERAND_X2,F
061C   0CA0           00256         rrf OPERAND_X1,F
061D   0008           00257         return
                      00258 ;**********************************************************
061E                  00259 POSUNDOPRAVA_1  ; X := X div 2
                      00260                                 ; PRETECENI := X mod 2
                      00261         BANK_1
061E   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
061F   1683               M                 bsf     STATUS,RP0    
0620   0820           00262         movfw OPERAND_X1
0621   3901           00263         andlw b'00000001'
0622   00AC           00264         movwf PRETECENI         ; PRETECENI := X mod 2
                      00265         
0623   2618           00266         call POSUNDOPRAVA
                      00267 
                      00268         BANK_0
0624   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0625   1283               M                 bcf     STATUS,RP0    
0626   0008           00269         return
                      00270 ;**********************************************************
0627                  00271 POSUNDOPRAVA_2  ; X := X div 4
                      00272                                 ; PRETECENI := X mod 4
                      00273         BANK_1
0627   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0628   1683               M                 bsf     STATUS,RP0    
0629   0820           00274         movfw OPERAND_X1
062A   3903           00275         andlw b'00000011'
062B   00AC           00276         movwf PRETECENI         ; PRETECENI := X mod 4
                      00277         
062C   2618           00278         call POSUNDOPRAVA
062D   2618           00279         call POSUNDOPRAVA
                      00280 
                      00281         BANK_0
062E   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
062F   1283               M                 bcf     STATUS,RP0    
0630   0008           00282         return
                      00283 ;**********************************************************
0631                  00284 POSUNDOPRAVA_3  ; X := X div 8
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 58


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00285                                 ; PRETECENI := X mod 8
                      00286         BANK_1
0631   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0632   1683               M                 bsf     STATUS,RP0    
0633   0820           00287         movfw OPERAND_X1
0634   3907           00288         andlw b'00000111'
0635   00AC           00289         movwf PRETECENI         ; PRETECENI := X mod 8
                      00290         
0636   2618           00291         call POSUNDOPRAVA
0637   2618           00292         call POSUNDOPRAVA
0638   2618           00293         call POSUNDOPRAVA
                      00294 
                      00295         BANK_0
0639   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
063A   1283               M                 bcf     STATUS,RP0    
063B   0008           00296         return
                      00297 ;**********************************************************
063C                  00298 POSUNDOPRAVA_4  ; X := X div 16
                      00299                                 ; PRETECENI := X mod 16
                      00300         BANK_1
063C   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
063D   1683               M                 bsf     STATUS,RP0    
063E   0820           00301         movfw OPERAND_X1
063F   390F           00302         andlw b'00001111'
0640   00AC           00303         movwf PRETECENI         ; PRETECENI := X mod 16
                      00304         
0641   2618           00305         call POSUNDOPRAVA
0642   2618           00306         call POSUNDOPRAVA
0643   2618           00307         call POSUNDOPRAVA
0644   2618           00308         call POSUNDOPRAVA
                      00309 
                      00310         BANK_0
0645   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0646   1283               M                 bcf     STATUS,RP0    
0647   0008           00311         return
                      00312 ;**********************************************************
0648                  00313 POSUNDOPRAVA_5  ; X := X div 32
                      00314                                 ; PRETECENI := X mod 32
                      00315         BANK_1
0648   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0649   1683               M                 bsf     STATUS,RP0    
064A   0820           00316         movfw OPERAND_X1
064B   391F           00317         andlw b'00011111'
064C   00AC           00318         movwf PRETECENI         ; PRETECENI := X mod 32
                      00319         
064D   2618           00320         call POSUNDOPRAVA
064E   2618           00321         call POSUNDOPRAVA
064F   2618           00322         call POSUNDOPRAVA
0650   2618           00323         call POSUNDOPRAVA
0651   2618           00324         call POSUNDOPRAVA
                      00325 
                      00326         BANK_0
0652   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0653   1283               M                 bcf     STATUS,RP0    
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 59


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0654   0008           00327         return
                      00328 ;**********************************************************
0655                  00329 POSUNDOPRAVA_6  ; X := X div 64
                      00330                                 ; PRETECENI := X mod 64
                      00331         BANK_1
0655   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0656   1683               M                 bsf     STATUS,RP0    
0657   0820           00332         movfw OPERAND_X1
0658   393F           00333         andlw b'00111111'
0659   00AC           00334         movwf PRETECENI         ; PRETECENI := X mod 64
                      00335         
065A   2618           00336         call POSUNDOPRAVA
065B   2618           00337         call POSUNDOPRAVA
065C   2618           00338         call POSUNDOPRAVA
065D   2618           00339         call POSUNDOPRAVA
065E   2618           00340         call POSUNDOPRAVA
065F   2618           00341         call POSUNDOPRAVA
                      00342 
                      00343         BANK_0
0660   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0661   1283               M                 bcf     STATUS,RP0    
0662   0008           00344         return
                      00345 ;**********************************************************
0663                  00346 POSUNDOPRAVA_7  ; X := X div 128
                      00347                                 ; PRETECENI := X mod 128
                      00348         BANK_1
0663   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0664   1683               M                 bsf     STATUS,RP0    
0665   0820           00349         movfw OPERAND_X1
0666   397F           00350         andlw b'01111111'
0667   00AC           00351         movwf PRETECENI         ; PRETECENI := X mod 128
                      00352         
0668   2618           00353         call POSUNDOPRAVA
0669   2618           00354         call POSUNDOPRAVA
066A   2618           00355         call POSUNDOPRAVA
066B   2618           00356         call POSUNDOPRAVA
066C   2618           00357         call POSUNDOPRAVA
066D   2618           00358         call POSUNDOPRAVA
066E   2618           00359         call POSUNDOPRAVA
                      00360 
                      00361         BANK_0
066F   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0670   1283               M                 bcf     STATUS,RP0    
0671   0008           00362         return
                      00363 ;**********************************************************
0672                  00364 NULA    ; if (X =  0) then PRETECENI := 0
                      00365                 ; if (X <> 0) then PRETECENI := 1
                      00366                 ; obsah X zustane nezmenen
                      00367         BANK_1
0672   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0673   1683               M                 bsf     STATUS,RP0    
0674   01AC           00368         clrf PRETECENI
0675   30FF           00369         movlw h'FF'     
                      00370 
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 60


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0676   05A0           00371         andwf OPERAND_X1,F
0677   1D03           00372         btfss STATUS,Z
0678   142C           00373                 bsf PRETECENI,0
0679   05A1           00374         andwf OPERAND_X2,F
067A   1D03           00375         btfss STATUS,Z
067B   142C           00376                 bsf PRETECENI,0
067C   05A2           00377         andwf OPERAND_X3,F
067D   1D03           00378         btfss STATUS,Z
067E   142C           00379                 bsf PRETECENI,0
067F   05A3           00380         andwf OPERAND_X4,F
0680   1D03           00381         btfss STATUS,Z
0681   142C           00382                 bsf PRETECENI,0         
                      00383 
                      00384         BANK_0
0682   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0683   1283               M                 bcf     STATUS,RP0    
0684   0008           00385         return
                      00386 ;**********************************************************
                      00076  
                      00077 
0800                  00078  org 0x0800                                     ; PAGE 1
                      00079 ;#IF VS1001==1
                      00080         include "vs1001.asm"    ; podprogramy na ovladani mp3 decoderu
                      00001 ;**********************************************************
                      00002 ;**********************************************************
                      00003 ;**********************************************************
                      00004 ; OBSLUZNE PODPROGRAMY PRO MP3 DECODER vs1001g
                      00005 ;**********************************************************
                      00006 ;**********************************************************
                      00007 ;**********************************************************
                      00008 
                      00009 ; MP3_PORT              
                      00010 ; MP3_PORT_TRIS 
                      00011 
                      00012 ; BITY MP3_PORT
                      00013 ; #define MP3_SO                MP3_PORT,0      ; serial output - tady dostavame z dekoderu data
                      00014 ; #define MP3_SI                MP3_PORT,1      ; serial input  - pokud MP3_CS=1, tak posilame mp3 data,
                             pokud =0, tak posilame prikaz
                      00015 ; #define MP3_SCLK              MP3_PORT,2      ; clock - nabezna hrana urcuje platnost dat pri seriovem
                             prenosu
                      00016 ; #define MP3_CS                MP3_PORT,3      ; cable select  - pokud MP3_CS=1, tak po SI posilame mp3
                             data, pokud =0, tak posilame prikaz
                      00017 ; #define MP3_DREQ              MP3_PORT,4      ; data request  - pokud =1, tak dekoder pozaduje dalsi m
                            p3 data (vic jak 32B)
                      00018 ; #define MP3_BSYNC             MP3_PORT,5      ; pro synchronizaci - ma byt nastaven pri prvnim prenase
                            nem bitu kazdeho bytu
                      00019 
                      00020 ;**********************************************************
                      00021 ; co nejrychleji vodesle hodnotu ve W smerem k dekoderu (obsluhuje signaly DSYNC, SI, SCLK)
0800                  00022 VS_WR_BYTE
                      00023         ; k praci pouziva TEMPW
0800   00B5           00024         movwf TEMPW             ; dato co mame odeslat si hodime do tempu...
                      00025 
0801   1507           00026         bsf MP3_BSYNC   ; bude nasledovat prvni bit bytu, proto nastavime BSYNC
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 61


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00027 
                      00028         ; 7. bit bytu
0802   1187           00029         bcf MP3_SCLK    ; shodime SCLK
0803   1287           00030         bcf MP3_SI              ; nevime zda bit bude 0 nebo 1, SI nulujeme
0804   0DB5           00031         rlf TEMPW,f             ; odesilame od nejvyssiho bitu k nejnizsimu
0805   1803           00032         btfsc STATUS,C
0806   1687           00033         bsf MP3_SI
0807   1587           00034         bsf MP3_SCLK
0808   1107           00035         bcf MP3_BSYNC
                      00036         
                      00037         ; 6. bit bytu
0809   1187           00038         bcf MP3_SCLK    ; shodime SCLK
080A   1287           00039         bcf MP3_SI              ; nevime zda bit bude 0 nebo 1, SI nulujeme
080B   0DB5           00040         rlf TEMPW,f             ; odesilame od nejvyssiho bitu k nejnizsimu
080C   1803           00041         btfsc STATUS,C
080D   1687           00042         bsf MP3_SI
080E   1587           00043         bsf MP3_SCLK
                      00044 
                      00045         ; 5. bit bytu
080F   1187           00046         bcf MP3_SCLK    ; shodime SCLK
0810   1287           00047         bcf MP3_SI              ; nevime zda bit bude 0 nebo 1, SI nulujeme
0811   0DB5           00048         rlf TEMPW,f             ; odesilame od nejvyssiho bitu k nejnizsimu
0812   1803           00049         btfsc STATUS,C
0813   1687           00050         bsf MP3_SI
0814   1587           00051         bsf MP3_SCLK
                      00052 
                      00053         ; 4. bit bytu
0815   1187           00054         bcf MP3_SCLK    ; shodime SCLK
0816   1287           00055         bcf MP3_SI              ; nevime zda bit bude 0 nebo 1, SI nulujeme
0817   0DB5           00056         rlf TEMPW,f             ; odesilame od nejvyssiho bitu k nejnizsimu
0818   1803           00057         btfsc STATUS,C
0819   1687           00058         bsf MP3_SI
081A   1587           00059         bsf MP3_SCLK
                      00060 
                      00061         ; 3. bit bytu
081B   1187           00062         bcf MP3_SCLK    ; shodime SCLK
081C   1287           00063         bcf MP3_SI              ; nevime zda bit bude 0 nebo 1, SI nulujeme
081D   0DB5           00064         rlf TEMPW,f             ; odesilame od nejvyssiho bitu k nejnizsimu
081E   1803           00065         btfsc STATUS,C
081F   1687           00066         bsf MP3_SI
0820   1587           00067         bsf MP3_SCLK
                      00068 
                      00069         ; 2. bit bytu
0821   1187           00070         bcf MP3_SCLK    ; shodime SCLK
0822   1287           00071         bcf MP3_SI              ; nevime zda bit bude 0 nebo 1, SI nulujeme
0823   0DB5           00072         rlf TEMPW,f             ; odesilame od nejvyssiho bitu k nejnizsimu
0824   1803           00073         btfsc STATUS,C
0825   1687           00074         bsf MP3_SI
0826   1587           00075         bsf MP3_SCLK
                      00076 
                      00077         ; 1. bit bytu
0827   1187           00078         bcf MP3_SCLK    ; shodime SCLK
0828   1287           00079         bcf MP3_SI              ; nevime zda bit bude 0 nebo 1, SI nulujeme
0829   0DB5           00080         rlf TEMPW,f             ; odesilame od nejvyssiho bitu k nejnizsimu
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 62


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

082A   1803           00081         btfsc STATUS,C
082B   1687           00082         bsf MP3_SI
082C   1587           00083         bsf MP3_SCLK
                      00084 
                      00085         ; 0. bit bytu
082D   1187           00086         bcf MP3_SCLK    ; shodime SCLK
082E   1287           00087         bcf MP3_SI              ; nevime zda bit bude 0 nebo 1, SI nulujeme
082F   0DB5           00088         rlf TEMPW,f             ; odesilame od nejvyssiho bitu k nejnizsimu
0830   1803           00089         btfsc STATUS,C
0831   1687           00090         bsf MP3_SI
0832   1587           00091         bsf MP3_SCLK
                      00092 
0833   1187           00093         bcf MP3_SCLK
0834   0008           00094         return
                      00095 ;**********************************************************
                      00096 ; co nejrychleji prijme dato z vs1001 a umisti jej do W
0835                  00097 VS_RD_BYTE
                      00098         ; k praci pouziva TEMPW
                      00099 
0835   01B5           00100         clrf TEMPW              ; vymazeme, sem budeme strkat dato co nam prijde...
0836   1187           00101         bcf MP3_SCLK    ; shodime SCLK
0837   1507           00102         bsf MP3_BSYNC   ; bude nasledovat prvni bit bytu, proto nastavime BSYNC
0838   1003           00103         bcf STATUS,C    ; nulujeme priznak CARRY, staci to delat jen na zacatku, protoze TEMW mame prazd
                            ny...
                      00104 
                      00105         ; 7. bit bytu
0839   1587           00106         bsf MP3_SCLK    ; nabezna hrana SCLK
083A   1A07           00107         btfsc MP3_SO
083B   1403           00108         bsf STATUS,C    ; pokud je SO v jednice nastavime C...
083C   0DB5           00109         rlf TEMPW,f
083D   1187           00110         bcf MP3_SCLK    ; shodime SCLK
                      00111 
083E   1107           00112         bcf MP3_BSYNC
                      00113 
                      00114         ; 6. bit bytu
083F   1587           00115         bsf MP3_SCLK    ; nabezna hrana SCLK
0840   1A07           00116         btfsc MP3_SO
0841   1403           00117         bsf STATUS,C    ; pokud je SO v jednice nastavime C...
0842   0DB5           00118         rlf TEMPW,f
0843   1187           00119         bcf MP3_SCLK    ; shodime SCLK  
                      00120 
                      00121         ; 5. bit bytu
0844   1587           00122         bsf MP3_SCLK    ; nabezna hrana SCLK
0845   1A07           00123         btfsc MP3_SO
0846   1403           00124         bsf STATUS,C    ; pokud je SO v jednice nastavime C...
0847   0DB5           00125         rlf TEMPW,f
0848   1187           00126         bcf MP3_SCLK    ; shodime SCLK  
                      00127 
                      00128         ; 4. bit bytu
0849   1587           00129         bsf MP3_SCLK    ; nabezna hrana SCLK
084A   1A07           00130         btfsc MP3_SO
084B   1403           00131         bsf STATUS,C    ; pokud je SO v jednice nastavime C...
084C   0DB5           00132         rlf TEMPW,f
084D   1187           00133         bcf MP3_SCLK    ; shodime SCLK  
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 63


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00134 
                      00135         ; 3. bit bytu
084E   1587           00136         bsf MP3_SCLK    ; nabezna hrana SCLK
084F   1A07           00137         btfsc MP3_SO
0850   1403           00138         bsf STATUS,C    ; pokud je SO v jednice nastavime C...
0851   0DB5           00139         rlf TEMPW,f
0852   1187           00140         bcf MP3_SCLK    ; shodime SCLK  
                      00141 
                      00142         ; 2. bit bytu
0853   1587           00143         bsf MP3_SCLK    ; nabezna hrana SCLK
0854   1A07           00144         btfsc MP3_SO
0855   1403           00145         bsf STATUS,C    ; pokud je SO v jednice nastavime C...
0856   0DB5           00146         rlf TEMPW,f
0857   1187           00147         bcf MP3_SCLK    ; shodime SCLK  
                      00148 
                      00149         ; 1. bit bytu
0858   1587           00150         bsf MP3_SCLK    ; nabezna hrana SCLK
0859   1A07           00151         btfsc MP3_SO
085A   1403           00152         bsf STATUS,C    ; pokud je SO v jednice nastavime C...
085B   0DB5           00153         rlf TEMPW,f
085C   1187           00154         bcf MP3_SCLK    ; shodime SCLK  
                      00155 
                      00156         ; 0. bit bytu
085D   1587           00157         bsf MP3_SCLK    ; nabezna hrana SCLK
085E   1A07           00158         btfsc MP3_SO
085F   1403           00159         bsf STATUS,C    ; pokud je SO v jednice nastavime C...
0860   0D35           00160         rlf TEMPW,W
0861   1187           00161         bcf MP3_SCLK    ; shodime SCLK  
                      00162 
                      00163         ; movfw TEMPW ; tuto operaci jiz nemusime provadet, protoze jsme posledni rotaci hodily do W (rl
                            f TEMPW,W)
0862   0008           00164         return
                      00165 ;**********************************************************
                      00166 ; do TEMP1 dame adresu registru 
                      00167 ; do TEMP2 dame dolni slabiku zapisovaneho slova
                      00168 ; do TEMP3 dame horni slabiku zapisovaneho slova
0863                  00169 VS_WR_REG       ; zapise 16bitove slovo (TEMP2,TEMP3) do registru mp3 dekoderu (TEMP1)
                      00170                         ; 16bit dato se odesila od nejvyssiho bitu (15,14...8,7...1,0)
                      00171                         ; kde TEMP3 = bity 15-8 ; TEMP2 = bity 7-0
                      00172 ; pri praci pouziva TEMP1, TEMP2, TEMP3, TEMPW
0863   1C07           00173         btfss MP3_DREQ
0864   2863           00174         goto $-1
                      00175         ; v datasheetu k VS1001k o tom sice nic nepisou, v diskuzi na ikoras.iglu.cz mi bylo al porazeno
                            , 
                      00176         ; ze necekani na DREQ pri cteni/zapisu registru muze zpusobovat praskani n vystupu...
                      00177 
0865   1087           00178         bcf MP3_CS                      ; po SI posilame prikaz
0866   3002           00179         movlw b'00000010'       ; write
0867   2000           00180         call VS_WR_BYTE 
0868   0836           00181         movfw TEMP1                     ; adresa zapisovaneho registru
0869   2000           00182         call VS_WR_BYTE
086A   0838           00183         movfw TEMP3             ; horni slabika
086B   2000           00184         call VS_WR_BYTE
086C   0837           00185         movfw TEMP2             ; dolni slabika
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 64


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

086D   2000           00186         call VS_WR_BYTE
                      00187 
086E   2114           00188         call DELAY_5us          ; pozor, prepise TEMP1
086F   1487           00189         bsf MP3_CS
0870   0008           00190         return
                      00191 ;**********************************************************
                      00192 ; do TEMP1 dame adresu registru 
                      00193 ; v TEMP2 nam vrati dolni slabiku precteneho slova
                      00194 ; v TEMP3 nam vrati horni slabiku precteneho slova
0871                  00195 VS_RD_REG       ; precte 16bitove slovo (TEMP3,TEMP2) z registru mp3 dekoderu (TEMP1)
                      00196                         ; kde TEMP3 = bity 15-8 ; TEMP2 = bity 7-0
                      00197 ; pri praci pouziva TEMP1, TEMP2, TEMP3, TEMPW
0871   1C07           00198         btfss MP3_DREQ
0872   2871           00199         goto $-1
                      00200         ; v datasheetu k VS1001k o tom sice nic nepisou, v diskuzi na ikoras.iglu.cz mi bylo al porazeno
                            , 
                      00201         ; ze necekani na DREQ pri cteni/zapisu registru muze zpusobovat praskani n vystupu...
                      00202 
0873   1087           00203         bcf MP3_CS                      ; po SI posilame prikaz
0874   3003           00204         movlw b'00000011'       ; read
0875   2000           00205         call VS_WR_BYTE 
0876   0836           00206         movfw TEMP1                     ; adresa cteneho registru
0877   2000           00207         call VS_WR_BYTE
0878   2035           00208         call VS_RD_BYTE
0879   00B8           00209         movwf TEMP3             ; horni slabika
087A   2035           00210         call VS_RD_BYTE
087B   00B7           00211         movwf TEMP2             ; dolni slabika
                      00212 
087C   2114           00213         call DELAY_5us          ; pozor, prepise TEMP1
087D   1487           00214         bsf MP3_CS
087E   0008           00215         return
                      00216 ;**********************************************************
087F                  00217 VS_SOFT_RESET_NO_PLUG   ; provede softwarovy reset dekoderu bez resetu pluginu
                      00218         PROG_PAGE_0
087F   118A               M                         bcf PCLATH,3
0880   120A               M                         bcf PCLATH,4
0881   2235           00219         call DELAY_200ms
                      00220         PROG_PAGE_1
0882   158A               M                         bsf PCLATH,3
0883   120A               M                         bcf PCLATH,4
                      00221 
0884   3000           00222         movlw VSADDR_MODE
0885   00B6           00223         movwf TEMP1
0886   154D           00224         bsf VSREG_MODE_L,2      ; soft reset=1
0887   084D           00225         movfw VSREG_MODE_L
0888   00B7           00226         movwf TEMP2
0889   3000           00227         movlw .0                        ; MODE_H
088A   00B8           00228         movwf TEMP3
088B   2063           00229         call VS_WR_REG
                      00230 
                      00231         PROG_PAGE_0
088C   118A               M                         bcf PCLATH,3
088D   120A               M                         bcf PCLATH,4
088E   222C           00232         call DELAY_2ms
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 65


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00233         PROG_PAGE_1
088F   158A               M                         bsf PCLATH,3
0890   120A               M                         bcf PCLATH,4
0891   20CF           00234         call VS_SEND_1024_NULL  
                      00235 
0892   114D           00236         bcf VSREG_MODE_L,2      ; soft reset=0
0893   0008           00237         return
                      00238 ;**********************************************************
0894                  00239 VS_SOFT_RESET   ; provede softwarovy reset dekoderu (pri zapnuti a pote po skonceni kazde mp3)
                      00240         PROG_PAGE_0
0894   118A               M                         bcf PCLATH,3
0895   120A               M                         bcf PCLATH,4
0896   2235           00241         call DELAY_200ms
                      00242         PROG_PAGE_1
0897   158A               M                         bsf PCLATH,3
0898   120A               M                         bcf PCLATH,4
                      00243 
0899   3000           00244         movlw VSADDR_MODE
089A   00B6           00245         movwf TEMP1
089B   154D           00246         bsf VSREG_MODE_L,2      ; soft reset=1
089C   084D           00247         movfw VSREG_MODE_L
089D   00B7           00248         movwf TEMP2
089E   3000           00249         movlw .0                        ; MODE_H
089F   00B8           00250         movwf TEMP3
08A0   2063           00251         call VS_WR_REG
                      00252 
                      00253         PROG_PAGE_0
08A1   118A               M                         bcf PCLATH,3
08A2   120A               M                         bcf PCLATH,4
08A3   222C           00254         call DELAY_2ms
                      00255         PROG_PAGE_1
08A4   158A               M                         bsf PCLATH,3
08A5   120A               M                         bcf PCLATH,4
08A6   20CF           00256         call VS_SEND_1024_NULL  
                      00257 
08A7   114D           00258         bcf VSREG_MODE_L,2      ; soft reset=0
                      00259 
08A8   300A           00260         movlw VSADDR_AIADDR
08A9   00B6           00261         movwf TEMP1
08AA   3000           00262         movlw 0x00
08AB   00B7           00263         movwf TEMP2     
08AC   3042           00264         movlw 0x42
08AD   00B8           00265         movwf TEMP3
08AE   2063           00266         call VS_WR_REG                          ; nastavime zacatek uzivatelskeho programu (0x4200)
                      00267 
08AF   300D           00268         movlw VSADDR_AICTRL0
08B0   00B6           00269         movwf TEMP1
08B1   3000           00270         movlw 0x00
08B2   00B7           00271         movwf TEMP2     
08B3   3000           00272         movlw 0x00
08B4   00B8           00273         movwf TEMP3
08B5   2063           00274         call VS_WR_REG                          ; resetujeme plugin
                      00275 
08B6   300D           00276         movlw VSADDR_AICTRL0
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 66


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

08B7   00B6           00277         movwf TEMP1
08B8   302F           00278         movlw VS_LOUDNESS
08B9   00B7           00279         movwf TEMP2     
08BA   3000           00280         movlw 0x00
08BB   00B8           00281         movwf TEMP3
08BC   2063           00282         call VS_WR_REG                          ; nastavime pouzivany filter
                      00283 
08BD   082F           00284         movfw VS_LOUDNESS
08BE   39FF           00285         andlw h'FF'
08BF   1D03           00286         btfss STATUS,Z
08C0   0008           00287         return
                      00288 
08C1   300A           00289         movlw VSADDR_AIADDR
08C2   00B6           00290         movwf TEMP1
08C3   01B7           00291         clrf TEMP2      
08C4   01B8           00292         clrf TEMP3
08C5   2063           00293         call VS_WR_REG                          ; pokud je filter 0, vypneme plugin
08C6   0008           00294         return
                      00295 ;**********************************************************
08C7                  00296 VS_SEND_32_NULL
08C7   20DE           00297         call WAIT_FOR_VSDREQ
08C8   3020           00298         movlw .32
08C9   00B7           00299         movwf TEMP2
                      00300         
08CA   3000           00301         movlw .0
08CB   2000           00302         call VS_WR_BYTE
08CC   0BB7           00303         decfsz TEMP2,F
08CD   28CA           00304         goto $-3
08CE   0008           00305         return
                      00306 ;**********************************************************
08CF                  00307 VS_SEND_1024_NULL
08CF   1487           00308         bsf MP3_CS                      ; po SI posilam data
08D0   3020           00309         movlw .32
08D1   00B6           00310         movwf TEMP1
                      00311 
08D2   20C7           00312         call VS_SEND_32_NULL
08D3   0BB6           00313         decfsz TEMP1,F
08D4   28D2           00314         goto $-2
                      00315          
08D5   0008           00316         return
                      00317 ;**********************************************************
08D6                  00318 VS_SET_VOLUME
08D6   300B           00319         movlw VSADDR_VOL
08D7   00B6           00320         movwf TEMP1
                      00321 
08D8   084F           00322         movfw VSREG_VOL_L
08D9   00B7           00323         movwf TEMP2
08DA   0850           00324         movfw VSREG_VOL_H
08DB   00B8           00325         movwf TEMP3
08DC   2063           00326         call VS_WR_REG
08DD   0008           00327         return          
                      00328 ;**********************************************************
08DE                  00329 WAIT_FOR_VSDREQ
08DE   1C07           00330         btfss MP3_DREQ
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 67


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

08DF   28DE           00331         goto WAIT_FOR_VSDREQ
08E0   0008           00332         return
                      00333 ;**********************************************************
08E1                  00334 VS_END_BEEP
08E1   20DE           00335         call WAIT_FOR_VSDREQ
                      00336 
08E2   3045           00337         movlw h'45'
08E3   2000           00338         call VS_WR_BYTE
08E4   3078           00339         movlw h'78'
08E5   2000           00340         call VS_WR_BYTE
08E6   3069           00341         movlw h'69'
08E7   2000           00342         call VS_WR_BYTE
08E8   3074           00343         movlw h'74'                     ; odeslanim tohoto kodu sinusovku ukoncime...
08E9   2000           00344         call VS_WR_BYTE
08EA   3000           00345         movlw .0
08EB   2000           00346         call VS_WR_BYTE
08EC   3000           00347         movlw .0
08ED   2000           00348         call VS_WR_BYTE
08EE   3000           00349         movlw .0
08EF   2000           00350         call VS_WR_BYTE
08F0   3000           00351         movlw .0
08F1   2000           00352         call VS_WR_BYTE
                      00353 
08F2   0008           00354         return
                      00355 ;**********************************************************
08F3                  00356 VS_BEEP
                      00357 ;       call VS_SOFT_RESET
                      00358 ;       call WAIT_FOR_VSDREQ
                      00359 
08F3   1487           00360         bsf MP3_CS                      ; po SI posilam data
08F4   3053           00361         movlw h'53'
08F5   2000           00362         call VS_WR_BYTE
08F6   30EF           00363         movlw h'EF'
08F7   2000           00364         call VS_WR_BYTE
08F8   306E           00365         movlw h'6E'
08F9   2000           00366         call VS_WR_BYTE
08FA   303E           00367         movlw .62                       ; ctyr bytova testovaci sekvence. Tento posledni byte znamena, 
08FB   2000           00368         call VS_WR_BYTE         ; ze s pouzitim vzorkovaci frekvence 16kHz bude generovan ton 1kHz
08FC   3000           00369         movlw .0
08FD   2000           00370         call VS_WR_BYTE
08FE   3000           00371         movlw .0
08FF   2000           00372         call VS_WR_BYTE
0900   3000           00373         movlw .0
0901   2000           00374         call VS_WR_BYTE
0902   3000           00375         movlw .0                        ; testovaci kod musi byt nasledovan 4 nulamy
0903   2000           00376         call VS_WR_BYTE
                      00377 
0904   0008           00378         return
                      00379 ;**********************************************************
0905                  00380 VS_INIT
0905   01CD           00381         clrf VSREG_MODE_L
0906   01CE           00382         clrf VSREG_STATUS_L
0907   3040           00383         movlw h'40'
0908   00CF           00384         movwf VSREG_VOL_L               ; VOL=0x40 => nenastavuji maximalni hlasitost, protoze kdyz jsou
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 68


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                             pripojena sluchatka, tak by z toho jeden ohluchl...
0909   00D0           00385         movwf VSREG_VOL_H
                      00386 
090A   207F           00387         call VS_SOFT_RESET_NO_PLUG              ; resetujeme
                      00388         
090B   3003           00389         movlw .3
090C   00BA           00390         movwf TEMP5
090D   20D6           00391         call VS_SET_VOLUME              ; nastavime hlasitost
090E   20F3           00392         call VS_BEEP
090F   0BBA           00393         decfsz TEMP5,f
0910   290D           00394         goto $-3
                      00395         ; asi proto, ze nemam osetreny hardwarovy reset dekoderu, se mu obcas nechce nastartovat....
                      00396         ; proto jej 5x za sebou resetuji a zapinam pokusnou sinusovku...
                      00397         
0911   20E1           00398         call VS_END_BEEP
0912   207F           00399         call VS_SOFT_RESET_NO_PLUG              ; resetujeme
                      00400 
0913   0008           00401         return
                      00402 ;**********************************************************
0914                  00403 DELAY_5us
                      00404         ; pouziva TEMP1
                      00405         ; (Fosc = 20 MHz , instr. cyklus= 0.20 us) 5us / 0.20 us = 25 instrukcnich cyklu
                      00406         ; (Fosc = 16 MHz , instr. cyklus= 0.25 us) 5us / 0.25 us = 20 instrukcnich cyklu
                      00407 ;Variable: TMP0
                      00408 ;Delay 25 cycles
0914   3008           00409         MOVLW 0x08  ;8 DEC
0915   00B6           00410         MOVWF TEMP1
0916   0BB6           00411         DECFSZ TEMP1,F
0917   2916           00412         GOTO $-1
                      00413 ;End of Delay
0918   0008           00414         return
                      00415 ;**********************************************************
                      00081 ;#ENDIF
                      00082         include "commands.asm"  ; prni cast podprogramu na obsluhu prikazu (od ridiciho procesoru)
                      00001 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
                      00002 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
                      00003 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
                      00004 ; tady jsou procedury resici jednotlive prikazy
                      00005 ; Pokud je v zasobniku prikaz pro nejakou proceduru, musi tato procedura nastavit byt STAV_PRIKAZU do 1 
                            (i kdyz treba nema vsechny parametry)
                      00006 ; Pokud procedura najde svuj prikaz a jsou prijate vsechny parametry, musi odeslat nejakou odpoved po US
                            ARTu a smazat reg. PRIJATYCH_DAT!!!
                      00007 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
                      00008 ; CAST 1
0919                  00009 CEKEJ_PRIKAZ                                    ; ceka dokud nedostaneme nejaky prikaz
0919   0873           00010         movfw PRIJATYCH_DAT
091A   39FF           00011         andlw h'FF'
091B   1903           00012         btfsc STATUS,Z                          ; koukneme se zda prisel nejaky prikaz...
091C   2919           00013         goto CEKEJ_PRIKAZ
091D   0008           00014         return
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 69


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00015 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
091E                  00016 PRIKAZ_02h                                              ; 02h - vrat oddily se systemem FAT32
091E   0878           00017         movfw 0x078                                     ; prvni byte zasobniku prikazu
091F   3C02           00018         sublw h'02'                                     
0920   1D03           00019         btfss STATUS,Z
0921   0008           00020         return                                          ; nebyl prijat prikaz 02h
0922   1475           00021         bsf STAV_PRIKAZU,0                      ; mame tu prikaz 02h, nastavime byt STAV_PRIKAZU
0923   0873           00022         movfw PRIJATYCH_DAT
0924   3C01           00023         sublw .1                                        ; pro prikaz 02h museji prijit 2 byty (prikaz + 
                            1 parametr)
0925   1803           00024         btfsc STATUS,C
0926   0008           00025         return                                          ; jeste nemame vsechny parametry
                      00026         ; Prisel prikaz 02h s jednim parametrem (vrat oddily se systemem FAT32)
                      00027 
0927   0879           00028         movfw 0x079                                     ; parametr prikazu 02h (cislo svazku, jehoz para
                            metry chceme vratit)
0928   3903           00029         andlw b'00000011'                       ; parametr musi byt v rozsahu 0-3
0929   00B6           00030         movwf TEMP1
092A   1003           00031         bcf STATUS,C
092B   0DB6           00032         rlf TEMP1,F
092C   0DB6           00033         rlf TEMP1,F
092D   0DB6           00034         rlf TEMP1,F
092E   0D36           00035         rlf TEMP1,W                                     ; parametr vynasobime 16
092F   3E10           00036         addlw 0x10                                      ; buffer 2 je v bance 2 na adrese 0x10
0930   0084           00037         movwf FSR
                      00038         INDF_BANK_2
0931   1783               M                         bsf STATUS,IRP    
0932   3010           00039         movlw .16                                       ; budeme odesilat 16 bytu
0933   00B6           00040         movwf TEMP1
0934                  00041 PRIKAZ_02h__ODESILANI_ODDILU
0934   0800           00042         movfw INDF
                      00043         PROG_PAGE_0
0935   118A               M                         bcf PCLATH,3
0936   120A               M                         bcf PCLATH,4
0937   21D0           00044         call WR_USART
                      00045         PROG_PAGE_1
0938   158A               M                         bsf PCLATH,3
0939   120A               M                         bcf PCLATH,4
093A   0A84           00046         incf FSR,F
093B   0BB6           00047         decfsz TEMP1,F
093C   2934           00048         goto PRIKAZ_02h__ODESILANI_ODDILU
093D   01F3           00049         clrf PRIJATYCH_DAT
093E   0008           00050         return
                      00051 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
093F                  00052 PRIKAZ_03h                                              ; 03h – nastav oddil
093F   0878           00053         movfw 0x078                                     ; prvni byte zasobniku prikazu
0940   3C03           00054         sublw h'03'                                     
0941   1D03           00055         btfss STATUS,Z
0942   0008           00056         return                                          ; nebyl prijat prikaz 03h
0943   1475           00057         bsf STAV_PRIKAZU,0                      ; mame tu prikaz 03h, nastavime byt STAV_PRIKAZU
0944   0873           00058         movfw PRIJATYCH_DAT
0945   3C04           00059         sublw .4                                        ; pro prikaz 03h museji prijit 5 byty (prikaz + 
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 70


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            4byty parametr)
0946   1803           00060         btfsc STATUS,C
0947   0008           00061         return                                          ; jeste nemame vsechny parametry
                      00062         ; Prisel prikaz 03h s 4bytovym parametrem (nacti oddily se systemem FAT32)
                      00063 
0948   0879           00064         movfw 0x079                                     ; parametrem prikazu 03h ma byt 4bytova adresa z
                            acatku svazku, ktery se ma nacist
0949   00A7           00065         movwf LBA1
094A   087A           00066         movfw 0x07A
094B   00A8           00067         movwf LBA2
094C   087B           00068         movfw 0x07B
094D   00A9           00069         movwf LBA3
094E   087C           00070         movfw 0x07C
094F   00AA           00071         movwf LBA4
                      00072         PROG_PAGE_2
0950   118A               M                         bcf PCLATH,3
0951   160A               M                         bsf PCLATH,4
0952   20E7           00073         call NACTI_FAT32                        ; nacte parametry zvoleneho oddilu
                      00074         PROG_PAGE_1
0953   158A               M                         bsf PCLATH,3
0954   120A               M                         bcf PCLATH,4
                      00075 
0955   082E           00076         movfw ATA_ATTRIBUTES
                      00077         PROG_PAGE_0
0956   118A               M                         bcf PCLATH,3
0957   120A               M                         bcf PCLATH,4
0958   21D0           00078         call WR_USART
                      00079         PROG_PAGE_1
0959   158A               M                         bsf PCLATH,3
095A   120A               M                         bcf PCLATH,4
095B   01F3           00080         clrf PRIJATYCH_DAT                      ; vyprazdnime zasobnik
095C   0008           00081         return
                      00082 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
095D                  00083 PRIKAZ_04h                                              ; 04h – vrat velikost clusteru
095D   0878           00084         movfw 0x078                                     ; prvni byte zasobniku prikazu
095E   3C04           00085         sublw h'04'                                     
095F   1D03           00086         btfss STATUS,Z
0960   0008           00087         return                                          ; nebyl prijat prikaz 04h
0961   1475           00088         bsf STAV_PRIKAZU,0                      ; mame tu prikaz 04h, nastavime byt STAV_PRIKAZU
                      00089         ; pro prikaz 04h nejsou definovany zadne parametry, proto jiz nic jineho netestujeme
                      00090 
0962   084C           00091         movfw CLUSTER_SIZE
                      00092         PROG_PAGE_0
0963   118A               M                         bcf PCLATH,3
0964   120A               M                         bcf PCLATH,4
0965   21D0           00093         call WR_USART
                      00094         PROG_PAGE_1
0966   158A               M                         bsf PCLATH,3
0967   120A               M                         bcf PCLATH,4
0968   01F3           00095         clrf PRIJATYCH_DAT                      ; vyprazdnime zasobnik
0969   0008           00096         return
                      00097 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 71


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

096A                  00098 PRIKAZ_05h                                              ; 05h – zjisti, zda je cluster prvni v adresari
096A   0878           00099         movfw 0x078                                     ; prvni byte zasobniku prikazu
096B   3C05           00100         sublw h'05'
096C   1D03           00101         btfss STATUS,Z
096D   0008           00102         return                                          ; nebyl prijat prikaz 05h
096E   1475           00103         bsf STAV_PRIKAZU,0                      ; mame tu prikaz 05h, nastavime byt STAV_PRIKAZU
096F   0873           00104         movfw PRIJATYCH_DAT
0970   3C06           00105         sublw .6                                        ; pro prikaz 05h musi prijit 7 bytu (prikaz + 6b
                            ytu parametr)
0971   1803           00106         btfsc STATUS,C
0972   0008           00107         return                                          ; jeste nemame vsechny parametry
                      00108         ; Prisel prikaz 05h s 6bytovym parametrem 
                      00109 
0973   0879           00110         movfw 0x079                                     ; nejnizsi cast clusteru adresare
0974   00BC           00111         movwf CLUSTER1
0975   087A           00112         movfw 0x07A
0976   00BD           00113         movwf CLUSTER2
0977   087B           00114         movfw 0x07B
0978   00BE           00115         movwf CLUSTER3
0979   087C           00116         movfw 0x07C
097A   00BF           00117         movwf CLUSTER4
097B   237C           00118         call PRVNI_CL_ADRESARE
                      00119 
097C   1C3B           00120         btfss POZICE,0
097D   2984           00121         goto PRIKAZ_05h_PAR1_OK
                      00122 
097E                  00123 PRIKAZ_05h_PAR1_NOT_OK
                      00124         INDF_BANK_2
097E   1783               M                         bsf STATUS,IRP    
097F   3010           00125         movlw 0x10                                      ; 1. byte bufferu 2
0980   0084           00126         movwf FSR
0981   3081           00127         movlw h'81'                                     ; jako prvni byte odpovedi dame 81h (Zadany clus
                            ter neobsahuje adresar)
0982   0080           00128         movwf INDF
0983   2992           00129         goto PRIKAZ_05h_KONEC
0984                  00130 PRIKAZ_05h_PAR1_OK
                      00131 
0984   087D           00132         movfw 0x07D
0985   00E0           00133         movwf ZAZNAM1
0986   087E           00134         movfw 0x07E
0987   00E1           00135         movwf ZAZNAM2
                      00136 
0988   23B6           00137         call SKOC_NA_ZAZNAM
0989   1C3B           00138         btfss POZICE,0
098A   2991           00139         goto PRIKAZ_05h_PAR2_OK
                      00140 
098B                  00141 PRIKAZ_05h_PAR2_NOT_OK
                      00142         INDF_BANK_2
098B   1783               M                         bsf STATUS,IRP    
098C   3010           00143         movlw 0x10                                      ; 1. byte bufferu 2
098D   0084           00144         movwf FSR
098E   3080           00145         movlw h'80'                                     ; jako prvni byte odpovedi dame 80h (Zadany zazn
                            am mimo rozsah)
098F   0080           00146         movwf INDF
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 72


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0990   2992           00147         goto PRIKAZ_05h_KONEC
0991                  00148 PRIKAZ_05h_PAR2_OK
                      00149 
0991   2436           00150         call FILE_INFO
                      00151 
0992                  00152 PRIKAZ_05h_KONEC
                      00153         ; At uz bylo v zaznamu cokoli, odesleme 16 bytu z BUFFERU 2
0992   3010           00154         movlw .16
0993   00B6           00155         movwf TEMP1
                      00156         PROG_PAGE_0
0994   118A               M                         bcf PCLATH,3
0995   120A               M                         bcf PCLATH,4
0996   21FB           00157         call ODESLI_BUFFER2                     ; odesleme si zaznam o souboru  
                      00158         PROG_PAGE_1
0997   158A               M                         bsf PCLATH,3
0998   120A               M                         bcf PCLATH,4
                      00159 
0999   01F3           00160         clrf PRIJATYCH_DAT                      ; vyprazdnime zasobnik prikazu
099A   0008           00161         return
                      00162 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
099B                  00163 PRIKAZ_06h                                              ; 06h – vrat cislo dalsiho clusteru v alokacnim 
                            retezu
099B   0878           00164         movfw 0x078                                     ; prvni byte zasobniku prikazu
099C   3C06           00165         sublw h'06'                                     
099D   1D03           00166         btfss STATUS,Z
099E   0008           00167         return                                          ; nebyl prijat prikaz 06h
099F   1475           00168         bsf STAV_PRIKAZU,0                      ; mame tu prikaz 06h, nastavime byt STAV_PRIKAZU
09A0   0873           00169         movfw PRIJATYCH_DAT
09A1   3C04           00170         sublw .4                                        ; pro prikaz 06h museji prijit 5 bytu (prikaz + 
                            4byty parametr)
09A2   1803           00171         btfsc STATUS,C
09A3   0008           00172         return                                          ; jeste nemame vsechny parametry
                      00173         ; Prisel prikaz 06h s 4bytovym parametrem 
                      00174 
09A4   0879           00175         movfw 0x079                                     ; nejnizsi cast clusteru
09A5   00BC           00176         movwf CLUSTER1
09A6   087A           00177         movfw 0x07A
09A7   00BD           00178         movwf CLUSTER2
09A8   087B           00179         movfw 0x07B
09A9   00BE           00180         movwf CLUSTER3
09AA   087C           00181         movfw 0x07C
09AB   00BF           00182         movwf CLUSTER4
                      00183         PROG_PAGE_0
09AC   118A               M                         bcf PCLATH,3
09AD   120A               M                         bcf PCLATH,4
09AE   241F           00184         call NEXT_CLUSTER
09AF   083B           00185         movfw POZICE                            ; pokud POZICE = 00h, je vse v poradku (vratime c. dalsi
                            ho clusteru v retezci). 
                      00186                                                                 ; Pokud POZICE = FFh byl predany cluster
                             posledni v retezu, nebo byl prazdny...
09B0   21D0           00187         call WR_USART
09B1   083C           00188         movfw CLUSTER1
09B2   21D0           00189         call WR_USART
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 73


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

09B3   083D           00190         movfw CLUSTER2
09B4   21D0           00191         call WR_USART
09B5   083E           00192         movfw CLUSTER3
09B6   21D0           00193         call WR_USART
09B7   083F           00194         movfw CLUSTER4
09B8   21D0           00195         call WR_USART
                      00196         PROG_PAGE_1
09B9   158A               M                         bsf PCLATH,3
09BA   120A               M                         bcf PCLATH,4
                      00197         
09BB   01F3           00198         clrf PRIJATYCH_DAT                      ; vyprazdnime zasobnik prikazu
09BC   0008           00199         return
                      00200 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
09BD                  00201 PRIKAZ_07h                                              ; 07h – cti cluster
09BD   0878           00202         movfw 0x078                                     ; prvni byte zasobniku prikazu
09BE   3C07           00203         sublw h'07'                                     
09BF   1D03           00204         btfss STATUS,Z
09C0   0008           00205         return                                          ; nebyl prijat prikaz 07h
09C1   1475           00206         bsf STAV_PRIKAZU,0                      ; mame tu prikaz 07h, nastavime byt STAV_PRIKAZU
09C2   0873           00207         movfw PRIJATYCH_DAT
09C3   3C04           00208         sublw .4                                        ; pro prikaz 07h museji prijit 5 bytu (prikaz + 
                            4byty parametr)
09C4   1803           00209         btfsc STATUS,C
09C5   0008           00210         return                                          ; jeste nemame vsechny parametry
                      00211         ; Prisel prikaz 07h s 4bytovym parametrem 
                      00212 
09C6   0879           00213         movfw 0x079                                     ; nejnizsi cast clusteru
09C7   00BC           00214         movwf CLUSTER1
09C8   087A           00215         movfw 0x07A
09C9   00BD           00216         movwf CLUSTER2
09CA   087B           00217         movfw 0x07B
09CB   00BE           00218         movwf CLUSTER3
09CC   087C           00219         movfw 0x07C
09CD   00BF           00220         movwf CLUSTER4
09CE   01BB           00221         clrf POZICE
                      00222         PROG_PAGE_0
09CF   118A               M                         bcf PCLATH,3
09D0   120A               M                         bcf PCLATH,4
09D1   23BC           00223         call CLUSTER_TO_LBA                     ; zjistime si skutecnou polohu pozadovaneho clusteru na 
                            disku...
09D2   084C           00224         movfw CLUSTER_SIZE
09D3   00A6           00225         movwf SECTOR_C                          ; tentokrat cteme cely cluster a ne sector
09D4   2315           00226         call READ_SECTOR;S
                      00227         PROG_PAGE_1
09D5   158A               M                         bsf PCLATH,3
09D6   120A               M                         bcf PCLATH,4
                      00228 
09D7   084C           00229         movfw CLUSTER_SIZE
09D8   00B7           00230         movwf TEMP2                                     ; kolik sektoru budeme odesilat
                      00231 
09D9                  00232 PRIKAZ_07h__ODESLI_SECTOR
09D9   3000           00233         movlw .0                                        ; budeme odesilat cely sector (256slov = 512bytu
                            )
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 74


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

09DA   00B6           00234         movwf TEMP1
                      00235         PROG_PAGE_0
09DB   118A               M                         bcf PCLATH,3
09DC   120A               M                         bcf PCLATH,4
09DD   21D8           00236         call ODESLI_DATA
                      00237         PROG_PAGE_1
09DE   158A               M                         bsf PCLATH,3
09DF   120A               M                         bcf PCLATH,4
09E0   0BB7           00238         decfsz TEMP2,F                          ; a to tolikrat, kolik ma cluster sektroru
09E1   29D9           00239         goto PRIKAZ_07h__ODESLI_SECTOR
                      00240         
09E2   01F3           00241         clrf PRIJATYCH_DAT                      ; vyprazdnime zasobnik prikazu
09E3   0008           00242         return
                      00243 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
09E4                  00244 PRIKAZ_08h                                              ; 08h – zjisti velikost souboru
09E4   0878           00245         movfw 0x078                                     ; prvni byte zasobniku prikazu
09E5   3C08           00246         sublw h'08'
09E6   1D03           00247         btfss STATUS,Z
09E7   0008           00248         return                                          ; nebyl prijat prikaz 08h
09E8   1475           00249         bsf STAV_PRIKAZU,0                      ; mame tu prikaz 08h, nastavime byt STAV_PRIKAZU
09E9   0873           00250         movfw PRIJATYCH_DAT
09EA   3C06           00251         sublw .6                                        ; pro prikaz 08h musi prijit 7 bytu (prikaz + 6b
                            ytu parametr)
09EB   1803           00252         btfsc STATUS,C
09EC   0008           00253         return                                          ; jeste nemame vsechny parametry
                      00254         ; Prisel prikaz 08h s 6bytovym parametrem 
                      00255 
09ED   0879           00256         movfw 0x079                                     ; nejnizsi cast clusteru adresare
09EE   00BC           00257         movwf CLUSTER1
09EF   087A           00258         movfw 0x07A
09F0   00BD           00259         movwf CLUSTER2
09F1   087B           00260         movfw 0x07B
09F2   00BE           00261         movwf CLUSTER3
09F3   087C           00262         movfw 0x07C
09F4   00BF           00263         movwf CLUSTER4
09F5   237C           00264         call PRVNI_CL_ADRESARE
                      00265 
09F6   1C3B           00266         btfss POZICE,0
09F7   29FB           00267         goto PRIKAZ_08h_PAR1_OK
                      00268 
09F8                  00269 PRIKAZ_08h_PAR1_NOT_OK
09F8   3081           00270         movlw h'81'                                     ; jako prvni byte odpovedi dame 81h (Zadany clus
                            ter neobsahuje adresar)
09F9   00B6           00271         movwf TEMP1
09FA   2A07           00272         goto PRIKAZ_08h_KONEC
09FB                  00273 PRIKAZ_08h_PAR1_OK
                      00274 
09FB   087D           00275         movfw 0x07D
09FC   00E0           00276         movwf ZAZNAM1
09FD   087E           00277         movfw 0x07E
09FE   00E1           00278         movwf ZAZNAM2
                      00279 
09FF   23B6           00280         call SKOC_NA_ZAZNAM
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 75


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0A00   1C3B           00281         btfss POZICE,0
0A01   2A05           00282         goto PRIKAZ_08h_PAR2_OK
                      00283 
0A02                  00284 PRIKAZ_08h_PAR2_NOT_OK
0A02   3080           00285         movlw h'80'                                     ; jako prvni byte odpovedi dame 80h (Zadany zazn
                            am mimo rozsah)
0A03   00B6           00286         movwf TEMP1
0A04   2A07           00287         goto PRIKAZ_08h_KONEC
0A05                  00288 PRIKAZ_08h_PAR2_OK
                      00289 
0A05   24B1           00290         call FILE_SIZE
0A06   01B6           00291         clrf TEMP1
                      00292 
0A07                  00293 PRIKAZ_08h_KONEC
                      00294         ; At uz bylo v zaznamu cokoli, odesleme 4 byty z BUFFERU 2
0A07   0836           00295         movfw TEMP1
                      00296         PROG_PAGE_0
0A08   118A               M                         bcf PCLATH,3
0A09   120A               M                         bcf PCLATH,4
0A0A   21D0           00297         call WR_USART
0A0B   3004           00298         movlw .4
0A0C   00B6           00299         movwf TEMP1
0A0D   21FB           00300         call ODESLI_BUFFER2                     ; odesleme si zaznam o souboru  
                      00301         PROG_PAGE_1
0A0E   158A               M                         bsf PCLATH,3
0A0F   120A               M                         bcf PCLATH,4
                      00302 
0A10   01F3           00303         clrf PRIJATYCH_DAT                      ; vyprazdnime zasobnik prikazu
0A11   0008           00304         return
                      00305 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
0A12                  00306 PRIKAZ_09h                                              ; 09h – hledej zaznam
0A12   0878           00307         movfw 0x078                                     ; prvni byte zasobniku prikazu
0A13   3C09           00308         sublw h'09'
0A14   1D03           00309         btfss STATUS,Z
0A15   0008           00310         return                                          ; nebyl prijat prikaz 09h
0A16   1475           00311         bsf STAV_PRIKAZU,0                      ; mame tu prikaz 09h, nastavime byt STAV_PRIKAZU
0A17   0873           00312         movfw PRIJATYCH_DAT
0A18   3C07           00313         sublw .7                                        ; pro prikaz 09h musi prijit 8 bytu (prikaz + 7b
                            ytu parametr)
0A19   1803           00314         btfsc STATUS,C
0A1A   0008           00315         return                                          ; jeste nemame vsechny parametry
                      00316         ; Prisel prikaz 09h s 5bytovym parametrem 
                      00317 
0A1B   0879           00318         movfw 0x079                                     ; nejnizsi cast clusteru adresare
0A1C   00BC           00319         movwf CLUSTER1
0A1D   087A           00320         movfw 0x07A
0A1E   00BD           00321         movwf CLUSTER2
0A1F   087B           00322         movfw 0x07B
0A20   00BE           00323         movwf CLUSTER3
0A21   087C           00324         movfw 0x07C
0A22   00BF           00325         movwf CLUSTER4
0A23   237C           00326         call PRVNI_CL_ADRESARE
                      00327 
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 76


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0A24   183B           00328         btfsc POZICE,0
0A25   2A36           00329         goto PRIKAZ_09h_SPATNY_PAR
                      00330 
0A26   0879           00331         movfw 0x079                                     ; nejnizsi cast clusteru adresare
0A27   00DA           00332         movwf HL_ADR_CL1
0A28   087A           00333         movfw 0x07A
0A29   00DB           00334         movwf HL_ADR_CL2
0A2A   087B           00335         movfw 0x07B
0A2B   00DC           00336         movwf HL_ADR_CL3
0A2C   087C           00337         movfw 0x07C
0A2D   00DD           00338         movwf HL_ADR_CL4
                      00339 
0A2E   087D           00340         movfw 0x07D
0A2F   00E0           00341         movwf ZAZNAM1
0A30   087E           00342         movfw 0x07E
0A31   00E1           00343         movwf ZAZNAM2
                      00344 
0A32   087F           00345         movfw 0x07F
0A33   00D9           00346         movwf HL_PARAMETRY
                      00347 
0A34   24CE           00348         call HLEDEJ             ; mocna procedura, ktera man podle zadanych parametru vyhleda pozadovany
                             zaznam 
                      00349                                         ; a umisti jej do bufferu2 na offset 32 (od zacatku bufferu)
0A35   2A3C           00350         goto PRIKAZ_09h_KONEC
0A36                  00351 PRIKAZ_09h_SPATNY_PAR
                      00352         BANK_2
0A36   1703               M                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
0A37   1283               M                 bcf     STATUS,RP0    
0A38   3081           00353         movlw h'81'
0A39   00B0           00354         movwf 0x130
                      00355         BANK_0
0A3A   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0A3B   1283               M                 bcf     STATUS,RP0    
0A3C                  00356 PRIKAZ_09h_KONEC
0A3C   3012           00357         movlw .18
0A3D   00B6           00358         movwf TEMP1     
                      00359 
                      00360         PROG_PAGE_0
0A3E   118A               M                         bcf PCLATH,3
0A3F   120A               M                         bcf PCLATH,4
0A40   21F1           00361         call ODESLI_BUFF2_HIGH
                      00362         PROG_PAGE_1
0A41   158A               M                         bsf PCLATH,3
0A42   120A               M                         bcf PCLATH,4
                      00363 
0A43   01F3           00364         clrf PRIJATYCH_DAT                      ; vyprazdnime zasobnik prikazu
0A44   0008           00365         return
                      00366 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
0A45                  00367 PRIKAZ_0Ah                                              ; 0Ah – precti dlouhe jmeno
0A45   0878           00368         movfw 0x078                                     ; prvni byte zasobniku prikazu
0A46   3C0A           00369         sublw h'0A'
0A47   1D03           00370         btfss STATUS,Z
0A48   0008           00371         return                                          ; nebyl prijat prikaz 0Ah
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 77


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0A49   1475           00372         bsf STAV_PRIKAZU,0                      ; mame tu prikaz 0Ah, nastavime byt STAV_PRIKAZU
0A4A   0873           00373         movfw PRIJATYCH_DAT
0A4B   3C06           00374         sublw .6                                        ; pro prikaz 0Ah musi prijit 7 bytu (prikaz + 6b
                            ytu parametr)
0A4C   1803           00375         btfsc STATUS,C
0A4D   0008           00376         return                                          ; jeste nemame vsechny parametry
                      00377         ; Prisel prikaz 0Ah s 6bytovym parametrem 
                      00378 
0A4E   0879           00379         movfw 0x079                                     ; nejnizsi cast clusteru adresare
0A4F   00DA           00380         movwf HL_ADR_CL1
0A50   00BC           00381         movwf CLUSTER1
0A51   087A           00382         movfw 0x07A
0A52   00DB           00383         movwf HL_ADR_CL2
0A53   00BD           00384         movwf CLUSTER2
0A54   087B           00385         movfw 0x07B
0A55   00DC           00386         movwf HL_ADR_CL3
0A56   00BE           00387         movwf CLUSTER3
0A57   087C           00388         movfw 0x07C
0A58   00DD           00389         movwf HL_ADR_CL4
0A59   00BF           00390         movwf CLUSTER4
0A5A   237C           00391         call PRVNI_CL_ADRESARE
                      00392 
0A5B   1C3B           00393         btfss POZICE,0
0A5C   2A63           00394         goto PRIKAZ_0Ah_PAR1_OK
                      00395 
0A5D                  00396 PRIKAZ_0Ah_PAR1_NOT_OK
                      00397         INDF_BANK_2
0A5D   1783               M                         bsf STATUS,IRP    
0A5E   3010           00398         movlw 0x10                                      ; 1. byte bufferu 2
0A5F   0084           00399         movwf FSR
0A60   3081           00400         movlw h'81'                                     ; jako prvni byte odpovedi dame 81h (Zadany clus
                            ter neobsahuje adresar)
0A61   00BB           00401         movwf POZICE
0A62   2A68           00402         goto PRIKAZ_0Ah_KONEC
0A63                  00403 PRIKAZ_0Ah_PAR1_OK
0A63   087D           00404         movfw 0x07D
0A64   00E0           00405         movwf ZAZNAM1
0A65   087E           00406         movfw 0x07E
0A66   00E1           00407         movwf ZAZNAM2
                      00408 
0A67   26A5           00409         call LONG_NAME
0A68                  00410 PRIKAZ_0Ah_KONEC
                      00411         PROG_PAGE_0
0A68   118A               M                         bcf PCLATH,3
0A69   120A               M                         bcf PCLATH,4
0A6A   083B           00412         movfw POZICE
0A6B   21D0           00413         call WR_USART   
                      00414         ; At uz bylo v zaznamu cokoli, odesleme 65 bytu z BUFFERU 2
0A6C   3041           00415         movlw .65
0A6D   00B6           00416         movwf TEMP1
0A6E   21FB           00417         call ODESLI_BUFFER2                     ; odesleme si zaznam o souboru  
                      00418         PROG_PAGE_1
0A6F   158A               M                         bsf PCLATH,3
0A70   120A               M                         bcf PCLATH,4
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 78


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00419 
0A71   01F3           00420         clrf PRIJATYCH_DAT                      ; vyprazdnime zasobnik prikazu
0A72   0008           00421         return
                      00422 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
0A73                  00423 PRIKAZ_80h                                              ; 80h – hraj mp3 soubor
0A73   0878           00424         movfw 0x078                                     ; prvni byte zasobniku prikazu
0A74   3C80           00425         sublw h'80'
0A75   1D03           00426         btfss STATUS,Z
0A76   0008           00427         return                                          ; nebyl prijat prikaz 80h
0A77   1475           00428         bsf STAV_PRIKAZU,0                      ; mame tu prikaz 80h, nastavime byt STAV_PRIKAZU
0A78   0873           00429         movfw PRIJATYCH_DAT
0A79   3C06           00430         sublw .6                                        ; pro prikaz 80h musi prijit 7 bytu (prikaz + 6b
                            ytu parametr)
0A7A   1803           00431         btfsc STATUS,C
0A7B   0008           00432         return                                          ; jeste nemame vsechny parametry
                      00433         ; Prisel prikaz 80h s 6bytovym parametrem 
                      00434 
0A7C   0879           00435         movfw 0x079                                     ; nejnizsi cast clusteru adresare
0A7D   00BC           00436         movwf CLUSTER1
0A7E   087A           00437         movfw 0x07A
0A7F   00BD           00438         movwf CLUSTER2
0A80   087B           00439         movfw 0x07B
0A81   00BE           00440         movwf CLUSTER3
0A82   087C           00441         movfw 0x07C
0A83   00BF           00442         movwf CLUSTER4
0A84   237C           00443         call PRVNI_CL_ADRESARE
                      00444 
0A85   1C3B           00445         btfss POZICE,0
0A86   2A8D           00446         goto PRIKAZ_80h_PAR1_OK
                      00447 
0A87                  00448 PRIKAZ_80h_PAR1_NOT_OK
                      00449         INDF_BANK_2
0A87   1783               M                         bsf STATUS,IRP    
0A88   3010           00450         movlw 0x10                                      ; 1. byte bufferu 2
0A89   0084           00451         movwf FSR
0A8A   3081           00452         movlw h'81'                                     ; jako prvni byte odpovedi dame 81h (Zadany clus
                            ter neobsahuje adresar)
0A8B   0080           00453         movwf INDF
0A8C   2AD4           00454         goto PRIKAZ_80h_KONEC
0A8D                  00455 PRIKAZ_80h_PAR1_OK
                      00456 
0A8D   087D           00457         movfw 0x07D
0A8E   00E0           00458         movwf ZAZNAM1
0A8F   087E           00459         movfw 0x07E
0A90   00E1           00460         movwf ZAZNAM2
                      00461 
0A91   23B6           00462         call SKOC_NA_ZAZNAM
0A92   1C3B           00463         btfss POZICE,0
0A93   2A9A           00464         goto PRIKAZ_80h_PAR2_OK
                      00465 
0A94                  00466 PRIKAZ_80h_PAR2_NOT_OK
                      00467         INDF_BANK_2
0A94   1783               M                         bsf STATUS,IRP    
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 79


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0A95   3010           00468         movlw 0x10                                      ; 1. byte bufferu 2
0A96   0084           00469         movwf FSR
0A97   3080           00470         movlw h'80'                                     ; jako prvni byte odpovedi dame 80h (Zadany zazn
                            am mimo rozsah)
0A98   0080           00471         movwf INDF
0A99   2AD4           00472         goto PRIKAZ_80h_KONEC
0A9A                  00473 PRIKAZ_80h_PAR2_OK
                      00474 
0A9A   2436           00475         call FILE_INFO
                      00476 
                      00477         INDF_BANK_2
0A9B   1783               M                         bsf STATUS,IRP    
0A9C   3010           00478         movlw 0x10                                      ; 1. byte bufferu 2
0A9D   0084           00479         movwf FSR
0A9E   0800           00480         movfw INDF
0A9F   3C06           00481         sublw h'06'                                     ; pokud na zadanem miste se nachazi soubor s pri
                            ponou mp3...
0AA0   1D03           00482         btfss STATUS,Z
0AA1   2AD4           00483         goto PRIKAZ_80h_KONEC
                      00484                         
                      00485         ; ...nastavime jej jako prehravany soubor.
0AA2   301C           00486         movlw 0x1C                                      ; 13. byte bufferu 2
0AA3   0084           00487         movwf FSR
0AA4   0800           00488         movfw INDF
0AA5   00E9           00489         movwf PREH_DATA_CL1
0AA6   00BC           00490         movwf CLUSTER1
0AA7   0A84           00491         incf FSR,f
0AA8   0800           00492         movfw INDF
0AA9   00EA           00493         movwf PREH_DATA_CL2
0AAA   00BD           00494         movwf CLUSTER2
0AAB   0A84           00495         incf FSR,f
0AAC   0800           00496         movfw INDF
0AAD   00EB           00497         movwf PREH_DATA_CL3
0AAE   00BE           00498         movwf CLUSTER3
0AAF   0A84           00499         incf FSR,f
0AB0   0800           00500         movfw INDF
0AB1   00EC           00501         movwf PREH_DATA_CL4
0AB2   00BF           00502         movwf CLUSTER4
                      00503 
                      00504         PROG_PAGE_0
0AB3   118A               M                         bcf PCLATH,3
0AB4   120A               M                         bcf PCLATH,4
0AB5   24A7           00505         call ZJISTI_FRAGMENT
                      00506         PROG_PAGE_1
0AB6   158A               M                         bsf PCLATH,3
0AB7   120A               M                         bcf PCLATH,4
                      00507 ; v CLUSTER[1-4] prijme cislo clusteru a do FRAGMENT[1-2] umisti kolik clusteru 
                      00508 ; po tomto clusteru nasledujich (vcetne) tvori jeden fragment
                      00509 
                      00510 ; Pokud soucasny cluster je prazdny (coz by se stat nemelo) vrati v POZICE FFh
                      00511 ; Jinak, pokud s vse povede, dame do POZICE 0
                      00512 
                      00513 ; ! PODPROGRAM NENI POUZITELNY PRO CLUSTER 0 (prvni cluster ROOT adresare)
                      00514 ; ! PODPROGRAM NETESTUJE ZDA NEBYLO ZADANO VETSI CISLO NEZ JE POCET CLUSTERU !!!
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 80


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0AB8   0851           00515         movfw FRAGMENT1
0AB9   00D3           00516         movwf PREH_D_FRAGMENT1
0ABA   0852           00517         movfw FRAGMENT2
0ABB   00D4           00518         movwf PREH_D_FRAGMENT2
                      00519         
0ABC   087D           00520         movfw 0x07D
0ABD   00E6           00521         movwf PREH_ZAZNAM1
0ABE   087E           00522         movfw 0x07E
0ABF   00E7           00523         movwf PREH_ZAZNAM2
                      00524 
0AC0   0879           00525         movfw 0x079                                     ; nejnizsi cast clusteru adresare
0AC1   00E2           00526         movwf PREH_ADR_CL1
0AC2   087A           00527         movfw 0x07A
0AC3   00E3           00528         movwf PREH_ADR_CL2
0AC4   087B           00529         movfw 0x07B
0AC5   00E4           00530         movwf PREH_ADR_CL3
0AC6   087C           00531         movfw 0x07C
0AC7   00E5           00532         movwf PREH_ADR_CL4
                      00533         ; aktualni prehravany soubor i prehravana slozka byly nastaveny...
                      00534 
0AC8   01ED           00535         clrf PREH_DATA_POZICE
0AC9   146E           00536         bsf PREH_STAV0,0
0ACA   14EE           00537         bsf PREH_STAV0,1                        ; nastavime si vlastosti prehravani: (PREH_STAV[0-1])
                      00538 
0ACB   10CD           00539         bcf VSREG_MODE_L,1                      ; prehravame normalni rychlosti 
0ACC   106F           00540         bcf PREH_STAV1,0                        ; prehravame normalni rychlosti 
                      00541         
0ACD   2094           00542         call VS_SOFT_RESET
                      00543 
0ACE   3000           00544         movlw VSADDR_MODE
0ACF   00B6           00545         movwf TEMP1
0AD0   084D           00546         movfw VSREG_MODE_L
0AD1   00B7           00547         movwf TEMP2
0AD2   01B8           00548         clrf TEMP3
0AD3   2063           00549         call VS_WR_REG
                      00550 
0AD4                  00551 PRIKAZ_80h_KONEC
                      00552         ; At uz bylo v zaznamu cokoli, odesleme 1 byt z BUFFERU 2
                      00553         INDF_BANK_2
0AD4   1783               M                         bsf STATUS,IRP    
0AD5   3010           00554         movlw 0x10                                      ; 1. byte bufferu 2
0AD6   0084           00555         movwf FSR
0AD7   0800           00556         movfw INDF
                      00557         PROG_PAGE_0
0AD8   118A               M                         bcf PCLATH,3
0AD9   120A               M                         bcf PCLATH,4
0ADA   21D0           00558         call WR_USART   
                      00559         PROG_PAGE_1
0ADB   158A               M                         bsf PCLATH,3
0ADC   120A               M                         bcf PCLATH,4
                      00560         
0ADD   01F3           00561         clrf PRIJATYCH_DAT                      ; vyprazdnime zasobnik prikazu
0ADE   0008           00562         return
                      00563 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 81


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            XXXXXXXXXXXXXXXXXXXXX
0ADF                  00564 PRIKAZ_81h                                              ; 81h – vrat stav prehravaneho souboru
0ADF   0878           00565         movfw 0x078                                     ; prvni byte zasobniku prikazu
0AE0   3C81           00566         sublw h'81'
0AE1   1D03           00567         btfss STATUS,Z
0AE2   0008           00568         return                                          ; nebyl prijat prikaz 81h
0AE3   1475           00569         bsf STAV_PRIKAZU,0                      ; mame tu prikaz 81h, nastavime byt STAV_PRIKAZU
                      00570         ; pro prikaz 81h nejsou definovany zadne parametry, proto jiz nic jineho netestujeme
                      00571 
0AE4   086E           00572         movfw PREH_STAV0
                      00573         PROG_PAGE_0
0AE5   118A               M                         bcf PCLATH,3
0AE6   120A               M                         bcf PCLATH,4
0AE7   21D0           00574         call WR_USART
                      00575         PROG_PAGE_1
0AE8   158A               M                         bsf PCLATH,3
0AE9   120A               M                         bcf PCLATH,4
                      00576 
0AEA   086F           00577         movfw PREH_STAV1
                      00578         PROG_PAGE_0
0AEB   118A               M                         bcf PCLATH,3
0AEC   120A               M                         bcf PCLATH,4
0AED   21D0           00579         call WR_USART
                      00580         PROG_PAGE_1
0AEE   158A               M                         bsf PCLATH,3
0AEF   120A               M                         bcf PCLATH,4
                      00581 
0AF0   116E           00582         bcf PREH_STAV0,2                        ; 2. bit je nastaven, kdyz se zmeni prehravany soubor (b
                            ez volani prikazu) do doby, nez prijde prikaz na dotaz STAVU... (81h)
                      00583 
0AF1   3004           00584         movlw VSADDR_DECODE_TIME
0AF2   00B6           00585         movwf TEMP1
0AF3   2071           00586         call VS_RD_REG                          ; zjistime si aktualni pozici v souboru v sekundach
0AF4   0837           00587         movfw TEMP2
                      00588         PROG_PAGE_0
0AF5   118A               M                         bcf PCLATH,3
0AF6   120A               M                         bcf PCLATH,4
0AF7   21D0           00589         call WR_USART
0AF8   0838           00590         movfw TEMP3
0AF9   21D0           00591         call WR_USART
                      00592         PROG_PAGE_1
0AFA   158A               M                         bsf PCLATH,3
0AFB   120A               M                         bcf PCLATH,4
                      00593 
                      00594 ;       movlw VSADDR_STATUS
                      00595 ;       movwf TEMP1
                      00596 ;       call VS_RD_REG
                      00597 ;       movfw TEMP2
                      00598 ;       PROG_PAGE_0
                      00599 ;       call WR_USART
                      00600 ;       PROG_PAGE_1
                      00601 
0AFC   01F3           00602         clrf PRIJATYCH_DAT                      ; vyprazdnime zasobnik
0AFD   0008           00603         return
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 82


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00604 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
0AFE                  00605 PRIKAZ_82h                                              ; 82h – nastav hlasitost
0AFE   0878           00606         movfw 0x078                                     ; prvni byte zasobniku prikazu
0AFF   3C82           00607         sublw h'82'
0B00   1D03           00608         btfss STATUS,Z
0B01   0008           00609         return                                          ; nebyl prijat prikaz 82h
0B02   1475           00610         bsf STAV_PRIKAZU,0                      ; mame tu prikaz 82h, nastavime byt STAV_PRIKAZU
0B03   0873           00611         movfw PRIJATYCH_DAT
0B04   3C02           00612         sublw .2                                        ; pro prikaz 82h museji prijit 3 byty (prikaz + 
                            2byty parametr)
0B05   1803           00613         btfsc STATUS,C
0B06   0008           00614         return                                          ; jeste nemame vsechny parametry
                      00615         ; Prisel prikaz 82h s 2bytovym parametrem 
                      00616 
0B07   0879           00617         movfw 0x079                                     ; hlasitost pro levy kanal
0B08   00D0           00618         movwf VSREG_VOL_H
0B09   087A           00619         movfw 0x07A                                     ; hlasitost pro pravy kanal
0B0A   00CF           00620         movwf VSREG_VOL_L
0B0B   20D6           00621         call VS_SET_VOLUME                      ; nastavime hlasitost   
                      00622 
0B0C   30FF           00623         movlw h'FF'
                      00624         PROG_PAGE_0
0B0D   118A               M                         bcf PCLATH,3
0B0E   120A               M                         bcf PCLATH,4
0B0F   21D0           00625         call WR_USART
                      00626         PROG_PAGE_1
0B10   158A               M                         bsf PCLATH,3
0B11   120A               M                         bcf PCLATH,4
0B12   01F3           00627         clrf PRIJATYCH_DAT                      ; vyprazdnime zasobnik
0B13   0008           00628         return
                      00629 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
0B14                  00630 PRIKAZ_83h                                              ; 83h – vrat informace o prehravanem souboru
0B14   0878           00631         movfw 0x078                                     ; prvni byte zasobniku prikazu
0B15   3C83           00632         sublw h'83'
0B16   1D03           00633         btfss STATUS,Z
0B17   0008           00634         return                                          ; nebyl prijat prikaz 83h
0B18   1475           00635         bsf STAV_PRIKAZU,0                      ; mame tu prikaz 83h, nastavime byt STAV_PRIKAZU
                      00636         ; pro prikaz 83h nejsou definovane zadne parametry, proto jiz nic jineho netestujeme
                      00637 
0B19   3005           00638         movlw VSADDR_AUDATA
0B1A   00B6           00639         movwf TEMP1
0B1B   2071           00640         call VS_RD_REG
0B1C   0837           00641         movfw TEMP2
                      00642         PROG_PAGE_0
0B1D   118A               M                         bcf PCLATH,3
0B1E   120A               M                         bcf PCLATH,4
0B1F   21D0           00643         call WR_USART
0B20   0838           00644         movfw TEMP3
0B21   21D0           00645         call WR_USART   
                      00646         PROG_PAGE_1
0B22   158A               M                         bsf PCLATH,3
0B23   120A               M                         bcf PCLATH,4
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 83


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00647         ; odeslali jsme AUDATA
                      00648 
0B24   3008           00649         movlw VSADDR_HDAT0
0B25   00B6           00650         movwf TEMP1
0B26   2071           00651         call VS_RD_REG
0B27   0837           00652         movfw TEMP2
                      00653         PROG_PAGE_0
0B28   118A               M                         bcf PCLATH,3
0B29   120A               M                         bcf PCLATH,4
0B2A   21D0           00654         call WR_USART
0B2B   0838           00655         movfw TEMP3
0B2C   21D0           00656         call WR_USART   
                      00657         PROG_PAGE_1
0B2D   158A               M                         bsf PCLATH,3
0B2E   120A               M                         bcf PCLATH,4
                      00658         ; odeslali jsme HDAT0
                      00659 
0B2F   3009           00660         movlw VSADDR_HDAT1
0B30   00B6           00661         movwf TEMP1
0B31   2071           00662         call VS_RD_REG
0B32   0837           00663         movfw TEMP2
                      00664         PROG_PAGE_0
0B33   118A               M                         bcf PCLATH,3
0B34   120A               M                         bcf PCLATH,4
0B35   21D0           00665         call WR_USART
0B36   0838           00666         movfw TEMP3
0B37   21D0           00667         call WR_USART   
                      00668         ; odeslali jsme HDAT1
                      00669 
0B38   0862           00670         movfw PREH_ADR_CL1
0B39   21D0           00671         call WR_USART
0B3A   0863           00672         movfw PREH_ADR_CL2
0B3B   21D0           00673         call WR_USART
0B3C   0864           00674         movfw PREH_ADR_CL3
0B3D   21D0           00675         call WR_USART
0B3E   0865           00676         movfw PREH_ADR_CL4
0B3F   21D0           00677         call WR_USART
                      00678 
0B40   0866           00679         movfw PREH_ZAZNAM1
0B41   21D0           00680         call WR_USART
0B42   0867           00681         movfw PREH_ZAZNAM2
0B43   21D0           00682         call WR_USART
                      00683         PROG_PAGE_1
0B44   158A               M                         bsf PCLATH,3
0B45   120A               M                         bcf PCLATH,4
                      00684 
0B46   01F3           00685         clrf PRIJATYCH_DAT                      ; vyprazdnime zasobnik
0B47   0008           00686         return
                      00687 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
0B48                  00688 PRIKAZ_84h                                              ; 84h – nastav stav prehravani
0B48   0878           00689         movfw 0x078                                     ; prvni byte zasobniku prikazu
0B49   3C84           00690         sublw h'84'
0B4A   1D03           00691         btfss STATUS,Z
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 84


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0B4B   0008           00692         return                                          ; nebyl prijat prikaz 84h
0B4C   1475           00693         bsf STAV_PRIKAZU,0                      ; mame tu prikaz 84h, nastavime byt STAV_PRIKAZU
0B4D   0873           00694         movfw PRIJATYCH_DAT
0B4E   3C02           00695         sublw .2                                        ; pro prikaz 8h museji prijit 3 byty (prikaz + 2
                            byty parametr)
0B4F   1803           00696         btfsc STATUS,C
0B50   0008           00697         return                                          ; jeste nemame vsechny parametry
                      00698         ; Prisel prikaz 84h s 2bytovym parametrem 
                      00699 
0B51   086E           00700         movfw PREH_STAV0
0B52   3906           00701         andlw b'00000110'
0B53   00EE           00702         movwf PREH_STAV0
0B54   0879           00703         movfw 0x079                                     ; parametr 1
0B55   39F9           00704         andlw b'11111001'                       ; nektere bity vymaskujeme (vsechny nelze ovladat prikaz
                            em)
0B56   046E           00705         iorwf PREH_STAV0,w      
0B57   00EE           00706         movwf PREH_STAV0
                      00707 
0B58   087A           00708         movfw 0x07A                                     ; parametr 2
0B59   00EF           00709         movwf PREH_STAV1
                      00710 
0B5A   10CD           00711         bcf VSREG_MODE_L,1                      ; prehravame normalni rychlosti (zda se mp3 prevyji je r
                            eseno v hlavni smycce podle stavu registru PREH_STAV1)
0B5B   13CD           00712         bcf VSREG_MODE_L,7                      ;bass/treble enhancer
0B5C   19EF           00713         btfsc PREH_STAV1,3                      ; 3. bit =      1 => zvyrazneni basu a vysek (moznost de
                            koderu vs1001 "bass/treble enhancer")
0B5D   17CD           00714         bsf VSREG_MODE_L,7                      ;bass/treble enhancer
                      00715         
0B5E   3000           00716         movlw VSADDR_MODE
0B5F   00B6           00717         movwf TEMP1
0B60   084D           00718         movfw VSREG_MODE_L
0B61   00B7           00719         movwf TEMP2
0B62   01B8           00720         clrf TEMP3
0B63   2063           00721         call VS_WR_REG
                      00722         
0B64   3001           00723         movlw VSADDR_STATUS
0B65   2071           00724         call VS_RD_REG
0B66   0837           00725         movfw TEMP2
0B67   00CE           00726         movwf VSREG_STATUS_L
                      00727 
0B68   114E           00728         bcf VSREG_STATUS_L,2            ; Bit 2 is analog powerdown bit.
0B69   1A6F           00729         btfsc PREH_STAV1,4                      ; 4. bit = 1 => MUTE
0B6A   154E           00730         bsf VSREG_STATUS_L,2            ; Bit 2 is analog powerdown bit.
                      00731         
0B6B   3001           00732         movlw VSADDR_STATUS
0B6C   00B6           00733         movwf TEMP1
0B6D   084E           00734         movfw VSREG_STATUS_L
0B6E   00B7           00735         movwf TEMP2
0B6F   01B8           00736         clrf TEMP3
0B70   2063           00737         call VS_WR_REG
                      00738 
0B71   1E6F           00739         btfss PREH_STAV1,4                      ; 4. bit = 1 => MUTE
0B72   20D6           00740         call VS_SET_VOLUME                      ; nastavime hlasitost
                      00741                                                                 ; nevim sice proc, ale kdyz prepisu VS r
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 85


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            eg. STATUS, zmeni se hlasitost
                      00742 
                      00743         PROG_PAGE_0
0B73   118A               M                         bcf PCLATH,3
0B74   120A               M                         bcf PCLATH,4
0B75   30FF           00744         movlw h'FF'
0B76   21D0           00745         call WR_USART
                      00746         PROG_PAGE_1
0B77   158A               M                         bsf PCLATH,3
0B78   120A               M                         bcf PCLATH,4
0B79   01E8           00747         clrf PREH_CITAC_PREV
0B7A   01F3           00748         clrf PRIJATYCH_DAT                      ; vyprazdnime zasobnik
0B7B   0008           00749         return
                      00750 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
                      00083         include "filesystem.asm"; podprogramy pro praci s adresari a setrideni obsahu adresaru
                      00001 ;**********************************************************
                      00002 ;**********************************************************
                      00003 ;**********************************************************
                      00004 ; podprogramy pro praci s adresari a setrideni obsahu adresaru
                      00005 ;**********************************************************
                      00006 ;**********************************************************
                      00007 ;**********************************************************
                      00008 
                      00009 ;**************************************************************************
0B7C                  00010 PRVNI_CL_ADRESARE
                      00011         ; V CLUSTER[1-4] prijme cislo clusteru. Zkontroluje, zda zadany sluster obsahuje zacatek adresar
                            e
                      00012         ; V POZICE vrati 00h, pokud cluster je prvni cluster nejakeho adresare, FFh, pokud neobsahuje ad
                            resar
0B7C   01BB           00013         clrf POZICE
                      00014 
0B7D   083C           00015         movfw CLUSTER1
0B7E   043D           00016         iorwf CLUSTER2,W
0B7F   043E           00017         iorwf CLUSTER3,W
0B80   043F           00018         iorwf CLUSTER4,W
0B81   1903           00019         btfsc STATUS,Z
0B82   0008           00020         return                          ; pokud CLUSTER[1-4]=0, tak se jedna o 1. cluster ROOT adr., pro
                            to nemusime dale resit co tam je...
                      00021         
                      00022         PROG_PAGE_0
0B83   118A               M                         bcf PCLATH,3
0B84   120A               M                         bcf PCLATH,4
0B85   23BC           00023         call CLUSTER_TO_LBA
0B86   3001           00024         movlw .1
0B87   00A6           00025         movwf SECTOR_C
0B88   2315           00026         call READ_SECTOR        ; precteme udajny prvni sektor z prvniho clusteru adresare      
                      00027         PROG_PAGE_1
0B89   158A               M                         bsf PCLATH,3
0B8A   120A               M                         bcf PCLATH,4
                      00028 
                      00029         ; Tady vychazime z toho, ze kazdy adresar krome ROOTu ma jako prvni zaznam ukazatel na sebe (jak
                            o jmeno je jedna tecka)
                      00030         ; Mohlo by se sice stat, ze bychom narazili na soubor, ktery zacina retezcem ".          " to by
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 86


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            ch ale neresil...
0B8B   30FF           00031         movlw h'FF'
0B8C   00BB           00032         movwf POZICE
                      00033 
                      00034         PROG_PAGE_0
0B8D   118A               M                         bcf PCLATH,3
0B8E   120A               M                         bcf PCLATH,4
0B8F   22B8           00035         call READ_DATA
                      00036         PROG_PAGE_1
0B90   158A               M                         bsf PCLATH,3
0B91   120A               M                         bcf PCLATH,4
0B92   0820           00037         movfw DATA_L
0B93   3C2E           00038         sublw '.'               ; 1. znak
0B94   1D03           00039         btfss STATUS,Z
0B95   2BB5           00040         goto PRVNI_CL_ADRESARE_KONEC
0B96   0821           00041         movfw DATA_H
0B97   3C20           00042         sublw h'20'             ; 2. znak
0B98   1D03           00043         btfss STATUS,Z
0B99   2BB5           00044         goto PRVNI_CL_ADRESARE_KONEC
                      00045 
0B9A   3004           00046         movlw .4                ; dalsich 8 znaku maji byt mezery
0B9B   00B6           00047         movwf TEMP1
                      00048         
0B9C                  00049 PRVNI_CL_ADRESARE_MEZERY
                      00050         PROG_PAGE_0
0B9C   118A               M                         bcf PCLATH,3
0B9D   120A               M                         bcf PCLATH,4
0B9E   22B8           00051         call READ_DATA
                      00052         PROG_PAGE_1
0B9F   158A               M                         bsf PCLATH,3
0BA0   120A               M                         bcf PCLATH,4
0BA1   0820           00053         movfw DATA_L
0BA2   3C20           00054         sublw h'20'
0BA3   1D03           00055         btfss STATUS,Z
0BA4   2BB5           00056         goto PRVNI_CL_ADRESARE_KONEC
0BA5   0821           00057         movfw DATA_H
0BA6   3C20           00058         sublw h'20'
0BA7   1D03           00059         btfss STATUS,Z
0BA8   2BB5           00060         goto PRVNI_CL_ADRESARE_KONEC
0BA9   0BB6           00061         decfsz TEMP1,f
0BAA   2B9C           00062         goto PRVNI_CL_ADRESARE_MEZERY
                      00063 
                      00064         PROG_PAGE_0
0BAB   118A               M                         bcf PCLATH,3
0BAC   120A               M                         bcf PCLATH,4
0BAD   22B8           00065         call READ_DATA
                      00066         PROG_PAGE_1
0BAE   158A               M                         bsf PCLATH,3
0BAF   120A               M                         bcf PCLATH,4
0BB0   0820           00067         movfw DATA_L
0BB1   3C20           00068         sublw h'20'
0BB2   1D03           00069         btfss STATUS,Z
0BB3   2BB5           00070         goto PRVNI_CL_ADRESARE_KONEC
                      00071 
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 87


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0BB4   01BB           00072         clrf POZICE     
0BB5                  00073 PRVNI_CL_ADRESARE_KONEC
0BB5   0008           00074         return
                      00075 ;**************************************************************************
0BB6                  00076 SKOC_NA_ZAZNAM
                      00077         ; !!!! pozor, tato procedura potrebuje min. 5 mist ve STACKu (vcetne sama sebe)
                      00078 
                      00079         ; V CLUSTER[1-4] prijme cislo clusteru na kterem se nachazi zacatek adresare
                      00080         ; V ZAZNAM[1-2] prijme cislo zaznamu 
                      00081         ; - pokud ZAZNAM[1-2] ukazuji mimo adresar, vrati v POZICE FFh (jinak 00h)
                      00082         ; - pokud byl zaznam nalezen,
                      00083         ;       da disku prikaz k jeho precteni a skoci az k zaznamu...
                      00084         ;       ...v bufferu disku budeme mit teda 32bytu dat ktere prezentuji jeden zaznam ve slozce
0BB6   0860           00085         movfw ZAZNAM1
                      00086         BANK_1
0BB7   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0BB8   1683               M                 bsf     STATUS,RP0    
0BB9   00A0           00087         movwf OPERAND_X1
                      00088         BANK_0
0BBA   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0BBB   1283               M                 bcf     STATUS,RP0    
0BBC   0861           00089         movfw ZAZNAM2
                      00090         BANK_1
0BBD   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0BBE   1683               M                 bsf     STATUS,RP0    
0BBF   00A1           00091         movwf OPERAND_X2
0BC0   01A2           00092         clrf OPERAND_X3
0BC1   01A3           00093         clrf OPERAND_X4
                      00094         BANK_0                                  ; OPERAND_X := ZAZNAM
0BC2   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0BC3   1283               M                 bcf     STATUS,RP0    
                      00095         
                      00096         PROG_PAGE_0
0BC4   118A               M                         bcf PCLATH,3
0BC5   120A               M                         bcf PCLATH,4
0BC6   263C           00097         call POSUNDOPRAVA_4             ; OPERAND_X := OPERAND_X div 16
                      00098         ; tady mame v PRETECENI kolikaty zaznam v sektoru chceme
                      00099         BANK_1
0BC7   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0BC8   1683               M                 bsf     STATUS,RP0    
0BC9   082C           00100         movfw PRETECENI
                      00101         BANK_0
0BCA   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0BCB   1283               M                 bcf     STATUS,RP0    
0BCC   00BA           00102         movwf TEMP5
                      00103         BANK_1
0BCD   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0BCE   1683               M                 bsf     STATUS,RP0    
0BCF   01AC           00104         clrf PRETECENI                          ; pokud CLUSTER_SIZE = 1 tak preteceni := 0 a X zustane 
                            stejne
                      00105         BANK_0
0BD0   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0BD1   1283               M                 bcf     STATUS,RP0    
                      00106 
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 88


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0BD2   18CC           00107         btfsc CLUSTER_SIZE,1            ; 2
0BD3   261E           00108         call POSUNDOPRAVA_1                     ; X := X div 2
0BD4   194C           00109         btfsc CLUSTER_SIZE,2            ; 4
0BD5   2627           00110         call POSUNDOPRAVA_2                     ; X := X div 4
0BD6   19CC           00111         btfsc CLUSTER_SIZE,3            ; 8
0BD7   2631           00112         call POSUNDOPRAVA_3                     ; X := X div 8
0BD8   1A4C           00113         btfsc CLUSTER_SIZE,4            ; 16
0BD9   263C           00114         call POSUNDOPRAVA_4                     ; X := X div 4
0BDA   1ACC           00115         btfsc CLUSTER_SIZE,5            ; 32
0BDB   2648           00116         call POSUNDOPRAVA_5                     ; X := X div 32
0BDC   1B4C           00117         btfsc CLUSTER_SIZE,6            ; 64
0BDD   2655           00118         call POSUNDOPRAVA_6                     ; X := X div 64
0BDE   1BCC           00119         btfsc CLUSTER_SIZE,7            ; 128
0BDF   2663           00120         call POSUNDOPRAVA_7                     ; X := X div 128
                      00121         ; tady mame v PRETECENI na kolikatem sektoru v clusteru je hledany zaznam
                      00122         BANK_1
0BE0   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0BE1   1683               M                 bsf     STATUS,RP0    
0BE2   082C           00123         movfw PRETECENI
                      00124         BANK_0
0BE3   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0BE4   1283               M                 bcf     STATUS,RP0    
0BE5   00B9           00125         movwf TEMP4
                      00126 
                      00127         ; OPERAND_X := (ZAZNAM div 16) div CLUSTER_SIZE
                      00128         ; ted v OPERAND_X mame hodnotu kolik clusteru mame od zacatku adresare preskocit...
0BE6                  00129 SKOC_NA_ZAZNAM_PRESKOC_CL
                      00130         PROG_PAGE_0
0BE6   118A               M                         bcf PCLATH,3
0BE7   120A               M                         bcf PCLATH,4
0BE8   2672           00131         call NULA
                      00132         PROG_PAGE_1
0BE9   158A               M                         bsf PCLATH,3
0BEA   120A               M                         bcf PCLATH,4
                      00133         BANK_1
0BEB   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0BEC   1683               M                 bsf     STATUS,RP0    
0BED   1C2C           00134         btfss PRETECENI,0
0BEE   2C14           00135         goto SKOC_NA_ZAZNAM_MAME_CL     
                      00136         BANK_0
0BEF   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0BF0   1283               M                 bcf     STATUS,RP0    
                      00137 
                      00138         INDF_BANK_1
0BF1   1383               M                         bcf STATUS,IRP    
0BF2   30A0           00139         movlw 0xA0
0BF3   0084           00140         movwf FSR
0BF4   0800           00141         movfw INDF
0BF5   00B7           00142         movwf TEMP2
0BF6   0A84           00143         incf FSR,F
0BF7   0800           00144         movfw INDF
0BF8   00B8           00145         movwf TEMP3
                      00146 
                      00147         PROG_PAGE_0
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 89


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0BF9   118A               M                         bcf PCLATH,3
0BFA   120A               M                         bcf PCLATH,4
0BFB   241F           00148         call NEXT_CLUSTER
                      00149         PROG_PAGE_1
0BFC   158A               M                         bsf PCLATH,3
0BFD   120A               M                         bcf PCLATH,4
0BFE   183B           00150         btfsc POZICE,0          ; pokud s vse povedlo, mame v POZICE 0
0BFF   2C33           00151         goto SKOC_NA_ZAZNAM_MIMO_ROZSAH
                      00152 
                      00153         INDF_BANK_1
0C00   1383               M                         bcf STATUS,IRP    
0C01   30A0           00154         movlw 0xA0
0C02   0084           00155         movwf FSR
0C03   0837           00156         movfw TEMP2
0C04   0080           00157         movwf INDF
0C05   0A84           00158         incf FSR,F
0C06   0838           00159         movfw TEMP3
0C07   0080           00160         movwf INDF
                      00161         BANK_1
0C08   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
0C09   1683               M                 bsf     STATUS,RP0    
0C0A   01A2           00162         clrf OPERAND_X3
0C0B   01A3           00163         clrf OPERAND_X4
                      00164         BANK_0  
0C0C   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0C0D   1283               M                 bcf     STATUS,RP0    
                      00165 
                      00166         PROG_PAGE_0
0C0E   118A               M                         bcf PCLATH,3
0C0F   120A               M                         bcf PCLATH,4
0C10   25B5           00167         call DEKREMENTUJ        ; X := X - 1
                      00168         PROG_PAGE_1
0C11   158A               M                         bsf PCLATH,3
0C12   120A               M                         bcf PCLATH,4
                      00169 
0C13   2BE6           00170         goto SKOC_NA_ZAZNAM_PRESKOC_CL
                      00171 
0C14                  00172 SKOC_NA_ZAZNAM_MAME_CL
                      00173         BANK_0
0C14   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0C15   1283               M                 bcf     STATUS,RP0    
                      00174 
0C16   0839           00175         movfw TEMP4                                     ; v kolikatem sektoru v clusteru je hledany zazn
                            am
0C17   00BB           00176         movwf POZICE 
                      00177         PROG_PAGE_0
0C18   118A               M                         bcf PCLATH,3
0C19   120A               M                         bcf PCLATH,4
0C1A   23BC           00178         call CLUSTER_TO_LBA                     ; zjistime si skutecnou polohu zaznamu na disku
0C1B   3001           00179         movlw .1
0C1C   00A6           00180         movwf SECTOR_C
0C1D   2315           00181         call READ_SECTOR                        ; dame prikaz precist sektor
                      00182         PROG_PAGE_1
0C1E   158A               M                         bsf PCLATH,3
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 90


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0C1F   120A               M                         bcf PCLATH,4
                      00183 
0C20   3010           00184         movlw .16
0C21   00DE           00185         movwf ZAZNAMU_vBUFFERU_DISKU
0C22   083A           00186         movfw TEMP5
0C23   02DE           00187         subwf ZAZNAMU_vBUFFERU_DISKU,f          ; ZAZNAMU_vBUFFERU_DISKU := 16 - TEMP5
                      00188 
0C24   083A           00189         movfw TEMP5                                     ; kolikaty zaznam v casti adersare (sektoru) mam
                            e precist [0..15]
0C25   390F           00190         andlw b'00001111'
0C26   00B6           00191         movwf TEMP1                                     ; rozsah by mel byt spravne, pro jistotu jej ale
                             orizneme [0..15]
0C27   39FF           00192         andlw h'FF'
0C28   1903           00193         btfsc STATUS,Z                          ; pokud chceme prvni zaznam ze sektoru...
0C29   2C30           00194         goto SKOC_NA_ZAZNAM_MAME_ZAZNAM         ; ...koncime
                      00195 
0C2A   0EB6           00196         swapf TEMP1,F                           ; protoze kazdy zaznam o souboru ma 32B=16slov, tak musi
                            me TEMP1 vynasobit 16...
                      00197         PROG_PAGE_0
0C2B   118A               M                         bcf PCLATH,3
0C2C   120A               M                         bcf PCLATH,4
0C2D   22D8           00198         call PRESKOC                            ; a tolik slov preskocit (tolik slov je pro nas nepotreb
                            nych)
                      00199         PROG_PAGE_1
0C2E   158A               M                         bsf PCLATH,3
0C2F   120A               M                         bcf PCLATH,4
                      00200 
0C30                  00201 SKOC_NA_ZAZNAM_MAME_ZAZNAM
0C30   3000           00202         movlw h'00'
0C31   00BB           00203         movwf POZICE 
0C32   2C35           00204         goto SKOC_NA_ZAZNAM_KONEC
0C33                  00205 SKOC_NA_ZAZNAM_MIMO_ROZSAH
0C33   30FF           00206         movlw h'FF'
0C34   00BB           00207         movwf POZICE 
0C35                  00208 SKOC_NA_ZAZNAM_KONEC
0C35   0008           00209         return
                      00210 ;**************************************************************************
0C36                  00211 FILE_INFO
                      00212         ; z disku nam ted ma prijit 32bytu dat, ktere reprezentuji jeden zaznam ve slozce
                      00213         ; tato procedura zaznam precte, analyzuje, a do bufferu 2 da nasledujici informace:
                      00214         ;               1.     byte ->  = 00h -> zaznam je prazdny; 
                      00215         ;                                               = 01h -> zaznam je adresar; 
                      00216         ;                                               = 02h -> zaznam je soubor; 
                      00217         ;                                               = 06h -> zaznam je soubor s priponou MP3
                      00218         ;               2..9   byte -> 8 znaku dlouhe jmeno ("DOSovsky" tvar - napr. slouzka "dokumenty"
                             = "DOKUME~1" )
                      00219         ;               10..12 byte -> u souboru tri znaky pripony (u adresaru vetsinou mezery - 20h 20h
                             20h)
                      00220         ;               13..16 byte -> 1. cluster souboru
                      00221         ; Pokud se jedna o adresar, a zaznam o pripone se nerovna 0x202020 (tri mezery), tak skutecne jm
                            eno adresare je : ADRESAR.PRI
                      00222         INDF_BANK_2
0C36   1783               M                         bsf STATUS,IRP    
0C37   3010           00223         movlw 0x10                                      ; 1. byte bufferu 2
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 91


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0C38   0084           00224         movwf FSR
0C39   3000           00225         movlw .0                                        ; zatim nevime co zaznam obsahuje, tak ho oznaci
                            me jako prazdny
0C3A   0080           00226         movwf INDF
0C3B   0A84           00227         incf FSR,F      
                      00228 
0C3C   3005           00229         movlw .5                                        ; 5 slov = 10 bytu -> 8 znaku jmena souboru/sloz
                            ky + 2 znaky pripony
0C3D   00B6           00230         movwf TEMP1
0C3E                  00231 FILE_INFO__READ_NAME
                      00232         PROG_PAGE_0
0C3E   118A               M                         bcf PCLATH,3
0C3F   120A               M                         bcf PCLATH,4
0C40   22B8           00233         call READ_DATA                          ; 2 znaky jmena souboru/slozky, nebo pripony souboru
                      00234         PROG_PAGE_1
0C41   158A               M                         bsf PCLATH,3
0C42   120A               M                         bcf PCLATH,4
0C43   0820           00235         movfw DATA_L
0C44   0080           00236         movwf INDF
0C45   0A84           00237         incf FSR,F
0C46   0821           00238         movfw DATA_H
0C47   0080           00239         movwf INDF
0C48   0A84           00240         incf FSR,F
0C49   03B6           00241         decf TEMP1,F
0C4A   1D03           00242         btfss STATUS,Z
0C4B   2C3E           00243         goto FILE_INFO__READ_NAME       
                      00244 
                      00245         PROG_PAGE_0
0C4C   118A               M                         bcf PCLATH,3
0C4D   120A               M                         bcf PCLATH,4
0C4E   22B8           00246         call READ_DATA                          ; posledni znak pripony a byt s atributy souboru
                      00247         PROG_PAGE_1
0C4F   158A               M                         bsf PCLATH,3
0C50   120A               M                         bcf PCLATH,4
0C51   0820           00248         movfw DATA_L
0C52   0080           00249         movwf INDF
                      00250 
0C53   3011           00251         movlw 0x11                                      ; 2. byte bufferu 2 -> 1. znak jmena souboru
0C54   0084           00252         movwf FSR
0C55   0800           00253         movfw INDF                                      ; ted ve W mame 1. znak jmena souboru/slozky
0C56   39FF           00254         andlw h'FF'
0C57   1903           00255         btfsc STATUS,Z
0C58   2CA9           00256         goto FILE_INFO__CTI20_KONEC             ; pokud 1. znak jmena souboru = 00h, je zaznam prazdny
0C59   3CE5           00257         sublw h'E5'
0C5A   1903           00258         btfsc STATUS,Z
0C5B   2CA9           00259         goto FILE_INFO__CTI20_KONEC             ; pokud 1. znak jmena souboru = E5h, je zaznam prazdny
                      00260         
                      00261         ; pokud jsme tady, tak zaznam obsahuje soubor, adresar, dlouhe jmeno souboru, nebo jmenovku disk
                            u 
                      00262         ; (jsou dva zpusoby jak zapsat jmenovku svazku, bud do spousteciho zaznamu, nebo jako polozku RO
                            OT adresare)
0C5C   0821           00263         movfw DATA_H                            ; byt s atributy souboru
0C5D   390F           00264         andlw h'0F'
0C5E   3C0F           00265         sublw h'0F'                                     ; if (atributy and 0Fh) = 0Fh -> zaznam s dlouhy
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 92


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            m nazvem souboru
0C5F   1903           00266         btfsc STATUS,Z
0C60   2CA9           00267         goto FILE_INFO__CTI20_KONEC             ; pokud zaznam je dlouhy nazav souboru, koncime
0C61   19A1           00268         btfsc DATA_H,3
0C62   2CA9           00269         goto FILE_INFO__CTI20_KONEC             ; if (atributy and 08h) = 08h -> jmenovka disku
0C63   1A21           00270         btfsc DATA_H,4                          ; if (atributy and 10h) = 10h -> adresar
0C64   2C7A           00271         goto FILE_INFO__DIR
                      00272 
0C65   3002           00273         movlw h'02'                                     ; zaznam je soubor
0C66   00B6           00274         movwf TEMP1
                      00275         ; tady vime, ze zaznam je soubor, tak se podivame, zda to neni mp3
0C67   3019           00276         movlw 0x19                                      ; 10. byt bufferu 2 -> 1. znak pripony souboru
0C68   0084           00277         movwf FSR
                      00278 
0C69   0800           00279         movfw INDF
0C6A   3C4D           00280         sublw 'M'                                       ; (jmena souboru v "DOSovskem" tvaru maji vzdy v
                            elka pismena)
0C6B   1D03           00281         btfss STATUS,Z
0C6C   2C7C           00282         goto FILE_INFO__FILE
0C6D   0A84           00283         incf FSR,F
0C6E   0800           00284         movfw INDF
0C6F   3C50           00285         sublw 'P'
0C70   1D03           00286         btfss STATUS,Z
0C71   2C7C           00287         goto FILE_INFO__FILE
0C72   0A84           00288         incf FSR,F
0C73   0800           00289         movfw INDF
0C74   3C33           00290         sublw '3'
0C75   1D03           00291         btfss STATUS,Z
0C76   2C7C           00292         goto FILE_INFO__FILE
                      00293 
0C77   3006           00294         movlw h'06'                                     ; ted je jasne, ze soubor je mp3
0C78   00B6           00295         movwf TEMP1
0C79   2C7C           00296         goto FILE_INFO__FILE
                      00297 
0C7A                  00298 FILE_INFO__DIR
0C7A   3001           00299         movlw h'01'                                     ; zaznam je adresar
0C7B   00B6           00300         movwf TEMP1
                      00301 
0C7C                  00302 FILE_INFO__FILE
                      00303         ; tady mame v TEMP 1 jednu z nasledujicich hodnot:
                      00304         ; 01h -> zaznam je adresar; 02h -> zaznam je soubor; 06h -> zaznam je soubor s priponou MP3
0C7C   3010           00305         movlw 0x10                                      ; 1. byt bufferu 2 -> identifikace zaznamu
0C7D   0084           00306         movwf FSR
0C7E   0836           00307         movfw TEMP1
0C7F   0080           00308         movwf INDF
                      00309 
0C80   3004           00310         movlw .4
0C81   00B6           00311         movwf TEMP1
                      00312         PROG_PAGE_0
0C82   118A               M                         bcf PCLATH,3
0C83   120A               M                         bcf PCLATH,4
0C84   22D8           00313         call PRESKOC                            ; nasledujicich 8 bytu ze zaznamu je pro nas k nicemu (o
                            bsahuji cas posledni upravy, otevreni a buh vi co jeste...)
                      00314         PROG_PAGE_1
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 93


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0C85   158A               M                         bsf PCLATH,3
0C86   120A               M                         bcf PCLATH,4
                      00315 
0C87   301E           00316         movlw 0x1E                                      ; 15. byt bufferu 2 -> 2. byt prvniho clusteru
0C88   0084           00317         movwf FSR
                      00318         PROG_PAGE_0
0C89   118A               M                         bcf PCLATH,3
0C8A   120A               M                         bcf PCLATH,4
0C8B   22B8           00319         call READ_DATA                          ; jedno slovo -> horni cast cisla prvniho clusteru
                      00320         PROG_PAGE_1
0C8C   158A               M                         bsf PCLATH,3
0C8D   120A               M                         bcf PCLATH,4
0C8E   0820           00321         movfw DATA_L
0C8F   0080           00322         movwf INDF
0C90   0A84           00323         incf FSR,F
0C91   0821           00324         movfw DATA_H
0C92   0080           00325         movwf INDF
                      00326 
                      00327         PROG_PAGE_0
0C93   118A               M                         bcf PCLATH,3
0C94   120A               M                         bcf PCLATH,4
0C95   22B8           00328         call READ_DATA                          ; cas vytvoreni   (1 word)
0C96   22B8           00329         call READ_DATA                          ; datum vytvoreni (1 word)
                      00330 
0C97   301C           00331         movlw 0x1C                                      ; 13. byt bufferu 2 -> 0. byt prvniho clusteru
0C98   0084           00332         movwf FSR
0C99   22B8           00333         call READ_DATA                          ; jedno slovo -> dolni cast cisla prvniho clusteru
                      00334         PROG_PAGE_1
0C9A   158A               M                         bsf PCLATH,3
0C9B   120A               M                         bcf PCLATH,4
0C9C   0820           00335         movfw DATA_L
0C9D   0080           00336         movwf INDF
0C9E   0A84           00337         incf FSR,F
0C9F   0821           00338         movfw DATA_H
0CA0   0080           00339         movwf INDF
                      00340         
                      00341         ; Pak jsou v zaznamu jeste 4 byty, ktere obsahuji velikost souboru. Ty mi sice nepotrebujeme,
                      00342         ; musime je ale precist, aby jsme precetli vsech 32 bytu zaznamu
0CA1   3002           00343         movlw .2
0CA2   00B6           00344         movwf TEMP1
                      00345         PROG_PAGE_0
0CA3   118A               M                         bcf PCLATH,3
0CA4   120A               M                         bcf PCLATH,4
0CA5   22D8           00346         call PRESKOC
                      00347         PROG_PAGE_1
0CA6   158A               M                         bsf PCLATH,3
0CA7   120A               M                         bcf PCLATH,4
0CA8   0008           00348         return
0CA9                  00349 FILE_INFO__CTI20_KONEC
0CA9   300A           00350         movlw .10
0CAA   00B6           00351         movwf TEMP1
                      00352         PROG_PAGE_0
0CAB   118A               M                         bcf PCLATH,3
0CAC   120A               M                         bcf PCLATH,4
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 94


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0CAD   22D8           00353         call PRESKOC
                      00354         PROG_PAGE_1
0CAE   158A               M                         bsf PCLATH,3
0CAF   120A               M                         bcf PCLATH,4
0CB0   0008           00355         return
                      00356 ;**************************************************************************
0CB1                  00357 FILE_SIZE
                      00358         ; z disku nam ted ma prijit 32bytu dat, ktere reprezentuji jeden zaznam ve slozce
                      00359         ; Zaznam by mel byt soubor, podprogram toto nekontroluje (zda zaznam neni adresar)
                      00360         ; Na zacatek bufferu 1 da 4 byty obsahujici velikost zaznamu
0CB1   300E           00361         movlw .14                                       ; my ted potrebujeme jen posledni 4 byty ze zazn
                            amu, tam se nachazi velikost souboru
0CB2   00B6           00362         movwf TEMP1
                      00363         PROG_PAGE_0
0CB3   118A               M                         bcf PCLATH,3
0CB4   120A               M                         bcf PCLATH,4
0CB5   22D8           00364         call PRESKOC
                      00365         PROG_PAGE_1
0CB6   158A               M                         bsf PCLATH,3
0CB7   120A               M                         bcf PCLATH,4
                      00366 
                      00367         INDF_BANK_2
0CB8   1783               M                         bsf STATUS,IRP    
0CB9   3010           00368         movlw 0x10                                      ; 1. byte bufferu 1
0CBA   0084           00369         movwf FSR
                      00370 
                      00371         PROG_PAGE_0
0CBB   118A               M                         bcf PCLATH,3
0CBC   120A               M                         bcf PCLATH,4
0CBD   22B8           00372         call READ_DATA
0CBE   0820           00373         movfw DATA_L
0CBF   0080           00374         movwf INDF
0CC0   0A84           00375         incf FSR,F
0CC1   0821           00376         movfw DATA_H
0CC2   0080           00377         movwf INDF
0CC3   0A84           00378         incf FSR,F
                      00379 
0CC4   22B8           00380         call READ_DATA
                      00381         PROG_PAGE_1
0CC5   158A               M                         bsf PCLATH,3
0CC6   120A               M                         bcf PCLATH,4
0CC7   0820           00382         movfw DATA_L
0CC8   0080           00383         movwf INDF
0CC9   0A84           00384         incf FSR,F
0CCA   0821           00385         movfw DATA_H
0CCB   0080           00386         movwf INDF
0CCC   0A84           00387         incf FSR,F
                      00388 
0CCD   0008           00389         return
                      00390 ;**************************************************************************
0CCE                  00391 HLEDEJ
                      00392 ; !!!! pozor, tato procedura potrebuje min. 6 mist ve STACKu (vcetne sama sebe)
                      00393 
                      00394 ; mocna procedura, ktera nam podle zadanych parametru vyhleda pozadovany zaznam 
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 95


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00395 ; a umisti jej do bufferu2 na offset 32 (do horni poloviny bufferu)
                      00396 
                      00397 ; ZAZNAM V DRUHE POLOVINE BUFFERU2 MA NASLEDUJICI STRUKTURU:
                      00398 ;       1. byte:        = 00h -> zadny vyhovujici zaznam nebyl nalezen
                      00399 ;                               = 01h -> zaznam je adresar
                      00400 ;                               = 02h -> zaznam je soubor; 
                      00401 ;                               = 06h -> zaznam je soubor s priponou MP3
                      00402 ;       2..9   byte -> 8 znaku dlouhe jmeno ("DOSovsky" tvar - napr. slouzka "dokumenty" = "DOKUME~1" )
                      00403 ;       10..12 byte -> u souboru tri znaky pripony (u adresaru vetsinou mezery - 20h 20h 20h)
                      00404 ;       13..16 byte -> 1. cluster souboru
                      00405 ;       17..18 byte -> cislo zaznamu v adresari
                      00406 
                      00407 ;       HL_PARAMETRY    -- parametry hledani
                      00408 ;       HL_ADR_CL[1-4]  -- prnvi cluster prohledavaneho adresare
                      00409 ;       ZAZNAM[1-2]             -- zaznam od ktereho hledame
                      00410 
                      00411 ; Filozofie je takova, ze v bufferu 1 mame ulozen zaznam vuci kteremu vyhledavame (ZAZ_REF),
                      00412 ; v dolni polovine bufferu 2 mame ulozen zaznam, ktery jsme prave precetli (ZAZ_A)
                      00413 ; a v hodni polovine bufferu 2 zaznam, ktery zatim byl nejblize k pozadovanemu zaznamu (ZAZ_N).
                      00414 
                      00415 ; Hruby vyvojak by pak mohl vypadat takto:
                      00416 ;******************************************************************************************************
                      00417 ; if ((HL_PARAMETRY = [prvni]):
                      00418 ;       if (CLUSTER = ROOT):
                      00419 ;               HL_PARAMETRY := [dalsi]
                      00420 ;               ZAZ_REF := 0x0000000.....
                      00421 ;               goto hledej_hledani
                      00422 ;       else:
                      00423 ;               ZAZ_N naplnit daty ze zaznamu 1 // prvni polozkou vsech adresaru krome ROOTu jsou ".."
                      00424 ;               goto hledej_konec
                      00425 ;       endif;
                      00426 ; endif;
                      00427 
                      00428 ; if ((CLUSTER != ROOT) and (ZAZNAM<2)):
                      00429 ;               if (HL_PARAMETRY = [dalsi]):
                      00430 ;                       ZAZ_REF := 0x0000000.....
                      00431 ;                       goto hledej_hledani
                      00432 ;               else:
                      00433 ;                       goto hledej_konec
                      00434 ;               endif;
                      00435 ; endif;
                      00436 ;
                      00437 ; ZAZ_REF naplnit daty ze zaznamu ZAZNAM
                      00438 ; ZAZNAM := 0
                      00439 ; if (CLUSTER != ROOT):
                      00440 ;               ZAZNAM :=2
                      00441 ; end;
                      00442 ;
                      00443 ; repeat
                      00444 ;       nacti_zaznam
                      00445 ;       IF     (hledame dalsi zaznam)     AND (ZAZ_A > ZAZ_REF) AND ((ZAZ_A < ZAZ_N) OR (ZAZ_N is empty)
                            ):
                      00446 ;                       ZAZ_N := ZAZ_A
                      00447 ;       ELSEIF (hledame predchozi zaznam) AND (ZAZ_A < ZAZ_REF) AND (ZAZ_A > ZAZ_N):
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 96


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00448 ;                       ZAZ_N := ZAZ_A
                      00449 ;       ENDIF
                      00450 ;       zaznam++
                      00451 ; until (byl zaznam posledni)
                      00452 ;
                      00453 ; if (HL_PARAMETRY = [predchozi]) and (ZAZ_N = 00000) and (!ROOT):
                      00454 ;       ZAZ_N naplnit daty ze zaznamu 1
                      00455 ; endif;
                      00456 ; KONEC
                      00457 ;******************************************************************************************************
                      00458         PROG_PAGE_0
0CCE   118A               M                         bcf PCLATH,3
0CCF   120A               M                         bcf PCLATH,4
0CD0   22EE           00459         call CLEAR_BUFFER2              ; vymazeme si buffer2, abychom tam nemeli bordel
                      00460         PROG_PAGE_1
0CD1   158A               M                         bsf PCLATH,3
0CD2   120A               M                         bcf PCLATH,4
0CD3   2632           00461         call CLEAR_BUFFER1              ; vymazeme si buffer1, abychom tam nemeli bordel
                      00462 
0CD4   085A           00463         movfw HL_ADR_CL1
0CD5   00BC           00464         movwf CLUSTER1
0CD6   085B           00465         movfw HL_ADR_CL2
0CD7   00BD           00466         movwf CLUSTER2
0CD8   085C           00467         movfw HL_ADR_CL3
0CD9   00BE           00468         movwf CLUSTER3
0CDA   085D           00469         movfw HL_ADR_CL4
0CDB   00BF           00470         movwf CLUSTER4
                      00471 
                      00472         ; protoze to budeme v nasledujicim kodu potrebova, nastavime si 7. bit HL_PARAMETRY podle toho, 
                      00473         ; zda predany adresar je ROOT ci nikoliv
0CDC   13D9           00474         bcf HL_PARAMETRY,7
0CDD   30FF           00475         movlw h'FF'     
0CDE   05BC           00476         andwf CLUSTER1,F
0CDF   1D03           00477         btfss STATUS,Z
0CE0   17D9           00478                 bsf HL_PARAMETRY,7
0CE1   05BD           00479         andwf CLUSTER2,F
0CE2   1D03           00480         btfss STATUS,Z
0CE3   17D9           00481                 bsf HL_PARAMETRY,7
0CE4   05BE           00482         andwf CLUSTER3,F
0CE5   1D03           00483         btfss STATUS,Z
0CE6   17D9           00484                 bsf HL_PARAMETRY,7
0CE7   05BF           00485         andwf CLUSTER4,F
0CE8   1D03           00486         btfss STATUS,Z
0CE9   17D9           00487                 bsf HL_PARAMETRY,7
                      00488 
                      00489 
0CEA   1DD9           00490         btfss HL_PARAMETRY,3                    ; if ((HL_PARAMETRY = [prvni]):
0CEB   2CF8           00491         goto HLEDEJ_NEHLEDAME_PRVNI
0CEC   1BD9           00492         btfsc HL_PARAMETRY,7                    ;               IF (CLUSTER = ROOT):
0CED   2CF0           00493         goto HLEDEJ_ELSE1
0CEE   1259           00494         bcf HL_PARAMETRY,4
0CEF   2D0E           00495         goto HLEDEJ_HLEDANI
0CF0                  00496 HLEDEJ_ELSE1                                            ;               ELSE:
0CF0   3001           00497         movlw .1
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 97


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0CF1   00E0           00498         movwf ZAZNAM1
0CF2   01E1           00499         clrf ZAZNAM2
0CF3   23B6           00500         call SKOC_NA_ZAZNAM     
0CF4   2436           00501         call FILE_INFO
0CF5   2560           00502         call ZAPIS_C_ZAZNAMU
0CF6   267C           00503         call BUF2_LOW_TO_HIGH
0CF7   2D5F           00504         goto HLEDEJ_KONEC                               ;               ENDIF;
0CF8                  00505 HLEDEJ_NEHLEDAME_PRVNI                          ; ENDIF 
                      00506 
0CF8   1FD9           00507         btfss HL_PARAMETRY,7
0CF9   2D08           00508         goto HLEDEJ_IF2_ENDIF
0CFA   0861           00509         movfw ZAZNAM2 
0CFB   39FF           00510         andlw h'FF'
0CFC   1D03           00511         btfss STATUS,Z
0CFD   2D08           00512         goto HLEDEJ_IF2_ENDIF
0CFE   0860           00513         movfw ZAZNAM1
0CFF   39FF           00514         andlw h'FF'
0D00   1903           00515         btfsc STATUS,Z
0D01   2D05           00516         goto IF2
0D02   3C01           00517         sublw .1
0D03   1D03           00518         btfss STATUS,Z
0D04   2D08           00519         goto HLEDEJ_IF2_ENDIF                   ; if ((CLUSTER != ROOT) and (ZAZNAM < 2)):
0D05                  00520 IF2
0D05   1A59           00521         btfsc HL_PARAMETRY,4                    ;               if (HL_PARAMETRY = [predchozi]):
0D06   2D5F           00522         goto HLEDEJ_KONEC                               ;               ... else:
0D07   2D0E           00523         goto HLEDEJ_HLEDANI                             ;               ... endif;
0D08                  00524 HLEDEJ_IF2_ENDIF                                        ; endif
                      00525 
0D08   23B6           00526         call SKOC_NA_ZAZNAM             ; - pokud ZAZNAM[1-2] ukazuji mimo adresar, vrati v POZICE FFh (
                            jinak 00h)
0D09   183B           00527         btfsc POZICE,0
0D0A   2D5F           00528         goto HLEDEJ_KONEC       
0D0B   2436           00529         call FILE_INFO
0D0C   2560           00530         call ZAPIS_C_ZAZNAMU    
0D0D   263E           00531         call BUF2_TO_BUF1
                      00532 
0D0E                  00533 HLEDEJ_HLEDANI  
0D0E   01E0           00534         clrf ZAZNAM1
0D0F   01E1           00535         clrf ZAZNAM2
0D10   1BD9           00536         btfsc HL_PARAMETRY,7
0D11   14E0           00537         bsf ZAZNAM1,1                   ; if (!ROOT): ZAZNAM = 2; endif;
0D12   01DE           00538         clrf ZAZNAMU_vBUFFERU_DISKU
0D13                  00539 HLEDEJ_REPEAT
0D13   085A           00540         movfw HL_ADR_CL1
0D14   00BC           00541         movwf CLUSTER1
0D15   085B           00542         movfw HL_ADR_CL2
0D16   00BD           00543         movwf CLUSTER2
0D17   085C           00544         movfw HL_ADR_CL3
0D18   00BE           00545         movwf CLUSTER3
0D19   085D           00546         movfw HL_ADR_CL4
0D1A   00BF           00547         movwf CLUSTER4
                      00548 
                      00549 
0D1B   01BB           00550         clrf POZICE
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 98


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0D1C   085E           00551         movfw ZAZNAMU_vBUFFERU_DISKU
0D1D   39FF           00552         andlw h'FF'
0D1E   1903           00553         btfsc STATUS,Z                  ; pokud jeste nejake po sobe jdouci zaznamy jsou pripraveny v bu
                            fferu disku, tak nemusime volat SKOC_NA_ZAZNAM
0D1F   23B6           00554         call SKOC_NA_ZAZNAM             ; - pokud ZAZNAM[1-2] ukazuji mimo adresar, vrati v POZICE FFh (
                            jinak 00h)
0D20   183B           00555         btfsc POZICE,0
0D21   2D44           00556         goto HLEDEJ_END_REPEAT
                      00557 
0D22   03DE           00558         decf ZAZNAMU_vBUFFERU_DISKU,f   ; ted jeden zaznam precteme, proto jich bude v bufferu disku o j
                            eden min
0D23   2436           00559         call FILE_INFO
0D24   2560           00560         call ZAPIS_C_ZAZNAMU
                      00561 
0D25   0AE0           00562         incf ZAZNAM1,f
0D26   1903           00563         btfsc STATUS,Z
0D27   0AE1           00564         incf ZAZNAM2,f
                      00565 
0D28   256D           00566         call VYHOVUJE_ZAZNAM
0D29   1C36           00567         btfss TEMP1,0
0D2A   2D13           00568         goto HLEDEJ_REPEAT
                      00569         
                      00570 ;       movlw .16
                      00571 ;       movwf TEMP1
                      00572 ;       PROG_PAGE_0
                      00573 ;       call ODESLI_BUFFER2                     ; odesleme si zaznam o souboru  
                      00574 ;       call DELAY_500ms    
                      00575 ;       PROG_PAGE_1
                      00576 
                      00577 ;       IF     (hledame dalsi zaznam)
                      00578 ;               IF (ZAZ_A > ZAZ_REF) AND ((ZAZ_A < ZAZ_N) OR (ZAZ_N is empty)):
                      00579 ;                       ZAZ_N := ZAZ_A
                      00580 ;               ENDIF
                      00581 ;       ELSEIF (hledame predchozi zaznam)
                      00582 ;               IF (ZAZ_A < ZAZ_REF) AND (ZAZ_A > ZAZ_N):
                      00583 ;                       ZAZ_N := ZAZ_A
                      00584 ;               ENDIF
                      00585 ;       ENDIF
0D2B   25A2           00586         call COMPARE_BUFF1_BUFF2
                      00587         ; porovna nazvy souboru na zacatku bufferu1 s bufferem2
                      00588         ; pokud v abecede je driv nazev v bufferu1 da to TEMP1 0x01
                      00589         ; pokud v abecede je driv nazev v bufferu2 da to TEMP1 0x02
                      00590         ; pokud se nazvy shoduji da do TEMP1 0x00
0D2C   1A59           00591         btfsc HL_PARAMETRY,4            ;       IF     (hledame dalsi zaznam)
0D2D   2D3D           00592         goto HLEDEJ_ELSE3
0D2E   1C36           00593         btfss TEMP1,0                           ;               IF (ZAZ_A > ZAZ_REF)
0D2F   2D43           00594         goto HLEDEJ_ENDIF3
                      00595 
                      00596         BANK_2
0D30   1703               M                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
0D31   1283               M                 bcf     STATUS,RP0    
0D32   0830           00597         movfw 0x30
                      00598         BANK_0
0D33   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 99


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0D34   1283               M                 bcf     STATUS,RP0    
0D35   39FF           00599         andlw h'FF'
0D36   1903           00600         btfsc STATUS,Z
0D37   2D3B           00601         goto HLEDEJ_IF4
                      00602 
0D38   258F           00603         call COMPARE_BUFF2_L_H
                      00604         ; porovna nazvy souboru na zacatku bufferu2 a na konci bufferu2
                      00605         ; pokud v abecede je driv nazev v horni polovine buff2 da to TEMP1 0x01
                      00606         ; pokud v abecede je driv nazev v dolni polovine buff2 da to TEMP1 0x02
                      00607         ; pokud se nazvy shoduji da do TEMP1 0x00
0D39   1CB6           00608         btfss TEMP1,1
0D3A   2D43           00609         goto HLEDEJ_ENDIF3
0D3B                  00610 HLEDEJ_IF4                                              ;               AND ((ZAZ_A < ZAZ_N) OR (ZAZ_N i
                            s empty)):
0D3B   267C           00611         call BUF2_LOW_TO_HIGH           ;                               ZAZ_N := ZAZ_A
0D3C   2D43           00612         goto HLEDEJ_ENDIF3                      ;               ENDIF
0D3D                  00613 HLEDEJ_ELSE3                                    ;       ELSEIF (hledame predchozi zaznam)
0D3D   1CB6           00614         btfss TEMP1,1                           ;               IF (ZAZ_A < ZAZ_REF)
0D3E   2D43           00615         goto HLEDEJ_ENDIF3
0D3F   258F           00616         call COMPARE_BUFF2_L_H
0D40   1C36           00617         btfss TEMP1,0                           ;               AND (ZAZ_A > ZAZ_N):
0D41   2D43           00618         goto HLEDEJ_ENDIF3
0D42   267C           00619         call BUF2_LOW_TO_HIGH           ;                               ZAZ_N := ZAZ_A
0D43                  00620 HLEDEJ_ENDIF3                                   ;       ENDIF
                      00621         
0D43   2D13           00622         goto HLEDEJ_REPEAT
0D44                  00623 HLEDEJ_END_REPEAT
                      00624 
                      00625 ; if (HL_PARAMETRY = [predchozi]) and (ZAZ_N = 00000) and (!ROOT):
                      00626 ;       ZAZ_N naplnit daty ze zaznamu 1
                      00627 ; endif;
0D44   1E59           00628         btfss HL_PARAMETRY,4            ; if (HL_PARAMETRY = [predchozi])
0D45   2D5F           00629         goto HLEDEJ_KONEC
0D46   1FD9           00630         btfss HL_PARAMETRY,7            ;       and (!ROOT)
0D47   2D5F           00631         goto HLEDEJ_KONEC
                      00632         BANK_2
0D48   1703               M                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
0D49   1283               M                 bcf     STATUS,RP0    
0D4A   0830           00633         movfw 0x30
                      00634         BANK_0
0D4B   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0D4C   1283               M                 bcf     STATUS,RP0    
0D4D   39FF           00635         andlw h'FF'
0D4E   1D03           00636         btfss STATUS,Z                          ;       and (ZAZ_N is empty):
0D4F   2D5F           00637         goto HLEDEJ_KONEC
                      00638 
0D50   085A           00639         movfw HL_ADR_CL1
0D51   00BC           00640         movwf CLUSTER1
0D52   085B           00641         movfw HL_ADR_CL2
0D53   00BD           00642         movwf CLUSTER2
0D54   085C           00643         movfw HL_ADR_CL3
0D55   00BE           00644         movwf CLUSTER3
0D56   085D           00645         movfw HL_ADR_CL4
0D57   00BF           00646         movwf CLUSTER4
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 100


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0D58   3001           00647         movlw .1
0D59   00E0           00648         movwf ZAZNAM1
0D5A   01E1           00649         clrf ZAZNAM2
0D5B   23B6           00650         call SKOC_NA_ZAZNAM     
0D5C   2436           00651         call FILE_INFO
0D5D   2560           00652         call ZAPIS_C_ZAZNAMU
0D5E   267C           00653         call BUF2_LOW_TO_HIGH
                      00654 
0D5F                  00655 HLEDEJ_KONEC                                    ; endif;
0D5F   0008           00656         return
                      00657 ;**************************************************************************
0D60                  00658 ZAPIS_C_ZAZNAMU
                      00659         ; podprogram FILE_INFO nam dava vsechny mozny informace o souboru, krome cisla zaznamu, 
                      00660         ; proto si toto cislo musime zapsat sami do bufferu2
0D60   0860           00661         movfw ZAZNAM1
                      00662         BANK_2
0D61   1703               M                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
0D62   1283               M                 bcf     STATUS,RP0    
0D63   00A0           00663         movwf 0x120
                      00664         BANK_0
0D64   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0D65   1283               M                 bcf     STATUS,RP0    
0D66   0861           00665         movfw ZAZNAM2
                      00666         BANK_2
0D67   1703               M                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
0D68   1283               M                 bcf     STATUS,RP0    
0D69   00A1           00667         movwf 0x121
                      00668         BANK_0
0D6A   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0D6B   1283               M                 bcf     STATUS,RP0    
0D6C   0008           00669         return
                      00670 ;**************************************************************************
0D6D                  00671 VYHOVUJE_ZAZNAM
                      00672         ; pokud zaznam ZAZ_A v bufferu2 vyhovuje hledani, nastavi bit TEMP1,0
0D6D   01B6           00673         clrf TEMP1
                      00674         BANK_2
0D6E   1703               M                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
0D6F   1283               M                 bcf     STATUS,RP0    
0D70   0810           00675         movfw 0x110
                      00676         BANK_0
0D71   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0D72   1283               M                 bcf     STATUS,RP0    
                      00677         ;               1.     byte ->  = 00h -> zaznam je prazdny; 
                      00678         ;                                               = 01h -> zaznam je adresar; 
                      00679         ;                                               = 02h -> zaznam je soubor; 
                      00680         ;                                               = 06h -> zaznam je soubor s priponou MP3
0D73   00B7           00681         movwf TEMP2
0D74   39FF           00682         andlw h'FF'
0D75   1903           00683         btfsc STATUS,Z
0D76   0008           00684         return                          ; pokud je zaznam prazdny, tak jej proste neberem
                      00685 ;HL_PARAMETRY   equ 0x059
                      00686 ;               0. bit = 0 > pokud hledáme soubory, tak pouze MP3
                      00687 ;                                1 > pokud hledáme soubory, vrací všechny soubory
                      00688 ;               1. bit = 0 > hledáme klasicky (nejdøíve adresáøe, poté soubory
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 101


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00689 ;                                1 > hledáme pouze adresáøe, nebo soubory
                      00690 ;               2. bit = 0 > je-li nastaven 1. bit, hledáme pouze adresáøe
                      00691 ;                                1 > je-li nastaven 1. bit, hledáme pouze soubory
0D77   1CD9           00692         btfss HL_PARAMETRY,1
0D78   2D86           00693         goto VYHOV_ZAZ_SOUBiADR
0D79   1D59           00694         btfss HL_PARAMETRY,2
0D7A   2D83           00695         goto VYHOV_ZAZ_ONLY_ADR
0D7B   1C59           00696         btfss HL_PARAMETRY,0
0D7C   2D80           00697         goto VYHOV_ZAZ_ONLY_MP3
0D7D                  00698 VYHOV_ZAZ_ALL_FILES
0D7D   1C37           00699         btfss TEMP2,0
0D7E   1436           00700         bsf TEMP1,0
0D7F   0008           00701         return          
0D80                  00702 VYHOV_ZAZ_ONLY_MP3
0D80   1937           00703         btfsc TEMP2,2
0D81   1436           00704         bsf TEMP1,0
0D82   0008           00705         return
0D83                  00706 VYHOV_ZAZ_ONLY_ADR
0D83   1837           00707         btfsc TEMP2,0
0D84   1436           00708         bsf TEMP1,0
0D85   0008           00709         return
0D86                  00710 VYHOV_ZAZ_SOUBiADR
0D86   1C59           00711         btfss HL_PARAMETRY,0
0D87   2D8A           00712         goto VYHOV_ZAZ_SOUBiADR_MP3
0D88   1436           00713         bsf TEMP1,0
0D89   0008           00714         return
0D8A                  00715 VYHOV_ZAZ_SOUBiADR_MP3
0D8A   1837           00716         btfsc TEMP2,0
0D8B   1436           00717         bsf TEMP1,0
0D8C   1937           00718         btfsc TEMP2,2
0D8D   1436           00719         bsf TEMP1,0
0D8E   0008           00720         return
                      00721 ;**************************************************************************
0D8F                  00722 COMPARE_BUFF2_L_H
                      00723 ; porovna nazvy souboru na zacatku bufferu2 a na konci bufferu2
                      00724 ; pokud v abecede je driv nazev v horni polovine buff2 da to TEMP1 0x01
                      00725 ; pokud v abecede je driv nazev v dolni polovine buff2 da to TEMP1 0x02
                      00726 ; pokud se nazvy shoduji da do TEMP1 0x00
0D8F   01B6           00727         clrf TEMP1
                      00728         INDF_BANK_2                     ; stejne jako INDF_BANK_2
0D90   1783               M                         bsf STATUS,IRP    
                      00729         BANK_0
0D91   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0D92   1283               M                 bcf     STATUS,RP0    
0D93   3010           00730         movlw 0x10
0D94   0084           00731         movwf FSR
0D95   0800           00732         movfw INDF
0D96   3903           00733         andlw h'03'                     ; ted nerozlisuji mezi souborem mp3 a ostatnimi soubory
0D97   00B7           00734         movwf TEMP2
                      00735 
0D98   3030           00736         movlw 0x30
0D99   0084           00737         movwf FSR
0D9A   0800           00738         movfw INDF
0D9B   3903           00739         andlw h'03'                     ; ted nerozlisuji mezi souborem mp3 a ostatnimi soubory 
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 102


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0D9C   0237           00740         subwf TEMP2,W           ; prni byte z bufferu 2 - prvni byte z bufferu 1
                      00741 
0D9D   1903           00742         btfsc STATUS,Z
0D9E   2DB5           00743         goto COMPARE_B1_B2_BYT2         ; prvni byt signalizujici typ byl shodny, pokracujeme bytem druh
                            ym (prvni byt nazvu)
0D9F   1C03           00744         btfss STATUS,C
0DA0   2E2D           00745         goto COMPARE_B1_B2_BUFF2        ; hodnota v bufferu 1 byla vetsi, proto je v abecede dal...
0DA1   2E28           00746         goto COMPARE_B1_B2_BUFF1
                      00747 ; tato procedura je temer shodna s tou nasledujici, proto jen zadame jinou hodnotu do FSR
                      00748 ; (misto pro buffer1 na horni pulku bufferu2) a nechame probehnout stejny kus kodu...
                      00749 ;**************************************************************************
0DA2                  00750 COMPARE_BUFF1_BUFF2
                      00751 ; porovna nazvy souboru na zacatku bufferu1 s bufferem2
                      00752 ; pokud v abecede je driv nazev v bufferu1 da to TEMP1 0x01
                      00753 ; pokud v abecede je driv nazev v bufferu2 da to TEMP1 0x02
                      00754 ; pokud se nazvy shoduji da do TEMP1 0x00
                      00755 
                      00756 ; zaznamy v obou bufferech vypadaji nasledovne:
                      00757 ;               1.     byte ->  = 00h -> zaznam je prazdny; 
                      00758 ;                                               = 01h -> zaznam je adresar; 
                      00759 ;                                               = 02h -> zaznam je soubor; 
                      00760 ;                                               = 06h -> zaznam je soubor s priponou MP3
                      00761 ;               2..9   byte -> 8 znaku dlouhe jmeno ("DOSovsky" tvar - napr. slouzka "dokumenty" = "DOKU
                            ME~1" )
                      00762 ;               10..12 byte -> u souboru tri znaky pripony (u adresaru vetsinou mezery - 20h 20h 20h)
                      00763 ;               13..16 byte -> 1. cluster souboru
0DA2   01B6           00764         clrf TEMP1
                      00765         INDF_BANK_3                     ; stejne jako INDF_BANK_2
0DA3   1783               M                         bsf STATUS,IRP    
                      00766         BANK_0
0DA4   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0DA5   1283               M                 bcf     STATUS,RP0    
0DA6   3010           00767         movlw 0x10
0DA7   0084           00768         movwf FSR
0DA8   0800           00769         movfw INDF
0DA9   3903           00770         andlw h'03'                     ; ted nerozlisuji mezi souborem mp3 a ostatnimi soubory
0DAA   00B7           00771         movwf TEMP2
                      00772 
0DAB   3090           00773         movlw 0x90
0DAC   0084           00774         movwf FSR
0DAD   0800           00775         movfw INDF
0DAE   3903           00776         andlw h'03'                     ; ted nerozlisuji mezi souborem mp3 a ostatnimi soubory 
0DAF   0237           00777         subwf TEMP2,W           ; prni byte z bufferu 2 - prvni byte z bufferu 1
                      00778 
0DB0   1903           00779         btfsc STATUS,Z
0DB1   2DB5           00780         goto COMPARE_B1_B2_BYT2 ; prvni byt signalizujici typ byl shodny, pokracujeme bytem druhym (prvn
                            i byt nazvu)
0DB2   1C03           00781         btfss STATUS,C
0DB3   2E2D           00782         goto COMPARE_B1_B2_BUFF2        ; hodnota v bufferu 1 byla vetsi, proto je v abecede dal...
0DB4   2E28           00783         goto COMPARE_B1_B2_BUFF1
                      00784 
0DB5                  00785 COMPARE_B1_B2_BYT2
                      00786         BANK_2
0DB5   1703               M                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 103


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0DB6   1283               M                 bcf     STATUS,RP0    
0DB7   0A84           00787         incf FSR,F
0DB8   0800           00788         movfw INDF
0DB9   0211           00789         subwf 0x111,W                           ; 2. byte z bufferu 2 - 2. byte z bufferu 1
0DBA   1903           00790         btfsc STATUS,Z
0DBB   2DBF           00791         goto COMPARE_B1_B2_BYT3
0DBC   1C03           00792         btfss STATUS,C
0DBD   2E2D           00793         goto COMPARE_B1_B2_BUFF2        ; hodnota v bufferu 1 byla vetsi, proto je v abecede dal...
0DBE   2E28           00794         goto COMPARE_B1_B2_BUFF1
                      00795 
0DBF                  00796 COMPARE_B1_B2_BYT3
                      00797         BANK_2
0DBF   1703               M                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
0DC0   1283               M                 bcf     STATUS,RP0    
0DC1   0A84           00798         incf FSR,F
0DC2   0800           00799         movfw INDF
0DC3   0212           00800         subwf 0x112,W                           ; 3. byte z bufferu 2 - 3. byte z bufferu 1
0DC4   1903           00801         btfsc STATUS,Z
0DC5   2DC9           00802         goto COMPARE_B1_B2_BYT4
0DC6   1C03           00803         btfss STATUS,C
0DC7   2E2D           00804         goto COMPARE_B1_B2_BUFF2        ; hodnota v bufferu 1 byla vetsi, proto je v abecede dal...
0DC8   2E28           00805         goto COMPARE_B1_B2_BUFF1
                      00806 
0DC9                  00807 COMPARE_B1_B2_BYT4
                      00808         BANK_2
0DC9   1703               M                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
0DCA   1283               M                 bcf     STATUS,RP0    
0DCB   0A84           00809         incf FSR,F
0DCC   0800           00810         movfw INDF
0DCD   0213           00811         subwf 0x113,W                           ; 4. byte z bufferu 2 - 4. byte z bufferu 1
0DCE   1903           00812         btfsc STATUS,Z
0DCF   2DD3           00813         goto COMPARE_B1_B2_BYT5
0DD0   1C03           00814         btfss STATUS,C
0DD1   2E2D           00815         goto COMPARE_B1_B2_BUFF2        ; hodnota v bufferu 1 byla vetsi, proto je v abecede dal...
0DD2   2E28           00816         goto COMPARE_B1_B2_BUFF1
                      00817 
0DD3                  00818 COMPARE_B1_B2_BYT5
                      00819         BANK_2
0DD3   1703               M                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
0DD4   1283               M                 bcf     STATUS,RP0    
0DD5   0A84           00820         incf FSR,F
0DD6   0800           00821         movfw INDF
0DD7   0214           00822         subwf 0x114,W                           ; 5. byte z bufferu 2 - 5. byte z bufferu 1
0DD8   1903           00823         btfsc STATUS,Z
0DD9   2DDD           00824         goto COMPARE_B1_B2_BYT6
0DDA   1C03           00825         btfss STATUS,C
0DDB   2E2D           00826         goto COMPARE_B1_B2_BUFF2        ; hodnota v bufferu 1 byla vetsi, proto je v abecede dal...
0DDC   2E28           00827         goto COMPARE_B1_B2_BUFF1
                      00828 
0DDD                  00829 COMPARE_B1_B2_BYT6
                      00830         BANK_2
0DDD   1703               M                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
0DDE   1283               M                 bcf     STATUS,RP0    
0DDF   0A84           00831         incf FSR,F
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 104


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0DE0   0800           00832         movfw INDF
0DE1   0215           00833         subwf 0x115,W                           ; 6. byte z bufferu 2 - 6. byte z bufferu 1
0DE2   1903           00834         btfsc STATUS,Z
0DE3   2DE7           00835         goto COMPARE_B1_B2_BYT7
0DE4   1C03           00836         btfss STATUS,C
0DE5   2E2D           00837         goto COMPARE_B1_B2_BUFF2        ; hodnota v bufferu 1 byla vetsi, proto je v abecede dal...
0DE6   2E28           00838         goto COMPARE_B1_B2_BUFF1
                      00839 
0DE7                  00840 COMPARE_B1_B2_BYT7
                      00841         BANK_2
0DE7   1703               M                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
0DE8   1283               M                 bcf     STATUS,RP0    
0DE9   0A84           00842         incf FSR,F
0DEA   0800           00843         movfw INDF
0DEB   0216           00844         subwf 0x116,W                           ; 7. byte z bufferu 2 - 7. byte z bufferu 1
0DEC   1903           00845         btfsc STATUS,Z
0DED   2DF1           00846         goto COMPARE_B1_B2_BYT8
0DEE   1C03           00847         btfss STATUS,C
0DEF   2E2D           00848         goto COMPARE_B1_B2_BUFF2        ; hodnota v bufferu 1 byla vetsi, proto je v abecede dal...
0DF0   2E28           00849         goto COMPARE_B1_B2_BUFF1
                      00850 
0DF1                  00851 COMPARE_B1_B2_BYT8
                      00852         BANK_2
0DF1   1703               M                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
0DF2   1283               M                 bcf     STATUS,RP0    
0DF3   0A84           00853         incf FSR,F
0DF4   0800           00854         movfw INDF
0DF5   0217           00855         subwf 0x117,W                           ; 8. byte z bufferu 2 - 8. byte z bufferu 1
0DF6   1903           00856         btfsc STATUS,Z
0DF7   2DFB           00857         goto COMPARE_B1_B2_BYT9
0DF8   1C03           00858         btfss STATUS,C
0DF9   2E2D           00859         goto COMPARE_B1_B2_BUFF2        ; hodnota v bufferu 1 byla vetsi, proto je v abecede dal...
0DFA   2E28           00860         goto COMPARE_B1_B2_BUFF1
                      00861 
0DFB                  00862 COMPARE_B1_B2_BYT9
                      00863         BANK_2
0DFB   1703               M                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
0DFC   1283               M                 bcf     STATUS,RP0    
0DFD   0A84           00864         incf FSR,F
0DFE   0800           00865         movfw INDF
0DFF   0218           00866         subwf 0x118,W                           ; 9. byte z bufferu 2 - 9. byte z bufferu 1
0E00   1903           00867         btfsc STATUS,Z
0E01   2E05           00868         goto COMPARE_B1_B2_BYT10
0E02   1C03           00869         btfss STATUS,C
0E03   2E2D           00870         goto COMPARE_B1_B2_BUFF2        ; hodnota v bufferu 1 byla vetsi, proto je v abecede dal...
0E04   2E28           00871         goto COMPARE_B1_B2_BUFF1
                      00872 
0E05                  00873 COMPARE_B1_B2_BYT10
                      00874         BANK_2
0E05   1703               M                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
0E06   1283               M                 bcf     STATUS,RP0    
0E07   0A84           00875         incf FSR,F
0E08   0800           00876         movfw INDF
0E09   0219           00877         subwf 0x119,W                           ; 10. byte z bufferu 2 - 10. byte z bufferu 1
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 105


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0E0A   1903           00878         btfsc STATUS,Z
0E0B   2E0F           00879         goto COMPARE_B1_B2_BYT11
0E0C   1C03           00880         btfss STATUS,C
0E0D   2E2D           00881         goto COMPARE_B1_B2_BUFF2        ; hodnota v bufferu 1 byla vetsi, proto je v abecede dal...
0E0E   2E28           00882         goto COMPARE_B1_B2_BUFF1
                      00883 
0E0F                  00884 COMPARE_B1_B2_BYT11
                      00885         BANK_2
0E0F   1703               M                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
0E10   1283               M                 bcf     STATUS,RP0    
0E11   0A84           00886         incf FSR,F
0E12   0800           00887         movfw INDF
0E13   021A           00888         subwf 0x11A,W                           ; 11. byte z bufferu 2 - 11. byte z bufferu 1
0E14   1903           00889         btfsc STATUS,Z
0E15   2E19           00890         goto COMPARE_B1_B2_BYT12
0E16   1C03           00891         btfss STATUS,C
0E17   2E2D           00892         goto COMPARE_B1_B2_BUFF2        ; hodnota v bufferu 1 byla vetsi, proto je v abecede dal...
0E18   2E28           00893         goto COMPARE_B1_B2_BUFF1
                      00894 
0E19                  00895 COMPARE_B1_B2_BYT12
                      00896         BANK_2
0E19   1703               M                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
0E1A   1283               M                 bcf     STATUS,RP0    
0E1B   0A84           00897         incf FSR,F
0E1C   0800           00898         movfw INDF
0E1D   021B           00899         subwf 0x11B,W                           ; 12. byte z bufferu 2 - 12. byte z bufferu 1
0E1E   1903           00900         btfsc STATUS,Z
0E1F   2E23           00901         goto COMPARE_B1_B2_SHODNE
0E20   1C03           00902         btfss STATUS,C
0E21   2E2D           00903         goto COMPARE_B1_B2_BUFF2        ; hodnota v bufferu 1 byla vetsi, proto je v abecede dal...
0E22   2E28           00904         goto COMPARE_B1_B2_BUFF1
                      00905 
0E23                  00906 COMPARE_B1_B2_SHODNE
                      00907         BANK_0
0E23   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0E24   1283               M                 bcf     STATUS,RP0    
0E25   3000           00908         movlw h'00'
0E26   00B6           00909         movwf TEMP1     
0E27   0008           00910         return
0E28                  00911 COMPARE_B1_B2_BUFF1
                      00912         BANK_0
0E28   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0E29   1283               M                 bcf     STATUS,RP0    
0E2A   3001           00913         movlw h'01'
0E2B   00B6           00914         movwf TEMP1     
0E2C   0008           00915         return
0E2D                  00916 COMPARE_B1_B2_BUFF2
                      00917         BANK_0
0E2D   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0E2E   1283               M                 bcf     STATUS,RP0    
0E2F   3002           00918         movlw h'02'
0E30   00B6           00919         movwf TEMP1
0E31   0008           00920         return
                      00921 ;**************************************************************************
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 106


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0E32                  00922 CLEAR_BUFFER1           ; BUFFER1 je 64bytu dat v bance 3 na adrese 0x190 - 0x1CF
                      00923                                         ; pouziva TEMP1
0E32   3040           00924         movlw .64
0E33   00B6           00925         movwf TEMP1
                      00926         INDF_BANK_3             ; neprime adresovani na banku 3
0E34   1783               M                         bsf STATUS,IRP    
0E35   3090           00927         movlw 0x90
0E36   0084           00928         movwf FSR
0E37   3000           00929         movlw .0
                      00930 
0E38                  00931 CLEAR_BEFFER1__CLEAR
0E38   0080           00932         movwf INDF
0E39   0A84           00933         incf FSR,F
0E3A   0BB6           00934         decfsz TEMP1,F
0E3B   2E38           00935         goto CLEAR_BEFFER1__CLEAR
                      00936 
                      00937         INDF_BANK_0             ; neprime adresovani na banku 0
0E3C   1383               M                         bcf STATUS,IRP    
0E3D   0008           00938         return
                      00939 ;**************************************************************************
0E3E                  00940 BUF2_TO_BUF1
                      00941         ; hodi 18 dat z dolni pulky bufferu 2 do dolni pulky bufferu 1
                      00942         ; 0x110 -> 0x190
                      00943         INDF_BANK_3
0E3E   1783               M                         bsf STATUS,IRP    
                      00944         BANK_2
0E3F   1703               M                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
0E40   1283               M                 bcf     STATUS,RP0    
0E41   3090           00945         movlw 0x90
0E42   0084           00946         movwf FSR
                      00947 
0E43   0810           00948         movfw 0x110
0E44   0080           00949         movwf INDF
0E45   0A84           00950         incf FSR,F
0E46   0811           00951         movfw 0x111
0E47   0080           00952         movwf INDF
0E48   0A84           00953         incf FSR,F
0E49   0812           00954         movfw 0x112
0E4A   0080           00955         movwf INDF
0E4B   0A84           00956         incf FSR,F
0E4C   0813           00957         movfw 0x113
0E4D   0080           00958         movwf INDF
0E4E   0A84           00959         incf FSR,F
0E4F   0814           00960         movfw 0x114
0E50   0080           00961         movwf INDF
0E51   0A84           00962         incf FSR,F
0E52   0815           00963         movfw 0x115
0E53   0080           00964         movwf INDF
0E54   0A84           00965         incf FSR,F
0E55   0816           00966         movfw 0x116
0E56   0080           00967         movwf INDF
0E57   0A84           00968         incf FSR,F
0E58   0817           00969         movfw 0x117
0E59   0080           00970         movwf INDF
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 107


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0E5A   0A84           00971         incf FSR,F
0E5B   0818           00972         movfw 0x118
0E5C   0080           00973         movwf INDF
0E5D   0A84           00974         incf FSR,F
0E5E   0819           00975         movfw 0x119
0E5F   0080           00976         movwf INDF
0E60   0A84           00977         incf FSR,F
0E61   081A           00978         movfw 0x11A
0E62   0080           00979         movwf INDF
0E63   0A84           00980         incf FSR,F
0E64   081B           00981         movfw 0x11B
0E65   0080           00982         movwf INDF
0E66   0A84           00983         incf FSR,F
0E67   081C           00984         movfw 0x11C
0E68   0080           00985         movwf INDF
0E69   0A84           00986         incf FSR,F
0E6A   081D           00987         movfw 0x11D
0E6B   0080           00988         movwf INDF
0E6C   0A84           00989         incf FSR,F
0E6D   081E           00990         movfw 0x11E
0E6E   0080           00991         movwf INDF
0E6F   0A84           00992         incf FSR,F
0E70   081F           00993         movfw 0x11F
0E71   0080           00994         movwf INDF
0E72   0A84           00995         incf FSR,F
                      00996 
0E73   0820           00997         movfw 0x120
0E74   0080           00998         movwf INDF
0E75   0A84           00999         incf FSR,F
0E76   0821           01000         movfw 0x121
0E77   0080           01001         movwf INDF
0E78   0A84           01002         incf FSR,F
                      01003         BANK_0
0E79   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0E7A   1283               M                 bcf     STATUS,RP0    
0E7B   0008           01004         return
                      01005 ;**************************************************************************
0E7C                  01006 BUF2_LOW_TO_HIGH
                      01007         ; hodi 18 dat z dolni pulky bufferu 2 do horni pulky bufferu 2
                      01008         ; 0x110 - 0x121 -> 0x130 - 0x141
                      01009         BANK_2
0E7C   1703               M                 bsf     STATUS,RP1              ; BANK2  RP1:RP0 = 10
0E7D   1283               M                 bcf     STATUS,RP0    
0E7E   0810           01010         movfw 0x110
0E7F   00B0           01011         movwf 0x130
0E80   0811           01012         movfw 0x111
0E81   00B1           01013         movwf 0x131
0E82   0812           01014         movfw 0x112
0E83   00B2           01015         movwf 0x132
0E84   0813           01016         movfw 0x113
0E85   00B3           01017         movwf 0x133
0E86   0814           01018         movfw 0x114
0E87   00B4           01019         movwf 0x134
0E88   0815           01020         movfw 0x115
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 108


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0E89   00B5           01021         movwf 0x135
0E8A   0816           01022         movfw 0x116
0E8B   00B6           01023         movwf 0x136
0E8C   0817           01024         movfw 0x117
0E8D   00B7           01025         movwf 0x137
0E8E   0818           01026         movfw 0x118
0E8F   00B8           01027         movwf 0x138
0E90   0819           01028         movfw 0x119
0E91   00B9           01029         movwf 0x139
0E92   081A           01030         movfw 0x11A
0E93   00BA           01031         movwf 0x13A
0E94   081B           01032         movfw 0x11B
0E95   00BB           01033         movwf 0x13B
0E96   081C           01034         movfw 0x11C
0E97   00BC           01035         movwf 0x13C
0E98   081D           01036         movfw 0x11D
0E99   00BD           01037         movwf 0x13D
0E9A   081E           01038         movfw 0x11E
0E9B   00BE           01039         movwf 0x13E
0E9C   081F           01040         movfw 0x11F
0E9D   00BF           01041         movwf 0x13F
                      01042 
0E9E   0820           01043         movfw 0x120
0E9F   00C0           01044         movwf 0x140
0EA0   0821           01045         movfw 0x121
0EA1   00C1           01046         movwf 0x141
                      01047         BANK_0
0EA2   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0EA3   1283               M                 bcf     STATUS,RP0    
0EA4   0008           01048         return
                      01049 ;**************************************************************************
0EA5                  01050 LONG_NAME
                      01051 ; Tato procedura prevezme v HL_ADR_CL[1-4] cislo prvniho clusteru adresare a v ZAZNAM[1-2] cislo zaznamu
                             
                      01052 ; od kteremu se pokusi najit dlouhe jmeno. Toto dlouhe jmeno umisti do bufferu 2
                      01053 ; Dlouhe jmeno je ukonceno nulovym bytem. Pokud v bufferu 2 se nulovy byt nevyskytuje, je delka dlouheho
                      01054 ; jmena delsi ci rovna 65.
                      01055 ; V POZICE vraci 00h pri nenalezeni dlouheho jmena a 01h pri pravdepodobnem nalezeni dlouheho jmena.
                      01056 
                      01057 ; 65 znaku neni moc, neco se tam ale vejde "1-3. G & D - Purify (Gabriel & Dresden Remix) featuring Ball
                            igom"   (ingo.mp3)
                      01058 ; vyvojak:
                      01059 ;
                      01060 ; CLEAR_BUFFER2
                      01061 ;
                      01062 ; ZAZNAMU_vBUFFERU_DISKU := 0
                      01063 ; IF (ZAZNAM < 5):                                      // zaznamy cislujeme od 0, 
                      01064 ;       HL_PARAMETRY := ZAZNAM;
                      01065 ;       ZAZNAM := 0
                      01066 ; else:
                      01067 ;       ZAZNAM := ZAZNAM - 5                    // protoze chceme prohledat 5 predchozich
                      01068 ;       HL_PARAMETRY := 5
                      01069 ; endif
                      01070 ;
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 109


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01071 ; while (HL_PARAMETRY <> 0)
                      01072 ;       if (ZAZNAMU_vBUFFERU_DISKU = 0):
                      01073 ;               SKOC_NA_ZAZNAM
                      01074 ;       endif;
                      01075 
                      01076 ;////////////////////
                      01077 ; if (BUFF1[0] != 0) and (BUFF1[0] != E5h) and (BUFF1[11] = 0Fh):
                      01078 ;               // v bufferu1 mame zaznam obsahujici dlouhe jmeno 
                      01079 ;               FSR := (HL_PARAMETRY * 13) + 3
                      01080 ;               INDF := BUFF1[1]
                      01081 ;               inc FSR
                      01082 ;               INDF := BUFF1[3]
                      01083 ;               inc FSR
                      01084 ;               ...
                      01085 ; else:
                      01086 ;               CLEAR_BUFFER2   // zaznam neobsahuje dlouhe jmeno, proto jsou vsechny predchozi zaznamy 
                            k nicemu
                      01087 ; endif;
                      01088 ;////////////////////
                      01089 
                      01090 ;       HL_PARAMETRY --
                      01091 ;       ZAZNAM ++
                      01092 ;       ZAZNAMU_vBUFFERU_DISKU --
                      01093 ; endwhile
                      01094         PROG_PAGE_0
0EA5   118A               M                         bcf PCLATH,3
0EA6   120A               M                         bcf PCLATH,4
0EA7   22EE           01095         call CLEAR_BUFFER2                              ;               CLEAR_BUFFER2   // zaznam neobsa
                            huje dlouhe jmeno, proto jsou vsechny predchozi zaznamy k nicemu
                      01096         PROG_PAGE_1
0EA8   158A               M                         bsf PCLATH,3
0EA9   120A               M                         bcf PCLATH,4
                      01097 
0EAA   01DE           01098         clrf ZAZNAMU_vBUFFERU_DISKU             ; ZAZNAMU_vBUFFERU_DISKU := 0
0EAB   01BB           01099         clrf POZICE
0EAC   0860           01100         movfw ZAZNAM1
0EAD   3C04           01101         sublw .4
0EAE   1C03           01102         btfss STATUS,C
0EAF   2EB8           01103         goto LONG_NAME_ELSE1
0EB0   0861           01104         movfw ZAZNAM2
0EB1   39FF           01105         andlw h'FF'
0EB2   1D03           01106         btfss STATUS,Z                                  ; IF (ZAZNAM < 5):                              
                                    // zaznamy cislujeme od 0, 
0EB3   2EB8           01107         goto LONG_NAME_ELSE1
                      01108 
0EB4   0860           01109         movfw ZAZNAM1
0EB5   00D9           01110         movwf HL_PARAMETRY                              ;       HL_PARAMETRY := ZAZNAM;
0EB6   01E0           01111         clrf ZAZNAM1                                    ;       ZAZNAM := 0
0EB7   2EBE           01112         goto LONG_NAME_ENDIF1
0EB8                  01113 LONG_NAME_ELSE1                                         ; else:
0EB8   3005           01114         movlw .5
0EB9   02E0           01115         subwf ZAZNAM1,F                                 ;       ZAZNAM := ZAZNAM - 5                    
                            // protoze chceme prohledat 5 predchozich
0EBA   1C03           01116         btfss STATUS,C
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 110


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0EBB   03E1           01117         decf ZAZNAM2,F
0EBC   3005           01118         movlw .5
0EBD   00D9           01119         movwf HL_PARAMETRY                              ;       HL_PARAMETRY := 5
0EBE                  01120 LONG_NAME_ENDIF1                                        ; endif
                      01121 
0EBE                  01122 LONG_NAME_WHILE                                         ; while (HL_PARAMETRY <> 0)
0EBE   0859           01123         movfw HL_PARAMETRY
0EBF   39FF           01124         andlw h'FF'
0EC0   1903           01125         btfsc STATUS,Z
0EC1   2F29           01126         goto LONG_NAME_ENDWHILE
                      01127         
0EC2   085A           01128         movfw HL_ADR_CL1
0EC3   00BC           01129         movwf CLUSTER1
0EC4   085B           01130         movfw HL_ADR_CL2
0EC5   00BD           01131         movwf CLUSTER2
0EC6   085C           01132         movfw HL_ADR_CL3
0EC7   00BE           01133         movwf CLUSTER3
0EC8   085D           01134         movfw HL_ADR_CL4
0EC9   00BF           01135         movwf CLUSTER4
                      01136 
0ECA   085E           01137         movfw ZAZNAMU_vBUFFERU_DISKU
0ECB   39FF           01138         andlw h'FF'
0ECC   1903           01139         btfsc STATUS,Z                                  ;       if (ZAZNAMU_vBUFFERU_DISKU = 0):
0ECD   23B6           01140         call SKOC_NA_ZAZNAM                     ;               SKOC_NA_ZAZNAM  endif;
                      01141         
0ECE   183B           01142         btfsc POZICE,0          ; SKOC_NA_ZAZNAM - pokud ZAZNAM[1-2] ukazuji mimo adresar, vrati v POZIC
                            E FFh (jinak 00h)
0ECF   2F2C           01143         goto LONG_NAME_MIMO_ROZSAH
                      01144 
                      01145 ;////////////////////////////////
                      01146 ;       //tady probehne cteni zaznamu, zjisteni, zda jde o dlouhe jmeno a jeho cteni;   
0ED0   3010           01147         movlw .16
0ED1   00B6           01148         movwf TEMP1
                      01149         PROG_PAGE_0
0ED2   118A               M                         bcf PCLATH,3
0ED3   120A               M                         bcf PCLATH,4
0ED4   22E0           01150         call ZAPIS_DO_BUFFERU_1                 ; kazdy zaznam v adresari ma 32 bytu
                      01151         PROG_PAGE_1
0ED5   158A               M                         bsf PCLATH,3
0ED6   120A               M                         bcf PCLATH,4
                      01152 
                      01153         BANK_3
0ED7   1703               M                 bsf     STATUS,RP1              ; BANK3  RP1:RP0 = 11
0ED8   1683               M                 bsf     STATUS,RP0    
0ED9   0810           01154         movfw 0x190
0EDA   39FF           01155         andlw h'FF'
0EDB   1903           01156         btfsc STATUS,Z
0EDC   2F1C           01157         goto LONG_NAME_ELSE2
0EDD   3CE5           01158         sublw h'E5'
0EDE   1903           01159         btfsc STATUS,Z
0EDF   2F1C           01160         goto LONG_NAME_ELSE2
0EE0   081B           01161         movfw 0x19B
0EE1   3C0F           01162         sublw h'0F'
0EE2   1D03           01163         btfss STATUS,Z
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 111


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0EE3   2F1C           01164         goto LONG_NAME_ELSE2
0EE4                  01165 LONG_NAME_IF2                                           ; if (BUFF1[0] != 0) and (BUFF1[0] != E5h) and (
                            BUFF1[11] = 0Fh):
                      01166         BANK_0                                                  ;               // v bufferu1 mame zazna
                            m obsahujici dlouhe jmeno 
0EE4   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0EE5   1283               M                 bcf     STATUS,RP0    
0EE6   0859           01167         movfw HL_PARAMETRY
0EE7   00B6           01168         movwf TEMP1
0EE8   3000           01169         movlw .0
0EE9                  01170 LONG_NAME_NASOBENI
0EE9   3E0D           01171         addlw .13
0EEA   0BB6           01172         decfsz TEMP1,f
0EEB   2EE9           01173         goto LONG_NAME_NASOBENI
0EEC   3E03           01174         addlw .3        
0EED   0084           01175         movwf FSR                                               ;               FSR := (HL_PARAMETRY * 1
                            3) + 3
                      01176 
                      01177         BANK_3
0EEE   1703               M                 bsf     STATUS,RP1              ; BANK3  RP1:RP0 = 11
0EEF   1683               M                 bsf     STATUS,RP0    
                      01178         INDF_BANK_2
0EF0   1783               M                         bsf STATUS,IRP    
0EF1   0811           01179         movfw 0x190+.1
0EF2   0080           01180         movwf INDF
0EF3   0A84           01181         incf FSR,F
0EF4   0813           01182         movfw 0x190+.3
0EF5   0080           01183         movwf INDF
0EF6   0A84           01184         incf FSR,F
0EF7   0815           01185         movfw 0x190+.5
0EF8   0080           01186         movwf INDF
0EF9   0A84           01187         incf FSR,F
0EFA   0817           01188         movfw 0x190+.7
0EFB   0080           01189         movwf INDF
0EFC   0A84           01190         incf FSR,F
0EFD   0819           01191         movfw 0x190+.9
0EFE   0080           01192         movwf INDF
0EFF   0A84           01193         incf FSR,F
0F00   081E           01194         movfw 0x190+.14
0F01   0080           01195         movwf INDF
0F02   0A84           01196         incf FSR,F
0F03   0820           01197         movfw 0x190+.16
0F04   0080           01198         movwf INDF
0F05   0A84           01199         incf FSR,F
0F06   0822           01200         movfw 0x190+.18
0F07   0080           01201         movwf INDF
0F08   0A84           01202         incf FSR,F
0F09   0824           01203         movfw 0x190+.20
0F0A   0080           01204         movwf INDF
0F0B   0A84           01205         incf FSR,F
0F0C   0826           01206         movfw 0x190+.22
0F0D   0080           01207         movwf INDF
0F0E   0A84           01208         incf FSR,F
0F0F   0828           01209         movfw 0x190+.24
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 112


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0F10   0080           01210         movwf INDF
0F11   0A84           01211         incf FSR,F
0F12   082C           01212         movfw 0x190+.28
0F13   0080           01213         movwf INDF
0F14   0A84           01214         incf FSR,F
0F15   082E           01215         movfw 0x190+.30
0F16   0080           01216         movwf INDF
0F17   0A84           01217         incf FSR,F
                      01218         INDF_BANK_0
0F18   1383               M                         bcf STATUS,IRP    
                      01219         BANK_0
0F19   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0F1A   1283               M                 bcf     STATUS,RP0    
0F1B   2F23           01220         goto LONG_NAME_ENDIF2
0F1C                  01221 LONG_NAME_ELSE2                                         ; else:
                      01222         BANK_0
0F1C   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
0F1D   1283               M                 bcf     STATUS,RP0    
                      01223         PROG_PAGE_0
0F1E   118A               M                         bcf PCLATH,3
0F1F   120A               M                         bcf PCLATH,4
0F20   22EE           01224         call CLEAR_BUFFER2                              ;               CLEAR_BUFFER2   // zaznam neobsa
                            huje dlouhe jmeno, proto jsou vsechny predchozi zaznamy k nicemu
                      01225         PROG_PAGE_1
0F21   158A               M                         bsf PCLATH,3
0F22   120A               M                         bcf PCLATH,4
0F23                  01226 LONG_NAME_ENDIF2                                        ; endif;
                      01227 ;////////////////////////////////
                      01228 
0F23   0AE0           01229         incf ZAZNAM1,F
0F24   1903           01230         btfsc STATUS,Z
0F25   0AE1           01231         incf ZAZNAM2,F                                  ;       ZAZNAM ++
0F26   03D9           01232         decf HL_PARAMETRY,F                             ;       HL_PARAMETRY --
0F27   03DE           01233         decf ZAZNAMU_vBUFFERU_DISKU,F   ;       ZAZNAMU_vBUFFERU_DISKU --
0F28   2EBE           01234         goto LONG_NAME_WHILE
0F29                  01235 LONG_NAME_ENDWHILE                                      ; endwhile
0F29   3001           01236         movlw .1
0F2A   00BB           01237         movwf POZICE
0F2B   0008           01238         return
0F2C                  01239 LONG_NAME_MIMO_ROZSAH
0F2C   3000           01240         movlw .0
0F2D   00BB           01241         movwf POZICE
0F2E   0008           01242         return
                      01243 ;**************************************************************************
0F2F                  01244 HLEDEJ_V_NADRAZENEM
                      01245 ; v CLUSTER prijme prvni cluster adresare
                      01246 
                      01247 ; v nadrazenem adresari se pokusi najit zaznam odkazujici na tento adresar
                      01248 ; na zacatek BUFFERU 1 da cislo clusteru se zacatkem nadrazeneho adresare, 
                      01249 ; do HL_ADR_CL da prvni cluster hledaneho adresare a v ZAZNAM vratime cislo 
                      01250 ; zaznamu odkazujici na HL_ADR_CL
0F2F   083C           01251         movfw CLUSTER1
0F30   00DA           01252         movwf HL_ADR_CL1
0F31   083D           01253         movfw CLUSTER2
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 113


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0F32   00DB           01254         movwf HL_ADR_CL2
0F33   083E           01255         movfw CLUSTER3
0F34   00DC           01256         movwf HL_ADR_CL3
0F35   083F           01257         movfw CLUSTER4
0F36   00DD           01258         movwf HL_ADR_CL4
                      01259 
0F37   01BB           01260         clrf POZICE
                      01261         PROG_PAGE_0
0F38   118A               M                         bcf PCLATH,3
0F39   120A               M                         bcf PCLATH,4
0F3A   23BC           01262         call CLUSTER_TO_LBA
0F3B   3001           01263         movlw .1
0F3C   00A6           01264         movwf SECTOR_C
0F3D   2315           01265         call READ_SECTOR        ; precteme prvni sektor z prvniho clusteru adresare     
0F3E   301A           01266         movlw .26                       ; prvnich 26 slov je ted nepotrebnych
0F3F   00B6           01267         movwf TEMP1
0F40   22D8           01268         call PRESKOC
                      01269 
0F41   22B8           01270         call READ_DATA
0F42   0820           01271         movfw DATA_L
0F43   00BE           01272         movwf CLUSTER3
0F44   0821           01273         movfw DATA_H
0F45   00BF           01274         movwf CLUSTER4
                      01275 
0F46   3002           01276         movlw .2                        ; dalsi 4 byty jsou ted nepotrebne
0F47   00B6           01277         movwf TEMP1
0F48   22D8           01278         call PRESKOC
                      01279 
0F49   22B8           01280         call READ_DATA
0F4A   0820           01281         movfw DATA_L
0F4B   00BC           01282         movwf CLUSTER1
0F4C   0821           01283         movfw DATA_H
0F4D   00BD           01284         movwf CLUSTER2
                      01285         PROG_PAGE_1
0F4E   158A               M                         bsf PCLATH,3
0F4F   120A               M                         bcf PCLATH,4
                      01286 
                      01287         ; v CLUSTER ted mame cislo prvniho clusteru nadrazeneho adresare. Umistime jej na zacatek BUFFER
                            U 1
                      01288         INDF_BANK_3
0F50   1783               M                         bsf STATUS,IRP    
0F51   3090           01289         movlw h'90'
0F52   0084           01290         movwf FSR
0F53   083C           01291         movfw CLUSTER1
0F54   0080           01292         movwf INDF
0F55   0A84           01293         incf FSR,f
0F56   083D           01294         movfw CLUSTER2
0F57   0080           01295         movwf INDF
0F58   0A84           01296         incf FSR,f
0F59   083E           01297         movfw CLUSTER3
0F5A   0080           01298         movwf INDF
0F5B   0A84           01299         incf FSR,f
0F5C   083F           01300         movfw CLUSTER4
0F5D   0080           01301         movwf INDF
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 114


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0F5E   0A84           01302         incf FSR,f
                      01303         
0F5F   01E0           01304         clrf ZAZNAM1
0F60   01E1           01305         clrf ZAZNAM2
0F61                  01306 HLEDEJVNAD_CLUSTER
0F61   01BB           01307         clrf POZICE
0F62                  01308 HLEDEJVNAD_SECTOR
                      01309         PROG_PAGE_0
0F62   118A               M                         bcf PCLATH,3
0F63   120A               M                         bcf PCLATH,4
0F64   23BC           01310         call CLUSTER_TO_LBA
0F65   3001           01311         movlw .1
0F66   00A6           01312         movwf SECTOR_C
0F67   2315           01313         call READ_SECTOR
                      01314         PROG_PAGE_1
0F68   158A               M                         bsf PCLATH,3
0F69   120A               M                         bcf PCLATH,4
                      01315 
0F6A   3010           01316         movlw .16
0F6B   00B7           01317         movwf TEMP2
0F6C                  01318 HLEDEJVNAD_ZAZNAM
0F6C   01B8           01319         clrf TEMP3                                      ; pokud bude zaznam vyhovovat, bude TEMP3 0
                      01320         PROG_PAGE_0
0F6D   118A               M                         bcf PCLATH,3
0F6E   120A               M                         bcf PCLATH,4
0F6F   22B8           01321         call READ_DATA
0F70   0820           01322         movfw DATA_L
0F71   39FF           01323         andlw h'FF'
0F72   1903           01324         btfsc STATUS,Z                          ; pokud 1. znak jmena souboru = 00h, je zaznam prazdny
0F73   1438           01325         bsf TEMP3,0
                      01326 
0F74   0820           01327         movfw DATA_L
0F75   3CE5           01328         sublw h'E5'
0F76   1903           01329         btfsc STATUS,Z                          ; pokud 1. znak jmena souboru = E5h, je zaznam prazdny
0F77   1438           01330         bsf TEMP3,0
                      01331 
0F78   3004           01332         movlw .4
0F79   00B6           01333         movwf TEMP1
0F7A   22D8           01334         call PRESKOC                            ; jmeno (8) a priponu (3) ted nepotrebujeme
                      01335 
0F7B   22B8           01336         call READ_DATA
0F7C   0821           01337         movfw DATA_H
0F7D   3910           01338         andlw h'10'
0F7E   3C10           01339         sublw h'10'
0F7F   1D03           01340         btfss STATUS,Z                          ; if (atributy and 10h) = 10h -> adresar
0F80   1438           01341         bsf TEMP3,0
                      01342 
0F81   3004           01343         movlw .4
0F82   00B6           01344         movwf TEMP1
0F83   22D8           01345         call PRESKOC                            ; dalsich 8 bytu je nam k nicemu
                      01346 
0F84   22B8           01347         call READ_DATA
0F85   0820           01348         movfw DATA_L
0F86   025C           01349         subwf HL_ADR_CL3,w
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 115


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0F87   1D03           01350         btfss STATUS,Z
0F88   1438           01351         bsf TEMP3,0
0F89   0821           01352         movfw DATA_H
0F8A   025D           01353         subwf HL_ADR_CL4,w
0F8B   1D03           01354         btfss STATUS,Z
0F8C   1438           01355         bsf TEMP3,0
                      01356 
0F8D   3002           01357         movlw .2                                        ; dalsi 4 byty jsou ted nepotrebne
0F8E   00B6           01358         movwf TEMP1
0F8F   22D8           01359         call PRESKOC
                      01360 
0F90   22B8           01361         call READ_DATA
0F91   0820           01362         movfw DATA_L
0F92   025A           01363         subwf HL_ADR_CL1,w
0F93   1D03           01364         btfss STATUS,Z
0F94   1438           01365         bsf TEMP3,0
0F95   0821           01366         movfw DATA_H
0F96   025B           01367         subwf HL_ADR_CL2,w
0F97   1D03           01368         btfss STATUS,Z
0F98   1438           01369         bsf TEMP3,0
                      01370 
0F99   3002           01371         movlw .2                                        ; musime precist i posledni 4 byty ze zaznamu
0F9A   00B6           01372         movwf TEMP1
0F9B   22D8           01373         call PRESKOC
                      01374         PROG_PAGE_1
0F9C   158A               M                         bsf PCLATH,3
0F9D   120A               M                         bcf PCLATH,4
                      01375         
0F9E   0838           01376         movfw TEMP3
0F9F   39FF           01377         andlw h'FF'
0FA0   1903           01378         btfsc STATUS,Z
0FA1   2FB5           01379         goto HLEDEJVNAD_KONEC           ; pokud se cluster shodoval, koncime
                      01380 
0FA2   0AE0           01381         incf ZAZNAM1,f
0FA3   1903           01382         btfsc STATUS,Z
0FA4   0AE1           01383         incf ZAZNAM2,f                          ; ZAZNAM ++
                      01384 
0FA5   0BB7           01385         decfsz TEMP2,f
0FA6   2F6C           01386         goto HLEDEJVNAD_ZAZNAM
                      01387 
0FA7   0ABB           01388         incf POZICE,f
0FA8   083B           01389         movfw POZICE
0FA9   024C           01390         subwf CLUSTER_SIZE,w
0FAA   1D03           01391         btfss STATUS,Z
0FAB   2F62           01392         goto HLEDEJVNAD_SECTOR
                      01393 
                      01394         PROG_PAGE_0
0FAC   118A               M                         bcf PCLATH,3
0FAD   120A               M                         bcf PCLATH,4
0FAE   241F           01395         call NEXT_CLUSTER
                      01396         PROG_PAGE_1
0FAF   158A               M                         bsf PCLATH,3
0FB0   120A               M                         bcf PCLATH,4
0FB1   083B           01397         movfw POZICE
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 116


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0FB2   39FF           01398         andlw h'FF'
0FB3   1903           01399         btfsc STATUS,Z
0FB4   2F61           01400         goto HLEDEJVNAD_CLUSTER
                      01401 
0FB5                  01402 HLEDEJVNAD_KONEC
0FB5   0008           01403         return
                      01404 ;**************************************************************************
                      00084 
                      00085 
1000                  00086  org 0x1000                                     ; PAGE 2
                      00087         include "particions.asm"; podprogramy pro analyzu MBR, nacteni a kontrolu FAT oddilu
                      00001 ;**********************************************************
                      00002 ;**********************************************************
                      00003 ;**********************************************************
                      00004 ; podprogramy pro analyzu MBR, nacteni a kontrolu FAT oddilu
                      00005 ;**********************************************************
                      00006 ;**********************************************************
                      00007 ;**********************************************************
                      00008 
                      00009 ;**************************************************************************
1000                  00010 SCAN_MBR
                      00011         ; Tato procedura ma na prvni pohled jednoduchy ukol, podiva se do MBR a do BUFFERU 2 hodi nasled
                            ujici data:
                      00012         ; 4 x 16 bytovy zaznam, kde kazdy zaznam reprezentuje jeden oddil se systemem FAT32
                      00013         ; struktura zaznamu je nasledujici:             1  byt (pokud = 0 tak v zaznamu neni zaznam o od
                            dilu, pokud = FFh , je zaznam o oddilu)
                      00014         ;                                                                               4  byty = adresa
                             kde se nachazi spousteci zaznam oddilu
                      00015         ;                                                                               11 bytu = jmenov
                            ka oddilu s FAT32 (neni dulezita, jen aby bylo co vypsat na display :-)
                      00016         PROG_PAGE_0
1000   118A               M                         bcf PCLATH,3
1001   120A               M                         bcf PCLATH,4
1002   22EE           00017         call CLEAR_BUFFER2
                      00018         PROG_PAGE_2
1003   118A               M                         bcf PCLATH,3
1004   160A               M                         bsf PCLATH,4
                      00019 
1005   01A7           00020         clrf LBA1
1006   01A8           00021         clrf LBA2
1007   01A9           00022         clrf LBA3
1008   01AA           00023         clrf LBA4                               ; jako prvni cteme MBR
                      00024 
1009   01BB           00025         clrf POZICE                             ; kolik zaznamu o oddilech uz bylo zapsano do bufferu2
100A                  00026 SCAN_BR                                         
                      00027         ; tady na tom navesti mame zadanou adresu MBR nebo BR nejakeho rozsireneho oddilu
100A   3001           00028         movlw .1
100B   00A6           00029         movwf SECTOR_C
                      00030         PROG_PAGE_0
100C   118A               M                         bcf PCLATH,3
100D   120A               M                         bcf PCLATH,4
100E   2315           00031         call READ_SECTOR                ; cteme MBR nebo BR rozsireneho oddilu
                      00032 
100F   30DF           00033         movlw .223                              ; 223 slov = 446 bytu
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 117


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1010   00B6           00034         movwf TEMP1
1011   22D8           00035         call PRESKOC                    ; na prvnich 446 bytech MBR je zavadeci program systemu (samozre
                            jme, pokud na disku system je)
1012   3020           00036         movlw .32
1013   00B6           00037         movwf TEMP1
1014   22E0           00038         call ZAPIS_DO_BUFFERU_1 ; do bufferu si dame vsechny zaznamy BR (16*4=64bytu / 32slov)
1015   3001           00039         movlw .1
1016   00B6           00040         movwf TEMP1
1017   22D8           00041         call PRESKOC
                      00042         PROG_PAGE_2
1018   118A               M                         bcf PCLATH,3
1019   160A               M                         bsf PCLATH,4
                      00043         ; tak ted jsme precetli cely MBR/BR a zaznamy o jeho oddilech mame v BEFFERU 1, tak se jdem na n
                            e podivat...
                      00044         
                      00045         ; Nejdriv si ale hodime aktualni LBA adresu do operandu Y pro aritmeticke operace
                      00046         INDF_BANK_1                             ; neprime adresovani na banku 1 (aritmeticke operace)
101A   1383               M                         bcf STATUS,IRP    
101B   30A4           00047         movlw 0xA4                              ; FSR na OPERAND_Y
101C   0084           00048         movwf FSR       
101D   0827           00049         movfw LBA1
101E   0080           00050         movwf INDF
101F   0A84           00051         incf FSR,F
1020   0828           00052         movfw LBA2
1021   0080           00053         movwf INDF
1022   0A84           00054         incf FSR,F
1023   0829           00055         movfw LBA3
1024   0080           00056         movwf INDF
1025   0A84           00057         incf FSR,F
1026   082A           00058         movfw LBA4
1027   0080           00059         movwf INDF
1028   0A84           00060         incf FSR,F
                      00061 
                      00062         INDF_BANK_3                             ; neprime adresovani na banku 3 (buffer 1)      
1029   1783               M                         bsf STATUS,IRP    
102A   3094           00063         movlw 0x94                              ; 90h (buffer1) + 4 (pozice kde je ulozen identifikator 
                            souboroveho systemu prvniho zaznamu BR)
102B   0084           00064         movwf FSR
102C   0800           00065         movfw INDF
102D   3C0C           00066         sublw h'0C'                             ; Pokud se FileSystem <> 0Ch...
102E   1D03           00067         btfss STATUS,Z
102F   3C01           00068         sublw .1                                ; ...ani 0Bh...
1030   1D03           00069         btfss STATUS,Z
1031   285B           00070         goto SCAN_MBR__HLEDEJ_ROZSIRENY_ODDIL   ; ...tak hledej rozsireny oddil.
                      00071 
                      00072         ; pokud jsme v teto casti programu, tak prvni zaznam MBR/BR obsahuje oddil FAT32, s reprezentaci
                             adres stylem LBA
                      00073         ; Tady pozor, v MBR/BR neni zapsana LBA adresa oddilu, ale relativni vzdalenost (offset) od MBR/
                            BR.
                      00074         ; To znamena, ze k adrese v (M)BR musime pricist offset oddilu.
                      00075         BANK_1
1032   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
1033   1683               M                 bsf     STATUS,RP0    
1034   3098           00076         movlw 0x98                              ; offset prvniho zaznamu 
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 118


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1035   0084           00077         movwf FSR
1036   0800           00078         movfw INDF
1037   00A0           00079         movwf OPERAND_X1
1038   0A84           00080         incf FSR,F
1039   0800           00081         movfw INDF
103A   00A1           00082         movwf OPERAND_X2
103B   0A84           00083         incf FSR,F
103C   0800           00084         movfw INDF
103D   00A2           00085         movwf OPERAND_X3
103E   0A84           00086         incf FSR,F
103F   0800           00087         movfw INDF
1040   00A3           00088         movwf OPERAND_X4
                      00089         BANK_0
1041   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
1042   1283               M                 bcf     STATUS,RP0    
                      00090 
                      00091         PROG_PAGE_0
1043   118A               M                         bcf PCLATH,3
1044   120A               M                         bcf PCLATH,4
1045   255D           00092         call SOUCET
                      00093         PROG_PAGE_2
1046   118A               M                         bcf PCLATH,3
1047   160A               M                         bsf PCLATH,4
                      00094 
                      00095         INDF_BANK_1                             ; neprime adresovani na banku 1 (aritmeticke operace)
1048   1383               M                         bcf STATUS,IRP    
1049   30A8           00096         movlw 0xA8                              ; FSR na VYSLEDEK
104A   0084           00097         movwf FSR       
104B   0800           00098         movfw INDF
104C   00A7           00099         movwf LBA1
104D   0A84           00100         incf FSR,F
104E   0800           00101         movfw INDF
104F   00A8           00102         movwf LBA2
1050   0A84           00103         incf FSR,F
1051   0800           00104         movfw INDF
1052   00A9           00105         movwf LBA3
1053   0A84           00106         incf FSR,F
1054   0800           00107         movfw INDF
1055   00AA           00108         movwf LBA4
1056   0A84           00109         incf FSR,F
                      00110 
1057   208A           00111         call ZKONTROLUJ_ODDIL_FAT32     ; pokud skutecne adresa v LBA1-4 ukazuje na zacatek oddilu s FAT
                            32, tak da do bufferu2 jmenovku a adresu oddilu
                      00112         INDF_BANK_3
1058   1783               M                         bsf STATUS,IRP    
1059   30A4           00113         movlw 0xA4                                      ; 90h (buffer 1) + 16 (velikost 1. zaznamu) + 4 
                            (identifikator souboroveho systemu 2. zaznamu)
105A   0084           00114         movwf FSR
105B                  00115 SCAN_MBR__HLEDEJ_ROZSIRENY_ODDIL                ; jdem v zaznamech MBR/BR hledat rozsireny oddil
                      00116         ; pokud byl v prvnim zaznamu oddil typu FAT32, tak nam  tad FSR ukazuje na FileSystem 2. zaznamu
                            ...
                      00117         ; ...pokud 1. zaznam nebyl typu FAT32, tak nam FSR ukazuje na FileSystem 1. zaznamu.
                      00118         ; Kazdopadne se ted podivame na dalsi zaznam a pokud obsahuje rozsireny oddil, skocime na jeho a
                            dresu a dame goto SCAN_BR ...
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 119


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

105B   0800           00119         movfw INDF
105C   3C05           00120         sublw h'05'                             ; Pokud se FileSystem <> 05h (rozsireny oddil CHS)...
105D   1D03           00121         btfss STATUS,Z
105E   3C0A           00122         sublw h'0A'                             ; ...ani se <> 0Fh (5+A=F) (rozsireny oddil LBA)...
105F   1D03           00123         btfss STATUS,Z
1060   2889           00124         goto SCAN_MBR__KONEC    ; ...tak koncime...
                      00125 
1061   0804           00126         movfw FSR                               ; ...pokud tu ale mame rozsireny oddil,...
1062   3E04           00127         addlw .4                                ; ...tak se jdem podivat na jeho adresu.
1063   0084           00128         movwf FSR
                      00129 
                      00130         BANK_1
1064   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
1065   1683               M                 bsf     STATUS,RP0    
                      00131         INDF_BANK_3
1066   1783               M                         bsf STATUS,IRP    
1067   0800           00132         movfw INDF
1068   00A0           00133         movwf OPERAND_X1
1069   0A84           00134         incf FSR,F
106A   0800           00135         movfw INDF
106B   00A1           00136         movwf OPERAND_X2
106C   0A84           00137         incf FSR,F
106D   0800           00138         movfw INDF
106E   00A2           00139         movwf OPERAND_X3
106F   0A84           00140         incf FSR,F
1070   0800           00141         movfw INDF
1071   00A3           00142         movwf OPERAND_X4
                      00143         BANK_0
1072   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
1073   1283               M                 bcf     STATUS,RP0    
                      00144 
                      00145         PROG_PAGE_0
1074   118A               M                         bcf PCLATH,3
1075   120A               M                         bcf PCLATH,4
1076   255D           00146         call SOUCET
                      00147         PROG_PAGE_2
1077   118A               M                         bcf PCLATH,3
1078   160A               M                         bsf PCLATH,4
                      00148 
                      00149         INDF_BANK_1                             ; neprime adresovani na banku 1 (aritmeticke operace)
1079   1383               M                         bcf STATUS,IRP    
107A   30A8           00150         movlw 0xA8                              ; FSR na VYSLEDEK
107B   0084           00151         movwf FSR       
107C   0800           00152         movfw INDF
107D   00A7           00153         movwf LBA1
107E   0A84           00154         incf FSR,F
107F   0800           00155         movfw INDF
1080   00A8           00156         movwf LBA2
1081   0A84           00157         incf FSR,F
1082   0800           00158         movfw INDF
1083   00A9           00159         movwf LBA3
1084   0A84           00160         incf FSR,F
1085   0800           00161         movfw INDF
1086   00AA           00162         movwf LBA4
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 120


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1087   0A84           00163         incf FSR,F
                      00164         
1088   280A           00165         goto SCAN_BR                    ; S rozirenym oddilem provedeme totez co s MBR
1089                  00166 SCAN_MBR__KONEC
1089   0008           00167         return
                      00168 ;**************************************************************************
108A                  00169 ZKONTROLUJ_ODDIL_FAT32
                      00170         ; tak ted bychom mely mit v LBA 1-4 adresu spousteciho zaznamu oddilu s FAT32, tak to jdem overi
                            t...
                      00171         ; ...a pokud tam doopravdy spousteci zaznam je, tak dame jmenovku a informace do bufferu 2 na po
                            zici jaka je v rag. POZICE
                      00172         INDF_BANK_2
108A   1783               M                         bsf STATUS,IRP    
108B   083B           00173         movfw POZICE
108C   00B6           00174         movwf TEMP1
108D   1003           00175         bcf STATUS,C
108E   0DB6           00176         rlf TEMP1,F
108F   0DB6           00177         rlf TEMP1,F
1090   0DB6           00178         rlf TEMP1,F
1091   0DB6           00179         rlf TEMP1,F                             ; TEMP1 := POZICE *16
1092   0836           00180         movfw TEMP1
1093   3E11           00181         addlw 0x11                              ; TEMP1 + pozice bufferu 2 + 1 (pozice kam budeme do buf
                            feru 2 davat adresu oddilu)
1094   0084           00182         movwf FSR
                      00183 
1095   0827           00184         movfw LBA1
1096   0080           00185         movwf INDF
1097   0A84           00186         incf FSR,F
1098   0828           00187         movfw LBA2
1099   0080           00188         movwf INDF
109A   0A84           00189         incf FSR,F
109B   0829           00190         movfw LBA3
109C   0080           00191         movwf INDF
109D   0A84           00192         incf FSR,F
109E   082A           00193         movfw LBA4
109F   0080           00194         movwf INDF
10A0   0A84           00195         incf FSR,F                              ; adresa oddilu je ulozena do bufferu 2, ted tam jdem da
                            vat jmenovku oddilu
                      00196 
10A1   3001           00197         movlw .1
10A2   00A6           00198         movwf SECTOR_C
                      00199         PROG_PAGE_0
10A3   118A               M                         bcf PCLATH,3
10A4   120A               M                         bcf PCLATH,4
10A5   2315           00200         call READ_SECTOR
10A6   3023           00201         movlw h'23'
10A7   00B6           00202         movwf TEMP1
10A8   22D8           00203         call PRESKOC                    ; informace o FATce co nas ted zrovna moc nezejimaji
                      00204         ; na offsetu 47 je ulozena jmenovka oddilu (11znaku), ted jsme na offsetu 46
                      00205 
10A9   22B8           00206         call READ_DATA
                      00207         PROG_PAGE_2
10AA   118A               M                         bcf PCLATH,3
10AB   160A               M                         bsf PCLATH,4
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 121


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

10AC   0821           00208         movfw DATA_H
10AD   0080           00209         movwf INDF                              ; 1. znak ze jmenovky svazku
10AE   0A84           00210         incf FSR,F
                      00211 
10AF   3005           00212         movlw .5                                ; dalsich 10 bytu je zbytek jmenovky
10B0   00B6           00213         movwf TEMP1
10B1                  00214 ZKONTROLUJ_ODDIL_FAT32__JMENOVKA
                      00215         PROG_PAGE_0
10B1   118A               M                         bcf PCLATH,3
10B2   120A               M                         bcf PCLATH,4
10B3   22B8           00216         call READ_DATA
                      00217         PROG_PAGE_2
10B4   118A               M                         bcf PCLATH,3
10B5   160A               M                         bsf PCLATH,4
10B6   0820           00218         movfw DATA_L
10B7   0080           00219         movwf INDF
10B8   0A84           00220         incf FSR,F
10B9   0821           00221         movfw DATA_H
10BA   0080           00222         movwf INDF
10BB   0A84           00223         incf FSR,F
10BC   0BB6           00224         decfsz TEMP1,F
10BD   28B1           00225         goto ZKONTROLUJ_ODDIL_FAT32__JMENOVKA
10BE   3010           00226         movlw .16
10BF   0284           00227         subwf FSR,F                                     ; aby fsr ukazoval na priznak o pravdivosti (FSR
                             := FSR - 16)
                      00228 
                      00229         PROG_PAGE_0
10C0   118A               M                         bcf PCLATH,3
10C1   120A               M                         bcf PCLATH,4
10C2   22B8           00230         call READ_DATA
                      00231         PROG_PAGE_2
10C3   118A               M                         bcf PCLATH,3
10C4   160A               M                         bsf PCLATH,4
10C5   0820           00232         movfw DATA_L
10C6   3C46           00233         sublw 'F'               
10C7   1D03           00234         btfss STATUS,Z
10C8   28E6           00235         goto ZKONTROLUJ_ODDIL_FAT32__KONEC
10C9   0821           00236         movfw DATA_H
10CA   3C41           00237         sublw 'A'               
10CB   1D03           00238         btfss STATUS,Z
10CC   28E6           00239         goto ZKONTROLUJ_ODDIL_FAT32__KONEC
                      00240 
                      00241         PROG_PAGE_0
10CD   118A               M                         bcf PCLATH,3
10CE   120A               M                         bcf PCLATH,4
10CF   22B8           00242         call READ_DATA
                      00243         PROG_PAGE_2
10D0   118A               M                         bcf PCLATH,3
10D1   160A               M                         bsf PCLATH,4
10D2   0820           00244         movfw DATA_L
10D3   3C54           00245         sublw 'T'               
10D4   1D03           00246         btfss STATUS,Z
10D5   28E6           00247         goto ZKONTROLUJ_ODDIL_FAT32__KONEC
10D6   0821           00248         movfw DATA_H
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 122


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

10D7   3C33           00249         sublw '3'               
10D8   1D03           00250         btfss STATUS,Z
10D9   28E6           00251         goto ZKONTROLUJ_ODDIL_FAT32__KONEC
                      00252 
                      00253         PROG_PAGE_0
10DA   118A               M                         bcf PCLATH,3
10DB   120A               M                         bcf PCLATH,4
10DC   22B8           00254         call READ_DATA
                      00255         PROG_PAGE_2
10DD   118A               M                         bcf PCLATH,3
10DE   160A               M                         bsf PCLATH,4
10DF   0820           00256         movfw DATA_L
10E0   3C32           00257         sublw '2'
10E1   1D03           00258         btfss STATUS,Z
10E2   28E6           00259         goto ZKONTROLUJ_ODDIL_FAT32__KONEC
                      00260         ; tak, ted uz opravdu vime, ze na tomto sektoru se nachazi spousteci zaznam svazku se souborovym
                             systemem FAT32
                      00261 
10E3   30FF           00262         movlw h'FF'
10E4   0080           00263         movwf INDF
10E5   0ABB           00264         incf POZICE,F                           ; sektor skutecne obsahoval spousteci zaznam svazku...
10E6                  00265 ZKONTROLUJ_ODDIL_FAT32__KONEC
10E6   0008           00266         return
                      00267 ;**************************************************************************
10E7                  00268 NACTI_FAT32
                      00269         ; V LBA1-4 bychom meli dostat adresu prvniho sektoru FAT32 oddilu, kde by se mely nalezat inform
                            ace o fatce
                      00270         ; pokud je FATka pro nas pouzitelna (Clustery nejsou moc velke, sektor = 512B ...) nastavime bit
                             FAT32_LOAD v ATA_ATTRIBUTES
10E7   122E           00271         bcf ATA_ATTRIBUTES,FAT32_LOAD
10E8   01C0           00272         clrf POCATEK_DAT1
10E9   01C1           00273         clrf POCATEK_DAT2
10EA   01C2           00274         clrf POCATEK_DAT3
10EB   01C3           00275         clrf POCATEK_DAT4
10EC   01C4           00276         clrf POCATEK_FAT1
10ED   01C5           00277         clrf POCATEK_FAT2
10EE   01C6           00278         clrf POCATEK_FAT3
10EF   01C7           00279         clrf POCATEK_FAT4
10F0   01C8           00280         clrf ROOT_DIR_CL1
10F1   01C9           00281         clrf ROOT_DIR_CL2
10F2   01CA           00282         clrf ROOT_DIR_CL3
10F3   01CB           00283         clrf ROOT_DIR_CL4
                      00284 
                      00285 
10F4   01A4           00286         clrf FEATURES
10F5   3001           00287         movlw .1
10F6   00A6           00288         movwf SECTOR_C
                      00289         PROG_PAGE_0
10F7   118A               M                         bcf PCLATH,3
10F8   120A               M                         bcf PCLATH,4
10F9   2315           00290         call READ_SECTOR
                      00291 
10FA   3005           00292         movlw .5
10FB   00B6           00293         movwf TEMP1
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 123


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

10FC   22D8           00294         call PRESKOC
                      00295 
10FD   22B8           00296         call READ_DATA                          ; 10 bytu precteno
                      00297         PROG_PAGE_2
10FE   118A               M                         bcf PCLATH,3
10FF   160A               M                         bsf PCLATH,4
1100   0821           00298         movfw DATA_H                            ; 11,12 byte - velikost sektoru (tady by melo byt 512, a
                            le co kdyby ne...)
1101   39FF           00299         andlw h'FF'
1102   1D03           00300         btfss STATUS,Z
1103   29D2           00301         goto NACTI_FAT32__KONEC         ; pokud 11 byte neni nula, koncime (velikost sektoru se nerovna 
                            512)
                      00302 
                      00303         PROG_PAGE_0
1104   118A               M                         bcf PCLATH,3
1105   120A               M                         bcf PCLATH,4
1106   22B8           00304         call READ_DATA                          ; ctu 12. a 13. byte
                      00305         PROG_PAGE_2
1107   118A               M                         bcf PCLATH,3
1108   160A               M                         bsf PCLATH,4
1109   0820           00306         movfw DATA_L
110A   3C02           00307         sublw h'02'
110B   1D03           00308         btfss STATUS,Z
110C   29D2           00309         goto NACTI_FAT32__KONEC         ; pokud 12 byte neni 2, koncime (velikost sektoru se nerovna 512
                            )
                      00310 
110D   0821           00311         movfw DATA_H                            ; byte 13. SectorsPerCluster
110E   00CC           00312         movwf CLUSTER_SIZE
110F   3C80           00313         sublw .128                              ; nas program neumi vic jak 128 (Velikost clusteru = 64K
                            B)
1110   1C03           00314         btfss STATUS,C
1111   29D2           00315         goto NACTI_FAT32__KONEC         ; pokud mame clustery vetsi jak 64KB, tak koncime
                      00316 
                      00317         PROG_PAGE_0
1112   118A               M                         bcf PCLATH,3
1113   120A               M                         bcf PCLATH,4
1114   22B8           00318         call READ_DATA                          ; ctu 14. a 15. byte
                      00319         PROG_PAGE_2
1115   118A               M                         bcf PCLATH,3
1116   160A               M                         bsf PCLATH,4
1117   0820           00320         movfw DATA_L
1118   00C4           00321         movwf POCATEK_FAT1                      ; tady se nachazi pocet rezervovanych sektoru, pak k ZAC
                            ATEK_FAT pricteme adresu zacatku sektoru a mame zacatek fat...
1119   0821           00322         movfw DATA_H
111A   00C5           00323         movwf POCATEK_FAT2
                      00324         
                      00325         PROG_PAGE_0
111B   118A               M                         bcf PCLATH,3
111C   120A               M                         bcf PCLATH,4
111D   22B8           00326         call READ_DATA                          ; ctu 16. a 17. byte
                      00327         PROG_PAGE_2
111E   118A               M                         bcf PCLATH,3
111F   160A               M                         bsf PCLATH,4
1120   0820           00328         movfw DATA_L                            ; Pocet FAT. byva temer vzdy 2, kdyby ale ne, tak by nam
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 124


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                             to delalo docela bordel...
1121   3C02           00329         sublw .2
1122   1D03           00330         btfss STATUS,Z
1123   29D2           00331         goto NACTI_FAT32__KONEC
                      00332 
1124   3009           00333         movlw .9
1125   00B6           00334         movwf TEMP1
                      00335         PROG_PAGE_0
1126   118A               M                         bcf PCLATH,3
1127   120A               M                         bcf PCLATH,4
1128   22D8           00336         call PRESKOC                            ; 18 - 35
                      00337 
1129   22B8           00338         call READ_DATA                          ; 36,37 -> velikost FAT (pocet sektoru)
112A   0820           00339         movfw DATA_L
112B   00C0           00340         movwf POCATEK_DAT1
112C   0821           00341         movfw DATA_H
112D   00C1           00342         movwf POCATEK_DAT2      
112E   22B8           00343         call READ_DATA                          ; 38,39 -> velikost FAT (pocet sektoru)
112F   0820           00344         movfw DATA_L
1130   00C2           00345         movwf POCATEK_DAT3
1131   0821           00346         movfw DATA_H
1132   00C3           00347         movwf POCATEK_DAT4
                      00348 
1133   22B8           00349         call READ_DATA                          ; 40,41
1134   22B8           00350         call READ_DATA                          ; 42,43
                      00351 
1135   22B8           00352         call READ_DATA                          ; 44,45
1136   0820           00353         movfw DATA_L
1137   00C8           00354         movwf ROOT_DIR_CL1
1138   0821           00355         movfw DATA_H
1139   00C9           00356         movwf ROOT_DIR_CL2
113A   22B8           00357         call READ_DATA                          ; 46,47
113B   0820           00358         movfw DATA_L
113C   00CA           00359         movwf ROOT_DIR_CL3
113D   0821           00360         movfw DATA_H
113E   00CB           00361         movwf ROOT_DIR_CL4
                      00362 
113F   3011           00363         movlw .17
1140   00B6           00364         movwf TEMP1
1141   22D8           00365         call PRESKOC                            ; 48 - 81
                      00366 
                      00367         ; ted jeste takova mala kontrola...
1142   22B8           00368         call READ_DATA
                      00369         PROG_PAGE_2
1143   118A               M                         bcf PCLATH,3
1144   160A               M                         bsf PCLATH,4
1145   0820           00370         movfw DATA_L
1146   3C46           00371         sublw 'F'               
1147   1D03           00372         btfss STATUS,Z
1148   29D2           00373         goto NACTI_FAT32__KONEC
1149   0821           00374         movfw DATA_H
114A   3C41           00375         sublw 'A'               
114B   1D03           00376         btfss STATUS,Z
114C   29D2           00377         goto NACTI_FAT32__KONEC
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 125


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00378         PROG_PAGE_0
114D   118A               M                         bcf PCLATH,3
114E   120A               M                         bcf PCLATH,4
114F   22B8           00379         call READ_DATA
                      00380         PROG_PAGE_2
1150   118A               M                         bcf PCLATH,3
1151   160A               M                         bsf PCLATH,4
1152   0820           00381         movfw DATA_L
1153   3C54           00382         sublw 'T'               
1154   1D03           00383         btfss STATUS,Z
1155   29D2           00384         goto NACTI_FAT32__KONEC
1156   0821           00385         movfw DATA_H
1157   3C33           00386         sublw '3'               
1158   1D03           00387         btfss STATUS,Z
1159   29D2           00388         goto NACTI_FAT32__KONEC
                      00389         PROG_PAGE_0
115A   118A               M                         bcf PCLATH,3
115B   120A               M                         bcf PCLATH,4
115C   22B8           00390         call READ_DATA
                      00391         PROG_PAGE_2
115D   118A               M                         bcf PCLATH,3
115E   160A               M                         bsf PCLATH,4
115F   0820           00392         movfw DATA_L
1160   3C32           00393         sublw '2'
1161   1D03           00394         btfss STATUS,Z
1162   29D2           00395         goto NACTI_FAT32__KONEC
                      00396         ; tak, ted uz opravdu vime, ze na tomto sektoru se nachazi spousteci zaznam svazku se souborovym
                             systemem FAT32...
                      00397         ; tak ted jdem vypocitat ty nejdulezitejsi cisla pro praci s FATkou...
                      00398 
                      00399         INDF_BANK_1                                     ; aritmeto/logicke operace
1163   1383               M                         bcf STATUS,IRP    
1164   30A0           00400         movlw 0xA0                                      ; OPERAND_X
1165   0084           00401         movwf FSR
1166   0844           00402         movfw POCATEK_FAT1
1167   0080           00403         movwf INDF
1168   0A84           00404         incf FSR,F
1169   0845           00405         movfw POCATEK_FAT2
116A   0080           00406         movwf INDF
116B   0A84           00407         incf FSR,F
116C   0846           00408         movfw POCATEK_FAT3
116D   0080           00409         movwf INDF
116E   0A84           00410         incf FSR,F
116F   0847           00411         movfw POCATEK_FAT4
1170   0080           00412         movwf INDF
1171   0A84           00413         incf FSR,F
1172   0827           00414         movfw LBA1                                      ; OPERAND_Y
1173   0080           00415         movwf INDF
1174   0A84           00416         incf FSR,F
1175   0828           00417         movfw LBA2
1176   0080           00418         movwf INDF
1177   0A84           00419         incf FSR,F
1178   0829           00420         movfw LBA3
1179   0080           00421         movwf INDF
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 126


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

117A   0A84           00422         incf FSR,F
117B   082A           00423         movfw LBA4
117C   0080           00424         movwf INDF
117D   0A84           00425         incf FSR,F
                      00426         PROG_PAGE_0
117E   118A               M                         bcf PCLATH,3
117F   120A               M                         bcf PCLATH,4
1180   255D           00427         call SOUCET                                     ; pricteme k zacatku oddilu pocet rezervovanych 
                            sektoru (obvykle 32) a mame z toho POCATEK_FAT
                      00428         PROG_PAGE_2
1181   118A               M                         bcf PCLATH,3
1182   160A               M                         bsf PCLATH,4
1183   0800           00429         movfw INDF
1184   00C4           00430         movwf POCATEK_FAT1
1185   0A84           00431         incf FSR,F
1186   0800           00432         movfw INDF
1187   00C5           00433         movwf POCATEK_FAT2
1188   0A84           00434         incf FSR,F
1189   0800           00435         movfw INDF
118A   00C6           00436         movwf POCATEK_FAT3
118B   0A84           00437         incf FSR,F
118C   0800           00438         movfw INDF
118D   00C7           00439         movwf POCATEK_FAT4
118E   0A84           00440         incf FSR,F
                      00441 
                      00442         ; v POCATEK_DAT ted mame hodnotu "velikost fat", tu vynasobime 2 a pricteme POCATEK_FAT. Tak zis
                            kame POCATEK_DAT
118F   30A0           00443         movlw 0xA0                                      ; OPERAND_X
1190   0084           00444         movwf FSR
1191   0840           00445         movfw POCATEK_DAT1
1192   0080           00446         movwf INDF
1193   0A84           00447         incf FSR,F
1194   0841           00448         movfw POCATEK_DAT2
1195   0080           00449         movwf INDF
1196   0A84           00450         incf FSR,F
1197   0842           00451         movfw POCATEK_DAT3
1198   0080           00452         movwf INDF
1199   0A84           00453         incf FSR,F
119A   0843           00454         movfw POCATEK_DAT4
119B   0080           00455         movwf INDF
119C   0A84           00456         incf FSR,F
                      00457         PROG_PAGE_0
119D   118A               M                         bcf PCLATH,3
119E   120A               M                         bcf PCLATH,4
119F   25CB           00458         call POSUNDOLEVA_1                      ; X := X * 2 -> POCATEK_DAT := 2 * "velikost fat"
                      00459                                                                 ; ted jeste staci pricist POCATEK_FAT
11A0   0844           00460         movfw POCATEK_FAT1
11A1   0080           00461         movwf INDF
11A2   0A84           00462         incf FSR,F
11A3   0845           00463         movfw POCATEK_FAT2
11A4   0080           00464         movwf INDF
11A5   0A84           00465         incf FSR,F
11A6   0846           00466         movfw POCATEK_FAT3
11A7   0080           00467         movwf INDF
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 127


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

11A8   0A84           00468         incf FSR,F
11A9   0847           00469         movfw POCATEK_FAT4
11AA   0080           00470         movwf INDF
11AB   0A84           00471         incf FSR,F
11AC   255D           00472         call SOUCET
                      00473         PROG_PAGE_2
11AD   118A               M                         bcf PCLATH,3
11AE   160A               M                         bsf PCLATH,4
                      00474 
                      00475         ;   tady je pro me jedna zcela nepochopitelna vlastnost FATky, a to to, ze prvni dva zaznamy (nu
                            lty a prvni)
                      00476         ;   ve FAT tabulce jsou obsazeny nejakyma srotama (identifikator FATky), coz by nebylo to nejhor
                            si, ale data na disku
                      00477         ;   zacinaji jiz na nultym clusteru. (POCATEK_DAT) Dochazi tedy k tomu, ze nulty cluster na disk
                            u je reprezentovan na druhe
                      00478         ;   pozici ve fatce a to cislem dve!!! Od udaje ve fatce bychom musime tedy vzdy odecist hodnotu
                             2
                      00479         ;   a ziskali bychom skutecnou polohu dat na disku.... (Je to pekne na vyliz!!!!!!!!)
                      00480         ;   Ja to tady resim tak, ze zacatek dat posunu o 2 clustery niz (POCATEK_DAT := POCATEK_DAT - 2
                            *VELIKOST_CLUSTERU),
                      00481         ;   aby udaje souhlasily a my nemuseli nic prepocitavat. 
                      00482         ;   Pak tu nastava jeste jeden problem, ROOT adresar byva adresovan jako by byl na clusteru 0, p
                            roto pokazdy kdyz je 
                      00483         ;   nekde cislo clusteru 0, tak skocime na prvni cluster root adresare. (Vetsinou 2. cluster)
                      00484         ;   O tomto jevu jsem nikde necetl, ale proste to tak je. Z toho vyplyva, ze zadny soubor nemuze
                             byt na slusteru 1...
                      00485         
                      00486         ; Tak ted mame v POCATEK_DAT = POCATEK_FAT + (velikostFat * 2)
                      00487         ; a ted jeste musime odecist 2 * velikost_clusteru
                      00488 
11AF   0D4C           00489         rlf CLUSTER_SIZE,W              ; W := CLUSTER_SIZE * 2
                      00490         BANK_1
11B0   1303               M                 bcf     STATUS,RP1              ; BANK1  RP1:RP0 = 01
11B1   1683               M                 bsf     STATUS,RP0    
11B2   00A4           00491         movwf OPERAND_Y1
11B3   01A5           00492         clrf OPERAND_Y2
11B4   01A6           00493         clrf OPERAND_Y3
11B5   01A7           00494         clrf OPERAND_Y4
11B6   0828           00495         movfw VYSLEDEK1
11B7   00A0           00496         movwf OPERAND_X1
11B8   0829           00497         movfw VYSLEDEK2
11B9   00A1           00498         movwf OPERAND_X2
11BA   082A           00499         movfw VYSLEDEK3
11BB   00A2           00500         movwf OPERAND_X3
11BC   082B           00501         movfw VYSLEDEK4
11BD   00A3           00502         movwf OPERAND_X4
                      00503         BANK_0
11BE   1303               M                 bcf     STATUS,RP1              ; BANK0  RP1:RP0 = 00
11BF   1283               M                 bcf     STATUS,RP0    
                      00504         PROG_PAGE_0
11C0   118A               M                         bcf PCLATH,3
11C1   120A               M                         bcf PCLATH,4
11C2   2589           00505         call ROZDIL                             ; VYSLEDEK := POCATEK_FAT + (2 * velikostFat) - (2 * CLU
                            STER_SIZE)
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 128


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00506         PROG_PAGE_2
11C3   118A               M                         bcf PCLATH,3
11C4   160A               M                         bsf PCLATH,4
11C5   0800           00507         movfw INDF
11C6   00C0           00508         movwf POCATEK_DAT1
11C7   0A84           00509         incf FSR,F
11C8   0800           00510         movfw INDF
11C9   00C1           00511         movwf POCATEK_DAT2
11CA   0A84           00512         incf FSR,F
11CB   0800           00513         movfw INDF
11CC   00C2           00514         movwf POCATEK_DAT3
11CD   0A84           00515         incf FSR,F
11CE   0800           00516         movfw INDF
11CF   00C3           00517         movwf POCATEK_DAT4
11D0   0A84           00518         incf FSR,F
                      00519         
                      00520         ; Tak ted uz to konecne mame, muzeme se pustit do prohlizeni adresaru a souboru...
                      00521 
11D1   162E           00522         bsf ATA_ATTRIBUTES,FAT32_LOAD   
11D2                  00523 NACTI_FAT32__KONEC
11D2   0008           00524         return  
                      00525 ;**************************************************************************
                      00526 
                      00088         include "commands2.asm" ; druha cast podprogramu na obsluhu prikazu (od ridiciho procesoru)
                      00001 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
                      00002 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
                      00003 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
                      00004 ; tady jsou procedury resici jednotlive prikazy
                      00005 ; Pokud je v zasobniku prikaz pro nejakou proceduru, musi tato procedura nastavit byt STAV_PRIKAZU do 1 
                            (i kdyz treba nema vsechny parametry)
                      00006 ; Pokud procedura najde svuj prikaz a jsou prijate vsechny parametry, musi odeslat nejakou odpoved po US
                            ARTu a smazat reg. PRIJATYCH_DAT!!!
                      00007 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
                      00008 ; CAST 2 
11D3                  00009 PRIKAZ_0Bh                                              ; 0Bh – zjisti velikost fragmentu
11D3   0878           00010         movfw 0x078                                     ; prvni byte zasobniku prikazu
11D4   3C0B           00011         sublw h'0b'                                     
11D5   1D03           00012         btfss STATUS,Z
11D6   0008           00013         return                                          ; nebyl prijat prikaz 0Bh
11D7   1475           00014         bsf STAV_PRIKAZU,0                      ; mame tu prikaz 0Bh, nastavime byt STAV_PRIKAZU
11D8   0873           00015         movfw PRIJATYCH_DAT
11D9   3C04           00016         sublw .4                                        ; pro prikaz 0Bh museji prijit 5 bytu (prikaz + 
                            4byty parametr)
11DA   1803           00017         btfsc STATUS,C
11DB   0008           00018         return                                          ; jeste nemame vsechny parametry
                      00019         ; Prisel prikaz 0Bh s 4bytovym parametrem 
                      00020 
11DC   0879           00021         movfw 0x079                                     ; nejnizsi cast clusteru
11DD   00BC           00022         movwf CLUSTER1
11DE   087A           00023         movfw 0x07A
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 129


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

11DF   00BD           00024         movwf CLUSTER2
11E0   087B           00025         movfw 0x07B
11E1   00BE           00026         movwf CLUSTER3
11E2   087C           00027         movfw 0x07C
11E3   00BF           00028         movwf CLUSTER4
                      00029 
                      00030         PROG_PAGE_0
11E4   118A               M                         bcf PCLATH,3
11E5   120A               M                         bcf PCLATH,4
11E6   24A7           00031         call ZJISTI_FRAGMENT
                      00032         PROG_PAGE_2
11E7   118A               M                         bcf PCLATH,3
11E8   160A               M                         bsf PCLATH,4
                      00033 ; v CLUSTER[1-4] prijme cislo clusteru a do FRAGMENT[1-2] umisti kolik clusteru 
                      00034 ; po tomto clusteru nasledujich tvori jeden fragment
                      00035 ; (pokud je retezec tvoren pouze z tohoto clusteru, je vraceno cislo 0)
                      00036 
                      00037 ; Pokud soucasny cluster je prazdny (coz by se stat nemelo) vrati v POZICE FFh
                      00038 ; Jinak, pokud s vse povede, dame do POZICE 0
                      00039 
                      00040 ; ! PODPROGRAM NENI POUZITELNY PRO CLUSTER 0 (prvni cluster ROOT adresare)
                      00041 ; ! PODPROGRAM NETESTUJE ZDA NEBYLO ZADANO VETSI CISLO NEZ JE POCET CLUSTERU !!!
                      00042         
                      00043         PROG_PAGE_0
11E9   118A               M                         bcf PCLATH,3
11EA   120A               M                         bcf PCLATH,4
11EB   083B           00044         movfw POZICE 
11EC   21D0           00045         call WR_USART
11ED   0851           00046         movfw FRAGMENT1
11EE   21D0           00047         call WR_USART
11EF   0852           00048         movfw FRAGMENT2
11F0   21D0           00049         call WR_USART
                      00050         PROG_PAGE_2
11F1   118A               M                         bcf PCLATH,3
11F2   160A               M                         bsf PCLATH,4
                      00051         
11F3   01F3           00052         clrf PRIJATYCH_DAT                      ; vyprazdnime zasobnik prikazu
11F4   0008           00053         return
                      00054 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
11F5                  00055 PRIKAZ_0Ch                                              ; 0Ch – najdi záznam o tomto adresáøi v nadøazen
                            ém adresáøi
11F5   0878           00056         movfw 0x078                                     ; prvni byte zasobniku prikazu
11F6   3C0C           00057         sublw h'0C'                                     
11F7   1D03           00058         btfss STATUS,Z
11F8   0008           00059         return                                          ; nebyl prijat prikaz 0Ch
11F9   1475           00060         bsf STAV_PRIKAZU,0                      ; mame tu prikaz 0Ch, nastavime byt STAV_PRIKAZU
11FA   0873           00061         movfw PRIJATYCH_DAT
11FB   3C04           00062         sublw .4                                        ; pro prikaz 0Ch museji prijit 5 bytu (prikaz + 
                            4byty parametr)
11FC   1803           00063         btfsc STATUS,C
11FD   0008           00064         return                                          ; jeste nemame vsechny parametry
                      00065         ; Prisel prikaz 0Ch s 4bytovym parametrem 
                      00066 
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 130


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

11FE   0879           00067         movfw 0x079                                     ; nejnizsi cast clusteru
11FF   00BC           00068         movwf CLUSTER1
1200   087A           00069         movfw 0x07A
1201   00BD           00070         movwf CLUSTER2
1202   087B           00071         movfw 0x07B
1203   00BE           00072         movwf CLUSTER3
1204   087C           00073         movfw 0x07C
1205   00BF           00074         movwf CLUSTER4
                      00075 
1206   083C           00076         movfw CLUSTER1
1207   043D           00077         iorwf CLUSTER2,W
1208   043E           00078         iorwf CLUSTER3,W
1209   043F           00079         iorwf CLUSTER4,W
120A   1903           00080         btfsc STATUS,Z
120B   2A1E           00081         goto PRIKAZ_0Ch_JEROOT          ; pokud CLUSTER[1-4]=0, tak se jedna o 1. cluster ROOT adr., pro
                            to nemusime dale resit co tam je...
                      00082 
                      00083         PROG_PAGE_1
120C   158A               M                         bsf PCLATH,3
120D   120A               M                         bcf PCLATH,4
120E   237C           00084         call PRVNI_CL_ADRESARE          ; V POZICE vrati 00h, pokud cluster je prvni cluster nejakeho ad
                            resare, FFh, pokud neobsahuje adresar
                      00085         PROG_PAGE_2
120F   118A               M                         bcf PCLATH,3
1210   160A               M                         bsf PCLATH,4
1211   083B           00086         movfw POZICE
1212   39FF           00087         andlw h'FF'
1213   1D03           00088         btfss STATUS,Z
1214   2A1C           00089         goto PRIKAZ_0Ch_NENI_ZACATEK_ADR        
                      00090 
                      00091         PROG_PAGE_1
1215   158A               M                         bsf PCLATH,3
1216   120A               M                         bcf PCLATH,4
1217   272F           00092         call HLEDEJ_V_NADRAZENEM
                      00093         PROG_PAGE_2
1218   118A               M                         bcf PCLATH,3
1219   160A               M                         bsf PCLATH,4
                      00094 
121A   3000           00095         movlw h'00'
121B   2A1F           00096         goto PRIKAZ_0Ch_ODESLI
121C                  00097 PRIKAZ_0Ch_NENI_ZACATEK_ADR
121C   3081           00098         movlw h'81'
121D   2A1F           00099         goto PRIKAZ_0Ch_ODESLI
121E                  00100 PRIKAZ_0Ch_JEROOT
121E   3001           00101         movlw h'01'
121F                  00102 PRIKAZ_0Ch_ODESLI
                      00103 
                      00104         PROG_PAGE_0
121F   118A               M                         bcf PCLATH,3
1220   120A               M                         bcf PCLATH,4
1221   21D0           00105         call WR_USART
                      00106 
                      00107         INDF_BANK_3
1222   1783               M                         bsf STATUS,IRP    
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 131


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1223   3090           00108         movlw h'90'
1224   0084           00109         movwf FSR
                      00110 
1225   0800           00111         movfw INDF
1226   21D0           00112         call WR_USART
1227   0A84           00113         incf FSR,f
1228   0800           00114         movfw INDF
1229   21D0           00115         call WR_USART
122A   0A84           00116         incf FSR,f
122B   0800           00117         movfw INDF
122C   21D0           00118         call WR_USART
122D   0A84           00119         incf FSR,f
122E   0800           00120         movfw INDF
122F   21D0           00121         call WR_USART
1230   0A84           00122         incf FSR,f
                      00123 
1231   0860           00124         movfw ZAZNAM1
1232   21D0           00125         call WR_USART
1233   0861           00126         movfw ZAZNAM2
1234   21D0           00127         call WR_USART
                      00128         PROG_PAGE_2
1235   118A               M                         bcf PCLATH,3
1236   160A               M                         bsf PCLATH,4
                      00129         
1237   01F3           00130         clrf PRIJATYCH_DAT                      ; vyprazdnime zasobnik prikazu
1238   0008           00131         return
                      00132 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
1239                  00133 PRIKAZ_0Dh                                              ; 0Dh – nastav dobu, po ktere se disk prepne do 
                            STANDBY
1239   0878           00134         movfw 0x078                                     ; prvni byte zasobniku prikazu
123A   3C0D           00135         sublw h'0D'                                     
123B   1D03           00136         btfss STATUS,Z
123C   0008           00137         return                                          ; nebyl prijat prikaz 0Dh
123D   1475           00138         bsf STAV_PRIKAZU,0                      ; mame tu prikaz 0Dh, nastavime byt STAV_PRIKAZU
123E   0873           00139         movfw PRIJATYCH_DAT
123F   3C02           00140         sublw .2                                        ; pro prikaz 0Ch museji prijit 3 bytu (prikaz + 
                            2byty parametr)
1240   1803           00141         btfsc STATUS,C
1241   0008           00142         return                                          ; jeste nemame vsechny parametry
                      00143         ; Prisel prikaz 0Dh s 2bytovym parametrem 
                      00144 
1242   0879           00145         movfw 0x079
1243   047A           00146         iorwf 0x07A,w
1244   1903           00147         btfsc STATUS,Z
1245   2A4D           00148         goto PRIKAZ_0Dh_OKAMZITE
                      00149 
1246   0879           00150         movfw 0x079                                     ; 2. byte zasobniku prikazu             
1247   00D7           00151         movwf KONST_NECINNOSTI1
1248   00D5           00152         movwf CITAC_NECINNOSTI1
1249   087A           00153         movfw 0x07A                                     ; 3. byte zasobniku prikazu             
124A   00D8           00154         movwf KONST_NECINNOSTI2
124B   00D6           00155         movwf CITAC_NECINNOSTI2         ; disk je vypinan po urcite dobe necinosti
                      00156 
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 132


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

124C   2A4F           00157         goto PRIKAZ_0Dh_KONEC
124D                  00158 PRIKAZ_0Dh_OKAMZITE
124D   01D5           00159         clrf CITAC_NECINNOSTI1
124E   01D6           00160         clrf CITAC_NECINNOSTI2
                      00161 
124F                  00162 PRIKAZ_0Dh_KONEC
                      00163 
                      00164         PROG_PAGE_0
124F   118A               M                         bcf PCLATH,3
1250   120A               M                         bcf PCLATH,4
1251   30FF           00165         movlw h'ff'
1252   21D0           00166         call WR_USART
                      00167 
                      00168 ;       movfw KONST_NECINNOSTI1
                      00169 ;       call WR_USART
                      00170 ;       movfw KONST_NECINNOSTI2
                      00171 ;       call WR_USART
                      00172 ;       movfw CITAC_NECINNOSTI1
                      00173 ;       call WR_USART
                      00174 ;       movfw CITAC_NECINNOSTI2
                      00175 ;       call WR_USART
                      00176         PROG_PAGE_2
1253   118A               M                         bcf PCLATH,3
1254   160A               M                         bsf PCLATH,4
                      00177 
1255   01F3           00178         clrf PRIJATYCH_DAT                      ; vyprazdnime zasobnik
1256   0008           00179         return
                      00180 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
1257                  00181 PRIKAZ_85h                                              ; 85h – nastav pøedvolený „ekvalizér“
1257   0878           00182         movfw 0x078                                     ; prvni byte zasobniku prikazu
1258   3C85           00183         sublw h'85'                                     
1259   1D03           00184         btfss STATUS,Z
125A   0008           00185         return                                          ; nebyl prijat prikaz 0Dh
125B   1475           00186         bsf STAV_PRIKAZU,0                      ; mame tu prikaz 0Dh, nastavime byt STAV_PRIKAZU
125C   0873           00187         movfw PRIJATYCH_DAT
125D   3C01           00188         sublw .1                                        ; pro prikaz 85h museji prijit 2 byty (prikaz + 
                            1byt parametr)
125E   1803           00189         btfsc STATUS,C
125F   0008           00190         return                                          ; jeste nemame vsechny parametry
                      00191         ; Prisel prikaz 85h s 1 bytem parametru
                      00192 
1260   0879           00193         movfw 0x079
1261   39FF           00194         andlw h'FF'
1262   1903           00195         btfsc STATUS,Z
1263   2A99           00196         goto PRIKAZ_85h_VYPNI
                      00197 
1264   0879           00198         movfw 0x079     
1265   3C0C           00199         sublw .12
1266   1C03           00200         btfss STATUS,C
1267   2A92           00201         goto PRIKAZ_85h_SPATNY_PARAMETR
                      00202 
1268   0879           00203         movfw 0x079     
1269   00AF           00204         movwf VS_LOUDNESS
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 133


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00205 
126A   300A           00206         movlw VSADDR_AIADDR
126B   00B6           00207         movwf TEMP1
126C   3000           00208         movlw 0x00
126D   00B7           00209         movwf TEMP2     
126E   3042           00210         movlw 0x42
126F   00B8           00211         movwf TEMP3
                      00212         PROG_PAGE_1     
1270   158A               M                         bsf PCLATH,3
1271   120A               M                         bcf PCLATH,4
1272   2063           00213         call VS_WR_REG                          ; nastavime zacatek uzivatelskeho programu (0x4200)
                      00214         PROG_PAGE_2
1273   118A               M                         bcf PCLATH,3
1274   160A               M                         bsf PCLATH,4
                      00215 
1275   300D           00216         movlw VSADDR_AICTRL0
1276   00B6           00217         movwf TEMP1
1277   3000           00218         movlw 0x00
1278   00B7           00219         movwf TEMP2     
1279   3000           00220         movlw 0x00
127A   00B8           00221         movwf TEMP3
                      00222         PROG_PAGE_1     
127B   158A               M                         bsf PCLATH,3
127C   120A               M                         bcf PCLATH,4
127D   2063           00223         call VS_WR_REG                          ; resetujeme plugin
                      00224         PROG_PAGE_2
127E   118A               M                         bcf PCLATH,3
127F   160A               M                         bsf PCLATH,4
                      00225 
1280   300D           00226         movlw VSADDR_AICTRL0
1281   00B6           00227         movwf TEMP1
1282   082F           00228         movfw VS_LOUDNESS
1283   00B7           00229         movwf TEMP2     
1284   3000           00230         movlw 0x00
1285   00B8           00231         movwf TEMP3
                      00232         PROG_PAGE_1     
1286   158A               M                         bsf PCLATH,3
1287   120A               M                         bcf PCLATH,4
1288   2063           00233         call VS_WR_REG                          ; nastavime pozadovany filter
                      00234         PROG_PAGE_2
1289   118A               M                         bcf PCLATH,3
128A   160A               M                         bsf PCLATH,4
                      00235 
                      00236         PROG_PAGE_0
128B   118A               M                         bcf PCLATH,3
128C   120A               M                         bcf PCLATH,4
128D   30FF           00237         movlw h'ff'
128E   21D0           00238         call WR_USART
                      00239         PROG_PAGE_2
128F   118A               M                         bcf PCLATH,3
1290   160A               M                         bsf PCLATH,4
1291   2AB2           00240         goto PRIKAZ_85h_KONEC
                      00241 
1292                  00242 PRIKAZ_85h_SPATNY_PARAMETR
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 134


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00243         PROG_PAGE_0
1292   118A               M                         bcf PCLATH,3
1293   120A               M                         bcf PCLATH,4
1294   3000           00244         movlw h'00'
1295   21D0           00245         call WR_USART
                      00246         PROG_PAGE_2
1296   118A               M                         bcf PCLATH,3
1297   160A               M                         bsf PCLATH,4
1298   2AB2           00247         goto PRIKAZ_85h_KONEC
                      00248 
1299                  00249 PRIKAZ_85h_VYPNI
1299   01AF           00250         clrf VS_LOUDNESS
                      00251 
129A   300D           00252         movlw VSADDR_AICTRL0
129B   00B6           00253         movwf TEMP1
129C   3000           00254         movlw 0x00
129D   00B7           00255         movwf TEMP2     
129E   3000           00256         movlw 0x00
129F   00B8           00257         movwf TEMP3
                      00258         PROG_PAGE_1     
12A0   158A               M                         bsf PCLATH,3
12A1   120A               M                         bcf PCLATH,4
12A2   2063           00259         call VS_WR_REG                          ; resetujeme plugin
                      00260         PROG_PAGE_2
12A3   118A               M                         bcf PCLATH,3
12A4   160A               M                         bsf PCLATH,4
                      00261 
12A5   300A           00262         movlw VSADDR_AIADDR
12A6   00B6           00263         movwf TEMP1
12A7   01B7           00264         clrf TEMP2      
12A8   01B8           00265         clrf TEMP3
                      00266         PROG_PAGE_1     
12A9   158A               M                         bsf PCLATH,3
12AA   120A               M                         bcf PCLATH,4
12AB   2063           00267         call VS_WR_REG                          ; vypneme plugin
                      00268 
                      00269         PROG_PAGE_0
12AC   118A               M                         bcf PCLATH,3
12AD   120A               M                         bcf PCLATH,4
12AE   30FF           00270         movlw h'ff'
12AF   21D0           00271         call WR_USART
                      00272         PROG_PAGE_2
12B0   118A               M                         bcf PCLATH,3
12B1   160A               M                         bsf PCLATH,4
12B2                  00273 PRIKAZ_85h_KONEC
12B2   01F3           00274         clrf PRIJATYCH_DAT                      ; vyprazdnime zasobnik
12B3   0008           00275         return
                      00276 ; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                            XXXXXXXXXXXXXXXXXXXXX
                      00089 
1800                  00090  org 0x1800                                     ; PAGE 3
                      00091         include "loudness.asm"  ; plugin dekoderu "loudness" a podprogramy pro jeho nahrani a obsluhu
                      00001 ; Plugin LOUDNESS pro dekoder VS1001k umoznoje pri dekodovani mp3 menit prenosovou charakteristiku.
                      00002 ; Vybirat muzeme celkem z 12 prednastavenych ekvalizeru.
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 135


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00003 
                      00004 ; Samotny plugin je treba po resetu nahrat do RAM pameti dekoderu.
                      00005 ; Pak uz jej muzeme pres uzivatelske registry VS ovladat a poslouchat, jak nam to krasne hraje:)
                      00006 
                      00007 ; Je pouzit originalni vzorovy plugin od firmy VLSI (verze 1.41)
                      00008 ; Pro blizsi informace o pluginu si prectete datasheet ze stranek www.vlsi.fi
                      00009 
                      00010 ; Do VS registru WRAMADDR se nejdrive musi nahrat adresa 0x8200 pro zacatek pluginu na adrese 0x4200 
                      00011 ; (0x4200 + 0x4000 = 0x8200 vis. "6.5.8 WRAMADDR" datasheetu VS1001k)
                      00012 ; A pote do registru WRAM nasledujici tabulka. Prvni dato je dolni byte slova.
                      00013 
                      00014 ;# addr = 0x4200, 379 32-bit words = 1516 bytes
1800                  00015  org 0x1800                                     ; PAGE 3
1800   3413           00016         retlw 0x13
1801   3436           00017         retlw 0x36
1802   3424           00018         retlw 0x24
1803   3400           00019         retlw 0x00
1804   3412           00020         retlw 0x12
1805   343E           00021         retlw 0x3e
1806   3417           00022         retlw 0x17
1807   34B8           00023         retlw 0xb8
1808   3412           00024         retlw 0x12
1809   343E           00025         retlw 0x3e
180A   3415           00026         retlw 0x15
180B   3438           00027         retlw 0x38
180C   3405           00028         retlw 0x05
180D   343E           00029         retlw 0x3e
180E   3414           00030         retlw 0x14
180F   34B8           00031         retlw 0xb8
1810   3415           00032         retlw 0x15
1811   3436           00033         retlw 0x36
1812   3424           00034         retlw 0x24
1813   3400           00035         retlw 0x00
1814   3400           00036         retlw 0x00
1815   3400           00037         retlw 0x00
1816   340A           00038         retlw 0x0a
1817   3480           00039         retlw 0x80
1818   3410           00040         retlw 0x10
1819   343E           00041         retlw 0x3e
181A   3404           00042         retlw 0x04
181B   34B8           00043         retlw 0xb8
181C   3400           00044         retlw 0x00
181D   3400           00045         retlw 0x00
181E   3482           00046         retlw 0x82
181F   3400           00047         retlw 0x00
1820   3404           00048         retlw 0x04
1821   343E           00049         retlw 0x3e
1822   3412           00050         retlw 0x12
1823   3478           00051         retlw 0x78
1824   3424           00052         retlw 0x24
1825   3460           00053         retlw 0x60
1826   3424           00054         retlw 0x24
1827   3400           00055         retlw 0x00
1828   3404           00056         retlw 0x04
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 136


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1829   3400           00057         retlw 0x00
182A   3491           00058         retlw 0x91
182B   34E5           00059         retlw 0xe5
182C   3410           00060         retlw 0x10
182D   3428           00061         retlw 0x28
182E   3415           00062         retlw 0x15
182F   348A           00063         retlw 0x8a
1830   3494           00064         retlw 0x94
1831   3440           00065         retlw 0x40
1832   3424           00066         retlw 0x24
1833   3400           00067         retlw 0x00
1834   3400           00068         retlw 0x00
1835   3431           00069         retlw 0x31
1836   344C           00070         retlw 0x4c
1837   3498           00071         retlw 0x98
1838   3484           00072         retlw 0x84
1839   3442           00073         retlw 0x42
183A   3424           00074         retlw 0x24
183B   3400           00075         retlw 0x00
183C   3404           00076         retlw 0x04
183D   3400           00077         retlw 0x00
183E   3412           00078         retlw 0x12
183F   34E0           00079         retlw 0xe0
1840   3410           00080         retlw 0x10
1841   3428           00081         retlw 0x28
1842   3445           00082         retlw 0x45
1843   3487           00083         retlw 0x87
1844   3400           00084         retlw 0x00
1845   3400           00085         retlw 0x00
1846   3491           00086         retlw 0x91
1847   3400           00087         retlw 0x00
1848   3410           00088         retlw 0x10
1849   34F1           00089         retlw 0xf1
184A   3440           00090         retlw 0x40
184B   34B8           00091         retlw 0xb8
184C   3410           00092         retlw 0x10
184D   3429           00093         retlw 0x29
184E   34C0           00094         retlw 0xc0
184F   34D3           00095         retlw 0xd3
1850   3409           00096         retlw 0x09
1851   3430           00097         retlw 0x30
1852   3450           00098         retlw 0x50
1853   3438           00099         retlw 0x38
1854   3404           00100         retlw 0x04
1855   3400           00101         retlw 0x00
1856   3412           00102         retlw 0x12
1857   34E2           00103         retlw 0xe2
1858   3400           00104         retlw 0x00
1859   3400           00105         retlw 0x00
185A   3491           00106         retlw 0x91
185B   3400           00107         retlw 0x00
185C   3410           00108         retlw 0x10
185D   34F1           00109         retlw 0xf1
185E   3450           00110         retlw 0x50
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 137


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

185F   3498           00111         retlw 0x98
1860   3410           00112         retlw 0x10
1861   3429           00113         retlw 0x29
1862   34C0           00114         retlw 0xc0
1863   34D3           00115         retlw 0xd3
1864   3413           00116         retlw 0x13
1865   3430           00117         retlw 0x30
1866   3424           00118         retlw 0x24
1867   3400           00119         retlw 0x00
1868   3409           00120         retlw 0x09
1869   3430           00121         retlw 0x30
186A   34D0           00122         retlw 0xd0
186B   341B           00123         retlw 0x1b
186C   3410           00124         retlw 0x10
186D   3428           00125         retlw 0x28
186E   3480           00126         retlw 0x80
186F   3490           00127         retlw 0x90
1870   3409           00128         retlw 0x09
1871   3430           00129         retlw 0x30
1872   34C0           00130         retlw 0xc0
1873   341B           00131         retlw 0x1b
1874   3410           00132         retlw 0x10
1875   34F1           00133         retlw 0xf1
1876   3440           00134         retlw 0x40
1877   34B8           00135         retlw 0xb8
1878   3410           00136         retlw 0x10
1879   3429           00137         retlw 0x29
187A   3440           00138         retlw 0x40
187B   34C6           00139         retlw 0xc6
187C   3409           00140         retlw 0x09
187D   3430           00141         retlw 0x30
187E   3450           00142         retlw 0x50
187F   3438           00143         retlw 0x38
1880   3404           00144         retlw 0x04
1881   3400           00145         retlw 0x00
1882   3412           00146         retlw 0x12
1883   34E2           00147         retlw 0xe2
1884   3400           00148         retlw 0x00
1885   3400           00149         retlw 0x00
1886   3491           00150         retlw 0x91
1887   3400           00151         retlw 0x00
1888   3410           00152         retlw 0x10
1889   34F1           00153         retlw 0xf1
188A   3450           00154         retlw 0x50
188B   3498           00155         retlw 0x98
188C   3410           00156         retlw 0x10
188D   3429           00157         retlw 0x29
188E   3440           00158         retlw 0x40
188F   34C6           00159         retlw 0xc6
1890   3413           00160         retlw 0x13
1891   3430           00161         retlw 0x30
1892   3424           00162         retlw 0x24
1893   3400           00163         retlw 0x00
1894   3409           00164         retlw 0x09
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 138


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1895   3430           00165         retlw 0x30
1896   34D0           00166         retlw 0xd0
1897   341B           00167         retlw 0x1b
1898   3410           00168         retlw 0x10
1899   3428           00169         retlw 0x28
189A   3480           00170         retlw 0x80
189B   3490           00171         retlw 0x90
189C   3409           00172         retlw 0x09
189D   3430           00173         retlw 0x30
189E   34C0           00174         retlw 0xc0
189F   341B           00175         retlw 0x1b
18A0   3400           00176         retlw 0x00
18A1   3400           00177         retlw 0x00
18A2   3402           00178         retlw 0x02
18A3   3401           00179         retlw 0x01
18A4   3410           00180         retlw 0x10
18A5   3428           00181         retlw 0x28
18A6   3415           00182         retlw 0x15
18A7   348F           00183         retlw 0x8f
18A8   3400           00184         retlw 0x00
18A9   3400           00185         retlw 0x00
18AA   3424           00186         retlw 0x24
18AB   3400           00187         retlw 0x00
18AC   3400           00188         retlw 0x00
18AD   3431           00189         retlw 0x31
18AE   344C           00190         retlw 0x4c
18AF   3498           00191         retlw 0x98
18B0   3484           00192         retlw 0x84
18B1   3442           00193         retlw 0x42
18B2   3424           00194         retlw 0x24
18B3   3400           00195         retlw 0x00
18B4   3404           00196         retlw 0x04
18B5   3400           00197         retlw 0x00
18B6   3412           00198         retlw 0x12
18B7   34E0           00199         retlw 0xe0
18B8   3410           00200         retlw 0x10
18B9   3428           00201         retlw 0x28
18BA   3485           00202         retlw 0x85
18BB   348D           00203         retlw 0x8d
18BC   3400           00204         retlw 0x00
18BD   3400           00205         retlw 0x00
18BE   3451           00206         retlw 0x51
18BF   3400           00207         retlw 0x00
18C0   3480           00208         retlw 0x80
18C1   3441           00209         retlw 0x41
18C2   3440           00210         retlw 0x40
18C3   34B8           00211         retlw 0xb8
18C4   3410           00212         retlw 0x10
18C5   3429           00213         retlw 0x29
18C6   34C0           00214         retlw 0xc0
18C7   34D3           00215         retlw 0xd3
18C8   3409           00216         retlw 0x09
18C9   3430           00217         retlw 0x30
18CA   3450           00218         retlw 0x50
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 139


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

18CB   3438           00219         retlw 0x38
18CC   3409           00220         retlw 0x09
18CD   3430           00221         retlw 0x30
18CE   34D0           00222         retlw 0xd0
18CF   341B           00223         retlw 0x1b
18D0   3410           00224         retlw 0x10
18D1   3428           00225         retlw 0x28
18D2   3480           00226         retlw 0x80
18D3   3490           00227         retlw 0x90
18D4   3409           00228         retlw 0x09
18D5   3430           00229         retlw 0x30
18D6   34C0           00230         retlw 0xc0
18D7   341B           00231         retlw 0x1b
18D8   3480           00232         retlw 0x80
18D9   3441           00233         retlw 0x41
18DA   3440           00234         retlw 0x40
18DB   34B8           00235         retlw 0xb8
18DC   3410           00236         retlw 0x10
18DD   3429           00237         retlw 0x29
18DE   3440           00238         retlw 0x40
18DF   34C6           00239         retlw 0xc6
18E0   3409           00240         retlw 0x09
18E1   3430           00241         retlw 0x30
18E2   3450           00242         retlw 0x50
18E3   3438           00243         retlw 0x38
18E4   3409           00244         retlw 0x09
18E5   3430           00245         retlw 0x30
18E6   34D0           00246         retlw 0xd0
18E7   341B           00247         retlw 0x1b
18E8   3410           00248         retlw 0x10
18E9   3428           00249         retlw 0x28
18EA   3480           00250         retlw 0x80
18EB   3490           00251         retlw 0x90
18EC   3409           00252         retlw 0x09
18ED   3430           00253         retlw 0x30
18EE   34C0           00254         retlw 0xc0
18EF   341B           00255         retlw 0x1b
18F0   3424           00256         retlw 0x24
18F1   3460           00257         retlw 0x60
18F2   3424           00258         retlw 0x24
18F3   3400           00259         retlw 0x00
18F4   3400           00260         retlw 0x00
18F5   3400           00261         retlw 0x00
18F6   3424           00262         retlw 0x24
18F7   3400           00263         retlw 0x00
18F8   3410           00264         retlw 0x10
18F9   3428           00265         retlw 0x28
18FA   3495           00266         retlw 0x95
18FB   3490           00267         retlw 0x90
18FC   3400           00268         retlw 0x00
18FD   3400           00269         retlw 0x00
18FE   3424           00270         retlw 0x24
18FF   3400           00271         retlw 0x00
1900   3410           00272         retlw 0x10
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 140


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1901   3429           00273         retlw 0x29
1902   3440           00274         retlw 0x40
1903   3492           00275         retlw 0x92
1904   3488           00276         retlw 0x88
1905   3441           00277         retlw 0x41
1906   3424           00278         retlw 0x24
1907   3400           00279         retlw 0x00
1908   34F4           00280         retlw 0xf4
1909   3436           00281         retlw 0x36
190A   3412           00282         retlw 0x12
190B   3458           00283         retlw 0x58
190C   34F0           00284         retlw 0xf0
190D   3436           00285         retlw 0x36
190E   3404           00286         retlw 0x04
190F   3498           00287         retlw 0x98
1910   3405           00288         retlw 0x05
1911   3434           00289         retlw 0x34
1912   3414           00290         retlw 0x14
1913   3490           00291         retlw 0x90
1914   34F3           00292         retlw 0xf3
1915   3436           00293         retlw 0x36
1916   3424           00294         retlw 0x24
1917   3400           00295         retlw 0x00
1918   34F2           00296         retlw 0xf2
1919   3436           00297         retlw 0x36
191A   3415           00298         retlw 0x15
191B   3418           00299         retlw 0x18
191C   3400           00300         retlw 0x00
191D   3420           00301         retlw 0x20
191E   3400           00302         retlw 0x00
191F   3400           00303         retlw 0x00
1920   34F2           00304         retlw 0xf2
1921   3436           00305         retlw 0x36
1922   3417           00306         retlw 0x17
1923   3498           00307         retlw 0x98
1924   3413           00308         retlw 0x13
1925   3436           00309         retlw 0x36
1926   3424           00310         retlw 0x24
1927   3400           00311         retlw 0x00
1928   3422           00312         retlw 0x22
1929   343E           00313         retlw 0x3e
192A   3415           00314         retlw 0x15
192B   34B8           00315         retlw 0xb8
192C   3405           00316         retlw 0x05
192D   343E           00317         retlw 0x3e
192E   3414           00318         retlw 0x14
192F   34B8           00319         retlw 0xb8
1930   3425           00320         retlw 0x25
1931   3436           00321         retlw 0x36
1932   3424           00322         retlw 0x24
1933   3400           00323         retlw 0x00
1934   3400           00324         retlw 0x00
1935   3400           00325         retlw 0x00
1936   340A           00326         retlw 0x0a 
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 141


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1937   3480           00327         retlw 0x80
1938   3410           00328         retlw 0x10
1939   343E           00329         retlw 0x3e
193A   3401           00330         retlw 0x01
193B   3438           00331         retlw 0x38
193C   3404           00332         retlw 0x04
193D   3400           00333         retlw 0x00
193E   3400           00334         retlw 0x00
193F   34E0           00335         retlw 0xe0
1940   3411           00336         retlw 0x11
1941   343E           00337         retlw 0x3e
1942   3410           00338         retlw 0x10
1943   3478           00339         retlw 0x78
1944   3413           00340         retlw 0x13
1945   343E           00341         retlw 0x3e
1946   340E           00342         retlw 0x0e 
1947   34F8           00343         retlw 0xf8
1948   3403           00344         retlw 0x03
1949   343E           00345         retlw 0x3e
194A   344C           00346         retlw 0x4c
194B   3450           00347         retlw 0x50
194C   3488           00348         retlw 0x88
194D   3444           00349         retlw 0x44
194E   34C0           00350         retlw 0xc0
194F   3433           00351         retlw 0x33
1950   3404           00352         retlw 0x04
1951   3400           00353         retlw 0x00
1952   34D0           00354         retlw 0xd0
1953   34E0           00355         retlw 0xe0
1954   3410           00356         retlw 0x10
1955   3428           00357         retlw 0x28
1956   3495           00358         retlw 0x95
1957   3498           00359         retlw 0x98
1958   3400           00360         retlw 0x00
1959   3400           00361         retlw 0x00
195A   34CE           00362         retlw 0xce 
195B   3403           00363         retlw 0x03
195C   3410           00364         retlw 0x10
195D   3424           00365         retlw 0x24
195E   34CE           00366         retlw 0xce 
195F   3496           00367         retlw 0x96
1960   3480           00368         retlw 0x80
1961   34B8           00369         retlw 0xb8
1962   344C           00370         retlw 0x4c
1963   3410           00371         retlw 0x10
1964   3405           00372         retlw 0x05
1965   3434           00373         retlw 0x34
1966   3424           00374         retlw 0x24
1967   34C0           00375         retlw 0xc0
1968   3410           00376         retlw 0x10
1969   343F           00377         retlw 0x3f
196A   3424           00378         retlw 0x24
196B   3400           00379         retlw 0x00
196C   3405           00380         retlw 0x05
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 142


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

196D   343C           00381         retlw 0x3c
196E   3424           00382         retlw 0x24
196F   34C0           00383         retlw 0xc0
1970   3404           00384         retlw 0x04
1971   3400           00385         retlw 0x00
1972   3400           00386         retlw 0x00
1973   34E0           00387         retlw 0xe0
1974   3404           00388         retlw 0x04
1975   3400           00389         retlw 0x00
1976   34D0           00390         retlw 0xd0
1977   34E0           00391         retlw 0xe0
1978   3470           00392         retlw 0x70
1979   3438           00393         retlw 0x38
197A   34CC           00394         retlw 0xcc 
197B   3413           00395         retlw 0x13
197C   3404           00396         retlw 0x04
197D   3400           00397         retlw 0x00
197E   3400           00398         retlw 0x00
197F   34E2           00399         retlw 0xe2
1980   3410           00400         retlw 0x10
1981   3428           00401         retlw 0x28
1982   3400           00402         retlw 0x00
1983   34C4           00403         retlw 0xc4
1984   3413           00404         retlw 0x13
1985   3430           00405         retlw 0x30
1986   3424           00406         retlw 0x24
1987   3400           00407         retlw 0x00
1988   3470           00408         retlw 0x70
1989   3430           00409         retlw 0x30
198A   3424           00410         retlw 0x24
198B   3400           00411         retlw 0x00
198C   3480           00412         retlw 0x80
198D   3440           00413         retlw 0x40
198E   344C           00414         retlw 0x4c
198F   3400           00415         retlw 0x00
1990   3404           00416         retlw 0x04
1991   3400           00417         retlw 0x00
1992   3400           00418         retlw 0x00
1993   34E0           00419         retlw 0xe0
1994   3410           00420         retlw 0x10
1995   3428           00421         retlw 0x28
1996   3445           00422         retlw 0x45
1997   349B           00423         retlw 0x9b
1998   3400           00424         retlw 0x00
1999   3400           00425         retlw 0x00
199A   3424           00426         retlw 0x24
199B   3400           00427         retlw 0x00
199C   3400           00428         retlw 0x00
199D   3430           00429         retlw 0x30
199E   3424           00430         retlw 0x24
199F   3400           00431         retlw 0x00
19A0   3480           00432         retlw 0x80
19A1   3440           00433         retlw 0x40
19A2   3424           00434         retlw 0x24
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 143


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

19A3   3400           00435         retlw 0x00
19A4   3400           00436         retlw 0x00
19A5   3400           00437         retlw 0x00
19A6   3424           00438         retlw 0x24
19A7   3400           00439         retlw 0x00
19A8   3410           00440         retlw 0x10
19A9   3428           00441         retlw 0x28
19AA   3495           00442         retlw 0x95
19AB   349C           00443         retlw 0x9c
19AC   3490           00444         retlw 0x90
19AD   3444           00445         retlw 0x44
19AE   3424           00446         retlw 0x24
19AF   3400           00447         retlw 0x00
19B0   3404           00448         retlw 0x04
19B1   3400           00449         retlw 0x00
19B2   3400           00450         retlw 0x00
19B3   34E0           00451         retlw 0xe0
19B4   3404           00452         retlw 0x04
19B5   3400           00453         retlw 0x00
19B6   34D0           00454         retlw 0xd0
19B7   34E0           00455         retlw 0xe0
19B8   3470           00456         retlw 0x70
19B9   3438           00457         retlw 0x38
19BA   3424           00458         retlw 0x24
19BB   3400           00459         retlw 0x00
19BC   3404           00460         retlw 0x04
19BD   3400           00461         retlw 0x00
19BE   3400           00462         retlw 0x00
19BF   34E2           00463         retlw 0xe2
19C0   3413           00464         retlw 0x13
19C1   3430           00465         retlw 0x30
19C2   3424           00466         retlw 0x24
19C3   3400           00467         retlw 0x00
19C4   3490           00468         retlw 0x90
19C5   3444           00469         retlw 0x44
19C6   3400           00470         retlw 0x00
19C7   3420           00471         retlw 0x20
19C8   3400           00472         retlw 0x00
19C9   3400           00473         retlw 0x00
19CA   3480           00474         retlw 0x80
19CB   3400           00475         retlw 0x00
19CC   3410           00476         retlw 0x10
19CD   3428           00477         retlw 0x28
19CE   3495           00478         retlw 0x95
19CF   349F           00479         retlw 0x9f
19D0   3401           00480         retlw 0x01
19D1   3400           00481         retlw 0x00
19D2   3410           00482         retlw 0x10
19D3   34E0           00483         retlw 0xe0
19D4   3410           00484         retlw 0x10
19D5   3400           00485         retlw 0x00
19D6   3480           00486         retlw 0x80
19D7   34A2           00487         retlw 0xa2
19D8   3409           00488         retlw 0x09
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 144


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

19D9   3430           00489         retlw 0x30
19DA   3440           00490         retlw 0x40
19DB   3420           00491         retlw 0x20
19DC   340F           00492         retlw 0x0f 
19DD   3400           00493         retlw 0x00
19DE   3400           00494         retlw 0x00
19DF   347C           00495         retlw 0x7c
19E0   3409           00496         retlw 0x09
19E1   3430           00497         retlw 0x30
19E2   3440           00498         retlw 0x40
19E3   3420           00499         retlw 0x20
19E4   3420           00500         retlw 0x20
19E5   3400           00501         retlw 0x00
19E6   3400           00502         retlw 0x00
19E7   3400           00503         retlw 0x00
19E8   3409           00504         retlw 0x09
19E9   3430           00505         retlw 0x30
19EA   3440           00506         retlw 0x40
19EB   3420           00507         retlw 0x20
19EC   3407           00508         retlw 0x07
19ED   3400           00509         retlw 0x00
19EE   3400           00510         retlw 0x00
19EF   34E0           00511         retlw 0xe0
19F0   3410           00512         retlw 0x10
19F1   3428           00513         retlw 0x28
19F2   3400           00514         retlw 0x00
19F3   34C2           00515         retlw 0xc2
19F4   3409           00516         retlw 0x09
19F5   3430           00517         retlw 0x30
19F6   3400           00518         retlw 0x00
19F7   3420           00519         retlw 0x20
19F8   3400           00520         retlw 0x00
19F9   3464           00521         retlw 0x64
19FA   3424           00522         retlw 0x24
19FB   3400           00523         retlw 0x00
19FC   3400           00524         retlw 0x00
19FD   3400           00525         retlw 0x00
19FE   34C0           00526         retlw 0xc0
19FF   3400           00527         retlw 0x00
1A00   3410           00528         retlw 0x10
1A01   3428           00529         retlw 0x28
1A02   34D5           00530         retlw 0xd5
1A03   34A2           00531         retlw 0xa2
1A04   3400           00532         retlw 0x00
1A05   3400           00533         retlw 0x00
1A06   3424           00534         retlw 0x24
1A07   3400           00535         retlw 0x00
1A08   340E           00536         retlw 0x0e 
1A09   3400           00537         retlw 0x00
1A0A   3440           00538         retlw 0x40
1A0B   3491           00539         retlw 0x91
1A0C   3409           00540         retlw 0x09
1A0D   3430           00541         retlw 0x30
1A0E   3440           00542         retlw 0x40
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 145


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1A0F   3420           00543         retlw 0x20
1A10   3411           00544         retlw 0x11
1A11   3400           00545         retlw 0x00
1A12   3440           00546         retlw 0x40
1A13   3497           00547         retlw 0x97
1A14   3409           00548         retlw 0x09
1A15   3430           00549         retlw 0x30
1A16   3440           00550         retlw 0x40
1A17   3420           00551         retlw 0x20
1A18   3420           00552         retlw 0x20
1A19   3400           00553         retlw 0x00
1A1A   3400           00554         retlw 0x00
1A1B   3400           00555         retlw 0x00
1A1C   3409           00556         retlw 0x09
1A1D   3430           00557         retlw 0x30
1A1E   3440           00558         retlw 0x40
1A1F   3420           00559         retlw 0x20
1A20   3407           00560         retlw 0x07
1A21   3400           00561         retlw 0x00
1A22   3400           00562         retlw 0x00
1A23   34D7           00563         retlw 0xd7
1A24   3410           00564         retlw 0x10
1A25   3428           00565         retlw 0x28
1A26   3400           00566         retlw 0x00
1A27   34C2           00567         retlw 0xc2
1A28   3409           00568         retlw 0x09
1A29   3430           00569         retlw 0x30
1A2A   3400           00570         retlw 0x00
1A2B   3420           00571         retlw 0x20
1A2C   3400           00572         retlw 0x00
1A2D   3464           00573         retlw 0x64
1A2E   3424           00574         retlw 0x24
1A2F   3400           00575         retlw 0x00
1A30   3400           00576         retlw 0x00
1A31   3400           00577         retlw 0x00
1A32   3400           00578         retlw 0x00
1A33   3401           00579         retlw 0x01
1A34   3410           00580         retlw 0x10
1A35   3428           00581         retlw 0x28
1A36   3415           00582         retlw 0x15
1A37   34A6           00583         retlw 0xa6
1A38   3400           00584         retlw 0x00
1A39   3400           00585         retlw 0x00
1A3A   3424           00586         retlw 0x24
1A3B   3400           00587         retlw 0x00
1A3C   3411           00588         retlw 0x11
1A3D   3400           00589         retlw 0x00
1A3E   3440           00590         retlw 0x40
1A3F   3466           00591         retlw 0x66
1A40   3409           00592         retlw 0x09
1A41   3430           00593         retlw 0x30
1A42   3440           00594         retlw 0x40
1A43   3420           00595         retlw 0x20
1A44   340E           00596         retlw 0x0e 
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 146


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1A45   3400           00597         retlw 0x00
1A46   3440           00598         retlw 0x40
1A47   34BA           00599         retlw 0xba
1A48   3409           00600         retlw 0x09
1A49   3430           00601         retlw 0x30
1A4A   3440           00602         retlw 0x40
1A4B   3420           00603         retlw 0x20
1A4C   3420           00604         retlw 0x20
1A4D   3400           00605         retlw 0x00
1A4E   3400           00606         retlw 0x00
1A4F   3400           00607         retlw 0x00
1A50   3409           00608         retlw 0x09
1A51   3430           00609         retlw 0x30
1A52   3440           00610         retlw 0x40
1A53   3420           00611         retlw 0x20
1A54   3407           00612         retlw 0x07
1A55   3400           00613         retlw 0x00
1A56   3480           00614         retlw 0x80
1A57   34C2           00615         retlw 0xc2
1A58   3410           00616         retlw 0x10
1A59   3428           00617         retlw 0x28
1A5A   3400           00618         retlw 0x00
1A5B   34C2           00619         retlw 0xc2
1A5C   3409           00620         retlw 0x09
1A5D   3430           00621         retlw 0x30
1A5E   3400           00622         retlw 0x00
1A5F   3420           00623         retlw 0x20
1A60   3400           00624         retlw 0x00
1A61   3464           00625         retlw 0x64
1A62   3424           00626         retlw 0x24
1A63   3400           00627         retlw 0x00
1A64   3400           00628         retlw 0x00
1A65   3400           00629         retlw 0x00
1A66   3440           00630         retlw 0x40
1A67   3401           00631         retlw 0x01
1A68   3410           00632         retlw 0x10
1A69   3428           00633         retlw 0x28
1A6A   3455           00634         retlw 0x55
1A6B   34A9           00635         retlw 0xa9
1A6C   3400           00636         retlw 0x00
1A6D   3400           00637         retlw 0x00
1A6E   3424           00638         retlw 0x24
1A6F   3400           00639         retlw 0x00
1A70   3412           00640         retlw 0x12
1A71   3400           00641         retlw 0x00
1A72   3480           00642         retlw 0x80
1A73   3414           00643         retlw 0x14
1A74   3409           00644         retlw 0x09
1A75   3430           00645         retlw 0x30
1A76   3440           00646         retlw 0x40
1A77   3420           00647         retlw 0x20
1A78   340E           00648         retlw 0x0e 
1A79   3400           00649         retlw 0x00
1A7A   3400           00650         retlw 0x00
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 147


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1A7B   3429           00651         retlw 0x29
1A7C   3409           00652         retlw 0x09
1A7D   3430           00653         retlw 0x30
1A7E   3440           00654         retlw 0x40
1A7F   3420           00655         retlw 0x20
1A80   3420           00656         retlw 0x20
1A81   3400           00657         retlw 0x00
1A82   3400           00658         retlw 0x00
1A83   3400           00659         retlw 0x00
1A84   3409           00660         retlw 0x09
1A85   3430           00661         retlw 0x30
1A86   3440           00662         retlw 0x40
1A87   3420           00663         retlw 0x20
1A88   3407           00664         retlw 0x07
1A89   3400           00665         retlw 0x00
1A8A   3440           00666         retlw 0x40
1A8B   34E1           00667         retlw 0xe1
1A8C   3410           00668         retlw 0x10
1A8D   3428           00669         retlw 0x28
1A8E   3400           00670         retlw 0x00
1A8F   34C2           00671         retlw 0xc2
1A90   3409           00672         retlw 0x09
1A91   3430           00673         retlw 0x30
1A92   3400           00674         retlw 0x00
1A93   3420           00675         retlw 0x20
1A94   3400           00676         retlw 0x00
1A95   3464           00677         retlw 0x64
1A96   3424           00678         retlw 0x24
1A97   3400           00679         retlw 0x00
1A98   3400           00680         retlw 0x00
1A99   3400           00681         retlw 0x00
1A9A   3480           00682         retlw 0x80
1A9B   3401           00683         retlw 0x01
1A9C   3410           00684         retlw 0x10
1A9D   3428           00685         retlw 0x28
1A9E   3455           00686         retlw 0x55
1A9F   34AC           00687         retlw 0xac
1AA0   3400           00688         retlw 0x00
1AA1   3400           00689         retlw 0x00
1AA2   3424           00690         retlw 0x24
1AA3   3400           00691         retlw 0x00
1AA4   3410           00692         retlw 0x10
1AA5   3400           00693         retlw 0x00
1AA6   3400           00694         retlw 0x00
1AA7   3400           00695         retlw 0x00
1AA8   3480           00696         retlw 0x80
1AA9   34B8           00697         retlw 0xb8
1AAA   3440           00698         retlw 0x40
1AAB   34A0           00699         retlw 0xa0
1AAC   3409           00700         retlw 0x09
1AAD   3430           00701         retlw 0x30
1AAE   3440           00702         retlw 0x40
1AAF   3420           00703         retlw 0x20
1AB0   3438           00704         retlw 0x38
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 148


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1AB1   3400           00705         retlw 0x00
1AB2   3400           00706         retlw 0x00
1AB3   3429           00707         retlw 0x29
1AB4   3409           00708         retlw 0x09
1AB5   3430           00709         retlw 0x30
1AB6   3440           00710         retlw 0x40
1AB7   3420           00711         retlw 0x20
1AB8   3438           00712         retlw 0x38
1AB9   3400           00713         retlw 0x00
1ABA   3480           00714         retlw 0x80
1ABB   3410           00715         retlw 0x10
1ABC   3410           00716         retlw 0x10
1ABD   3428           00717         retlw 0x28
1ABE   3400           00718         retlw 0x00
1ABF   34C2           00719         retlw 0xc2
1AC0   3409           00720         retlw 0x09
1AC1   3430           00721         retlw 0x30
1AC2   3400           00722         retlw 0x00
1AC3   3420           00723         retlw 0x20
1AC4   3400           00724         retlw 0x00
1AC5   3464           00725         retlw 0x64
1AC6   3424           00726         retlw 0x24
1AC7   3400           00727         retlw 0x00
1AC8   3400           00728         retlw 0x00
1AC9   3400           00729         retlw 0x00
1ACA   34C0           00730         retlw 0xc0
1ACB   3401           00731         retlw 0x01
1ACC   3410           00732         retlw 0x10
1ACD   3428           00733         retlw 0x28
1ACE   3495           00734         retlw 0x95
1ACF   34AF           00735         retlw 0xaf
1AD0   3400           00736         retlw 0x00
1AD1   3400           00737         retlw 0x00
1AD2   3424           00738         retlw 0x24
1AD3   3400           00739         retlw 0x00
1AD4   3418           00740         retlw 0x18
1AD5   3400           00741         retlw 0x00
1AD6   3400           00742         retlw 0x00
1AD7   3400           00743         retlw 0x00
1AD8   3409           00744         retlw 0x09
1AD9   3430           00745         retlw 0x30
1ADA   3440           00746         retlw 0x40
1ADB   3420           00747         retlw 0x20
1ADC   3439           00748         retlw 0x39
1ADD   3400           00749         retlw 0x00
1ADE   3400           00750         retlw 0x00
1ADF   34FC           00751         retlw 0xfc
1AE0   3409           00752         retlw 0x09
1AE1   3430           00753         retlw 0x30
1AE2   3440           00754         retlw 0x40
1AE3   3420           00755         retlw 0x20
1AE4   3438           00756         retlw 0x38
1AE5   3400           00757         retlw 0x00
1AE6   3400           00758         retlw 0x00
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 149


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1AE7   3429           00759         retlw 0x29
1AE8   3409           00760         retlw 0x09
1AE9   3430           00761         retlw 0x30
1AEA   3440           00762         retlw 0x40
1AEB   3420           00763         retlw 0x20
1AEC   3438           00764         retlw 0x38
1AED   3400           00765         retlw 0x00
1AEE   3480           00766         retlw 0x80
1AEF   3410           00767         retlw 0x10
1AF0   3410           00768         retlw 0x10
1AF1   3428           00769         retlw 0x28
1AF2   3400           00770         retlw 0x00
1AF3   34C2           00771         retlw 0xc2
1AF4   3409           00772         retlw 0x09
1AF5   3430           00773         retlw 0x30
1AF6   3400           00774         retlw 0x00
1AF7   3420           00775         retlw 0x20
1AF8   3400           00776         retlw 0x00
1AF9   3464           00777         retlw 0x64
1AFA   3424           00778         retlw 0x24
1AFB   3400           00779         retlw 0x00
1AFC   3400           00780         retlw 0x00
1AFD   3400           00781         retlw 0x00
1AFE   3400           00782         retlw 0x00
1AFF   3402           00783         retlw 0x02
1B00   3410           00784         retlw 0x10
1B01   3428           00785         retlw 0x28
1B02   34D5           00786         retlw 0xd5
1B03   34B2           00787         retlw 0xb2
1B04   3401           00788         retlw 0x01
1B05   3400           00789         retlw 0x00
1B06   3410           00790         retlw 0x10
1B07   34E0           00791         retlw 0xe0
1B08   3415           00792         retlw 0x15
1B09   3400           00793         retlw 0x00
1B0A   3400           00794         retlw 0x00
1B0B   3458           00795         retlw 0x58
1B0C   3409           00796         retlw 0x09
1B0D   3430           00797         retlw 0x30
1B0E   3440           00798         retlw 0x40
1B0F   3420           00799         retlw 0x20
1B10   3438           00800         retlw 0x38
1B11   3400           00801         retlw 0x00
1B12   34C0           00802         retlw 0xc0
1B13   3488           00803         retlw 0x88
1B14   3409           00804         retlw 0x09
1B15   3430           00805         retlw 0x30
1B16   3440           00806         retlw 0x40
1B17   3420           00807         retlw 0x20
1B18   3438           00808         retlw 0x38
1B19   3400           00809         retlw 0x00
1B1A   3440           00810         retlw 0x40
1B1B   3433           00811         retlw 0x33
1B1C   3409           00812         retlw 0x09
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 150


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1B1D   3430           00813         retlw 0x30
1B1E   3440           00814         retlw 0x40
1B1F   3420           00815         retlw 0x20
1B20   3438           00816         retlw 0x38
1B21   3400           00817         retlw 0x00
1B22   3480           00818         retlw 0x80
1B23   3410           00819         retlw 0x10
1B24   3410           00820         retlw 0x10
1B25   3428           00821         retlw 0x28
1B26   3400           00822         retlw 0x00
1B27   34C2           00823         retlw 0xc2
1B28   3409           00824         retlw 0x09
1B29   3430           00825         retlw 0x30
1B2A   3400           00826         retlw 0x00
1B2B   3420           00827         retlw 0x20
1B2C   3400           00828         retlw 0x00
1B2D   3464           00829         retlw 0x64
1B2E   3424           00830         retlw 0x24
1B2F   3400           00831         retlw 0x00
1B30   3400           00832         retlw 0x00
1B31   3400           00833         retlw 0x00
1B32   3440           00834         retlw 0x40
1B33   3402           00835         retlw 0x02
1B34   3410           00836         retlw 0x10
1B35   3428           00837         retlw 0x28
1B36   3415           00838         retlw 0x15
1B37   34B6           00839         retlw 0xb6
1B38   3400           00840         retlw 0x00
1B39   3400           00841         retlw 0x00
1B3A   3424           00842         retlw 0x24
1B3B   3400           00843         retlw 0x00
1B3C   3419           00844         retlw 0x19
1B3D   3400           00845         retlw 0x00
1B3E   3400           00846         retlw 0x00
1B3F   34D3           00847         retlw 0xd3
1B40   3409           00848         retlw 0x09
1B41   3430           00849         retlw 0x30
1B42   3440           00850         retlw 0x40
1B43   3420           00851         retlw 0x20
1B44   3406           00852         retlw 0x06
1B45   3400           00853         retlw 0x00
1B46   3400           00854         retlw 0x00
1B47   342D           00855         retlw 0x2d
1B48   3409           00856         retlw 0x09
1B49   3430           00857         retlw 0x30
1B4A   3440           00858         retlw 0x40
1B4B   3420           00859         retlw 0x20
1B4C   3438           00860         retlw 0x38
1B4D   3400           00861         retlw 0x00
1B4E   3440           00862         retlw 0x40
1B4F   3408           00863         retlw 0x08
1B50   3409           00864         retlw 0x09
1B51   3430           00865         retlw 0x30
1B52   3440           00866         retlw 0x40
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 151


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1B53   3420           00867         retlw 0x20
1B54   3438           00868         retlw 0x38
1B55   3400           00869         retlw 0x00
1B56   3480           00870         retlw 0x80
1B57   3410           00871         retlw 0x10
1B58   3410           00872         retlw 0x10
1B59   3428           00873         retlw 0x28
1B5A   3400           00874         retlw 0x00
1B5B   34C2           00875         retlw 0xc2
1B5C   3409           00876         retlw 0x09
1B5D   3430           00877         retlw 0x30
1B5E   3400           00878         retlw 0x00
1B5F   3420           00879         retlw 0x20
1B60   3400           00880         retlw 0x00
1B61   3464           00881         retlw 0x64
1B62   3424           00882         retlw 0x24
1B63   3400           00883         retlw 0x00
1B64   3400           00884         retlw 0x00
1B65   3400           00885         retlw 0x00
1B66   3480           00886         retlw 0x80
1B67   3402           00887         retlw 0x02
1B68   3410           00888         retlw 0x10
1B69   3428           00889         retlw 0x28
1B6A   3415           00890         retlw 0x15
1B6B   34B9           00891         retlw 0xb9
1B6C   3400           00892         retlw 0x00
1B6D   3400           00893         retlw 0x00
1B6E   3424           00894         retlw 0x24
1B6F   3400           00895         retlw 0x00
1B70   3410           00896         retlw 0x10
1B71   3400           00897         retlw 0x00
1B72   3400           00898         retlw 0x00
1B73   3400           00899         retlw 0x00
1B74   3480           00900         retlw 0x80
1B75   34B8           00901         retlw 0xb8
1B76   3440           00902         retlw 0x40
1B77   34A0           00903         retlw 0xa0
1B78   3409           00904         retlw 0x09
1B79   3430           00905         retlw 0x30
1B7A   3440           00906         retlw 0x40
1B7B   3420           00907         retlw 0x20
1B7C   3438           00908         retlw 0x38
1B7D   3400           00909         retlw 0x00
1B7E   3480           00910         retlw 0x80
1B7F   3466           00911         retlw 0x66
1B80   3409           00912         retlw 0x09
1B81   3430           00913         retlw 0x30
1B82   3440           00914         retlw 0x40
1B83   3420           00915         retlw 0x20
1B84   3438           00916         retlw 0x38
1B85   3400           00917         retlw 0x00
1B86   3400           00918         retlw 0x00
1B87   3429           00919         retlw 0x29
1B88   3410           00920         retlw 0x10
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 152


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1B89   3428           00921         retlw 0x28
1B8A   3400           00922         retlw 0x00
1B8B   34C2           00923         retlw 0xc2
1B8C   3409           00924         retlw 0x09
1B8D   3430           00925         retlw 0x30
1B8E   3400           00926         retlw 0x00
1B8F   3420           00927         retlw 0x20
1B90   3400           00928         retlw 0x00
1B91   3464           00929         retlw 0x64
1B92   3424           00930         retlw 0x24
1B93   3400           00931         retlw 0x00
1B94   3400           00932         retlw 0x00
1B95   3400           00933         retlw 0x00
1B96   34C0           00934         retlw 0xc0
1B97   3402           00935         retlw 0x02
1B98   3410           00936         retlw 0x10
1B99   3428           00937         retlw 0x28
1B9A   3455           00938         retlw 0x55
1B9B   34BC           00939         retlw 0xbc
1B9C   3400           00940         retlw 0x00
1B9D   3400           00941         retlw 0x00
1B9E   3424           00942         retlw 0x24
1B9F   3400           00943         retlw 0x00
1BA0   3418           00944         retlw 0x18
1BA1   3400           00945         retlw 0x00
1BA2   3400           00946         retlw 0x00
1BA3   3400           00947         retlw 0x00
1BA4   3409           00948         retlw 0x09
1BA5   3430           00949         retlw 0x30
1BA6   3440           00950         retlw 0x40
1BA7   3420           00951         retlw 0x20
1BA8   3439           00952         retlw 0x39
1BA9   3400           00953         retlw 0x00
1BAA   3400           00954         retlw 0x00
1BAB   34FC           00955         retlw 0xfc
1BAC   3409           00956         retlw 0x09
1BAD   3430           00957         retlw 0x30
1BAE   3440           00958         retlw 0x40
1BAF   3420           00959         retlw 0x20
1BB0   3438           00960         retlw 0x38
1BB1   3400           00961         retlw 0x00
1BB2   3400           00962         retlw 0x00
1BB3   347B           00963         retlw 0x7b
1BB4   3409           00964         retlw 0x09
1BB5   3430           00965         retlw 0x30
1BB6   3440           00966         retlw 0x40
1BB7   3420           00967         retlw 0x20
1BB8   3438           00968         retlw 0x38
1BB9   3400           00969         retlw 0x00
1BBA   3440           00970         retlw 0x40
1BBB   3433           00971         retlw 0x33
1BBC   3410           00972         retlw 0x10
1BBD   3428           00973         retlw 0x28
1BBE   3400           00974         retlw 0x00
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 153


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1BBF   34C2           00975         retlw 0xc2
1BC0   3409           00976         retlw 0x09
1BC1   3430           00977         retlw 0x30
1BC2   3400           00978         retlw 0x00
1BC3   3420           00979         retlw 0x20
1BC4   3400           00980         retlw 0x00
1BC5   3464           00981         retlw 0x64
1BC6   3424           00982         retlw 0x24
1BC7   3400           00983         retlw 0x00
1BC8   3400           00984         retlw 0x00
1BC9   3400           00985         retlw 0x00
1BCA   3400           00986         retlw 0x00
1BCB   3403           00987         retlw 0x03
1BCC   3410           00988         retlw 0x10
1BCD   3428           00989         retlw 0x28
1BCE   3495           00990         retlw 0x95
1BCF   34BF           00991         retlw 0xbf
1BD0   3400           00992         retlw 0x00
1BD1   3400           00993         retlw 0x00
1BD2   3424           00994         retlw 0x24
1BD3   3400           00995         retlw 0x00
1BD4   3415           00996         retlw 0x15
1BD5   3400           00997         retlw 0x00
1BD6   3400           00998         retlw 0x00
1BD7   3458           00999         retlw 0x58
1BD8   3409           01000         retlw 0x09
1BD9   3430           01001         retlw 0x30
1BDA   3440           01002         retlw 0x40
1BDB   3420           01003         retlw 0x20
1BDC   3438           01004         retlw 0x38
1BDD   3400           01005         retlw 0x00
1BDE   34C0           01006         retlw 0xc0
1BDF   3488           01007         retlw 0x88
1BE0   3409           01008         retlw 0x09
1BE1   3430           01009         retlw 0x30
1BE2   3440           01010         retlw 0x40
1BE3   3420           01011         retlw 0x20
1BE4   3438           01012         retlw 0x38
1BE5   3400           01013         retlw 0x00
1BE6   3480           01014         retlw 0x80
1BE7   3466           01015         retlw 0x66
1BE8   3409           01016         retlw 0x09
1BE9   3430           01017         retlw 0x30
1BEA   3440           01018         retlw 0x40
1BEB   3420           01019         retlw 0x20
1BEC   3438           01020         retlw 0x38
1BED   3400           01021         retlw 0x00
1BEE   34C0           01022         retlw 0xc0
1BEF   3424           01023         retlw 0x24
1BF0   3410           01024         retlw 0x10
1BF1   3428           01025         retlw 0x28
1BF2   3400           01026         retlw 0x00
1BF3   34C2           01027         retlw 0xc2
1BF4   3409           01028         retlw 0x09
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 154


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1BF5   3430           01029         retlw 0x30
1BF6   3400           01030         retlw 0x00
1BF7   3420           01031         retlw 0x20
1BF8   3400           01032         retlw 0x00
1BF9   3464           01033         retlw 0x64
1BFA   3424           01034         retlw 0x24
1BFB   3400           01035         retlw 0x00
1BFC   3410           01036         retlw 0x10
1BFD   3400           01037         retlw 0x00
1BFE   3400           01038         retlw 0x00
1BFF   3400           01039         retlw 0x00
1C00   3410           01040         retlw 0x10
1C01   3428           01041         retlw 0x28
1C02   3415           01042         retlw 0x15
1C03   34C2           01043         retlw 0xc2
1C04   3400           01044         retlw 0x00
1C05   3400           01045         retlw 0x00
1C06   3424           01046         retlw 0x24
1C07   3400           01047         retlw 0x00
1C08   3409           01048         retlw 0x09
1C09   3430           01049         retlw 0x30
1C0A   3440           01050         retlw 0x40
1C0B   3420           01051         retlw 0x20
1C0C   3409           01052         retlw 0x09
1C0D   3430           01053         retlw 0x30
1C0E   3440           01054         retlw 0x40
1C0F   3420           01055         retlw 0x20
1C10   3438           01056         retlw 0x38
1C11   3400           01057         retlw 0x00
1C12   3480           01058         retlw 0x80
1C13   3414           01059         retlw 0x14
1C14   3409           01060         retlw 0x09
1C15   3430           01061         retlw 0x30
1C16   3440           01062         retlw 0x40
1C17   3420           01063         retlw 0x20
1C18   3438           01064         retlw 0x38
1C19   3400           01065         retlw 0x00
1C1A   3400           01066         retlw 0x00
1C1B   3452           01067         retlw 0x52
1C1C   3409           01068         retlw 0x09
1C1D   3430           01069         retlw 0x30
1C1E   3400           01070         retlw 0x00
1C1F   3420           01071         retlw 0x20
1C20   3401           01072         retlw 0x01
1C21   3400           01073         retlw 0x00
1C22   3410           01074         retlw 0x10
1C23   34E1           01075         retlw 0xe1
1C24   3400           01076         retlw 0x00
1C25   3400           01077         retlw 0x00
1C26   3400           01078         retlw 0x00
1C27   3400           01079         retlw 0x00
1C28   3400           01080         retlw 0x00
1C29   3400           01081         retlw 0x00
1C2A   3401           01082         retlw 0x01
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 155


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1C2B   3401           01083         retlw 0x01
1C2C   3412           01084         retlw 0x12
1C2D   3464           01085         retlw 0x64
1C2E   3400           01086         retlw 0x00
1C2F   34A0           01087         retlw 0xa0
1C30   3400           01088         retlw 0x00
1C31   3400           01089         retlw 0x00
1C32   3440           01090         retlw 0x40
1C33   3400           01091         retlw 0x00
1C34   3410           01092         retlw 0x10
1C35   3428           01093         retlw 0x28
1C36   3419           01094         retlw 0x19
1C37   34C4           01095         retlw 0xc4
1C38   3404           01096         retlw 0x04
1C39   3400           01097         retlw 0x00
1C3A   3490           01098         retlw 0x90
1C3B   34E5           01099         retlw 0xe5
1C3C   3490           01100         retlw 0x90
1C3D   3440           01101         retlw 0x40
1C3E   3424           01102         retlw 0x24
1C3F   3400           01103         retlw 0x00
1C40   3400           01104         retlw 0x00
1C41   3438           01105         retlw 0x38
1C42   3424           01106         retlw 0x24
1C43   3400           01107         retlw 0x00
1C44   34F3           01108         retlw 0xf3
1C45   3436           01109         retlw 0x36
1C46   3424           01110         retlw 0x24
1C47   3440           01111         retlw 0x40
1C48   34F3           01112         retlw 0xf3
1C49   3436           01113         retlw 0x36
1C4A   340E           01114         retlw 0x0e 
1C4B   34D8           01115         retlw 0xd8
1C4C   34F1           01116         retlw 0xf1
1C4D   3436           01117         retlw 0x36
1C4E   3410           01118         retlw 0x10
1C4F   3458           01119         retlw 0x58
1C50   34F0           01120         retlw 0xf0
1C51   3436           01121         retlw 0x36
1C52   3401           01122         retlw 0x01
1C53   3418           01123         retlw 0x18
1C54   3405           01124         retlw 0x05
1C55   3434           01125         retlw 0x34
1C56   3414           01126         retlw 0x14
1C57   3490           01127         retlw 0x90
1C58   34E3           01128         retlw 0xe3
1C59   3436           01129         retlw 0x36
1C5A   3424           01130         retlw 0x24
1C5B   3400           01131         retlw 0x00
1C5C   3400           01132         retlw 0x00
1C5D   3420           01133         retlw 0x20
1C5E   3400           01134         retlw 0x00
1C5F   3400           01135         retlw 0x00
1C60   34F2           01136         retlw 0xf2
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 156


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1C61   3436           01137         retlw 0x36
1C62   3415           01138         retlw 0x15
1C63   3498           01139         retlw 0x98
1C64   3412           01140         retlw 0x12
1C65   343E           01141         retlw 0x3e
1C66   3417           01142         retlw 0x17
1C67   34B8           01143         retlw 0xb8
1C68   3412           01144         retlw 0x12
1C69   343E           01145         retlw 0x3e
1C6A   3415           01146         retlw 0x15
1C6B   3438           01147         retlw 0x38
1C6C   3414           01148         retlw 0x14
1C6D   343E           01149         retlw 0x3e
1C6E   3411           01150         retlw 0x11
1C6F   3438           01151         retlw 0x38
1C70   3414           01152         retlw 0x14
1C71   343E           01153         retlw 0x3e
1C72   3413           01154         retlw 0x13
1C73   34B8           01155         retlw 0xb8
1C74   3415           01156         retlw 0x15
1C75   343E           01157         retlw 0x3e
1C76   340D           01158         retlw 0x0d 
1C77   3438           01159         retlw 0x38
1C78   3410           01160         retlw 0x10
1C79   343E           01161         retlw 0x3e
1C7A   3401           01162         retlw 0x01
1C7B   3438           01163         retlw 0x38
1C7C   3410           01164         retlw 0x10
1C7D   343E           01165         retlw 0x3e
1C7E   3403           01166         retlw 0x03
1C7F   34B8           01167         retlw 0xb8
1C80   3411           01168         retlw 0x11
1C81   343E           01169         retlw 0x3e
1C82   3405           01170         retlw 0x05
1C83   3438           01171         retlw 0x38
1C84   3411           01172         retlw 0x11
1C85   343E           01173         retlw 0x3e
1C86   3407           01174         retlw 0x07
1C87   34B8           01175         retlw 0xb8
1C88   3403           01176         retlw 0x03
1C89   343E           01177         retlw 0x3e
1C8A   340E           01178         retlw 0x0e 
1C8B   34F8           01179         retlw 0xf8
1C8C   3400           01180         retlw 0x00
1C8D   34F4           01181         retlw 0xf4
1C8E   3497           01182         retlw 0x97
1C8F   3444           01183         retlw 0x44
1C90   3400           01184         retlw 0x00
1C91   3400           01185         retlw 0x00
1C92   340A           01186         retlw 0x0a 
1C93   3400           01187         retlw 0x00
1C94   3433           01188         retlw 0x33
1C95   3437           01189         retlw 0x37
1C96   3424           01190         retlw 0x24
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 157


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1C97   3400           01191         retlw 0x00
1C98   3424           01192         retlw 0x24
1C99   3437           01193         retlw 0x37
1C9A   3424           01194         retlw 0x24
1C9B   3480           01195         retlw 0x80
1C9C   3401           01196         retlw 0x01
1C9D   3400           01197         retlw 0x00
1C9E   3414           01198         retlw 0x14
1C9F   34E0           01199         retlw 0xe0
1CA0   3420           01200         retlw 0x20
1CA1   3400           01201         retlw 0x00
1CA2   3415           01202         retlw 0x15
1CA3   3401           01203         retlw 0x01
1CA4   3490           01204         retlw 0x90
1CA5   3440           01205         retlw 0x40
1CA6   34C5           01206         retlw 0xc5
1CA7   341F           01207         retlw 0x1f
1CA8   3410           01208         retlw 0x10
1CA9   3424           01209         retlw 0x24
1CAA   3440           01210         retlw 0x40
1CAB   34D0           01211         retlw 0xd0
1CAC   3420           01212         retlw 0x20
1CAD   3400           01213         retlw 0x00
1CAE   3493           01214         retlw 0x93
1CAF   3400           01215         retlw 0x00
1CB0   348E           01216         retlw 0x8e 
1CB1   34BF           01217         retlw 0xbf
1CB2   3404           01218         retlw 0x04
1CB3   3400           01219         retlw 0x00
1CB4   3448           01220         retlw 0x48
1CB5   34F1           01221         retlw 0xf1
1CB6   3424           01222         retlw 0x24
1CB7   3400           01223         retlw 0x00
1CB8   3487           01224         retlw 0x87
1CB9   34BD           01225         retlw 0xbd
1CBA   3448           01226         retlw 0x48
1CBB   34AC           01227         retlw 0xac
1CBC   3409           01228         retlw 0x09
1CBD   34FE           01229         retlw 0xfe
1CBE   3449           01230         retlw 0x49
1CBF   3428           01231         retlw 0x28
1CC0   3407           01232         retlw 0x07
1CC1   3452           01233         retlw 0x52
1CC2   3448           01234         retlw 0x48
1CC3   3429           01235         retlw 0x29
1CC4   3407           01236         retlw 0x07
1CC5   3452           01237         retlw 0x52
1CC6   344C           01238         retlw 0x4c
1CC7   3429           01239         retlw 0x29
1CC8   34D6           01240         retlw 0xd6
1CC9   3458           01241         retlw 0x58
1CCA   3485           01242         retlw 0x85
1CCB   341C           01243         retlw 0x1c
1CCC   34DE           01244         retlw 0xde 
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 158


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1CCD   3458           01245         retlw 0x58
1CCE   3445           01246         retlw 0x45
1CCF   341C           01247         retlw 0x1c
1CD0   34BE           01248         retlw 0xbe 
1CD1   3446           01249         retlw 0x46
1CD2   3462           01250         retlw 0x62
1CD3   341F           01251         retlw 0x1f
1CD4   34D2           01252         retlw 0xd2
1CD5   344F           01253         retlw 0x4f
1CD6   3404           01254         retlw 0x04
1CD7   3492           01255         retlw 0x92
1CD8   34C2           01256         retlw 0xc2
1CD9   344C           01257         retlw 0x4c
1CDA   3424           01258         retlw 0x24
1CDB   3400           01259         retlw 0x00
1CDC   34C6           01260         retlw 0xc6
1CDD   344C           01261         retlw 0x4c
1CDE   3424           01262         retlw 0x24
1CDF   3400           01263         retlw 0x00
1CE0   34EA           01264         retlw 0xea 
1CE1   34F1           01265         retlw 0xf1
1CE2   3443           01266         retlw 0x43
1CE3   343C           01267         retlw 0x3c
1CE4   34E2           01268         retlw 0xe2
1CE5   344D           01269         retlw 0x4d
1CE6   3421           01270         retlw 0x21
1CE7   343C           01271         retlw 0x3c
1CE8   3486           01272         retlw 0x86
1CE9   344C           01273         retlw 0x4c
1CEA   3445           01274         retlw 0x45
1CEB   341C           01275         retlw 0x1c
1CEC   3410           01276         retlw 0x10
1CED   343F           01277         retlw 0x3f
1CEE   3424           01278         retlw 0x24
1CEF   3440           01279         retlw 0x40
1CF0   3410           01280         retlw 0x10
1CF1   3428           01281         retlw 0x28
1CF2   3452           01282         retlw 0x52
1CF3   34D0           01283         retlw 0xd0
1CF4   34D8           01284         retlw 0xd8
1CF5   343F           01285         retlw 0x3f
1CF6   3424           01286         retlw 0x24
1CF7   3400           01287         retlw 0x00
1CF8   3410           01288         retlw 0x10
1CF9   3428           01289         retlw 0x28
1CFA   3454           01290         retlw 0x54
1CFB   34D0           01291         retlw 0xd0
1CFC   341F           01292         retlw 0x1f 
1CFD   3400           01293         retlw 0x00
1CFE   34C3           01294         retlw 0xc3
1CFF   34FF           01295         retlw 0xff
1D00   34E0           01296         retlw 0xe0
1D01   340F           01297         retlw 0x0f
1D02   3403           01298         retlw 0x03
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 159


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1D03   3400           01299         retlw 0x00
1D04   3480           01300         retlw 0x80
1D05   3438           01301         retlw 0x38
1D06   3424           01302         retlw 0x24
1D07   34C0           01303         retlw 0xc0
1D08   34F3           01304         retlw 0xf3
1D09   3437           01305         retlw 0x37
1D0A   3424           01306         retlw 0x24
1D0B   3400           01307         retlw 0x00
1D0C   3404           01308         retlw 0x04
1D0D   343F           01309         retlw 0x3f
1D0E   3424           01310         retlw 0x24
1D0F   3480           01311         retlw 0x80
1D10   34F3           01312         retlw 0xf3
1D11   3436           01313         retlw 0x36
1D12   340E           01314         retlw 0x0e 
1D13   34D8           01315         retlw 0xd8
1D14   34F1           01316         retlw 0xf1
1D15   3436           01317         retlw 0x36
1D16   3407           01318         retlw 0x07
1D17   3498           01319         retlw 0x98
1D18   34F1           01320         retlw 0xf1
1D19   3436           01321         retlw 0x36
1D1A   3405           01322         retlw 0x05
1D1B   3418           01323         retlw 0x18
1D1C   34F0           01324         retlw 0xf0
1D1D   3436           01325         retlw 0x36
1D1E   3403           01326         retlw 0x03
1D1F   3498           01327         retlw 0x98
1D20   34F0           01328         retlw 0xf0
1D21   3436           01329         retlw 0x36
1D22   3401           01330         retlw 0x01
1D23   3418           01331         retlw 0x18
1D24   34F5           01332         retlw 0xf5
1D25   3436           01333         retlw 0x36
1D26   340D           01334         retlw 0x0d 
1D27   3418           01335         retlw 0x18
1D28   34F4           01336         retlw 0xf4
1D29   3436           01337         retlw 0x36
1D2A   3413           01338         retlw 0x13
1D2B   3498           01339         retlw 0x98
1D2C   34F4           01340         retlw 0xf4
1D2D   3436           01341         retlw 0x36
1D2E   3411           01342         retlw 0x11
1D2F   3418           01343         retlw 0x18
1D30   34F2           01344         retlw 0xf2
1D31   3436           01345         retlw 0x36
1D32   3415           01346         retlw 0x15
1D33   3418           01347         retlw 0x18
1D34   3400           01348         retlw 0x00
1D35   3420           01349         retlw 0x20
1D36   3400           01350         retlw 0x00
1D37   3400           01351         retlw 0x00
1D38   34F2           01352         retlw 0xf2
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 160


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1D39   3436           01353         retlw 0x36
1D3A   3417           01354         retlw 0x17
1D3B   3498           01355         retlw 0x98
1D3C   3412           01356         retlw 0x12
1D3D   343E           01357         retlw 0x3e
1D3E   3417           01358         retlw 0x17
1D3F   34B8           01359         retlw 0xb8
1D40   3412           01360         retlw 0x12
1D41   343E           01361         retlw 0x3e
1D42   3415           01362         retlw 0x15
1D43   3438           01363         retlw 0x38
1D44   3414           01364         retlw 0x14
1D45   343E           01365         retlw 0x3e
1D46   3411           01366         retlw 0x11
1D47   3438           01367         retlw 0x38
1D48   3414           01368         retlw 0x14
1D49   343E           01369         retlw 0x3e
1D4A   3413           01370         retlw 0x13
1D4B   34B8           01371         retlw 0xb8
1D4C   3415           01372         retlw 0x15
1D4D   343E           01373         retlw 0x3e
1D4E   340D           01374         retlw 0x0d 
1D4F   3438           01375         retlw 0x38
1D50   3410           01376         retlw 0x10
1D51   343E           01377         retlw 0x3e
1D52   3401           01378         retlw 0x01
1D53   3438           01379         retlw 0x38
1D54   3410           01380         retlw 0x10
1D55   343E           01381         retlw 0x3e
1D56   3403           01382         retlw 0x03
1D57   34B8           01383         retlw 0xb8
1D58   3411           01384         retlw 0x11
1D59   343E           01385         retlw 0x3e
1D5A   3405           01386         retlw 0x05
1D5B   3438           01387         retlw 0x38
1D5C   3411           01388         retlw 0x11
1D5D   343E           01389         retlw 0x3e
1D5E   3407           01390         retlw 0x07
1D5F   34B8           01391         retlw 0xb8
1D60   3413           01392         retlw 0x13
1D61   343E           01393         retlw 0x3e
1D62   340E           01394         retlw 0x0e 
1D63   34F8           01395         retlw 0xf8
1D64   3486           01396         retlw 0x86
1D65   34BD           01397         retlw 0xbd
1D66   3497           01398         retlw 0x97
1D67   3444           01399         retlw 0x44
1D68   3409           01400         retlw 0x09
1D69   3430           01401         retlw 0x30
1D6A   340C           01402         retlw 0x0c 
1D6B   341D           01403         retlw 0x1d
1D6C   3401           01404         retlw 0x01
1D6D   3400           01405         retlw 0x00
1D6E   3414           01406         retlw 0x14
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 161


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1D6F   34E0           01407         retlw 0xe0
1D70   3420           01408         retlw 0x20
1D71   3400           01409         retlw 0x00
1D72   34D5           01410         retlw 0xd5
1D73   3400           01411         retlw 0x00
1D74   3491           01412         retlw 0x91
1D75   3440           01413         retlw 0x40
1D76   34E2           01414         retlw 0xe2
1D77   34E2           01415         retlw 0xe2
1D78   3411           01416         retlw 0x11
1D79   3437           01417         retlw 0x37
1D7A   3424           01418         retlw 0x24
1D7B   3440           01419         retlw 0x40
1D7C   3410           01420         retlw 0x10
1D7D   3424           01421         retlw 0x24
1D7E   34C0           01422         retlw 0xc0
1D7F   34DD           01423         retlw 0xdd
1D80   34F8           01424         retlw 0xf8
1D81   3437           01425         retlw 0x37
1D82   340A           01426         retlw 0x0a 
1D83   3498           01427         retlw 0x98
1D84   3489           01428         retlw 0x89
1D85   3445           01429         retlw 0x45
1D86   3448           01430         retlw 0x48
1D87   3406           01431         retlw 0x06
1D88   340D           01432         retlw 0x0d 
1D89   34FE           01433         retlw 0xfe
1D8A   3448           01434         retlw 0x48
1D8B   3421           01435         retlw 0x21
1D8C   3417           01436         retlw 0x17
1D8D   3450           01437         retlw 0x50
1D8E   3448           01438         retlw 0x48
1D8F   34A6           01439         retlw 0xa6
1D90   34B6           01440         retlw 0xb6
1D91   344D           01441         retlw 0x4d
1D92   3485           01442         retlw 0x85
1D93   3448           01443         retlw 0x48
1D94   3484           01444         retlw 0x84
1D95   3443           01445         retlw 0x43
1D96   3443           01446         retlw 0x43
1D97   3448           01447         retlw 0x48
1D98   3431           01448         retlw 0x31
1D99   34FE           01449         retlw 0xfe
1D9A   3466           01450         retlw 0x66
1D9B   3467           01451         retlw 0x67
1D9C   34AE           01452         retlw 0xae 
1D9D   3450           01453         retlw 0x50
1D9E   3424           01454         retlw 0x24
1D9F   3400           01455         retlw 0x00
1DA0   34BE           01456         retlw 0xbe 
1DA1   3446           01457         retlw 0x46
1DA2   3400           01458         retlw 0x00
1DA3   3492           01459         retlw 0x92
1DA4   34D7           01460         retlw 0xd7
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 162


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1DA5   344E           01461         retlw 0x4e
1DA6   3464           01462         retlw 0x64
1DA7   3465           01463         retlw 0x65
1DA8   3430           01464         retlw 0x30
1DA9   34FE           01465         retlw 0xfe
1DAA   3481           01466         retlw 0x81
1DAB   3440           01467         retlw 0x40
1DAC   34AA           01468         retlw 0xaa 
1DAD   3450           01469         retlw 0x50
1DAE   34E0           01470         retlw 0xe0
1DAF   3440           01471         retlw 0x40
1DB0   34BA           01472         retlw 0xba 
1DB1   3444           01473         retlw 0x44
1DB2   3424           01474         retlw 0x24
1DB3   3400           01475         retlw 0x00
1DB4   34EA           01476         retlw 0xea
1DB5   346F           01477         retlw 0x6f
1DB6   3424           01478         retlw 0x24
1DB7   3400           01479         retlw 0x00
1DB8   3482           01480         retlw 0x82
1DB9   344C           01481         retlw 0x4c
1DBA   3424           01482         retlw 0x24
1DBB   3400           01483         retlw 0x00
1DBC   3400           01484         retlw 0x00
1DBD   3400           01485         retlw 0x00
1DBE   3424           01486         retlw 0x24
1DBF   3400           01487         retlw 0x00
1DC0   3410           01488         retlw 0x10
1DC1   3428           01489         retlw 0x28
1DC2   34D2           01490         retlw 0xd2
1DC3   34DD           01491         retlw 0xdd
1DC4   34EB           01492         retlw 0xeb
1DC5   344E           01493         retlw 0x4e
1DC6   3462           01494         retlw 0x62
1DC7   3463           01495         retlw 0x63
1DC8   3482           01496         retlw 0x82
1DC9   344C           01497         retlw 0x4c
1DCA   3424           01498         retlw 0x24
1DCB   3400           01499         retlw 0x00
1DCC   3400           01500         retlw 0x00
1DCD   3400           01501         retlw 0x00
1DCE   3424           01502         retlw 0x24
1DCF   3400           01503         retlw 0x00
1DD0   3410           01504         retlw 0x10
1DD1   3428           01505         retlw 0x28
1DD2   34D4           01506         retlw 0xd4
1DD3   34DD           01507         retlw 0xdd
1DD4   341F           01508         retlw 0x1f 
1DD5   3400           01509         retlw 0x00
1DD6   34C1           01510         retlw 0xc1
1DD7   34FF           01511         retlw 0xff
1DD8   34E0           01512         retlw 0xe0
1DD9   340F           01513         retlw 0x0f
1DDA   3401           01514         retlw 0x01
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 163


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1DDB   3400           01515         retlw 0x00
1DDC   34EA           01516         retlw 0xea
1DDD   344E           01517         retlw 0x4e
1DDE   3401           01518         retlw 0x01
1DDF   3422           01519         retlw 0x22
1DE0   3411           01520         retlw 0x11
1DE1   343F           01521         retlw 0x3f
1DE2   3424           01522         retlw 0x24
1DE3   3440           01523         retlw 0x40
1DE4   3410           01524         retlw 0x10
1DE5   3428           01525         retlw 0x28
1DE6   3400           01526         retlw 0x00
1DE7   34D1           01527         retlw 0xd1
1DE8   34F8           01528         retlw 0xf8
1DE9   343F           01529         retlw 0x3f
1DEA   34CC           01530         retlw 0xcc
1DEB   349B           01531         retlw 0x9b
                      01532 
                      01533 
                      01534 ;-----------------------------------------------------------------------
                      01535 ;-----------------------------------------------------------------------
                      01536 ; podprogramy pro nahrani pluginu
                      01537 ;-----------------------------------------------------------------------
                      01538 ;-----------------------------------------------------------------------
                      01539 
1DEC                  01540 CTI_TABULKU
1DEC   0861           01541         movfw ZAZNAM2
1DED   008A           01542         movwf PCLATH
1DEE   0860           01543         movfw ZAZNAM1
1DEF   0082           01544         movwf PCL
                      01545 
                      01546 ;-----------------------------------------------------------------------
                      01547 
1DF0                  01548 VS_LOAD_PLUGIN          ; nahraje plugin do RAM dekodeku
1DF0   3007           01549         movlw VSADDR_WRAMADDR 
1DF1   00B6           01550         movwf TEMP1             ; do TEMP1 dame adresu registru 
1DF2   3000           01551         movlw 0x00
1DF3   00B7           01552         movwf TEMP2             ; do TEMP2 dame dolni slabiku zapisovaneho slova
1DF4   3082           01553         movlw 0x82
1DF5   00B8           01554         movwf TEMP3             ; do TEMP3 dame horni slabiku zapisovaneho slova
                      01555 
                      01556         PROG_PAGE_1
1DF6   158A               M                         bsf PCLATH,3
1DF7   120A               M                         bcf PCLATH,4
1DF8   2063           01557         call VS_WR_REG
                      01558         PROG_PAGE_3
1DF9   158A               M                         bsf PCLATH,3
1DFA   160A               M                         bsf PCLATH,4
                      01559                         ; Do VS registru WRAMADDR se nejdrive musi nahrat adresa 0x8200 pro zacatek plug
                            inu na adrese 0x4200 
                      01560                         ; (0x4200 + 0x4000 = 0x8200 vis. "6.5.8 WRAMADDR" datasheetu VS1001k)
                      01561                         ;
                      01562         ; a ted jdeme nahravat samotny plugin
                      01563         ; tabulku s pluginem mame na adrese 0x1800..0x1DEB (1516 bytes)
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 164


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1DFB   3000           01564         movlw 0x00
1DFC   00E0           01565         movwf ZAZNAM1
1DFD   3018           01566         movlw 0x18
1DFE   00E1           01567         movwf ZAZNAM2
1DFF                  01568 VS_LOAD_PLUGIN_LOAD
1DFF   3006           01569         movlw VSADDR_WRAM
1E00   00B6           01570         movwf TEMP1             ; do TEMP1 dame adresu registru 
1E01   25EC           01571         call CTI_TABULKU
1E02   00B7           01572         movwf TEMP2             ; do TEMP2 dame dolni slabiku zapisovaneho slova
1E03   0AE0           01573         incf ZAZNAM1,f
1E04   25EC           01574         call CTI_TABULKU
1E05   00B8           01575         movwf TEMP3             ; do TEMP3 dame horni slabiku zapisovaneho slova
                      01576         PROG_PAGE_1
1E06   158A               M                         bsf PCLATH,3
1E07   120A               M                         bcf PCLATH,4
1E08   2063           01577         call VS_WR_REG
                      01578         PROG_PAGE_3
1E09   158A               M                         bsf PCLATH,3
1E0A   160A               M                         bsf PCLATH,4
                      01579 
1E0B   0AE0           01580         incf ZAZNAM1,f
1E0C   1903           01581         btfsc STATUS,Z
1E0D   0AE1           01582         incf ZAZNAM2,f
                      01583 
1E0E   0861           01584         movfw ZAZNAM2
1E0F   3C1D           01585         sublw 0x1D
1E10   1D03           01586         btfss STATUS,Z 
1E11   2DFF           01587         goto VS_LOAD_PLUGIN_LOAD
                      01588 
1E12   0860           01589         movfw ZAZNAM1
1E13   3CEC           01590         sublw 0xEC
1E14   1D03           01591         btfss STATUS,Z 
1E15   2DFF           01592         goto VS_LOAD_PLUGIN_LOAD
                      01593 
1E16   01AF           01594         clrf VS_LOUDNESS
                      01595         PROG_PAGE_1
1E17   158A               M                         bsf PCLATH,3
1E18   120A               M                         bcf PCLATH,4
1E19   2094           01596         call VS_SOFT_RESET
                      01597         PROG_PAGE_3     
1E1A   158A               M                         bsf PCLATH,3
1E1B   160A               M                         bsf PCLATH,4
1E1C   0008           01598         return
                      01599 ;-----------------------------------------------------------------------
                      00092 ;**********************************************************
                      00093         END
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 165


SYMBOL TABLE
  LABEL                             VALUE 

ABRT                              00000002
ACKDT                             00000005
ACKEN                             00000004
ACKSTAT                           00000006
ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000006
ADCS1                             00000007
ADDEN                             00000003
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
APPLICABLE                        00000007
ATA_ADDRESS                       00000005
ATA_ADDRESS_TRIS                  00000085
ATA_ATTRIBUTES                    0000002E
ATA_CONTROL                       00000009
ATA_CONTROL_TRIS                  00000089
ATA_DIOR_N                        ATA_CONTROL,2
ATA_DIOW_N                        ATA_CONTROL,1
ATA_ERROR                         00000025
ATA_OK                            00000000
ATA_RESET                         000002FA
ATA_RESET_N                       ATA_CONTROL,0
ATA_STANDBY                       0000034D
ATA_STATUS                        0000002C
ATA_STATUS_A                      00000022
BANK_0                            
BANK_1                            
BANK_2                            
BANK_3                            
BCLIE                             00000003
BCLIF                             00000003
BF                                00000000
BIG_LOOP                          00000041
BIG_LOOP_DALSI_FRAGMENT           00000091
BIG_LOOP_DEC_FRAGMENT             00000097
BIG_LOOP_DEC_FRAGMENT_NO_PLUG     000000B1
BIG_LOOP__NENI_PRIKAZ             00000062
BIG_LOOP__NO_STANDBY              0000006B
BIG_SECTOR                        00000003
BRGH                              00000002
BSY                               00000007
BUF2_LOW_TO_HIGH                  00000E7C
BUF2_TO_BUF1                      00000E3E
C                                 00000000
C1INV                             00000004
C1OUT                             00000006
C2INV                             00000005
C2OUT                             00000007
CCP1CON                           00000017
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 166


SYMBOL TABLE
  LABEL                             VALUE 

CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCP2CON                           0000001D
CCP2IE                            00000000
CCP2IF                            00000000
CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCP2X                             00000005
CCP2Y                             00000004
CCPR1H                            00000016
CCPR1L                            00000015
CCPR2H                            0000001C
CCPR2L                            0000001B
CEKEJ_PRIKAZ                      00000919
CEK_PRIKAZ_01h                    00000022
CEK_PRIKAZ_02h_03h                00000034
CHS0                              00000003
CHS1                              00000004
CHS2                              00000005
CIS                               00000003
CITAC_NECINNOSTI1                 00000055
CITAC_NECINNOSTI2                 00000056
CKE                               00000006
CKP                               00000004
CLEAR_BEFFER1__CLEAR              00000E38
CLEAR_BEFFER2__CLEAR              000002F4
CLEAR_BUFFER1                     00000E32
CLEAR_BUFFER2                     000002EE
CLUSTER1                          0000003C
CLUSTER2                          0000003D
CLUSTER3                          0000003E
CLUSTER4                          0000003F
CLUSTER_SIZE                      0000004C
CLUSTER_TO_LBA                    000003BC
CLUSTER_TO_LBA_NO_ROOT            000003E0
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON                             0000009C
CMIE                              00000006
CMIF                              00000006
COMMAND                           0000002D
COMPARE_B1_B2_BUFF1               00000E28
COMPARE_B1_B2_BUFF2               00000E2D
COMPARE_B1_B2_BYT10               00000E05
COMPARE_B1_B2_BYT11               00000E0F
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 167


SYMBOL TABLE
  LABEL                             VALUE 

COMPARE_B1_B2_BYT12               00000E19
COMPARE_B1_B2_BYT2                00000DB5
COMPARE_B1_B2_BYT3                00000DBF
COMPARE_B1_B2_BYT4                00000DC9
COMPARE_B1_B2_BYT5                00000DD3
COMPARE_B1_B2_BYT6                00000DDD
COMPARE_B1_B2_BYT7                00000DE7
COMPARE_B1_B2_BYT8                00000DF1
COMPARE_B1_B2_BYT9                00000DFB
COMPARE_B1_B2_SHODNE              00000E23
COMPARE_BUFF1_BUFF2               00000DA2
COMPARE_BUFF2_L_H                 00000D8F
CREN                              00000004
CSRC                              00000007
CTI_TABULKU                       00001DEC
CVR0                              00000000
CVR1                              00000001
CVR2                              00000002
CVR3                              00000003
CVRCON                            0000009D
CVREN                             00000007
CVROE                             00000006
CVRR                              00000005
D                                 00000005
DALSI_SKLADBA                     000000FF
DALSI_SKLADBA_MAME_SOUBOR         00000168
DALSI_SKLADBA_NO_R_S              00000139
DALSI_SKLADBA_PLAY                00000185
DALSI_SKLADBA_REPAT_SOUBORU       00000109
DATA_ADDRESS                      00000005
DATA_H                            00000021
DATA_L                            00000020
DATA_PORT_HIGH                    00000008
DATA_PORT_HIGH_TRIS               00000088
DATA_PORT_LOW                     00000006
DATA_PORT_LOW_TRIS                00000086
DC                                00000001
DEKREMENTUJ                       000005B5
DEKREMENTUJ_KONEC                 000005C2
DELAY_200ms                       00000235
DELAY_25us                        000003B1
DELAY_2ms                         0000022C
DELAY_5us                         00000914
DEVICE                            0000002B
DEVICE_C                          00000023
DRDY                              00000006
DRQ                               00000003
D_A                               00000005
D_COMMAND                         00000027
D_DATA_R                          00000020
D_DEVICE                          00000026
D_DEVICE_C                        0000001E
D_ERROR                           00000021
D_FEATURES                        00000021
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 168


SYMBOL TABLE
  LABEL                             VALUE 

D_LBA1                            00000023
D_LBA2                            00000024
D_LBA3                            00000025
D_SECTOR_C                        00000022
D_STATUS                          00000027
D_STATUS_A                        0000001E
EEADR                             0000010D
EEADRH                            0000010F
EECON1                            0000018C
EECON2                            0000018D
EEDATA                            0000010C
EEDATH                            0000010E
EEIE                              00000004
EEIF                              00000004
EEPGD                             00000007
END_OF_INTERRUPT                  00000224
ERR                               00000000
ERROR_LED                         ATA_ADDRESS,3
F                                 00000001
FAT32_LOAD                        00000004
FEATURES                          00000024
FERR                              00000002
FILE_INFO                         00000C36
FILE_INFO__CTI20_KONEC            00000CA9
FILE_INFO__DIR                    00000C7A
FILE_INFO__FILE                   00000C7C
FILE_INFO__READ_NAME              00000C3E
FILE_SIZE                         00000CB1
FRAGMENT1                         00000051
FRAGMENT2                         00000052
FSR                               00000004
GCEN                              00000007
GIE                               00000007
GO                                00000002
GO_DONE                           00000002
HLEDEJ                            00000CCE
HLEDEJVNAD_CLUSTER                00000F61
HLEDEJVNAD_KONEC                  00000FB5
HLEDEJVNAD_SECTOR                 00000F62
HLEDEJVNAD_ZAZNAM                 00000F6C
HLEDEJ_ELSE1                      00000CF0
HLEDEJ_ELSE3                      00000D3D
HLEDEJ_ENDIF3                     00000D43
HLEDEJ_END_REPEAT                 00000D44
HLEDEJ_HLEDANI                    00000D0E
HLEDEJ_IF2_ENDIF                  00000D08
HLEDEJ_IF4                        00000D3B
HLEDEJ_KONEC                      00000D5F
HLEDEJ_NEHLEDAME_PRVNI            00000CF8
HLEDEJ_REPEAT                     00000D13
HLEDEJ_V_NADRAZENEM               00000F2F
HL_ADR_CL1                        0000005A
HL_ADR_CL2                        0000005B
HL_ADR_CL3                        0000005C
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 169


SYMBOL TABLE
  LABEL                             VALUE 

HL_ADR_CL4                        0000005D
HL_PARAMETRY                      00000059
HOB                               00000007
I2C_DATA                          00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
IBF                               00000007
IBOV                              00000005
IDENTIFY_DEVICE                   00000366
IF2                               00000D05
INDF                              00000000
INDF_BANK_0                       
INDF_BANK_1                       
INDF_BANK_2                       
INDF_BANK_3                       
INIT_ATA__DALSI                   0000039D
INIT_ATA__DALSI2                  000003A7
INIT_ATA__NOT_SUPPORT_LBA48       0000039A
INIT_CONFIG                       000001AA
INIT_PORT                         00000197
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTERRUPT                         00000205
INTERRUPT_TIMER1                  0000020A
INTERRUPT_USART                   00000218
INTF                              00000001
IRP                               00000007
KONST_NECINNOSTI1                 00000057
KONST_NECINNOSTI2                 00000058
LBA1                              00000027
LBA2                              00000028
LBA3                              00000029
LBA4                              0000002A
LBA48_SUPPORT                     00000002
LBA_SUPPORT                       00000001
LONG_NAME                         00000EA5
LONG_NAME_ELSE1                   00000EB8
LONG_NAME_ELSE2                   00000F1C
LONG_NAME_ENDIF1                  00000EBE
LONG_NAME_ENDIF2                  00000F23
LONG_NAME_ENDWHILE                00000F29
LONG_NAME_IF2                     00000EE4
LONG_NAME_MIMO_ROZSAH             00000F2C
LONG_NAME_NASOBENI                00000EE9
LONG_NAME_WHILE                   00000EBE
MP3_BSYNC                         MP3_PORT,2
MP3_CS                            MP3_PORT,1
MP3_DREQ                          MP3_PORT,0
MP3_NOT_PLAY                      000000FE
MP3_PORT                          00000007
MP3_PORT_TRIS                     00000087
MP3_REWIND_FORWARD                000000D0
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 170


SYMBOL TABLE
  LABEL                             VALUE 

MP3_SCLK                          MP3_PORT,3
MP3_SI                            MP3_PORT,5
MP3_SO                            MP3_PORT,4
NACTI_FAT32                       000010E7
NACTI_FAT32__KONEC                000011D2
NEXT_CLUSTER                      0000041F
NEXT_CLUSTER_KONEC                000004A4
NEXT_CLUSTER_NEPRAZDNY            0000048D
NEXT_CLUSTER_NO_ROOT              00000443
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BO                            00000000
NOT_BOR                           00000000
NOT_DONE                          00000002
NOT_MP3_REWIND_FORWARD            000000DC
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RC8                           00000006
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_TX8                           00000006
NOT_W                             00000002
NOT_WRITE                         00000002
NULA                              00000672
OBF                               00000006
ODESLI_BUFF2_HIGH                 000001F1
ODESLI_BUFF2_HIGH_ODESILANI       000001F4
ODESLI_BUFFER2                    000001FB
ODESLI_BUFFER2_ODESILANI          000001FE
ODESLI_DATA                       000001D8
ODESLI_MODEL_NUMBER               000001E0
ODESLI_MODEL_NUMBER_ODESILANI     000001E5
OERR                              00000001
OPERAND_X1                        000000A0
OPERAND_X2                        000000A1
OPERAND_X3                        000000A2
OPERAND_X4                        000000A3
OPERAND_Y1                        000000A4
OPERAND_Y2                        000000A5
OPERAND_Y3                        000000A6
OPERAND_Y4                        000000A7
OPTION_REG                        00000081
P                                 00000004
PARAM_SLOV_V_SEKTORU1             00000033
PARAM_SLOV_V_SEKTORU2             00000034
PCFG0                             00000000
PCFG1                             00000001
PCFG2                             00000002
PCFG3                             00000003
PCL                               00000002
PCLATH                            0000000A
PCON                              0000008E
PEIE                              00000006
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 171


SYMBOL TABLE
  LABEL                             VALUE 

PEN                               00000002
PIE1                              0000008C
PIE2                              0000008D
PIR1                              0000000C
PIR2                              0000000D
POCATEK_DAT1                      00000040
POCATEK_DAT2                      00000041
POCATEK_DAT3                      00000042
POCATEK_DAT4                      00000043
POCATEK_FAT1                      00000044
POCATEK_FAT2                      00000045
POCATEK_FAT3                      00000046
POCATEK_FAT4                      00000047
PORTA                             00000005
PORTB                             00000006
PORTC                             00000007
PORTD                             00000008
PORTE                             00000009
POSUNDOLEVA                       000005C5
POSUNDOLEVA_1                     000005CB
POSUNDOLEVA_2                     000005D3
POSUNDOLEVA_3                     000005DC
POSUNDOLEVA_4                     000005E6
POSUNDOLEVA_5                     000005F1
POSUNDOLEVA_6                     000005FD
POSUNDOLEVA_7                     0000060A
POSUNDOPRAVA                      00000618
POSUNDOPRAVA_1                    0000061E
POSUNDOPRAVA_2                    00000627
POSUNDOPRAVA_3                    00000631
POSUNDOPRAVA_4                    0000063C
POSUNDOPRAVA_5                    00000648
POSUNDOPRAVA_6                    00000655
POSUNDOPRAVA_7                    00000663
POZICE                            0000003B
PR2                               00000092
PREH_ADR_CL1                      00000062
PREH_ADR_CL2                      00000063
PREH_ADR_CL3                      00000064
PREH_ADR_CL4                      00000065
PREH_CITAC_PREV                   00000068
PREH_DATA_CL1                     00000069
PREH_DATA_CL2                     0000006A
PREH_DATA_CL3                     0000006B
PREH_DATA_CL4                     0000006C
PREH_DATA_POZICE                  0000006D
PREH_D_FRAGMENT1                  00000053
PREH_D_FRAGMENT2                  00000054
PREH_STAV0                        0000006E
PREH_STAV1                        0000006F
PREH_ZAZNAM1                      00000066
PREH_ZAZNAM2                      00000067
PRESKOC                           000002D8
PRETECENI                         000000AC
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 172


SYMBOL TABLE
  LABEL                             VALUE 

PRIJATE_DATO                      00000074
PRIJATYCH_DAT                     00000073
PRIKAZ_02h                        0000091E
PRIKAZ_02h__ODESILANI_ODDILU      00000934
PRIKAZ_03h                        0000093F
PRIKAZ_04h                        0000095D
PRIKAZ_05h                        0000096A
PRIKAZ_05h_KONEC                  00000992
PRIKAZ_05h_PAR1_NOT_OK            0000097E
PRIKAZ_05h_PAR1_OK                00000984
PRIKAZ_05h_PAR2_NOT_OK            0000098B
PRIKAZ_05h_PAR2_OK                00000991
PRIKAZ_06h                        0000099B
PRIKAZ_07h                        000009BD
PRIKAZ_07h__ODESLI_SECTOR         000009D9
PRIKAZ_08h                        000009E4
PRIKAZ_08h_KONEC                  00000A07
PRIKAZ_08h_PAR1_NOT_OK            000009F8
PRIKAZ_08h_PAR1_OK                000009FB
PRIKAZ_08h_PAR2_NOT_OK            00000A02
PRIKAZ_08h_PAR2_OK                00000A05
PRIKAZ_09h                        00000A12
PRIKAZ_09h_KONEC                  00000A3C
PRIKAZ_09h_SPATNY_PAR             00000A36
PRIKAZ_0Ah                        00000A45
PRIKAZ_0Ah_KONEC                  00000A68
PRIKAZ_0Ah_PAR1_NOT_OK            00000A5D
PRIKAZ_0Ah_PAR1_OK                00000A63
PRIKAZ_0Bh                        000011D3
PRIKAZ_0Ch                        000011F5
PRIKAZ_0Ch_JEROOT                 0000121E
PRIKAZ_0Ch_NENI_ZACATEK_ADR       0000121C
PRIKAZ_0Ch_ODESLI                 0000121F
PRIKAZ_0Dh                        00001239
PRIKAZ_0Dh_KONEC                  0000124F
PRIKAZ_0Dh_OKAMZITE               0000124D
PRIKAZ_80h                        00000A73
PRIKAZ_80h_KONEC                  00000AD4
PRIKAZ_80h_PAR1_NOT_OK            00000A87
PRIKAZ_80h_PAR1_OK                00000A8D
PRIKAZ_80h_PAR2_NOT_OK            00000A94
PRIKAZ_80h_PAR2_OK                00000A9A
PRIKAZ_81h                        00000ADF
PRIKAZ_82h                        00000AFE
PRIKAZ_83h                        00000B14
PRIKAZ_84h                        00000B48
PRIKAZ_85h                        00001257
PRIKAZ_85h_KONEC                  000012B2
PRIKAZ_85h_SPATNY_PARAMETR        00001292
PRIKAZ_85h_VYPNI                  00001299
PROG_PAGE_0                       
PROG_PAGE_1                       
PROG_PAGE_2                       
PROG_PAGE_3                       
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 173


SYMBOL TABLE
  LABEL                             VALUE 

PRVNI_CL_ADRESARE                 00000B7C
PRVNI_CL_ADRESARE_KONEC           00000BB5
PRVNI_CL_ADRESARE_MEZERY          00000B9C
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PSPIE                             00000007
PSPIF                             00000007
PSPMODE                           00000004
R                                 00000002
RBIE                              00000003
RBIF                              00000000
RC8_9                             00000006
RC9                               00000006
RCD8                              00000000
RCEN                              00000003
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
RD_DEVICE                         0000025A
RD_ERROR                          00000246
RD_LBA1                           0000024E
RD_LBA2                           00000252
RD_LBA3                           00000256
RD_SC                             0000024A
RD_STATUS                         00000242
READ_DATA                         000002B8
READ_DATA_CTEME                   000002C1
READ_SECTOR                       00000315
READ_SECTOR_LBA27                 00000326
READ_SECTOR_LBA48                 00000335
READ_WRITE                        00000002
ROOT_DIR_CL1                      00000048
ROOT_DIR_CL2                      00000049
ROOT_DIR_CL3                      0000004A
ROOT_DIR_CL4                      0000004B
ROZDIL                            00000589
RP0                               00000005
RP1                               00000006
RSEN                              00000001
RUTR                              00000295
RUTW                              000002A2
RX9                               00000006
RX9D                              00000000
R_W                               00000002
S                                 00000003
SCAN_BR                           0000100A
SCAN_MBR                          00001000
SCAN_MBR__HLEDEJ_ROZSIRENY_ODDIL  0000105B
SCAN_MBR__KONEC                   00001089
SECTOR_C                          00000026
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 174


SYMBOL TABLE
  LABEL                             VALUE 

SELECT_DEVICE                     000002DC
SEN                               00000000
SEND_MP3_DATA                     000000C1
SEND_MP3_WORD                     000000ED
SKOC_NA_ZAZNAM                    00000BB6
SKOC_NA_ZAZNAM_KONEC              00000C35
SKOC_NA_ZAZNAM_MAME_CL            00000C14
SKOC_NA_ZAZNAM_MAME_ZAZNAM        00000C30
SKOC_NA_ZAZNAM_MIMO_ROZSAH        00000C33
SKOC_NA_ZAZNAM_PRESKOC_CL         00000BE6
SMP                               00000007
SOUCET                            0000055D
SPBRG                             00000099
SPEN                              00000007
SREN                              00000005
SRST                              00000002
SSPADD                            00000093
SSPBUF                            00000013
SSPCON                            00000014
SSPCON2                           00000091
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPOV                             00000006
SSPSTAT                           00000094
STANDBY                           00000005
START                             00000010
STATUS                            00000003
STAV_PRIKAZU                      00000075
SYNC                              00000004
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1INSYNC                          00000002
T1OSCEN                           00000003
T1SYNC                            00000002
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TEMP1                             00000036
TEMP2                             00000037
TEMP3                             00000038
TEMP4                             00000039
TEMP5                             0000003A
TEMPW                             00000035
TEMP_FSR                          00000072
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 175


SYMBOL TABLE
  LABEL                             VALUE 

TEMP_PCLATH                       00000076
TEMP_STATUS                       00000071
TEMP_WORKING                      00000070
TMP0                              00000038
TMP1                              00000036
TMP2                              00000037
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000085
TRISB                             00000086
TRISC                             00000087
TRISD                             00000088
TRISE                             00000089
TRISE0                            00000000
TRISE1                            00000001
TRISE2                            00000002
TRMT                              00000001
TX8_9                             00000006
TX9                               00000006
TX9D                              00000000
TXD8                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
UA                                00000001
VSADDR_AIADDR                     0000000A
VSADDR_AICTRL0                    0000000D
VSADDR_AICTRL1                    0000000E
VSADDR_AUDATA                     00000005
VSADDR_CLOCKF                     00000003
VSADDR_DECODE_TIME                00000004
VSADDR_HDAT0                      00000008
VSADDR_HDAT1                      00000009
VSADDR_MODE                       00000000
VSADDR_STATUS                     00000001
VSADDR_VOL                        0000000B
VSADDR_WRAM                       00000006
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 176


SYMBOL TABLE
  LABEL                             VALUE 

VSADDR_WRAMADDR                   00000007
VSREG_MODE_L                      0000004D
VSREG_STATUS_L                    0000004E
VSREG_VOL_H                       00000050
VSREG_VOL_L                       0000004F
VS_BEEP                           000008F3
VS_END_BEEP                       000008E1
VS_INIT                           00000905
VS_LOAD_PLUGIN                    00001DF0
VS_LOAD_PLUGIN_LOAD               00001DFF
VS_LOUDNESS                       0000002F
VS_RD_BYTE                        00000835
VS_RD_REG                         00000871
VS_SEND_1024_NULL                 000008CF
VS_SEND_32_NULL                   000008C7
VS_SET_VOLUME                     000008D6
VS_SOFT_RESET                     00000894
VS_SOFT_RESET_NO_PLUG             0000087F
VS_WR_BYTE                        00000800
VS_WR_REG                         00000863
VYHOVUJE_ZAZNAM                   00000D6D
VYHOV_ZAZ_ALL_FILES               00000D7D
VYHOV_ZAZ_ONLY_ADR                00000D83
VYHOV_ZAZ_ONLY_MP3                00000D80
VYHOV_ZAZ_SOUBiADR                00000D86
VYHOV_ZAZ_SOUBiADR_MP3            00000D8A
VYSLEDEK1                         000000A8
VYSLEDEK2                         000000A9
VYSLEDEK3                         000000AA
VYSLEDEK4                         000000AB
W                                 00000000
WAIT_FOR_READY                    000003B6
WAIT_FOR_VSDREQ                   000008DE
WCOL                              00000007
WR                                00000001
WREN                              00000002
WRERR                             00000003
WR_BLOCK                          00000286
WR_COMMAND                        00000263
WR_DC                             0000025E
WR_DEVICE                         0000027C
WR_FEATURES                       00000281
WR_LBA1                           0000026D
WR_LBA2                           00000272
WR_LBA3                           00000277
WR_SC                             00000268
WR_USART                          000001D0
Z                                 00000002
ZAPIS_C_ZAZNAMU                   00000D60
ZAPIS_DO_BUFFERU_1                000002E0
ZAPIS_DO_BUFFERU_1__ZAPIS         000002E3
ZAZNAM1                           00000060
ZAZNAM2                           00000061
ZAZNAMU_vBUFFERU_DISKU            0000005E
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 177


SYMBOL TABLE
  LABEL                             VALUE 

ZJISTI_FRAGMENT                   000004A7
ZJISTI_FRAGMENT_CLUSTER           000004EC
ZJISTI_FRAGMENT_CTI_SECTOR        000004E8
ZJISTI_FRAGMENT_INC_KONEC         00000557
ZJISTI_FRAGMENT_KONEC             0000055A
ZJISTI_FRAGMENT_NEPRAZDNY         00000504
ZKONTROLUJ_ODDIL_FAT32            0000108A
ZKONTROLUJ_ODDIL_FAT32__JMENOVKA  000010B1
ZKONTROLUJ_ODDIL_FAT32__KONEC     000010E6
_BODEN_OFF                        00003FBF
_BODEN_ON                         00003FFF
_CPD_OFF                          00003FFF
_CPD_ON                           00003EFF
_CP_ALL                           00001FFF
_CP_OFF                           00003FFF
_DEBUG_OFF                        00003FFF
_DEBUG_ON                         000037FF
_HS_OSC                           00003FFE
_LP_OSC                           00003FFC
_LVP_OFF                          00003F7F
_LVP_ON                           00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC                           00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_WRT_1FOURTH                      00003BFF
_WRT_256                          00003DFF
_WRT_HALF                         000039FF
_WRT_OFF                          00003FFF
_XT_OSC                           00003FFD
__16F877A                         00000001
nEIN                              00000001


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)

0000 : X---XXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0180 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
01C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0200 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0240 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 178


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)


0280 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
02C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0300 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0340 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0380 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
03C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0400 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0440 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0480 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
04C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0500 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0540 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0580 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
05C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0600 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0640 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0680 : XXXXX----------- ---------------- ---------------- ----------------
0800 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0840 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0880 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
08C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0900 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0940 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0980 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
09C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0A00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0A40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0A80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0AC0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0B00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0B40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0B80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0BC0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0C00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0C40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0C80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0CC0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0D00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0D40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0D80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0DC0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0E00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0E40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0E80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0EC0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0F00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0F40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
MPASM  5.02                          MAIN.ASM   5-7-2006  14:54:53         PAGE 179


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)


0F80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXX----------
1000 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
10C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1180 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
11C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1200 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1240 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1280 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXX------------
1800 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1840 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1880 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
18C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1900 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1940 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1980 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
19C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1A00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1A40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1A80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1AC0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1B00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1B40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1B80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1BC0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1C00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1C40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1C80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1CC0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1D00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1D40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1D80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1DC0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
1E00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXX--- ---------------- ----------------
2000 : -------X-------- ---------------- ---------------- ----------------

All other memory blocks unused.

Program Memory Words Used:  5897
Program Memory Words Free:  2295


Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     0 reported,   448 suppressed

